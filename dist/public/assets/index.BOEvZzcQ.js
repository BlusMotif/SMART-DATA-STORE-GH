var $l=Object.defineProperty;var Ol=(s,a,t)=>a in s?$l(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t;var ia=(s,a,t)=>Ol(s,typeof a!="symbol"?a+"":a,t);import{c as Bl,Q as ql,r as o,t as Ul,b as zl,j as e,V as Ha,R as Va,e as Tt,A as Ya,C as Qa,X as Ms,T as Xa,D as Ja,P as _l,f as Za,g as Gl,S as er,u as Fs,h as V,L as Q,i as Oe,k as ca,l as os,m as pa,W as Wl,n as Ke,o as js,M as Kl,B as Jt,E as nt,p as Hl,q as Vl,s as sr,v as Na,w as tr,x as Yl,y as ar,I as rr,F as lr,G as nr,H as Bt,J as ir,K as cr,N as dr,O as or,U as Ql,Y as Xl,Z as mr,$ as xr,a0 as hr,a1 as Zt,a2 as ur,a3 as ea,a4 as pr,a5 as sa,a6 as ta,a7 as jr,a8 as gr,a9 as fr,aa as Nr,ab as br,ac as Jl,ad as ja,ae as vr,af as lt,ag as wr,ah as G,ai as Zl,aj as Se,ak as it,al as pe,am as aa,an as zs,ao as qt,ap as Us,aq as en,ar as sn,as as tn,at as ze,au as Gt,av as be,aw as is,ax as Mt,ay as es,az as Le,aA as ra,aB as yr,aC as an,aD as ct,aE as kr,aF as rn,aG as ln,aH as nn,aI as Z,aJ as gs,aK as Ft,aL as Pt,aM as Js,aN as Zs,aO as fs,aP as la,aQ as It,aR as Sr,aS as Pr,aT as Cr,aU as cn,aV as Ar,aW as dn,aX as na,aY as Tr,aZ as Fr,a_ as Ir,a$ as on,b0 as Dr,b1 as mn,b2 as Er,b3 as Rr,b4 as xn,b5 as hn,b6 as Lr,b7 as un,b8 as pn,b9 as Dt,ba as re,bb as jn,bc as Me,bd as Mr,be as $r,bf as _s,bg as ge,bh as Or,bi as gn,bj as fn,bk as Br,bl as Nn,bm as bn,bn as qr,bo as vn,bp as Ns,bq as $t,br as hs,bs as Ts,bt as Es,bu as et,bv as Rs,bw as vs,bx as Ls,by as ys,bz as Ur,bA as zr,bB as _r,bC as Gr,bD as Wr,bE as Kr,bF as Hr,bG as as,bH as yt,bI as Et,bJ as wn,bK as yn,bL as kn,bM as Sn,bN as St,bO as Vr,bP as Yr,bQ as ga,bR as Ss,bS as Ct,bT as Pn,bU as Qr,bV as Cn,bW as Xr,bX as An,bY as Jr,bZ as Zr,b_ as el,b$ as sl,c0 as tl,c1 as Tn,c2 as Fn,c3 as De,c4 as Da,c5 as ba,c6 as al,c7 as rl,c8 as va,c9 as In,ca as Dn,cb as En,cc as Rn,cd as Ln,ce as Mn,cf as da,cg as $n,ch as On,ci as Bn,cj as qn,ck as Un,cl as zn}from"./vendor.PqpJQWnW.js";import{E as _n}from"./vendor_jspdf.BGMLdZEF.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(l){if(l.ep)return;l.ep=!0;const r=t(l);fetch(l.href,r)}})();const Ea="https://jddstfppigucldetsxws.supabase.co",Gn="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkZHN0ZnBwaWd1Y2xkZXRzeHdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MTQ1MDUsImV4cCI6MjA4MTM5MDUwNX0.MwvCy45DluqdocUkkEhZ3QoGsQfYC30XGzbILT_JGgk";let Vt=null;if(!Vt){Vt=Bl(Ea,Gn,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:window.localStorage}});const s=`sb-${Ea.split("//")[1].split(".")[0]}-auth-token`,a=localStorage.getItem(s);if(a)try{const t=JSON.parse(a);(!t.access_token||t.expires_at&&t.expires_at*1e3<Date.now())&&(console.warn("Clearing expired session data"),localStorage.removeItem(s))}catch{console.warn("Clearing invalid session data"),localStorage.removeItem(s)}Vt.auth.onAuthStateChange(async(t,n)=>{t==="SIGNED_OUT"&&!n&&(console.log("User signed out, clearing local storage"),localStorage.removeItem(s))})}const Ds=Vt;let rt=null,wt=null;async function ll(s){try{const a=await s.text();if(!a)return s.statusText;try{const t=JSON.parse(a);return t.error||t.message||a}catch{return a}}catch{return s.statusText}}async function nl(){var a;const s=Date.now();if(rt&&wt&&s<wt)return rt?{Authorization:`Bearer ${rt}`}:{};try{const{data:t,error:n}=await Ds.auth.getSession();if(n)return console.warn("Session error in getAuthHeaders:",n),rt=null,wt=null,{};const l=(a=t.session)==null?void 0:a.access_token;return rt=l||null,wt=l?s+5*60*1e3:null,l?{Authorization:`Bearer ${l}`}:{}}catch(t){return console.error("Failed to get session in getAuthHeaders:",t),rt=null,wt=null,{}}}function Wn(){rt=null,wt=null}async function Y(s,a,t){const n=await nl(),r=a.startsWith("http")?a:`${a}`,c=await fetch(r,{method:s,headers:{"Content-Type":"application/json",...n},body:t?JSON.stringify(t):void 0,credentials:"include"});if(!c.ok){const d=await ll(c);throw new Error(d)}return c.json()}const Kn=({on401:s})=>async({queryKey:a})=>{const t=await nl(),n="",l=a[0],r=l.startsWith("http")?l:`${n}${l}`,c=await fetch(r,{headers:{...t},credentials:"include"});if(c.status,!c.ok){const d=await ll(c);throw new Error(d)}return c.json()},ke=new ql({defaultOptions:{queries:{queryFn:Kn({on401:"throw"}),staleTime:60*1e3,gcTime:5*60*1e3,retry:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1},mutations:{retry:!1}}}),Hn=1,Vn=1e6;let oa=0;function Yn(){return oa=(oa+1)%Number.MAX_SAFE_INTEGER,oa.toString()}const ma=new Map,Ra=s=>{if(ma.has(s))return;const a=setTimeout(()=>{ma.delete(s),Ot({type:"REMOVE_TOAST",toastId:s})},Vn);ma.set(s,a)},Qn=(s,a)=>{switch(a.type){case"ADD_TOAST":return{...s,toasts:[a.toast,...s.toasts].slice(0,Hn)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(t=>t.id===a.toast.id?{...t,...a.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=a;return t?Ra(t):s.toasts.forEach(n=>{Ra(n.id)}),{...s,toasts:s.toasts.map(n=>n.id===t||t===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return a.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(t=>t.id!==a.toastId)}}},Yt=[];let Qt={toasts:[]};function Ot(s){Qt=Qn(Qt,s),Yt.forEach(a=>{a(Qt)})}function Xn({...s}){const a=Yn(),t=l=>Ot({type:"UPDATE_TOAST",toast:{...l,id:a}}),n=()=>Ot({type:"DISMISS_TOAST",toastId:a});return Ot({type:"ADD_TOAST",toast:{...s,id:a,open:!0,onOpenChange:l=>{l||n()}}}),{id:a,dismiss:n,update:t}}function he(){const[s,a]=o.useState(Qt);return o.useEffect(()=>(Yt.push(a),()=>{const t=Yt.indexOf(a);t>-1&&Yt.splice(t,1)}),[s]),{...s,toast:Xn,dismiss:t=>Ot({type:"DISMISS_TOAST",toastId:t})}}function L(...s){return Ul(zl(s))}const Jn=_l,il=o.forwardRef(({className:s,...a},t)=>e.jsx(Ha,{ref:t,className:L("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...a}));il.displayName=Ha.displayName;const Zn=Tt("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-white text-black dark:bg-black dark:text-white",destructive:"destructive group border-destructive bg-red-500 text-white dark:bg-red-700 dark:text-white"}},defaultVariants:{variant:"default"}}),cl=o.forwardRef(({className:s,variant:a,...t},n)=>e.jsx(Va,{ref:n,className:L(Zn({variant:a}),s),...t}));cl.displayName=Va.displayName;const ei=o.forwardRef(({className:s,...a},t)=>e.jsx(Ya,{ref:t,className:L("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...a}));ei.displayName=Ya.displayName;const dl=o.forwardRef(({className:s,...a},t)=>e.jsx(Qa,{ref:t,className:L("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...a,children:e.jsx(Ms,{className:"h-4 w-4"})}));dl.displayName=Qa.displayName;const ol=o.forwardRef(({className:s,...a},t)=>e.jsx(Xa,{ref:t,className:L("text-sm font-semibold",s),...a}));ol.displayName=Xa.displayName;const ml=o.forwardRef(({className:s,...a},t)=>e.jsx(Ja,{ref:t,className:L("text-sm opacity-90",s),...a}));ml.displayName=Ja.displayName;function si(){const{toasts:s}=he();return e.jsxs(Jn,{children:[s.map(function({id:a,title:t,description:n,action:l,...r}){return e.jsxs(cl,{...r,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(ol,{children:t}),n&&e.jsx(ml,{children:n})]}),l,e.jsx(dl,{})]},a)}),e.jsx(il,{})]})}const ti=Gl,ai=o.forwardRef(({className:s,sideOffset:a=4,...t},n)=>e.jsx(Za,{ref:n,sideOffset:a,className:L("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",s),...t}));ai.displayName=Za.displayName;const ri={theme:"light",setTheme:()=>null},xl=o.createContext(ri);function li({children:s,defaultTheme:a="light",storageKey:t="clectech-theme",...n}){const[l,r]=o.useState(()=>{try{if(typeof window<"u"&&window.localStorage){const d=localStorage.getItem(t);return d==="system"?(localStorage.setItem(t,"light"),"light"):d||a}return a}catch(d){return console.error("Error accessing localStorage:",d),a}});o.useEffect(()=>{const d=window.document.documentElement;d.classList.remove("light","dark"),d.classList.add(l),console.log("Applied theme:",l,"Classes on root:",d.classList.toString())},[l]);const c={theme:l,setTheme:d=>{try{console.log("Setting theme to:",d),typeof window<"u"&&window.localStorage&&(localStorage.setItem(t,d),console.log("Saved theme to localStorage:",d)),r(d)}catch(x){console.error("Error setting theme:",x),r(d)}}};return e.jsx(xl.Provider,{...n,value:c,children:s})}const Bs=()=>{const s=o.useContext(xl);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s},tt="/assets/logo_1765774201026.DUKIXttw.png",wa=Tt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-yellow-500 dark:text-white text-black shadow-sm hover:shadow-md hover:bg-yellow-600 active:scale-[0.98]",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:shadow-md hover:bg-destructive/90 active:scale-[0.98]",outline:"border border-yellow-500 bg-background text-yellow-700 shadow-sm hover:bg-yellow-50 hover:text-yellow-800 active:scale-[0.98]",secondary:"bg-yellow-400 dark:text-white text-black shadow-sm hover:shadow-md hover:bg-yellow-500 active:scale-[0.98]",ghost:"hover:bg-accent hover:text-accent-foreground active:scale-[0.98]",link:"text-primary underline-offset-4 hover:underline active:scale-[0.98]"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3 text-sm",lg:"h-12 rounded-lg px-8 text-base",xl:"h-14 rounded-lg px-10 text-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),g=o.forwardRef(({className:s,variant:a,size:t,asChild:n=!1,...l},r)=>{const c=n?er:"button";return e.jsx(c,{className:L(wa({variant:a,size:t,className:s})),ref:r,...l})});g.displayName="Button";function ni(){const[s,a]=o.useState(null),[t,n]=o.useState(!1),[l,r]=o.useState(!1),[c,d]=o.useState(!1);o.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches||navigator.standalone===!0?(r(!0),!0):!1)return;const j=localStorage.getItem("pwa-install-dismissed");if(j){const b=parseInt(j,10);if(Date.now()-b<1*60*60*1e3){d(!0);return}}const h=b=>{b.preventDefault(),a(b),n(!0)};window.addEventListener("beforeinstallprompt",h),window.addEventListener("appinstalled",()=>{r(!0),n(!1),a(null)});const f=setTimeout(()=>{!l&&!j&&!t&&(console.log("PWA: Showing install prompt for development/testing"),n(!0))},3e3);return()=>{window.removeEventListener("beforeinstallprompt",h),clearTimeout(f)}},[]);const x=async()=>{if(s){s.prompt();const{outcome:m}=await s.userChoice;m==="accepted"&&r(!0),a(null),n(!1)}else console.log("PWA: No deferred prompt available, attempting manual install"),alert(`To install this app:

1. Click the menu button (â‹®) in your browser
2. Select 'Add to Home screen' or 'Install app'
3. Follow the prompts to install`),n(!1),d(!0),localStorage.setItem("pwa-install-dismissed",Date.now().toString())},p=()=>{d(!0),n(!1),localStorage.setItem("pwa-install-dismissed",Date.now().toString())};return l||c||!t?null:e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-white border-b shadow-md p-3 z-[60]","data-testid":"pwa-install-prompt",children:e.jsxs("div",{className:"container mx-auto max-w-7xl flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg overflow-hidden",children:e.jsx("img",{src:tt,alt:"App Icon",className:"w-full h-full object-contain"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm","data-testid":"text-install-title",children:"Install App"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Install for quick access and offline use."})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(g,{size:"sm",onClick:x,"data-testid":"button-install-app",children:"Install"}),e.jsx(g,{size:"icon",variant:"ghost",onClick:p,"data-testid":"button-close-install",children:e.jsx(Ms,{className:"w-4 h-4"})})]})]})})}function je(){const s=Fs(),[a,t]=o.useState(null),[n,l]=o.useState(!0),[r,c]=o.useState(null),[d,x]=o.useState(null),[p,m]=o.useState(!1),[j,h]=o.useState(!1),[f,b]=o.useState(!1),i=o.useRef(!1);o.useEffect(()=>{let le=!0;Ds.auth.getSession().then(({data:N})=>{le&&(t(N.session),l(!1))});const{data:{subscription:w}}=Ds.auth.onAuthStateChange((N,y)=>{(N==="SIGNED_IN"||N==="TOKEN_REFRESHED")&&t(y),N==="SIGNED_OUT"&&(t(null),s.setQueryData(["/api/auth/me"],{user:null}),s.clear())});return()=>{le=!1,w.unsubscribe()}},[s]),o.useEffect(()=>{!n&&!a&&s.setQueryData(["/api/auth/me"],{user:null})},[a,n,s]);const{data:u,isLoading:F}=V({queryKey:["/api/auth/me"],enabled:!!(a!=null&&a.access_token),retry:!1,refetchOnWindowFocus:!1,staleTime:5*60*1e3,queryFn:async()=>{const le=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${a.access_token}`}});return le.ok?le.json():{user:null}}}),R=(u==null?void 0:u.user)??null,P=u==null?void 0:u.agent,v=!!R,U=n||!!(a!=null&&a.access_token)&&F;return{user:R,agent:P,isAuthenticated:v,isLoading:U,login:async({email:le,password:w})=>{m(!0),c(null);const{error:N}=await Ds.auth.signInWithPassword({email:le.trim(),password:w});return N?(c(N.message),m(!1),{error:N.message}):(s.invalidateQueries({queryKey:["/api/auth/me"]}),m(!1),{success:!0})},register:async({email:le,password:w,name:N})=>{h(!0),x(null);const{error:y}=await Ds.auth.signUp({email:le.trim(),password:w,options:{data:{name:N.trim()}}});return y?(x(y.message),h(!1),{error:y.message}):(s.invalidateQueries({queryKey:["/api/auth/me"]}),h(!1),{success:!0})},logout:async()=>{if(i.current){console.log("Logout already in progress, skipping duplicate call");return}try{i.current=!0,b(!0);const le=setTimeout(()=>{console.warn("Logout taking too long, forcing redirect..."),window.location.href="/"},3e3);s.clear(),Wn(),await Ds.auth.signOut(),t(null),clearTimeout(le),window.location.href="/"}catch(le){console.error("Logout error:",le),s.clear(),t(null),window.location.href="/"}finally{b(!1),i.current=!1}},loginError:r,registerError:d,isLoginLoading:p,isRegisterLoading:j,isLoggingOut:f}}function hl({size:s="md",className:a,text:t}){const n={sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8"};return e.jsxs("div",{className:L("flex flex-col items-center justify-center gap-2",a),children:[e.jsx(Q,{className:L("animate-spin text-primary",n[s])}),t&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t})]})}function ya({text:s="Loading..."}){return e.jsx("div",{className:"flex h-[50vh] items-center justify-center",children:e.jsx(hl,{size:"lg",text:s})})}function us({rows:s=5}){return e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-10 bg-muted rounded"}),Array.from({length:s}).map((a,t)=>e.jsx("div",{className:"h-14 bg-muted/50 rounded"},t))]})}function ue({path:s,component:a,requiredRole:t,requiredRoles:n,fallbackPath:l="/login"}){const{user:r,isLoading:c}=je();return e.jsx(Oe,{path:s,children:d=>!c&&!r?e.jsx(ca,{to:l}):c?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(hl,{size:"lg"})}):t&&r.role!==t?e.jsx(ca,{to:"/"}):n&&!n.includes(r.role)?e.jsx(ca,{to:"/"}):e.jsx(a,{...d})})}const ii=Tt("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),ms=o.forwardRef(({className:s,variant:a,...t},n)=>e.jsx("div",{ref:n,role:"alert",className:L(ii({variant:a}),s),...t}));ms.displayName="Alert";const kt=o.forwardRef(({className:s,...a},t)=>e.jsx("h5",{ref:t,className:L("mb-1 font-medium leading-none tracking-tight",s),...a}));kt.displayName="AlertTitle";const xs=o.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:L("text-sm [&_p]:leading-relaxed",s),...a}));xs.displayName="AlertDescription";const C=o.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:L("rounded-xl border border-border bg-card text-card-foreground shadow-md hover:shadow-lg transition-all duration-200",s),...a}));C.displayName="Card";const $=o.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:L("flex flex-col space-y-2 p-6 pb-4",s),...a}));$.displayName="CardHeader";const B=o.forwardRef(({className:s,...a},t)=>e.jsx("h3",{ref:t,className:L("text-xl font-semibold leading-tight tracking-tight",s),...a}));B.displayName="CardTitle";const J=o.forwardRef(({className:s,...a},t)=>e.jsx("p",{ref:t,className:L("text-sm text-muted-foreground leading-relaxed",s),...a}));J.displayName="CardDescription";const D=o.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:L("p-6 pt-0",s),...a}));D.displayName="CardContent";const ci=o.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:L("flex items-center p-6 pt-0",s),...a}));ci.displayName="CardFooter";class di extends o.Component{constructor(t){super(t);ia(this,"handleReload",()=>{window.location.reload()});ia(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t,errorInfo:null}}componentDidCatch(t,n){console.error("ErrorBoundary caught an error:",t,n),this.setState({error:t,errorInfo:n})}render(){var t;return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs(C,{className:"max-w-2xl w-full",children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"rounded-full bg-red-100 dark:bg-red-900/30 p-3",children:e.jsx(os,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx(B,{className:"text-2xl",children:"Something went wrong"}),e.jsx(J,{className:"mt-1",children:"The application encountered an unexpected error"})]})]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs(ms,{variant:"destructive",children:[e.jsx(os,{className:"h-4 w-4"}),e.jsx(kt,{children:"Error Details"}),e.jsx(xs,{className:"mt-2",children:((t=this.state.error)==null?void 0:t.message)||"An unknown error occurred"})]}),!1,e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please try one of the following options:"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(g,{onClick:this.handleReload,className:"flex items-center gap-2 flex-1",children:[e.jsx(pa,{className:"h-4 w-4"}),"Reload Page"]}),e.jsx(g,{onClick:this.handleReset,variant:"outline",className:"flex-1",children:"Try Again"})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"ðŸ’¡ Tip:"})," If this error persists, try clearing your browser cache or contact support."]})})]})]})]})}):this.props.children}}function oi(){const[s,a]=o.useState(navigator.onLine),[t,n]=o.useState(!1);return o.useEffect(()=>{const l=()=>{a(!0),n(!1)},r=()=>{a(!1),n(!0)};window.addEventListener("online",l),window.addEventListener("offline",r);const c=setInterval(()=>{!navigator.onLine&&s&&(a(!1),n(!0))},3e4);return()=>{window.removeEventListener("online",l),window.removeEventListener("offline",r),clearInterval(c)}},[s]),o.useEffect(()=>{if(s&&t){const l=setTimeout(()=>{n(!1)},3e3);return()=>clearTimeout(l)}},[s,t]),!t&&s?null:e.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-[9999] max-w-md w-full px-4",children:s?e.jsxs(ms,{className:"shadow-lg bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800",children:[e.jsx(os,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),e.jsxs(xs,{className:"ml-2 text-green-800 dark:text-green-200",children:[e.jsx("strong",{children:"Back Online"}),e.jsx("p",{className:"text-xs mt-1",children:"Connection restored successfully."})]})]}):e.jsxs(ms,{variant:"destructive",className:"shadow-lg",children:[e.jsx(Wl,{className:"h-4 w-4"}),e.jsxs(xs,{className:"ml-2",children:[e.jsx("strong",{children:"No Internet Connection"}),e.jsx("p",{className:"text-xs mt-1",children:"You're offline. Some features may not work properly."})]})]})})}const La=5*60*1e3;function mi(){const{logout:s,user:a}=je(),{toast:t}=he(),n=o.useRef(),l=o.useRef(),r=o.useRef(Date.now()),c=o.useRef(0),d=o.useCallback(()=>{const m=Date.now();m-c.current<1e3||(c.current=m,r.current=m,n.current&&clearTimeout(n.current),l.current&&clearTimeout(l.current),a&&(n.current=window.setTimeout(async()=>{try{console.log("Session timeout: Logging out user due to inactivity"),await s()}catch(j){console.error("Session timeout logout error:",j),window.location.href="/login"}},La)))},[a,s,t]),x=o.useCallback(()=>{d()},[d]);return o.useEffect(()=>{if(!a){n.current&&clearTimeout(n.current),l.current&&clearTimeout(l.current);return}d();const m=["mousedown","mousemove","keypress","scroll","touchstart","touchmove","click"];return m.forEach(j=>{document.addEventListener(j,x,!0)}),()=>{m.forEach(j=>{document.removeEventListener(j,x,!0)}),n.current&&clearTimeout(n.current),l.current&&clearTimeout(l.current)}},[a,x,d]),{getTimeUntilLogout:o.useCallback(()=>{if(!a)return null;const m=Date.now()-r.current;return Math.max(0,La-m)},[a]),resetTimer:x}}function xi({children:s}){const[a]=Ke(),{user:t,isLoading:n}=je(),{data:l,isLoading:r}=V({queryKey:["/api/break-settings"],refetchInterval:5*60*1e3,staleTime:4*60*1e3});if((n||r)&&!l&&!t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(a.startsWith("/admin"))return e.jsx(e.Fragment,{children:s});const d=["/login","/register"].includes(a);return(t==null?void 0:t.role)==="admin"||d?e.jsx(e.Fragment,{children:s}):l!=null&&l.isEnabled?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:e.jsxs("div",{className:"max-w-md w-full text-center space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:e.jsx(js,{className:"h-10 w-10 text-red-600 dark:text-red-400"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx(Ms,{className:"h-3 w-3 text-white"})})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:"Site Closed"}),e.jsx("div",{className:"text-muted-foreground whitespace-pre-wrap text-left bg-muted p-4 rounded-lg",children:l.message||"The site is currently closed. Please check back later."})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"We apologize for any inconvenience."})]})}):e.jsx(e.Fragment,{children:s})}const hi=Tt("whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 hover-elevate ",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow-xs",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground shadow-xs",outline:" border [border-color:var(--badge-outline)] shadow-xs"}},defaultVariants:{variant:"default"}});function X({className:s,variant:a,...t}){return e.jsx("div",{className:L(hi({variant:a}),s),...t})}function ui(s){const a=/(https?:\/\/[^\s]+)/g;return s.split(a).map((n,l)=>a.test(n)?e.jsxs("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-flex items-center gap-1",children:[n,e.jsx(nt,{className:"h-3 w-3"})]},l):n)}function pi(){const[s,a]=o.useState(!1),[t,n]=o.useState([]);o.useEffect(()=>{const x=localStorage.getItem("dismissedAnnouncements");x&&n(JSON.parse(x))},[]);const{data:l=[]}=V({queryKey:["announcements"],queryFn:()=>Y("GET","/api/announcements/active"),enabled:!0,staleTime:5*60*1e3,refetchOnWindowFocus:!1});o.useEffect(()=>{if(l.length>0){const x=l.some(p=>!t.includes(p.id));a(x)}},[l,t]);const r=x=>{const p=[...t,x];n(p),localStorage.setItem("dismissedAnnouncements",JSON.stringify(p))},c=()=>{const x=[...t,...l.map(p=>p.id)];n(x),localStorage.setItem("dismissedAnnouncements",JSON.stringify(x)),a(!1)};if(!s||l.length===0)return null;const d=l.filter(x=>!t.includes(x.id));return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-3 md:p-4 bg-black/50 backdrop-blur-sm",children:e.jsx("div",{className:"w-full max-w-2xl max-h-[85vh] md:max-h-[80vh] overflow-y-auto",children:e.jsxs(C,{className:"relative shadow-2xl border-0 bg-white text-black",children:[e.jsx($,{className:"pb-3 md:pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"p-1.5 md:p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full",children:e.jsx(Kl,{className:"h-4 w-4 md:h-5 md:w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(B,{className:"text-xl md:text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Important Announcements"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Stay updated with the latest news"})]})]}),e.jsx(g,{variant:"ghost",size:"sm",onClick:c,className:"h-7 w-7 md:h-8 md:w-8 p-0 hover:bg-gray-100 hover:text-gray-800 text-gray-600 flex-shrink-0",children:e.jsx(Ms,{className:"h-3 w-3 md:h-4 md:w-4"})})]})}),e.jsxs(D,{className:"space-y-3 md:space-y-4",children:[d.map(x=>e.jsx("div",{className:"relative group p-3 md:p-4 rounded-xl border border-gray-200 bg-gradient-to-r from-white to-blue-50/30 hover:shadow-lg transition-all duration-300",children:e.jsxs("div",{className:"flex items-start gap-2 md:gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("div",{className:"p-1 md:p-1.5 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full",children:e.jsx(Jt,{className:"h-3 w-3 md:h-3 md:w-3 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1 md:mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm md:text-base truncate",children:x.title}),e.jsx(X,{variant:"secondary",className:"text-xs md:text-sm bg-blue-100 text-blue-700 border-blue-200 px-1.5 py-0.5 flex-shrink-0",children:"New"})]}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>r(x.id),className:"flex-shrink-0 h-6 w-6 md:h-6 md:w-6 p-0 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity hover:bg-gray-200 text-gray-500 hover:text-gray-800",title:"Dismiss this announcement",children:e.jsx(Ms,{className:"h-3 w-3"})})]}),e.jsx("div",{className:"text-sm md:text-base text-gray-700 leading-relaxed whitespace-pre-wrap",children:ui(x.message)}),e.jsx("div",{className:"mt-2 md:mt-3 text-xs md:text-sm text-gray-500",children:new Date(x.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})})]})]})},x.id)),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center pt-3 md:pt-4 border-t border-gray-200 gap-3 sm:gap-0",children:[e.jsxs("p",{className:"text-xs md:text-sm text-gray-500",children:[d.length," announcement",d.length!==1?"s":""," remaining"]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:c,className:"hover:bg-gray-100 text-gray-700 border-gray-300 text-xs md:text-sm h-8 md:h-9 px-3 md:px-4 flex-1 sm:flex-initial",children:"Dismiss All"}),e.jsx(g,{onClick:c,size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white border-0 text-xs md:text-sm h-8 md:h-9 px-3 md:px-4 flex-1 sm:flex-initial",children:"Got it!"})]})]})]})]})})})}function Ne(){const{theme:s,setTheme:a}=Bs(),t=()=>{const n=s==="light"?"dark":"light";console.log("Theme toggle clicked. Current theme:",s,"New theme:",n),a(n)};return e.jsxs(g,{variant:"ghost",size:"sm",onClick:t,"data-testid":"button-theme-toggle",className:"h-8 w-8",children:[s==="light"?e.jsx(Hl,{className:"h-4 w-4 transition-all"}):e.jsx(Vl,{className:"h-4 w-4 transition-all"}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}const ji=Ql,gi=Xl,fi=o.forwardRef(({className:s,inset:a,children:t,...n},l)=>e.jsxs(sr,{ref:l,className:L("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",s),...n,children:[t,e.jsx(Na,{className:"ml-auto"})]}));fi.displayName=sr.displayName;const Ni=o.forwardRef(({className:s,...a},t)=>e.jsx(tr,{ref:t,className:L("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...a}));Ni.displayName=tr.displayName;const ul=o.forwardRef(({className:s,sideOffset:a=4,...t},n)=>e.jsx(Yl,{children:e.jsx(ar,{ref:n,sideOffset:a,className:L("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...t})}));ul.displayName=ar.displayName;const Xt=o.forwardRef(({className:s,inset:a,...t},n)=>e.jsx(rr,{ref:n,className:L("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",s),...t}));Xt.displayName=rr.displayName;const bi=o.forwardRef(({className:s,children:a,checked:t,...n},l)=>e.jsxs(lr,{ref:l,className:L("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:t,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(nr,{children:e.jsx(Bt,{className:"h-4 w-4"})})}),a]}));bi.displayName=lr.displayName;const vi=o.forwardRef(({className:s,children:a,...t},n)=>e.jsxs(ir,{ref:n,className:L("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(nr,{children:e.jsx(cr,{className:"h-2 w-2 fill-current"})})}),a]}));vi.displayName=ir.displayName;const wi=o.forwardRef(({className:s,inset:a,...t},n)=>e.jsx(dr,{ref:n,className:L("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",s),...t}));wi.displayName=dr.displayName;const pl=o.forwardRef(({className:s,...a},t)=>e.jsx(or,{ref:t,className:L("-mx-1 my-1 h-px bg-muted",s),...a}));pl.displayName=or.displayName;const Ut=o.forwardRef(({className:s,...a},t)=>e.jsx(mr,{ref:t,className:L(`
      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10
      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,s),...a}));Ut.displayName=mr.displayName;const yi=o.forwardRef(({className:s,...a},t)=>e.jsx(xr,{ref:t,className:L("aspect-square h-full w-full",s),...a}));yi.displayName=xr.displayName;const zt=o.forwardRef(({className:s,...a},t)=>e.jsx(hr,{ref:t,className:L("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a}));zt.displayName=hr.displayName;const He=jr,Is=gr,ki=ur,jl=o.forwardRef(({className:s,...a},t)=>e.jsx(Zt,{className:L("fixed inset-0 z-40 bg-black/50 dark:bg-white/20 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:t}));jl.displayName=Zt.displayName;const Si=Tt("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),qe=o.forwardRef(({side:s="right",className:a,children:t,...n},l)=>e.jsxs(ki,{children:[e.jsx(jl,{}),e.jsxs(ea,{ref:l,className:L(Si({side:s}),a),...n,children:[t,e.jsxs(pr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(Ms,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));qe.displayName=ea.displayName;const Ve=o.forwardRef(({className:s,...a},t)=>e.jsx(sa,{ref:t,className:L("text-lg font-semibold text-foreground",s),...a}));Ve.displayName=sa.displayName;const Ye=o.forwardRef(({className:s,...a},t)=>e.jsx(ta,{ref:t,className:L("text-sm text-muted-foreground",s),...a}));Ye.displayName=ta.displayName;const Gs="resellershubprogh",Xs=[{id:"mtn",name:"MTN",color:"#FFCC00",textColor:"#000000"},{id:"telecel",name:"TELECEL",color:"#E60000",textColor:"#FFFFFF"},{id:"at_bigtime",name:"AT Bigtime",color:"#FF0000",textColor:"#FFFFFF"},{id:"at_ishare",name:"AT ishare",color:"#FF0000",textColor:"#FFFFFF"}],ka=[{id:"bece",name:"BECE",description:"Basic Education Certificate Examination"},{id:"wassce",name:"WASSCE",description:"West African Senior School Certificate Examination"}],gl={pending:{label:"Pending",color:"bg-orange-500 text-white"},approved:{label:"Approved",color:"bg-blue-500 text-white"},rejected:{label:"Rejected",color:"bg-red-500 text-white"},paid:{label:"Paid",color:"bg-green-500 text-white"}},ae=s=>{const a=typeof s=="string"?parseFloat(s):s;return new Intl.NumberFormat("en-GH",{style:"currency",currency:"GHS",minimumFractionDigits:2}).format(a)},Qe=s=>{const a=typeof s=="string"?new Date(s):s;return new Intl.DateTimeFormat("en-GH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(a)},gt="/assets/darkmode-icon.D6ALZWof.png",fl="agentStore";function Pi(){localStorage.removeItem(fl)}function ps(){return localStorage.getItem(fl)}const ts=jr,Ws=gr,Ci=ur,Nl=o.forwardRef(({className:s,...a},t)=>e.jsx(Zt,{ref:t,className:L("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a}));Nl.displayName=Zt.displayName;const _e=o.forwardRef(({className:s,children:a,...t},n)=>e.jsxs(Ci,{children:[e.jsx(Nl,{}),e.jsxs(ea,{ref:n,className:L("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t,children:[a,e.jsxs(pr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Ms,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));_e.displayName=ea.displayName;const Ge=({className:s,...a})=>e.jsx("div",{className:L("flex flex-col space-y-1.5 text-center sm:text-left",s),...a});Ge.displayName="DialogHeader";const Sa=({className:s,...a})=>e.jsx("div",{className:L("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});Sa.displayName="DialogFooter";const We=o.forwardRef(({className:s,...a},t)=>e.jsx(sa,{ref:t,className:L("text-lg font-semibold leading-none tracking-tight",s),...a}));We.displayName=sa.displayName;const As=o.forwardRef(({className:s,...a},t)=>e.jsx(ta,{ref:t,className:L("text-sm text-muted-foreground",s),...a}));As.displayName=ta.displayName;const Hs=Jl,qs=o.forwardRef(({className:s,...a},t)=>e.jsx(fr,{ref:t,className:L("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...a}));qs.displayName=fr.displayName;const Ee=o.forwardRef(({className:s,...a},t)=>e.jsx(Nr,{ref:t,className:L("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...a}));Ee.displayName=Nr.displayName;const Be=o.forwardRef(({className:s,...a},t)=>e.jsx(br,{ref:t,className:L("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a}));Be.displayName=br.displayName;const Ma=[{id:"guest",category:"guest",title:"How to Use Resellers Data Hub Pro Gh",description:"Choose your options and see how to get started with Resellers Data Hub Pro Gh services.",url:"https://cdn.example.com/videos/how-to-use-dahtahome.mp4"},{id:"customer",category:"customer",title:"How to Purchase as Customer",description:"Learn how to buy data bundles, track orders, and manage your purchases.",url:"https://cdn.example.com/videos/how-to-purchase-as-customer.mp4"},{id:"agent",category:"agent",title:"How to Become an Agent",description:"Discover how to join our agent program, earn commissions, and grow your business.",url:"https://cdn.example.com/videos/how-to-become-agent.mp4"}];function bl({label:s="Watch How to Purchase",description:a="Learn the quickest way to purchase bundles or become an agent.",triggerVariant:t="outline",triggerSize:n="default",className:l}){const[r,c]=o.useState(!1),[d,x]=o.useState("guest"),[p,m]=o.useState(null),{data:j}=V({queryKey:["/api/guides",d],queryFn:async()=>await Y("GET",`/api/guides?category=${d}`)}),h=o.useMemo(()=>{const i=Array.isArray(j)?j:[],u=Ma.filter(F=>F.category===d);return i.length>0?i:u},[d,j]),f=p&&p.category===d?p:h[0]||null,b=()=>{var u,F,R;if(!(f!=null&&f.url))return e.jsx("div",{className:"rounded-lg border p-6 bg-muted/50 text-sm text-muted-foreground",children:"Video will appear here once an admin uploads it."});if(f.url.includes("youtube.com")||f.url.includes("youtu.be")||f.url.includes("vimeo.com")){let P=f.url;if(P.includes("youtube.com/watch")){const v=new URL(P).searchParams.get("v");v&&(P=`https://www.youtube.com/embed/${v}`)}else if(P.includes("youtube.com/shorts/")){const v=(u=P.split("/shorts/")[1])==null?void 0:u.split("?")[0];v&&(P=`https://www.youtube.com/embed/${v}`)}else if(P.includes("youtu.be/")){const v=(F=P.split("youtu.be/")[1])==null?void 0:F.split("?")[0];v&&(P=`https://www.youtube.com/embed/${v}`)}else if(P.includes("vimeo.com/")&&!P.includes("player.vimeo.com")){const v=(R=P.split("vimeo.com/")[1])==null?void 0:R.split("?")[0];v&&(P=`https://player.vimeo.com/video/${v}`)}return e.jsx("div",{className:"rounded-lg md:rounded-none overflow-hidden border bg-black aspect-video md:aspect-auto md:h-64",children:e.jsx("iframe",{src:P,title:f.title,className:"w-full h-full md:h-64",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})}return e.jsx("div",{className:"rounded-lg md:rounded-none overflow-hidden border bg-black aspect-video md:aspect-auto md:h-64",children:e.jsxs("video",{className:"w-full h-full md:h-64",controls:!0,poster:void 0,children:[e.jsx("source",{src:f.url}),"Your browser does not support the video tag."]})})};return e.jsxs(e.Fragment,{children:[e.jsxs(g,{variant:t,size:n,className:L("bg-transparent border-2 border-yellow-500 text-yellow-500 hover:bg-transparent",l),onClick:()=>c(!0),children:[e.jsx(ja,{className:"h-4 w-4 mr-2 text-yellow-500"}),s]}),e.jsx(ts,{open:r,onOpenChange:c,children:e.jsxs(_e,{className:"max-w-4xl bg-black text-white md:rounded-none",children:[e.jsxs(Ge,{children:[e.jsxs(We,{className:"flex items-center gap-2 text-white",children:[e.jsx(vr,{className:"h-5 w-5"}),"How to Use Resellers Data Hub Pro Gh"]}),e.jsx(As,{className:"text-white/80",children:a})]}),e.jsxs(Hs,{value:d,onValueChange:i=>x(i),children:[e.jsxs(qs,{className:"grid grid-cols-3 w-full text-white gap-2",children:[e.jsx(Ee,{value:"guest",className:"text-white border-2 border-yellow-500 rounded-md md:rounded-none px-3 py-2 transition-colors hover:bg-yellow-500/10 data-[state=active]:bg-yellow-500 data-[state=active]:text-black data-[state=active]:border-yellow-600",children:"Guest"}),e.jsx(Ee,{value:"customer",className:"text-white border-2 border-yellow-500 rounded-md md:rounded-none px-3 py-2 transition-colors hover:bg-yellow-500/10 data-[state=active]:bg-yellow-500 data-[state=active]:text-black data-[state=active]:border-yellow-600",children:"Customer"}),e.jsx(Ee,{value:"agent",className:"text-white border-2 border-yellow-500 rounded-md md:rounded-none px-3 py-2 transition-colors hover:bg-yellow-500/10 data-[state=active]:bg-yellow-500 data-[state=active]:text-black data-[state=active]:border-yellow-600",children:"Agent"})]}),["guest","customer","agent"].map(i=>{const u=i===d?h:Ma.filter(F=>F.category===i);return e.jsxs(Be,{value:i,className:"space-y-4 pt-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:u.map(F=>e.jsxs(C,{className:`h-full md:rounded-none ${(f==null?void 0:f.id)===F.id?"border-primary":""}`,children:[e.jsxs($,{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{variant:"secondary",className:"capitalize",children:F.category}),(f==null?void 0:f.id)===F.id&&e.jsx(lt,{className:"h-4 w-4 text-primary"})]}),e.jsx(B,{className:"text-base leading-tight text-white",children:F.title}),e.jsx(J,{className:"text-xs leading-snug text-white/80",children:F.description})]}),e.jsx(D,{className:"space-y-3",children:e.jsxs(g,{variant:(f==null?void 0:f.id)===F.id?"default":"outline",size:"sm",className:"w-full",onClick:()=>m(F),children:[e.jsx(ja,{className:"h-4 w-4 mr-2"}),(f==null?void 0:f.id)===F.id?"Playing":"Play"]})})]},F.id))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-white",children:[e.jsx(wr,{className:"h-4 w-4 text-primary"}),(f==null?void 0:f.title)||"Select a video"]}),b()]})]},i)})]})]})})]})}function ls(){const{user:s,isAuthenticated:a,logout:t,isLoggingOut:n,isLoading:l}=je(),{theme:r}=Bs(),[c]=Ke(),[d,x]=o.useState(!1),p=typeof window<"u"?ps():null,m=f=>f?f.split(" ").map(b=>b[0]).join("").toUpperCase().slice(0,2):"U",j=()=>s?s.role==="admin"?"/admin":s.role==="agent"?"/agent/dashboard":s.role==="dealer"?"/dealer/dashboard":s.role==="super_dealer"?"/super-dealer/dashboard":s.role==="master"?"/master/dashboard":s.role==="user"?"/user/dashboard":"/":"/login",h=[{href:"/",label:"Home",icon:Zl},{href:"/data-bundles",label:"Data Bundles",icon:Se},{href:"/products/result-checkers",label:"Result Checkers",icon:it}];return e.jsxs("header",{className:`sticky top-0 z-50 w-full border-b shadow-sm ${r==="dark"?"bg-black":"bg-white"}`,children:[e.jsx(G,{href:p?`/store/${p}`:"/",className:"absolute top-4 left-0 z-10 flex items-center hover:opacity-80 transition-opacity pl-4",children:e.jsx("img",{src:r==="dark"?gt:tt,alt:Gs,className:"h-6 md:h-10 w-auto"})}),e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex h-16 items-center justify-between",children:[e.jsx("div",{className:"w-32"}),!p&&e.jsx("nav",{className:"hidden md:flex items-center gap-8",children:h.map(f=>{const b=f.icon,i=c===f.href;return e.jsxs(G,{href:f.href,className:`flex items-center gap-2 text-sm font-medium transition-colors hover:text-primary px-3 py-2 rounded-md ${i?"bg-yellow-500 text-white":"text-muted-foreground hover:text-primary"}`,children:[e.jsx(b,{className:"w-4 h-4"}),f.label]},f.href)})}),e.jsxs("div",{className:"flex items-center gap-3",children:[c==="/"&&e.jsx("div",{className:"hidden md:flex",children:e.jsx(bl,{triggerVariant:"outline",triggerSize:"sm"})}),e.jsx(Ne,{}),!c.startsWith("/products")&&c!=="/"&&c!=="/data-bundles"&&e.jsxs(He,{open:d,onOpenChange:x,children:[e.jsx(Is,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",className:"md:hidden","aria-label":"Open menu",children:e.jsx(pe,{className:"h-5 w-5"})})}),e.jsx(qe,{side:"right",className:`w-80 ${r==="dark"?"bg-black":"bg-white"}`,style:{backgroundColor:r==="dark"?"#000000":"#ffffff"},children:e.jsxs("div",{className:"flex flex-col gap-6 mt-6",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"text-lg font-bold text-primary",children:Gs})}),e.jsx("nav",{className:"flex flex-col gap-2",children:h.map(f=>{const b=f.icon,i=c===f.href;return e.jsxs(G,{href:f.href,onClick:()=>x(!1),className:`flex items-center gap-3 text-base font-medium transition-colors hover:text-primary px-4 py-3 rounded-lg ${i?"bg-yellow-500 text-white":"text-muted-foreground hover:text-primary"}`,children:[e.jsx(b,{className:"w-5 h-5"}),f.label]},f.href)})})]})})]}),l?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground hidden sm:inline",children:"Loading..."})]}):a&&s&&s.email?e.jsxs(ji,{children:[e.jsx(gi,{asChild:!0,children:e.jsx(g,{variant:"ghost",className:"relative h-9 w-9 rounded-full bg-yellow-500 hover:bg-yellow-600 transition-colors","aria-label":"User menu",children:e.jsx(Ut,{className:"h-8 w-8",children:e.jsx(zt,{className:"bg-yellow-500 text-white text-sm font-medium",children:m(s.name)})})})}),e.jsxs(ul,{align:"end",className:"w-64 bg-yellow-500",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-yellow-600",children:[e.jsx(Ut,{className:"h-10 w-10 flex-shrink-0",children:e.jsx(zt,{className:"bg-yellow-600 text-white",children:m(s.name)})}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-semibold text-sm text-black truncate",children:s.name||"User"}),e.jsx("span",{className:"text-xs text-black/70 truncate",children:s.email})]}),e.jsx("span",{className:"text-xs text-black/80 capitalize font-medium mt-1",children:s.role})]})]}),e.jsx(Xt,{asChild:!0,children:e.jsxs(G,{href:j(),className:"flex items-center gap-2 cursor-pointer text-black hover:bg-yellow-600 focus:bg-yellow-600 focus:text-black",children:[e.jsx(aa,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"Dashboard"})]})}),s.role==="agent"&&e.jsx(Xt,{asChild:!0,children:e.jsxs(G,{href:"/agent/storefront",className:"flex items-center gap-2 cursor-pointer text-black hover:bg-yellow-600 focus:bg-yellow-600 focus:text-black",children:[e.jsx(zs,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"My Store"})]})}),e.jsx(pl,{className:"bg-yellow-600"}),e.jsxs(Xt,{onClick:t,disabled:n,className:"flex items-center gap-2 cursor-pointer text-black hover:bg-yellow-600 focus:bg-yellow-600 focus:text-black",children:[e.jsx(qt,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:n?"Signing out...":"Sign out"})]})]})]}):e.jsxs("div",{className:"flex items-center gap-0.5 md:gap-1",children:[e.jsx(g,{asChild:!0,variant:"ghost",size:"sm",className:"h-6 px-1.5 text-xs md:h-7 md:px-2",children:e.jsx(G,{href:"/login",children:"Sign In"})}),e.jsx(g,{asChild:!0,size:"sm",className:"h-6 px-1.5 text-xs md:h-7 md:px-2",children:e.jsx(G,{href:"/register",children:"Get Started"})})]})]})]})})]})}function Ps(){const{theme:s}=Bs();return e.jsx("footer",{className:"border-t bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-7xl px-4 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("img",{src:s==="dark"?gt:tt,alt:"ResellersHub Pro",className:"h-8 w-auto"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your trusted platform for data bundles and result checker purchases in Ghana."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Products"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("li",{children:"MTN Data Bundles"}),e.jsx("li",{children:"Telecel Data Bundles"}),e.jsx("li",{children:"AirtelTigo Data Bundles"}),e.jsx("li",{children:"BECE Result Checkers"}),e.jsx("li",{children:"WASSCE Result Checkers"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"For Agents"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("li",{children:"Become an Agent"}),e.jsx("li",{children:"Agent Dashboard"}),e.jsx("li",{children:"Custom Storefronts"}),e.jsx("li",{children:"Profit Withdrawals"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Security & Payments"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(Us,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Secure"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(js,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Encrypted"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("div",{className:"rounded bg-white dark:bg-black p-2",children:e.jsx(en,{className:"h-6 w-10 text-[#1A1F71]"})}),e.jsx("div",{className:"rounded bg-white dark:bg-black p-2",children:e.jsx(sn,{className:"h-6 w-10 text-[#EB001B]"})}),e.jsx("div",{className:"rounded bg-[#00C3F7] px-2 py-1",children:e.jsx("span",{className:"text-white font-bold text-xs",children:"Paystack"})})]})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t text-center text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Â© ",new Date().getFullYear()," ",Gs,". All rights reserved."]}),e.jsxs("p",{className:"mt-2",children:["Developed by"," ",e.jsx("a",{href:"https://bm-portfolio-up2x.onrender.com",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 font-medium",children:"BlusMotif"})]})]})]})})}const vl=o.forwardRef(({className:s,title:a,subtitle:t,description:n,aboveButtons:l,badge:r,primaryButton:c,secondaryButton:d,images:x=[],showNavigation:p=!1,background:m="gradient",overlay:j=!0,height:h="lg",align:f="center",size:b="lg",children:i,...u},F)=>{const[R,P]=o.useState(0);o.useEffect(()=>{if(x.length>1){const le=setInterval(()=>{P(w=>(w+1)%x.length)},5e3);return()=>clearInterval(le)}},[x.length]);const v={sm:"h-[50vh]",md:"h-[60vh]",lg:"h-[70vh]",xl:"h-[80vh]",full:"h-screen"},U={sm:"text-3xl sm:text-4xl",md:"text-4xl sm:text-5xl lg:text-6xl",lg:"text-4xl sm:text-5xl lg:text-7xl"},E=()=>{P(le=>(le+1)%x.length)},se=()=>{P(le=>(le-1+x.length)%x.length)},ee={default:"",gradient:"bg-gradient-to-br from-primary/5 via-background to-secondary/5",image:""};return e.jsxs("section",{ref:F,className:L("relative flex items-center justify-center overflow-hidden",v[h],ee[m],s),...u,children:[x.length>0&&e.jsxs(e.Fragment,{children:[x.map((le,w)=>e.jsxs("div",{className:`absolute inset-0 transition-opacity duration-1000 ${w===R?"opacity-100":"opacity-0"}`,children:[e.jsx("img",{src:le,alt:`Hero image ${w+1}`,className:"w-full h-full object-cover"}),j&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/60 via-black/40 to-transparent"})]},w)),p&&x.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:se,className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-white/20 backdrop-blur-sm hover:bg-white/30 transition-colors","aria-label":"Previous image",children:e.jsx(tn,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:E,className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-white/20 backdrop-blur-sm hover:bg-white/30 transition-colors","aria-label":"Next image",children:e.jsx(Na,{className:"w-6 h-6 text-white"})}),e.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2 z-10",children:x.map((le,w)=>e.jsx("button",{onClick:()=>P(w),className:`w-3 h-3 rounded-full transition-all ${w===R?"bg-white scale-125":"bg-white/50 hover:bg-white/75"}`,"aria-label":`Go to image ${w+1}`},w))})]})]}),e.jsx("div",{className:"relative z-10 flex items-center justify-center h-full",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 text-center",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[r&&e.jsx(X,{variant:"secondary",className:"mb-6 px-4 py-2 text-sm font-medium",children:r}),t&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:t}),e.jsx("h1",{className:L("font-bold mb-6 tracking-tight",U[b]),children:e.jsx("span",{className:"text-white",children:a})}),n&&e.jsx("p",{className:"text-base sm:text-lg text-white/90 mb-8 max-w-2xl mx-auto leading-relaxed",children:n}),l&&e.jsx("div",{className:"mb-4 flex justify-center",children:l}),(c||d)&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center",children:[c&&e.jsx(g,{size:c.size||"lg",className:L("px-8 py-4 text-lg font-semibold shadow-lg hover:shadow-xl transition-shadow",c.className),asChild:!!c.href,onClick:c.onClick,children:c.href?e.jsxs("a",{href:c.href,className:"flex items-center gap-2",children:[c.text,c.icon&&e.jsx(c.icon,{className:"w-5 h-5"})]}):e.jsxs(e.Fragment,{children:[c.text,c.icon&&e.jsx(c.icon,{className:"w-5 h-5"})]})}),d&&e.jsx(g,{size:d.size||"lg",variant:"outline",className:"px-8 py-4 text-lg font-semibold bg-yellow-500 border-yellow-500 text-black hover:bg-yellow-600",asChild:!!d.href,onClick:d.onClick,children:d.href?e.jsxs("a",{href:d.href,className:"flex items-center gap-2",children:[d.text,d.icon&&e.jsx(d.icon,{className:"w-5 h-5"})]}):e.jsxs(e.Fragment,{children:[d.text,d.icon&&e.jsx(d.icon,{className:"w-5 h-5"})]})})]}),i]})})})]})});vl.displayName="Hero";function xa({value:s}){const[a,t]=o.useState(0),[n,l]=o.useState(!1),r=s.match(/(\d+)/),c=r?parseInt(r[1]):0,d=s.replace(/^\d+/,"");return o.useEffect(()=>{o.createRef();const x=new IntersectionObserver(([m])=>{m.isIntersecting&&!n&&l(!0)},{threshold:.5}),p=document.querySelector(`[data-stat-value="${s}"]`);return p&&x.observe(p),()=>{p&&x.unobserve(p)}},[s,n]),o.useEffect(()=>{if(!n)return;const x=2e3,p=Date.now(),m=()=>{const j=Date.now()-p,h=Math.min(j/x,1),b=(u=>1-Math.pow(1-u,2))(h),i=Math.floor(c*b);t(i),h<1?requestAnimationFrame(m):t(c)};requestAnimationFrame(m)},[n,c]),e.jsxs("div",{"data-stat-value":s,children:[a,d]})}const wl=o.forwardRef(({className:s,title:a,description:t,stats:n,columns:l=4,variant:r="default",...c},d)=>{const x={2:"grid-cols-1 sm:grid-cols-2",3:"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",4:"grid-cols-2 lg:grid-cols-4"};return r==="cards"?e.jsx("section",{ref:d,className:L("py-8 bg-muted/30",s),...c,children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[(a||t)&&e.jsxs("div",{className:"text-center mb-8",children:[a&&e.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-2",children:a}),t&&e.jsx("p",{className:"text-base text-muted-foreground max-w-2xl mx-auto",children:t})]}),e.jsx("div",{className:L("grid gap-4","grid-cols-1 sm:grid-cols-2 lg:grid-cols-4"),children:n.map((p,m)=>{const j=p.icon;return e.jsxs("div",{className:"bg-white dark:bg-black rounded-lg p-4 text-center shadow-sm border hover:shadow-md transition-shadow",children:[j&&e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(j,{className:"w-5 h-5 text-primary"})}),e.jsx("div",{className:"text-2xl font-bold text-primary mb-1",children:e.jsx(xa,{value:p.value})}),e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:p.label}),p.description&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:p.description})]},m)})})]})}):r==="minimal"?e.jsx("section",{ref:d,className:L("py-12",s),...c,children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:L("grid gap-8",x[l]),children:n.map((p,m)=>{const j=p.icon;return e.jsxs("div",{className:"text-center",children:[j&&e.jsx(j,{className:"w-8 h-8 text-primary mx-auto mb-3"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-primary mb-1",children:e.jsx(xa,{value:p.value})}),e.jsx("div",{className:"text-sm text-muted-foreground font-medium",children:p.label})]},m)})})})}):e.jsx("section",{ref:d,className:L("py-16 bg-muted/20",s),...c,children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[(a||t)&&e.jsxs("div",{className:"text-center mb-12",children:[a&&e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold mb-4",children:a}),t&&e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:t})]}),e.jsx("div",{className:L("grid gap-8",x[l]),children:n.map((p,m)=>{const j=p.icon;return e.jsxs("div",{className:"text-center",children:[j&&e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(j,{className:"w-8 h-8 text-primary"})}),e.jsx("div",{className:"text-3xl font-bold text-primary mb-2",children:e.jsx(xa,{value:p.value})}),e.jsx("div",{className:"text-sm text-muted-foreground font-medium",children:p.label}),p.description&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:p.description})]},m)})})]})})});wl.displayName="Stats";const yl=o.forwardRef(({className:s,title:a,subtitle:t,description:n,features:l,columns:r=3,variant:c="default",background:d="default",...x},p)=>{const m={default:"",muted:"bg-muted/20",gradient:"bg-gradient-to-br from-primary/5 via-background to-secondary/5"},j={2:"grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 sm:grid-cols-2 lg:grid-cols-4"};return c==="bento"?e.jsx("section",{ref:p,className:L("py-20",m[d],s),...x,children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[(a||t||n)&&e.jsxs("div",{className:"text-center mb-16",children:[t&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:t}),a&&e.jsx("h2",{className:"text-3xl sm:text-4xl font-bold mb-4",children:a}),n&&e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:n})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-6xl mx-auto",children:l.map((h,f)=>{const b=h.icon,i=f===0||f===3;return e.jsx("div",{className:L("group relative overflow-hidden rounded-2xl bg-white dark:bg-black border hover:shadow-xl transition-all duration-300 hover:-translate-y-1",i?"md:col-span-2 md:row-span-1":"md:col-span-1"),children:e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"flex items-start gap-4",children:[b&&e.jsx("div",{className:L("flex-shrink-0 rounded-xl p-3",h.color||"bg-primary/10 text-primary"),children:e.jsx(b,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2 group-hover:text-primary transition-colors",children:h.title}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:h.description})]})]})})},h.id)})})]})}):c==="minimal"?e.jsx("section",{ref:p,className:L("py-16",m[d],s),...x,children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[(a||t||n)&&e.jsxs("div",{className:"text-center mb-12",children:[t&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:t}),a&&e.jsx("h2",{className:"text-3xl sm:text-4xl font-bold mb-4",children:a}),n&&e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:n})]}),e.jsx("div",{className:L("grid gap-8",j[r]),children:l.map(h=>{const f=h.icon;return e.jsxs("div",{className:"text-center",children:[f&&e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(f,{className:"w-6 h-6 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:h.title}),e.jsx("p",{className:"text-muted-foreground",children:h.description})]},h.id)})})]})}):c==="cards"?e.jsx("section",{ref:p,className:L("pt-0 sm:pt-2 pb-12 sm:pb-20",m[d],s),...x,children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-6 lg:px-8",children:[(a||t||n)&&e.jsxs("div",{className:"text-center mb-8 sm:mb-16",children:[t&&e.jsx("div",{className:"text-xs sm:text-sm font-medium text-primary mb-1 sm:mb-2 uppercase tracking-wide",children:t}),a&&e.jsx("h2",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold mb-2 sm:mb-4",children:a}),n&&e.jsx("p",{className:"text-sm sm:text-base lg:text-lg text-muted-foreground max-w-2xl mx-auto",children:n})]}),e.jsx("div",{className:L("grid gap-3 sm:gap-6 lg:gap-8","grid-cols-2 lg:grid-cols-4"),children:l.map(h=>{const f=h.icon;return e.jsx(C,{className:"hover:shadow-lg transition-shadow dark:border-2 dark:border-white bg-card backdrop-blur-sm aspect-square flex flex-col",children:e.jsxs(D,{className:"p-3 sm:p-6 lg:p-8 flex flex-col items-center justify-center h-full text-center",children:[f&&e.jsx("div",{className:L("w-10 sm:w-14 lg:w-16 h-10 sm:h-14 lg:h-16 mx-auto mb-2 sm:mb-4 lg:mb-6 rounded-lg sm:rounded-xl lg:rounded-2xl p-2 sm:p-3 lg:p-4 flex items-center justify-center",h.color||"bg-gradient-to-br from-primary/10 to-primary/5 text-primary"),children:e.jsx(f,{className:"w-5 sm:w-6 lg:w-8 h-5 sm:h-6 lg:h-8"})}),e.jsx("h3",{className:"text-sm sm:text-base lg:text-lg font-semibold mb-1 sm:mb-2 lg:mb-3",children:h.title}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:h.description})]})},h.id)})})]})}):e.jsx("section",{ref:p,className:L("py-20",m[d],s),...x,children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[(a||t||n)&&e.jsxs("div",{className:"text-center mb-16",children:[t&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:t}),a&&e.jsx("h2",{className:"text-3xl sm:text-4xl font-bold mb-4",children:a}),n&&e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:n})]}),e.jsx("div",{className:L("grid gap-8",j[r]),children:l.map(h=>{const f=h.icon;return e.jsxs("div",{className:"flex gap-6",children:[f&&e.jsx("div",{className:L("flex-shrink-0 w-12 h-12 rounded-lg flex items-center justify-center",h.color||"bg-primary/10 text-primary"),children:e.jsx(f,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:h.title}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:h.description})]})]},h.id)})})]})})});yl.displayName="Features";const kl=o.forwardRef(({className:s,title:a,subtitle:t,description:n,primaryButton:l,secondaryButton:r,variant:c="default",background:d="default",size:x="md",...p},m)=>{const j={default:"",muted:"bg-muted/20",gradient:"bg-gradient-to-r from-primary/10 via-primary/5 to-secondary/10",primary:"bg-primary text-primary-foreground"},h={sm:"py-12",md:"py-16",lg:"py-24"},f={sm:"text-2xl sm:text-3xl",md:"text-3xl sm:text-4xl",lg:"text-4xl sm:text-5xl"};return c==="minimal"?e.jsx("section",{ref:m,className:L("text-center",h[x],j[d],s),...p,children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[t&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:t}),e.jsx("h2",{className:L("font-bold mb-4",f[x]),children:a}),n&&e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto mb-8",children:n}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[l&&e.jsx(g,{asChild:!!l.href,variant:l.variant||"default",size:"lg",onClick:l.onClick,className:"min-w-[160px]",children:l.href?e.jsxs("a",{href:l.href,className:"flex items-center gap-2",children:[l.icon&&e.jsx(l.icon,{className:"w-5 h-5"}),l.text]}):e.jsxs(e.Fragment,{children:[l.icon&&e.jsx(l.icon,{className:"w-5 h-5"}),l.text]})}),r&&e.jsx(g,{asChild:!!r.href,variant:r.variant||"outline",size:"lg",onClick:r.onClick,className:"min-w-[160px]",children:r.href?e.jsxs("a",{href:r.href,className:"flex items-center gap-2",children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]}):e.jsxs(e.Fragment,{children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]})})]})]})}):c==="centered"?e.jsx("section",{ref:m,className:L("text-center",h[x],j[d],s),...p,children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl",children:e.jsxs("div",{className:"bg-white/50 dark:bg-black/50 backdrop-blur-sm rounded-3xl p-8 md:p-12 border",children:[t&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:t}),e.jsx("h2",{className:L("font-bold mb-4",f[x]),children:a}),n&&e.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:n}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[l&&e.jsx(g,{asChild:!!l.href,variant:l.variant||"default",size:"lg",onClick:l.onClick,className:"min-w-[160px]",children:l.href?e.jsxs("a",{href:l.href,className:"flex items-center gap-2",children:[l.icon&&e.jsx(l.icon,{className:"w-5 h-5"}),l.text]}):e.jsxs(e.Fragment,{children:[l.icon&&e.jsx(l.icon,{className:"w-5 h-5"}),l.text]})}),r&&e.jsx(g,{asChild:!!r.href,variant:r.variant||"outline",size:"lg",onClick:r.onClick,className:"min-w-[160px]",children:r.href?e.jsxs("a",{href:r.href,className:"flex items-center gap-2",children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]}):e.jsxs(e.Fragment,{children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]})})]})]})})}):c==="split"?e.jsx("section",{ref:m,className:L(h[x],j[d],s),...p,children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[e.jsxs("div",{children:[t&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:t}),e.jsx("h2",{className:L("font-bold mb-4",f[x]),children:a}),n&&e.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:n}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[l&&e.jsx(g,{asChild:!!l.href,variant:l.variant||"default",size:"lg",onClick:l.onClick,className:"min-w-[160px]",children:l.href?e.jsxs("a",{href:l.href,className:"flex items-center gap-2",children:[l.icon&&e.jsx(l.icon,{className:"w-5 h-5"}),l.text]}):e.jsxs(e.Fragment,{children:[l.icon&&e.jsx(l.icon,{className:"w-5 h-5"}),l.text]})}),r&&e.jsx(g,{asChild:!!r.href,variant:r.variant||"outline",size:"lg",onClick:r.onClick,className:"min-w-[160px]",children:r.href?e.jsxs("a",{href:r.href,className:"flex items-center gap-2",children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]}):e.jsxs(e.Fragment,{children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]})})]})]}),e.jsx("div",{className:"lg:text-right",children:e.jsx("div",{className:"bg-gradient-to-br from-primary/20 to-secondary/20 rounded-2xl p-8 h-64 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:(l==null?void 0:l.icon)&&e.jsx(l.icon,{className:"w-8 h-8 text-primary"})}),e.jsx("p",{className:"text-muted-foreground",children:"Visual content goes here"})]})})})]})})}):c==="gradient"?e.jsxs("section",{ref:m,className:L("relative overflow-hidden",h[x],s),...p,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary via-primary/80 to-secondary"}),e.jsx("div",{className:"absolute inset-0 bg-black/20"}),e.jsxs("div",{className:"relative container mx-auto px-4 sm:px-6 lg:px-8 text-center text-white",children:[t&&e.jsx("div",{className:"text-sm font-medium text-white/80 mb-2 uppercase tracking-wide",children:t}),e.jsx("h2",{className:L("font-bold mb-4",f[x]),children:a}),n&&e.jsx("p",{className:"text-lg text-white/90 max-w-2xl mx-auto mb-8",children:n}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[l&&e.jsx(g,{asChild:!!l.href,variant:"secondary",size:"lg",onClick:l.onClick,className:"min-w-[160px] bg-white text-primary hover:bg-white/90",children:l.href?e.jsxs("a",{href:l.href,className:"flex items-center gap-2",children:[l.icon&&e.jsx(l.icon,{className:"w-5 h-5"}),l.text]}):e.jsxs(e.Fragment,{children:[l.icon&&e.jsx(l.icon,{className:"w-5 h-5"}),l.text]})}),r&&e.jsx(g,{asChild:!!r.href,variant:"outline",size:"lg",onClick:r.onClick,className:"min-w-[160px] border-white/30 text-white hover:bg-white/10",children:r.href?e.jsxs("a",{href:r.href,className:"flex items-center gap-2",children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]}):e.jsxs(e.Fragment,{children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]})})]})]})]}):e.jsx("section",{ref:m,className:L("text-center",h[x],j[d],s),...p,children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[t&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:t}),e.jsx("h2",{className:L("font-bold mb-4",f[x]),children:a}),n&&e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto mb-8",children:n}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[l&&e.jsx(g,{asChild:!!l.href,variant:l.variant||"default",size:"lg",onClick:l.onClick,className:"min-w-[160px]",children:l.href?e.jsxs("a",{href:l.href,className:"flex items-center gap-2",children:[l.icon&&e.jsx(l.icon,{className:"w-5 h-5"}),l.text]}):e.jsxs(e.Fragment,{children:[l.icon&&e.jsx(l.icon,{className:"w-5 h-5"}),l.text]})}),r&&e.jsx(g,{asChild:!!r.href,variant:r.variant||"outline",size:"lg",onClick:r.onClick,className:"min-w-[160px]",children:r.href?e.jsxs("a",{href:r.href,className:"flex items-center gap-2",children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]}):e.jsxs(e.Fragment,{children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]})})]})]})})});kl.displayName="CTA";const $a="https://resellershubprogh.com",Re={baseURL:$a,buildUrl:s=>`${$a}${s}`,auth:{me:()=>Re.buildUrl("/api/auth/me"),login:()=>Re.buildUrl("/api/auth/login"),register:()=>Re.buildUrl("/api/auth/register"),logout:()=>Re.buildUrl("/api/auth/logout")},products:{dataBundles:()=>Re.buildUrl("/api/products/data-bundles"),dataBundle:s=>Re.buildUrl(`/api/products/data-bundles/${s}`),resultCheckers:()=>Re.buildUrl("/api/products/result-checkers/stock"),resultCheckerInfo:(s,a)=>Re.buildUrl(`/api/products/result-checkers/info/${s}/${a}`)},agent:{register:()=>Re.buildUrl("/api/agent/register"),profile:()=>Re.buildUrl("/api/profile"),transactions:()=>Re.buildUrl("/api/agent/transactions"),transactionsStats:()=>Re.buildUrl("/api/agent/transactions/stats"),withdrawals:()=>Re.buildUrl("/api/agent/withdrawals"),storefront:()=>Re.buildUrl("/api/agent/storefront"),pricing:()=>Re.buildUrl("/api/agent/pricing")},checkout:{initialize:()=>Re.buildUrl("/api/checkout/initialize")},wallet:{topup:{initialize:()=>Re.buildUrl("/api/wallet/topup/initialize"),verify:s=>Re.buildUrl(`/api/wallet/topup/verify/${s}`)},pay:()=>Re.buildUrl("/api/wallet/pay")},transactions:{verify:s=>Re.buildUrl(`/api/transactions/verify/${s}`)},store:(s,a)=>Re.buildUrl(`/api/store/${s}/${a}`)};let Oa=!1;async function Ie(s,a={}){var x;const{disableAutoLogout:t,...n}=a,l=Re.buildUrl(s),{data:r}=await Ds.auth.getSession(),c=(x=r.session)==null?void 0:x.access_token,d=await fetch(l,{headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0",...c&&{Authorization:`Bearer ${c}`},...n.headers},cache:"no-store",...n});if(!d.ok){const p=await d.json().catch(()=>({error:"Unknown error"})),m=p.error||p.message||`API request failed: ${d.status} ${d.statusText}`;if(console.error("API Error:",{endpoint:s,status:d.status,error:p}),d.status===401&&!t&&!Oa){Oa=!0;try{await Ds.auth.signOut(),window.location.href="/login"}catch(j){console.error("Auto-logout failed:",j),window.location.href="/login"}throw new Error("Session expired. Please log in again.")}throw new Error(m)}return d.json()}const ft="/assets/mtn_1765780772203.1XQhhhcx.jpg",Nt="/assets/telecel_1765780772206.CUaJa_BA.jpg",cs="/assets/at_1765780772206.ldktjSTD.jpg",Pa="/assets/result_1765780772205.DD_xs0-M.jpg",Sl="/assets/banner1_1765774201032.BpG3zOow.jpeg",Pl="/assets/banner2_1765774201033.CHuTf4Ze.jpeg",Cl="/assets/banner3_1765774201030.DzQW3uf5.jpeg",K=o.forwardRef(({className:s,type:a,...t},n)=>e.jsx("input",{type:a,className:L("flex h-9 w-full rounded-md border border-input bg-white px-3 py-2 text-base text-black ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:n,...t}));K.displayName="Input";function bt(){const[s,a]=o.useState(""),[t,n]=o.useState(!1),[l,r]=o.useState(null),{toast:c}=he(),d=async()=>{if(!s.trim()){c({title:"Search Required",description:"Please enter a transaction ID or beneficiary phone number",variant:"destructive"});return}n(!0);try{const m=await fetch(`/api/track-order?q=${encodeURIComponent(s.trim())}`),j=await m.json();m.ok?r(j):(r(null),c({title:"Order Not Found",description:j.error||"No order found with the provided information",variant:"destructive"}))}catch{r(null),c({title:"Search Failed",description:"Failed to search for order. Please try again.",variant:"destructive"})}finally{n(!1)}},x=(m,j)=>m==="completed"&&j==="delivered"?e.jsx(be,{className:"h-5 w-5 text-green-500"}):m==="failed"||j==="failed"?e.jsx(is,{className:"h-5 w-5 text-red-500"}):m==="completed"&&j==="processing"?e.jsx(ze,{className:"h-5 w-5 text-yellow-500"}):e.jsx(Se,{className:"h-5 w-5 text-blue-500"}),p=(m,j)=>m==="completed"&&j==="delivered"?e.jsx(X,{variant:"default",className:"bg-green-500 text-white",children:"Delivered"}):m==="failed"||j==="failed"?e.jsx(X,{variant:"destructive",className:"bg-red-500 text-white",children:"Failed"}):m==="completed"&&j==="processing"?e.jsx(X,{variant:"secondary",className:"bg-yellow-500 text-white",children:"Processing"}):m==="completed"&&j==="pending"?e.jsx(X,{variant:"secondary",className:"bg-blue-500 text-white",children:"Pending Delivery"}):e.jsx(X,{variant:"outline",className:"bg-gray-500 text-white",children:m});return e.jsxs(C,{className:"w-full max-w-2xl mx-auto",children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),"Track Your Order"]}),e.jsx(J,{children:"Enter your transaction ID or beneficiary phone number to track your order status"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{placeholder:"Transaction ID or Phone Number (e.g., CLEC-123456789-ABCDEF or 0241234567)",value:s,onChange:m=>a(m.target.value),onKeyPress:m=>m.key==="Enter"&&d(),className:"flex-1"}),e.jsxs(g,{onClick:d,disabled:t,children:[t?e.jsx(ze,{className:"h-4 w-4 animate-spin"}):e.jsx(Gt,{className:"h-4 w-4"}),"Search"]})]}),l&&e.jsxs(C,{className:"border-l-4 border-l-blue-500",children:[e.jsxs($,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[x(l.status,l.deliveryStatus),e.jsx(B,{className:"text-lg",children:l.productName})]}),p(l.status,l.deliveryStatus)]}),e.jsxs(J,{children:["Order #",l.reference]})]}),e.jsxs(D,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Amount:"}),e.jsxs("p",{className:"font-semibold",children:["GHS ",l.amount]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Date:"}),e.jsx("p",{children:new Date(l.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Customer Phone:"}),e.jsx("p",{children:l.customerPhone})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Type:"}),e.jsx("p",{children:l.isBulkOrder?"Bulk Order":"Single Order"})]})]}),l.isBulkOrder&&l.phoneNumbers&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Beneficiary Numbers:"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:l.phoneNumbers.map((m,j)=>e.jsx(X,{variant:"outline",className:"text-xs",children:m.phone},j))})]}),l.completedAt&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Completed:"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(l.completedAt).toLocaleString()})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(os,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-gray-600",children:"Need help? Contact our support team with your order reference."})]})})]})]})]})]})}const Ai=[Sl,Pl,Cl];function Ti(){const{user:s,isAuthenticated:a}=je(),{data:t}=V({queryKey:["/api/products/result-checkers/stock"],queryFn:()=>Ie("/api/products/result-checkers/stock"),refetchInterval:6e4}),n=[{id:"mtn",title:"MTN Data Bundles",description:"Fast & reliable MTN data packages",icon:()=>e.jsx("img",{src:ft,alt:"MTN",className:"w-8 h-8 object-contain"}),color:"bg-gradient-to-br from-yellow-400 to-orange-500"},{id:"telecel",title:"Telecel Data Bundles",description:"Affordable Telecel data solutions",icon:()=>e.jsx("img",{src:Nt,alt:"Telecel",className:"w-8 h-8 object-contain"}),color:"bg-gradient-to-br from-blue-400 to-blue-600"},{id:"at_bigtime",title:"AT BIG TIME Bundles",description:"High-speed AirtelTigo bundles",icon:()=>e.jsx("img",{src:cs,alt:"AirtelTigo",className:"w-8 h-8 object-contain"}),color:"bg-gradient-to-br from-red-400 to-red-600"},{id:"at_ishare",title:"AT iShare Bundles",description:"Flexible AirtelTigo iShare plans",icon:()=>e.jsx("img",{src:cs,alt:"AirtelTigo",className:"w-8 h-8 object-contain"}),color:"bg-gradient-to-br from-purple-400 to-purple-600"},{id:"waec-result-checker",title:"WAEC Result Checker",description:t&&t.length>0?`${t.reduce((x,p)=>x+p.available,0)} PINs available`:"Instant BECE & WASSCE results",icon:()=>e.jsx("img",{src:Pa,alt:"WAEC",className:"w-8 h-8 object-contain"}),color:"bg-gradient-to-br from-green-400 to-green-600",badge:t&&t.length>0?`${t.reduce((x,p)=>x+p.available,0)} In Stock`:null}],l=[{id:"instant-delivery",title:"Instant Delivery",description:"Get your data bundles delivered instantly after payment",icon:yr,color:"bg-gradient-to-br from-yellow-400/10 to-orange-500/10"},{id:"secured-payment",title:"100% Secure Payment",description:"Bank-grade security with encrypted transactions",icon:Us,color:"bg-gradient-to-br from-green-400/10 to-green-600/10"},{id:"customer-support",title:"24/7 Support",description:"Round-the-clock customer support for all your needs",icon:an,color:"bg-gradient-to-br from-blue-400/10 to-blue-600/10"},{id:"best-prices",title:"Best Market Prices",description:"Competitive pricing with exclusive agent discounts",icon:ct,color:"bg-gradient-to-br from-purple-400/10 to-purple-600/10"}],r=[{label:"Happy Customers",value:"50K+",icon:es},{label:"Data Bundles Sold",value:"1M+",icon:Le},{label:"Success Rate",value:"99.9%",icon:be},{label:"Years of Service",value:"5+",icon:ra}],c=()=>!a||!s?"/agent/register":s.role==="agent"||s.role==="dealer"||s.role==="super_dealer"?"/agent/dashboard":"/agent/register",d=()=>!a||!s?"Become an Agent":s.role==="agent"||s.role==="dealer"||s.role==="super_dealer"?"Go to Dashboard":"Become an Agent";return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ls,{}),e.jsxs("main",{children:[e.jsx(vl,{title:e.jsxs("span",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-extrabold text-center block",style:{fontFamily:"'Arial Rounded MT Bold', 'Helvetica Rounded', Arial, sans-serif"},children:[e.jsx("span",{className:"font-extrabold",children:"Your Trusted Platform for Digital"})," ",e.jsx("span",{className:"text-blue-600 font-extrabold",children:"Products"})]}),description:"Purchase data bundles and WAEC result checkers instantly with secure payments and instant delivery.",primaryButton:{text:"Browse Products",href:"/data-bundles",icon:Mt,size:"sm",className:"bg-yellow-500 hover:bg-yellow-600 dark:text-white text-black"},secondaryButton:{text:"Track Order",href:"#track-orders",icon:Se,size:"sm"},images:Ai,showNavigation:!1,background:"gradient",size:"lg"}),e.jsx("section",{className:"md:hidden py-4",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-sm mx-auto w-full",children:e.jsx(bl,{triggerVariant:"default",triggerSize:"sm",className:"w-full"})})})}),e.jsx("section",{id:"products",className:"py-20",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx(X,{variant:"outline",className:"mb-4",children:"Our Products"}),e.jsx("h2",{className:"text-3xl sm:text-4xl font-bold mb-4",children:"Choose Your Network"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Select from our wide range of data bundles and result checkers from all major networks"})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 md:gap-6",children:n.map(x=>e.jsx(G,{href:`/products/${x.id}`,children:e.jsx(C,{className:"group h-full hover:shadow-xl transition-all duration-300 hover:-translate-y-1 dark:border-2 dark:border-white shadow-md bg-card aspect-square md:aspect-auto flex flex-col",children:e.jsxs(D,{className:"p-2 md:p-2 text-center flex flex-col h-full",children:[x.badge&&e.jsx(X,{variant:"secondary",className:"mb-2 text-[10px] md:text-xs w-fit mx-auto",children:x.badge}),e.jsx("div",{className:"w-full h-24 md:h-32 mx-auto mb-1 md:mb-1 flex items-center justify-center group-hover:scale-110 transition-transform duration-300",children:e.jsx(x.icon,{})}),e.jsx("h3",{className:"font-semibold text-xs md:text-base lg:text-lg mb-0.5 md:mb-1 lg:mb-2 group-hover:text-primary transition-colors leading-tight",children:x.title}),e.jsx("p",{className:"text-[10px] md:text-xs lg:text-sm text-muted-foreground leading-tight md:leading-snug lg:leading-relaxed flex-grow",children:x.description}),e.jsx("div",{className:"mt-2 md:mt-3 lg:mt-4 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Mt,{className:"w-3 md:w-4 lg:w-5 h-3 md:h-4 lg:h-5 text-primary mx-auto"})})]})})},x.id))}),e.jsx(wl,{stats:r})]})}),e.jsx(yl,{title:"Experience Excellence",subtitle:"Why Choose Us",description:"We're committed to providing the best digital product experience with top-notch service",columns:4,className:"py-0",features:l,variant:"cards",background:"muted"}),e.jsx("section",{id:"track-orders",className:"py-20",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx(X,{variant:"outline",className:"mb-4",children:"Track Orders"}),e.jsx("h2",{className:"text-3xl sm:text-4xl font-bold mb-4",children:"Never Lose Track"}),e.jsx("p",{className:"text-lg text-muted-foreground mb-12 max-w-2xl mx-auto",children:"Easily track your data bundle and result checker orders using your transaction ID or beneficiary phone number."}),e.jsx(bt,{})]})})}),e.jsx(kl,{title:"Start Your Own Business",subtitle:"Become an Agent",description:"Join thousands of successful agents earning commissions. Get your custom storefront and start selling digital products today.",primaryButton:{text:d(),href:c(),icon:Mt},background:"gradient",size:"lg"})]}),e.jsx(Ps,{})]})}const Fi=Tt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),z=o.forwardRef(({className:s,...a},t)=>e.jsx(kr,{ref:t,className:L(Fi(),s),...a}));z.displayName=kr.displayName;const ws=ln,Al=o.createContext({}),me=({...s})=>e.jsx(Al.Provider,{value:{name:s.name},children:e.jsx(nn,{...s})}),Wt=()=>{const s=o.useContext(Al),a=o.useContext(Tl),{getFieldState:t,formState:n}=rn(),l=t(s.name,n);if(!s)throw new Error("useFormField should be used within <FormField>");const{id:r}=a;return{id:r,name:s.name,formItemId:`${r}-form-item`,formDescriptionId:`${r}-form-item-description`,formMessageId:`${r}-form-item-message`,...l}},Tl=o.createContext({}),ce=o.forwardRef(({className:s,...a},t)=>{const n=o.useId();return e.jsx(Tl.Provider,{value:{id:n},children:e.jsx("div",{ref:t,className:L("space-y-2",s),...a})})});ce.displayName="FormItem";const xe=o.forwardRef(({className:s,...a},t)=>{const{error:n,formItemId:l}=Wt();return e.jsx(z,{ref:t,className:L(n&&"text-destructive",s),htmlFor:l,...a})});xe.displayName="FormLabel";const Kt=o.forwardRef(({className:s,...a},t)=>{const{error:n}=Wt();return e.jsx(z,{ref:t,className:L(n&&"text-destructive",s),...a})});Kt.displayName="FormLabelWithoutFor";const de=o.forwardRef(({...s},a)=>{const{error:t,formItemId:n,formDescriptionId:l,formMessageId:r}=Wt();return e.jsx(er,{ref:a,id:n,"aria-describedby":t?`${l} ${r}`:`${l}`,"aria-invalid":!!t,...s})});de.displayName="FormControl";const ss=o.forwardRef(({className:s,...a},t)=>{const{formDescriptionId:n}=Wt();return e.jsx("div",{ref:t,id:n,className:L("text-sm text-muted-foreground",s),...a})});ss.displayName="FormDescription";const oe=o.forwardRef(({className:s,children:a,...t},n)=>{const{error:l,formMessageId:r}=Wt(),c=l?String((l==null?void 0:l.message)??""):a;return c?e.jsx("p",{ref:n,id:r,className:L("text-sm font-medium text-destructive",s),...t,children:c}):null});oe.displayName="FormMessage";const Ii=Z.object({email:Z.string().email("Invalid email address"),password:Z.string().min(6,"Password must be at least 6 characters")});function Di(){const[,s]=Ke(),[a,t]=o.useState(!1),{login:n,isLoginLoading:l,loginError:r,user:c,isLoading:d}=je(),{toast:x}=he(),{theme:p}=Bs(),[m,j]=o.useState(!1),h=gs({resolver:fs(Ii),defaultValues:{email:"",password:""}});o.useEffect(()=>{d||m||(c?(j(!0),c.role==="admin"?(console.log("Redirecting admin to /admin"),s("/admin")):c.role==="agent"?(console.log("Redirecting agent to /agent/dashboard"),s("/agent/dashboard")):c.role==="dealer"?(console.log("Redirecting dealer to /dealer/dashboard"),s("/dealer/dashboard")):c.role==="super_dealer"?(console.log("Redirecting super dealer to /super-dealer/dashboard"),s("/super-dealer/dashboard")):c.role==="master"?(console.log("Redirecting master to /master/dashboard"),s("/master/dashboard")):c.role==="user"?(console.log("Redirecting user to /user/dashboard"),s("/user/dashboard")):(console.log("Redirecting user to /"),s("/"))):console.log("No user found, staying on login page"))},[c,d,s]);const f=async i=>{try{(await n({email:i.email,password:i.password})).error||(Pi(),x({title:"Welcome back!",description:"You have successfully logged in."}))}catch{}},b=typeof window<"u"?ps():null;return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background px-4 py-6",children:[e.jsx("nav",{className:"mb-6 px-2",children:e.jsx(G,{href:b?`/store/${b}`:"/","data-testid":"link-back-home",children:e.jsxs(g,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(Ft,{className:"h-4 w-4"}),"Back to Home"]})})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md shadow-xl border-2 border-yellow-400 bg-white rounded-xl p-8",children:[l&&e.jsx("div",{className:"absolute inset-0 bg-background flex items-center justify-center z-10 rounded-lg",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(Q,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-black dark:text-black",children:"Signing you in..."})]})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:p==="dark"?gt:tt,alt:Gs,className:"h-8 w-auto"})}),e.jsx("h2",{className:"text-2xl font-bold text-black dark:text-black",children:"Welcome back"}),e.jsxs("p",{className:"text-black dark:text-black",children:["Sign in to your ",Gs," account"]})]}),e.jsxs("div",{children:[e.jsx(ws,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(f),className:"space-y-4",children:[e.jsx(me,{control:h.control,name:"email",render:({field:i})=>e.jsxs(ce,{children:[e.jsx(xe,{className:"text-black dark:text-black",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(de,{children:e.jsx(K,{placeholder:"you@example.com",type:"email",className:"pl-10","data-testid":"input-email",name:i.name,autoComplete:"email",...i})})]}),e.jsx(oe,{})]})}),e.jsx(me,{control:h.control,name:"password",render:({field:i})=>e.jsxs(ce,{children:[e.jsx(xe,{className:"text-black dark:text-black",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(js,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(de,{children:e.jsx(K,{placeholder:"Enter your password",type:a?"text":"password",className:"pl-10 pr-10","data-testid":"input-password",name:i.name,autoComplete:"current-password",...i})}),e.jsx(g,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-0 h-full px-3",onClick:()=>t(!a),children:a?e.jsx(Js,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(Zs,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsx(oe,{})]})}),e.jsxs(g,{type:"submit",className:"w-full",disabled:l,"data-testid":"button-submit-login",children:[l&&e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign in"]}),r&&e.jsx("div",{className:"text-red-500 dark:text-red-400 text-sm mt-2",children:r})]})}),e.jsxs("div",{className:"mt-6 text-center text-sm",children:[e.jsx("span",{className:"text-black dark:text-black",children:"Don't have an account? "}),e.jsx(G,{href:"/register",className:"text-primary hover:underline font-medium","data-testid":"link-register",children:"Sign up"})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:[e.jsx("span",{className:"text-black dark:text-black",children:"Want to become an agent? "}),e.jsx(G,{href:"/agent/register",className:"text-primary hover:underline font-medium","data-testid":"link-agent-register",children:"Register as Agent"})]})]})]})})]})}const Ei=Z.object({name:Z.string().min(2,"Name must be at least 2 characters"),email:Z.string().email("Invalid email address"),phone:Z.string().optional(),password:Z.string().min(6,"Password must be at least 6 characters"),confirmPassword:Z.string()}).refine(s=>s.password===s.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function Ri(){const[,s]=Ke(),[a,t]=o.useState(!1),{register:n,isRegisterLoading:l,registerError:r,user:c,isLoading:d}=je(),{toast:x}=he(),{theme:p}=Bs(),m=gs({resolver:fs(Ei),defaultValues:{name:"",email:"",phone:"",password:"",confirmPassword:""}});o.useEffect(()=>{if(!d&&c){const f=c.role;s(f==="admin"?"/admin":f==="agent"?"/agent":f==="user"?"/user/dashboard":"/")}},[c,d,s]);const j=async f=>{try{const b=await n({email:f.email,password:f.password,name:f.name});if((b==null?void 0:b.error)==="Email confirmation required"){x({title:"Check your email",description:"Please click the confirmation link in your email to complete registration."});return}x({title:"Account created!",description:"Welcome to "+Gs})}catch(b){x({title:"Registration failed",description:b.message||"Something went wrong",variant:"destructive"})}},h=typeof window<"u"?ps():null;return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background px-4 py-6",children:[e.jsx("nav",{className:"mb-6 px-2",children:e.jsx(G,{href:h?`/store/${h}`:"/","data-testid":"link-back-home",children:e.jsxs(g,{variant:"outline",size:"sm",className:"gap-2 text-black dark:text-white",children:[e.jsx(Ft,{className:"h-4 w-4"}),"Back to Home"]})})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md shadow-xl border-2 border-yellow-400 bg-white dark:bg-black text-black dark:text-white rounded-xl p-8",style:{backgroundColor:p==="dark"?"#000000":void 0},children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:p==="dark"?gt:tt,alt:Gs,className:"h-8 w-auto"})}),e.jsx("h2",{className:"text-2xl font-bold",children:"Create an account"}),e.jsxs("p",{className:"text-muted-foreground dark:text-gray-300",children:["Join ",Gs," to purchase data bundles and result checkers"]})]}),e.jsxs("div",{children:[e.jsx(ws,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(j),className:"space-y-4",children:[e.jsx(me,{control:m.control,name:"name",render:({field:f})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Full Name"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(la,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(K,{placeholder:"John Doe",className:"pl-10",autoComplete:"name","data-testid":"input-name",...f})]})}),e.jsx(oe,{})]})}),e.jsx(me,{control:m.control,name:"email",render:({field:f})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Email"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Pt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(K,{placeholder:"you@example.com",type:"email",autoComplete:"email",className:"pl-10","data-testid":"input-email",...f})]})}),e.jsx(oe,{})]})}),e.jsx(me,{control:m.control,name:"phone",render:({field:f})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Phone Number (optional)"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(It,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(K,{placeholder:"0241234567",autoComplete:"tel",className:"pl-10","data-testid":"input-phone",...f})]})}),e.jsx(oe,{})]})}),e.jsx(me,{control:m.control,name:"password",render:({field:f})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Password"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(js,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(K,{placeholder:"Create a password",type:a?"text":"password",autoComplete:"new-password",className:"pl-10 pr-10","data-testid":"input-password",...f}),e.jsx(g,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-0 h-full px-3",onClick:()=>t(!a),children:a?e.jsx(Js,{className:"h-4 w-4 text-muted-foreground dark:text-gray-400"}):e.jsx(Zs,{className:"h-4 w-4 text-muted-foreground dark:text-gray-400"})})]})}),e.jsx(oe,{})]})}),e.jsx(me,{control:m.control,name:"confirmPassword",render:({field:f})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Confirm Password"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(js,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(K,{placeholder:"Confirm your password",type:a?"text":"password",autoComplete:"new-password",className:"pl-10","data-testid":"input-confirm-password",...f})]})}),e.jsx(oe,{})]})}),e.jsxs(g,{type:"submit",className:"w-full",disabled:l,"data-testid":"button-submit-register",children:[l&&e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),r&&e.jsx("div",{className:"text-red-500 text-sm mt-2",children:r}),"Create account"]})]})}),e.jsxs("div",{className:"mt-6 text-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground dark:text-gray-300",children:"Already have an account? "}),e.jsx(G,{href:"/login",className:"text-primary hover:underline font-medium","data-testid":"link-login",children:"Sign in"})]})]})]})})]})}const _t=o.forwardRef(({className:s,orientation:a="horizontal",decorative:t=!0,...n},l)=>e.jsx(Sr,{ref:l,decorative:t,orientation:a,className:L("shrink-0 bg-border",a==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",s),...n}));_t.displayName=Sr.displayName;const Li={mtn:{bg:"bg-yellow-100 dark:bg-yellow-900/30",text:"text-yellow-800 dark:text-yellow-300",border:"border-yellow-300 dark:border-yellow-700"},telecel:{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-800 dark:text-red-300",border:"border-red-300 dark:border-red-700"},at_bigtime:{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-800 dark:text-red-300",border:"border-red-300 dark:border-red-700"},at_ishare:{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-800 dark:text-red-300",border:"border-red-300 dark:border-red-700"}},Mi={mtn:"MTN",telecel:"TELECEL",at_bigtime:"AT Bigtime",at_ishare:"AT ishare"};function $i({network:s,size:a="sm",className:t}){const n=Li[s.toLowerCase()]||{bg:"bg-gray-100 dark:bg-white",text:"text-gray-800 dark:text-gray-300",border:"border-gray-300 dark:border-gray-700"},l={sm:"text-xs px-2 py-0.5",md:"text-sm px-3 py-1",lg:"text-base px-4 py-1.5"};return e.jsx(X,{variant:"outline",className:L("font-semibold uppercase tracking-wide",n.bg,n.text,n.border,l[a],t),children:Mi[s.toLowerCase()]||s.toUpperCase()})}const dt=o.forwardRef(({className:s,...a},t)=>e.jsx(Pr,{className:L("grid gap-2",s),...a,ref:t}));dt.displayName=Pr.displayName;const Cs=o.forwardRef(({className:s,...a},t)=>e.jsx(Cr,{ref:t,className:L("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(cn,{className:"flex items-center justify-center",children:e.jsx(cr,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Cs.displayName=Cr.displayName;const Ae=un,Te=pn,Pe=o.forwardRef(({className:s,children:a,...t},n)=>e.jsxs(Ar,{ref:n,className:L("flex h-9 w-full items-center justify-between rounded-md border border-input bg-white px-3 py-2 text-sm text-black ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...t,children:[a,e.jsx(dn,{asChild:!0,children:e.jsx(na,{className:"h-4 w-4 opacity-50"})})]}));Pe.displayName=Ar.displayName;const Fl=o.forwardRef(({className:s,...a},t)=>e.jsx(Tr,{ref:t,className:L("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(Fr,{className:"h-4 w-4"})}));Fl.displayName=Tr.displayName;const Il=o.forwardRef(({className:s,...a},t)=>e.jsx(Ir,{ref:t,className:L("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(na,{className:"h-4 w-4"})}));Il.displayName=Ir.displayName;const Ce=o.forwardRef(({className:s,children:a,position:t="popper",...n},l)=>e.jsx(on,{children:e.jsxs(Dr,{ref:l,className:L("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-white text-black shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:t,...n,children:[e.jsx(Fl,{}),e.jsx(mn,{className:L("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),e.jsx(Il,{})]})}));Ce.displayName=Dr.displayName;const Oi=o.forwardRef(({className:s,...a},t)=>e.jsx(Er,{ref:t,className:L("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a}));Oi.displayName=Er.displayName;const H=o.forwardRef(({className:s,children:a,...t},n)=>e.jsxs(Rr,{ref:n,className:L("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(xn,{children:e.jsx(Bt,{className:"h-4 w-4"})})}),e.jsx(hn,{children:a})]}));H.displayName=Rr.displayName;const Bi=o.forwardRef(({className:s,...a},t)=>e.jsx(Lr,{ref:t,className:L("-mx-1 my-1 h-px bg-muted",s),...a}));Bi.displayName=Lr.displayName;const qi={mtn:["024","025","053","054","055","059"],telecel:["020","050"],airteltigo:["026","027","056","057"],at_bigtime:["026","027","056","057"],at_ishare:["026","027","056","057"]};function $s(s){let a=s.replace(/\D/g,"");return a.startsWith("233")&&(a="0"+a.substring(3)),a.startsWith("0")||(a="0"+a),a}function Ui(s){return $s(s).length===10}function ns(s){return qi[s]||[]}function Ks(s,a){const t=$s(s);return Ui(t)?{isValid:!0}:{isValid:!1,error:"Phone number must be exactly 10 digits (e.g., 0241234567)"}}const zi=Z.object({customerPhone:Z.string().min(10,"Phone number must be exactly 10 digits").max(10,"Phone number must be exactly 10 digits").regex(/^0[0-9]{9}$/,"Phone number must start with 0 and be 10 digits (e.g., 0241234567)"),customerEmail:Z.string().email("Invalid email").optional().or(Z.literal("")),paymentMethod:Z.enum(["paystack"]).default("paystack"),providerId:Z.string().optional()});function _i(){const{productType:s,productId:a,year:t}=Dt(),[,n]=Ke(),{toast:l}=he(),{user:r}=je(),[c,d]=o.useState(!1),x=new URLSearchParams(window.location.search).get("agent"),p=s==="data-bundle",m=s==="result-checker",{data:j,isLoading:h}=V({queryKey:[`/api/products/data-bundles/${a}`],enabled:p&&!!a}),{data:f,isLoading:b}=V({queryKey:[`/api/products/result-checkers/info/${a}/${t}`],enabled:m&&!!a&&!!t}),i=p?j!=null&&j.effective_price?parseFloat(j.effective_price):0:f!=null&&f.price?parseFloat(String(f.price)):0,u=gs({resolver:fs(zi),defaultValues:{customerPhone:(r==null?void 0:r.phone)||"",customerEmail:"",paymentMethod:"paystack"}}),F=re({mutationFn:async U=>{const E={productType:p?"data_bundle":"result_checker",productId:m?`${a}-${t}`:a,customerPhone:U.customerPhone,customerEmail:U.customerEmail||void 0,agentSlug:x||void 0};return(await Y("POST","/api/checkout/initialize",E)).json()},onSuccess:U=>{window.location.href=U.paymentUrl},onError:U=>{const E=U.message||"Unable to process payment";l({title:"âŒ Payment Failed",description:`${E}. Please try again or contact support if the problem persists.`,variant:"destructive",duration:6e3}),d(!1)}}),R=U=>{const E=$s(U.customerPhone);if(p&&j){const se=Ks(E,j.network);if(!se.isValid){const ee=ns(j.network);l({title:"âŒ Phone Number Mismatch",description:se.error||`This bundle is for ${j.network.toUpperCase()} network. Valid prefixes: ${ee.join(", ")}`,variant:"destructive",duration:8e3});return}}d(!0),F.mutate({...U,customerPhone:E})},P=h||b,v=p?j:f;return P?e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(ls,{}),e.jsx("main",{className:"flex-1",children:e.jsx(ya,{text:"Loading product..."})}),e.jsx(Ps,{})]}):v?e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(ls,{}),e.jsx("main",{className:"flex-1 py-12 px-4 pt-16",children:e.jsx("div",{className:"container mx-auto max-w-4xl",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 order-2 lg:order-1",children:e.jsxs(C,{className:"sticky top-24",children:[e.jsx($,{children:e.jsx(B,{className:"text-lg",children:"Order Summary"})}),e.jsxs(D,{className:"space-y-4",children:[p&&j&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx($i,{network:j.network,size:"md"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg","data-testid":"text-product-name",children:j.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(jn,{className:"h-4 w-4"}),e.jsx("span",{children:j.dataAmount})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{children:j.validity})]})]})]})]}),m&&f&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(it,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-medium uppercase",children:f.type})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg","data-testid":"text-product-name",children:[f.type.toUpperCase()," Result Checker"]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Year: ",f.year," â€¢ ",f.stock," in stock"]})]})]}),e.jsx(_t,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsx("span",{className:"font-medium",children:ae(i)})]}),e.jsxs("div",{className:"flex items-center justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-primary","data-testid":"text-total-price",children:ae(i)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground pt-4",children:[e.jsx(js,{className:"h-3 w-3"}),e.jsx("span",{children:"Secured by Paystack"})]})]})]})}),e.jsx("div",{className:"lg:col-span-3 order-1 lg:order-2",children:e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Checkout"}),e.jsx(J,{children:"Enter your details to complete the purchase"})]}),e.jsx(D,{children:e.jsx(ws,{...u,children:e.jsxs("form",{onSubmit:u.handleSubmit(R),className:"space-y-6",children:[e.jsx(me,{control:u.control,name:"paymentMethod",render:({field:U})=>e.jsxs(ce,{className:"space-y-3",children:[e.jsx(Kt,{children:"Payment Method"}),e.jsx(de,{children:e.jsx(dt,{onValueChange:U.onChange,value:U.value,className:"grid gap-3",children:e.jsxs("div",{children:[e.jsx(Cs,{value:"paystack",id:"paystack",className:"peer sr-only"}),e.jsxs(z,{className:"flex items-center justify-between rounded-lg border-2 border-muted !bg-white p-4 hover:border-green-500 peer-data-[state=checked]:border-green-500 peer-data-[state=checked]:bg-green-50 cursor-pointer transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Paystack"}),e.jsx("div",{className:"text-sm text-green-600",children:"Pay with card, bank transfer"})]})]}),U.value==="paystack"&&e.jsx(be,{className:"h-5 w-5 text-green-600"})]})]})})}),e.jsx(oe,{})]})}),hasInsufficientBalance&&u.watch("paymentMethod")==="wallet"&&e.jsxs(ms,{variant:"default",className:"border-destructive/50 bg-white text-destructive",children:[e.jsx(os,{className:"h-4 w-4"}),e.jsxs(xs,{className:"text-sm",children:[e.jsx("strong",{children:"Insufficient Balance:"})," You need GHâ‚µ",(i-walletBalance).toFixed(2)," more.",e.jsx("a",{href:"/user/wallet",className:"underline ml-1 font-medium hover:text-destructive-foreground",children:"Top up wallet"})," or select Paystack below."]})]}),e.jsx(me,{control:u.control,name:"customerPhone",render:({field:U})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Phone Number *"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(It,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(K,{placeholder:"0241234567",autoComplete:"tel",className:"pl-10","data-testid":"input-phone",...U})]})}),e.jsx(ss,{children:p&&j?e.jsxs("span",{className:"text-xs",children:["For ",e.jsx("strong",{children:j.network.toUpperCase()})," network only. Valid prefixes: ",e.jsx("strong",{children:ns(j.network).join(", ")})]}):"We'll send the result checker PIN to this number"}),e.jsx(oe,{})]})}),(r==null?void 0:r.role)==="admin"&&p&&providers&&providers.length>0&&e.jsx(me,{control:u.control,name:"providerId",render:({field:U})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"API Provider"}),e.jsxs(Ae,{onValueChange:U.onChange,value:U.value,children:[e.jsx(de,{children:e.jsx(Pe,{children:e.jsx(Te,{placeholder:"Select API provider"})})}),e.jsx(Ce,{children:providers.map(E=>e.jsxs(H,{value:E.id,children:[E.name," ",E.isDefault?"(Default)":""]},E.id))})]}),e.jsx(ss,{children:"Choose which external API provider to use for this transaction"}),e.jsx(oe,{})]})}),e.jsx(me,{control:u.control,name:"customerEmail",render:({field:U})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Email (optional)"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Pt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(K,{placeholder:"you@example.com",type:"email",autoComplete:"email",className:"pl-10","data-testid":"input-email",...U})]})}),e.jsx(ss,{children:"We'll send a receipt to this email"}),e.jsx(oe,{})]})}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(Mr,{className:"h-5 w-5 text-green-600 dark:text-green-400 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-green-800 dark:text-green-300",children:"Secure Payment"}),e.jsx("p",{className:"text-green-700 dark:text-green-400",children:"Your payment is processed securely through Paystack. We never store your card details."})]})]}),e.jsx(g,{type:"submit",size:"lg",className:"w-full gap-2",disabled:c,"data-testid":"button-pay",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:["Pay ",ae(i)]})})]})})})]})})]})})}),e.jsx(Ps,{})]}):e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(ls,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center",children:e.jsx(C,{className:"max-w-md w-full mx-4",children:e.jsxs(D,{className:"pt-6 text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Product Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The product you're looking for doesn't exist or is no longer available."}),e.jsx(g,{onClick:()=>n("/"),children:"Back to Products"})]})})}),e.jsx(Ps,{})]})}function Gi(){const s=$r(),[,a]=Ke(),{toast:t}=he(),{user:n,isLoading:l}=je(),r=new URLSearchParams(s),c=r.get("reference"),d=r.get("trxref"),x=r.get("status"),p=()=>{try{const w=localStorage.getItem("agentStorefront");if(w){const{role:N,slug:y,network:I}=JSON.parse(w);return localStorage.removeItem("agentStorefront"),`/store/${N}/${y}/${I}`}}catch(w){console.error("Failed to parse agentStorefront:",w)}return"/"},m=()=>n?n.role==="agent"||n.role==="dealer"||n.role==="super_dealer"?`/${n.role}/dashboard`:"/user/dashboard":"/",j=()=>{try{return!!localStorage.getItem("agentStorefront")}catch{return!1}},[h,f]=o.useState(!1),[b,i]=o.useState(x==="failed"||x==="cancelled"),[u,F]=o.useState(!1),{data:R}=V({queryKey:[`/api/transactions/verify/${c||d}`],queryFn:async()=>{const w=await fetch(`/api/transactions/verify/${c||d}`,{headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},cache:"no-store"});if(!w.ok){const N=await w.json().catch(()=>({error:"Unknown error"}));throw new Error(N.error||N.message||`API request failed: ${w.status} ${w.statusText}`)}return w.json()},enabled:!!(c||d)&&!b,retry:1,retryDelay:1e3});o.useEffect(()=>{R&&(f(!0),R.success===!1&&i(!0))},[R]);const P=R==null?void 0:R.transaction;if(o.useEffect(()=>{if(console.log("=== Auto-download effect triggered ==="),console.log("hasTransaction:",!!P),console.log("verificationComplete:",h),console.log("authLoading:",l),console.log("hasUser:",!!n),console.log("transactionType:",P==null?void 0:P.type),console.log("transactionId:",P==null?void 0:P.id),console.log("autoDownloadTriggered:",u),P&&h&&P.type==="result_checker"&&P.id&&!u){console.log("âœ… All conditions met! Triggering auto-download for result checker"),F(!0);const w=setTimeout(async()=>{try{console.log("ðŸ” Fetching PDF for guest download...");const N=await fetch(`/api/result-checker/download/${P.reference}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/pdf"}});if(!N.ok){console.warn("PDF not ready yet, status:",N.status);const k=await N.json().catch(()=>({error:"Unknown error"}));console.error("PDF error:",k),t({title:"PDF Not Ready",description:k.error||"Please click the download button manually",variant:"destructive"});return}const y=await N.blob(),I=window.URL.createObjectURL(y),T=document.createElement("a");T.href=I,T.download=`${P.productName.replace(/\s+/g,"-")}-${P.reference}.pdf`,document.body.appendChild(T),T.click(),document.body.removeChild(T),window.URL.revokeObjectURL(I),t({title:"Download Started",description:"Your result checker credentials are downloading"}),console.log("ðŸ“¥ Auto-download triggered successfully")}catch(N){console.error("Auto-download failed:",N),t({title:"Auto-download Failed",description:"Please click the download button manually",variant:"destructive"})}},2e3);return()=>clearTimeout(w)}},[P,h,u,t]),l)return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(ls,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx(C,{className:"max-w-md w-full",children:e.jsxs(D,{className:"pt-6 text-center",children:[e.jsx(ya,{}),e.jsx("h2",{className:"text-xl font-semibold mb-2 mt-4",children:"Restoring Session"}),e.jsx("p",{className:"text-muted-foreground",children:"Please wait while we verify your authentication..."})]})})}),e.jsx(Ps,{})]});const v=w=>{navigator.clipboard.writeText(w),t({title:"Copied!",description:"Details copied to clipboard"})};if(!c&&!d)return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(ls,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx(C,{className:"max-w-md w-full",children:e.jsxs(D,{className:"pt-6 text-center",children:[e.jsx(is,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Invalid Request"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"No transaction reference provided."}),e.jsx(g,{onClick:()=>{const w=localStorage.getItem("agentStore");a(w?`/store/agent/${w}`:"/")},"data-testid":"button-go-home",children:localStorage.getItem("agentStore")?"Back to Store":"Go to Home"})]})})}),e.jsx(Ps,{})]});if(b)return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(ls,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx(C,{className:"max-w-md w-full",children:e.jsxs(D,{className:"pt-6 text-center",children:[e.jsx(is,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsxs("h2",{className:"text-xl font-semibold mb-2",children:["Payment ",x==="cancelled"?"Cancelled":"Failed"]}),e.jsx("p",{className:"text-muted-foreground mb-4",children:x==="cancelled"?"You cancelled the payment. No charges were made to your account.":"Your payment could not be processed. Please try again."}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(g,{onClick:()=>{const w=localStorage.getItem("agentStore");a(w?`/store/agent/${w}`:"/")},children:localStorage.getItem("agentStore")?"Back to Store":"Go to Home"}),e.jsx(g,{variant:"outline",onClick:()=>window.history.back(),children:"Try Again"})]})]})})}),e.jsx(Ps,{})]});const U={completed:{icon:be,color:"text-white",bgColor:"bg-green-500 dark:bg-green-600",title:"Payment Successful!",description:h?"Your transaction has been completed successfully.":"Verifying transaction..."},pending:{icon:ze,color:"text-white",bgColor:"bg-orange-500 dark:bg-orange-600",title:"Payment Processing",description:"Your payment is being processed. Please wait..."},failed:{icon:is,color:"text-white",bgColor:"bg-red-500 dark:bg-red-600",title:"Payment Failed",description:"Your payment could not be processed. Please try again."}};let E;(P==null?void 0:P.type)==="data_bundle"&&(P==null?void 0:P.paymentStatus)==="paid"?E="completed":(P==null?void 0:P.type)==="result_checker"&&(P==null?void 0:P.paymentStatus)==="paid"?E=P.status==="completed"?"completed":"pending":E=(P==null?void 0:P.status)||(x==="success"?"completed":"pending");const se=E,ee=U[se],le=ee.icon;return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(ls,{}),e.jsx("main",{className:"flex-1 py-12 px-4 pt-16",children:e.jsx("div",{className:"container mx-auto max-w-lg",children:e.jsxs(C,{children:[e.jsxs($,{className:"text-center",children:[e.jsx("div",{className:`flex h-16 w-16 items-center justify-center rounded-full ${ee.bgColor} mx-auto mb-4`,children:e.jsx(le,{className:`h-8 w-8 ${ee.color}`})}),e.jsx(B,{className:"text-2xl","data-testid":"text-status-title",children:ee.title}),e.jsx(J,{children:ee.description})]}),e.jsxs(D,{className:"space-y-6",children:[!h&&e.jsxs("div",{className:"bg-blue-500 dark:bg-blue-600 rounded-lg p-4 flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("p",{className:"text-sm text-white font-medium",children:"Verifying transaction details..."})]}),P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-slate-700 dark:bg-slate-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Transaction ID"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-mono text-white","data-testid":"text-transaction-id",children:P.id}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6 text-white hover:bg-white/20",onClick:()=>v(P.id),children:e.jsx(_s,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Reference"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-mono text-white","data-testid":"text-reference",children:P.reference}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6 text-white hover:bg-white/20",onClick:()=>v(P.reference),children:e.jsx(_s,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Product"}),e.jsx("span",{className:"text-sm font-medium text-white","data-testid":"text-product",children:P.productName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Amount"}),e.jsx("span",{className:"text-sm font-medium text-white","data-testid":"text-amount",children:ae(P.amount)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Phone"}),e.jsx("span",{className:"text-sm font-medium text-white",children:P.customerPhone})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Date"}),e.jsx("span",{className:"text-sm text-white",children:Qe(P.createdAt)})]})]}),P.isBulkOrder&&P.phoneNumbers&&e.jsxs("div",{className:"bg-blue-500 dark:bg-blue-600 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(It,{className:"h-4 w-4"}),"Bulk Order Recipients (",P.phoneNumbers.length,")"]}),e.jsxs(g,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:()=>v(P.phoneNumbers.join(`
`)),children:[e.jsx(_s,{className:"h-3 w-3 mr-1"}),"Copy All"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto",children:P.phoneNumbers.map((w,N)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-900 dark:text-white bg-white dark:bg-blue-700 rounded px-2 py-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[N+1,"."]}),e.jsx("code",{className:"font-mono",children:w})]},N))})]}),P.status==="completed"&&P.type==="result_checker"&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-green-800 dark:text-green-300 mb-3",children:"Download Your Result Checker"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-400 mb-3",children:"Your result checker has been purchased successfully. Download your PDF credentials below."}),e.jsxs(g,{onClick:async()=>{try{const w=await fetch(`/api/result-checker/download/${P.reference}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/pdf"}});if(!w.ok){const T=await w.json().catch(()=>({error:"Unknown error"}));throw new Error(T.error||`Failed to download PDF: ${w.status}`)}const N=await w.blob(),y=window.URL.createObjectURL(N),I=document.createElement("a");I.href=y,I.download=`${P.productName.replace(/\s+/g,"-")}-${P.reference}.pdf`,document.body.appendChild(I),I.click(),document.body.removeChild(I),window.URL.revokeObjectURL(y),t({title:"âœ… Downloaded",description:"Your PDF credentials have been downloaded successfully"})}catch(w){console.error("PDF Download error:",w),t({title:"âŒ Download Failed",description:w.message||"Failed to download PDF. Please contact support.",variant:"destructive"})}},className:"w-full gap-2 bg-green-400 hover:bg-green-300 text-black border-2 border-green-400 font-semibold","data-testid":"button-download-pdf",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download PDF Credentials"]})]}),se==="completed"&&P.type==="data_bundle"&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-green-800 dark:text-green-300 mb-2 flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Order Placed Successfully"]}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-400",children:["Your data bundle order for ",e.jsx("strong",{children:P.customerPhone})," has been placed with our provider.",P.deliveryStatus==="processing"&&e.jsx("span",{className:"block mt-1",children:"â³ Delivery in progress - you will receive an SMS confirmation shortly."}),P.deliveryStatus==="delivered"&&e.jsx("span",{className:"block mt-1",children:"âœ“ Delivered! Check your phone for confirmation."})]})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:j()?e.jsxs(g,{onClick:()=>a(p()),className:"gap-2 flex-1",variant:"outline","data-testid":"button-continue-shopping",children:["Continue Shopping",e.jsx(Mt,{className:"h-4 w-4"})]}):e.jsxs(g,{onClick:()=>a(m()),className:"gap-2 flex-1",variant:"outline","data-testid":"button-continue-dashboard",children:["Back to Dashboard",e.jsx(Mt,{className:"h-4 w-4"})]})})]})]})})}),e.jsx(Ps,{})]})}function Wi({reference:s,agent:a,authLoading:t,attempts:n,query:l,setLocation:r}){const{data:c,isLoading:d,isError:x}=l;return t?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ls,{}),e.jsx("div",{className:"container mx-auto px-4 py-16 flex items-center justify-center",children:e.jsx(C,{className:"max-w-md w-full",children:e.jsxs(D,{className:"pt-6 text-center",children:[e.jsx(Q,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Restoring Session"}),e.jsx("p",{className:"text-muted-foreground",children:"Please wait while we verify your authentication."})]})})})]}):s?d||!c&&n<10?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ls,{}),e.jsx("div",{className:"container mx-auto px-4 py-16 flex items-center justify-center",children:e.jsxs(C,{className:"max-w-md w-full",children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-6 w-6 animate-spin"}),"Verifying Payment"]}),e.jsxs(J,{children:["Attempt ",n+1," of 10"]})]}),e.jsx(D,{children:e.jsx("p",{className:"text-muted-foreground",children:"Please wait while we confirm your payment."})})]})})]}):x||!(c!=null&&c.success)?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ls,{}),e.jsx("div",{className:"container mx-auto px-4 py-16 flex items-center justify-center",children:e.jsxs(C,{className:"max-w-md w-full border-destructive/50",children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(is,{className:"h-6 w-6"}),"Payment Verification Failed"]}),e.jsxs(J,{children:["Reference: ",s]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsx("p",{className:"text-muted-foreground",children:(c==null?void 0:c.message)??"We could not verify your payment."}),e.jsx(g,{className:"w-full",onClick:()=>r(a?"/agent/wallet":"/user/wallet"),children:"Check Wallet"})]})]})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ls,{}),e.jsx("div",{className:"container mx-auto px-4 py-16 flex items-center justify-center",children:e.jsxs(C,{className:"max-w-md w-full",children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2 text-green-600",children:[e.jsx(be,{className:"h-6 w-6"}),"Top-up Successful"]}),e.jsx(J,{children:"Your wallet has been credited"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-500 text-white border border-green-600 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Amount Added"}),e.jsxs("span",{className:"font-bold",children:["GHâ‚µ",c.amount]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"New Balance"}),e.jsxs("span",{className:"font-bold",children:["GHâ‚µ",c.newBalance]})]})]}),e.jsxs(g,{variant:"outline",className:"w-full",onClick:()=>r(a?"/agent/dashboard":"/user/dashboard"),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Continue"]}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground",children:["Reference: ",s]})]})]})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ls,{}),e.jsx("div",{className:"container mx-auto px-4 py-16 flex items-center justify-center",children:e.jsxs(C,{className:"max-w-md w-full",children:[e.jsx($,{children:e.jsxs(B,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(is,{className:"h-6 w-6"}),"Invalid Request"]})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No transaction reference was found."}),e.jsx(g,{onClick:()=>r("/user/wallet"),className:"w-full",children:"Go to Wallet"})]})]})})]})}function Ki(){const[,s]=Ke(),t=new URLSearchParams($r()).get("reference"),{agent:n,isLoading:l}=je(),r=Fs(),[c,d]=o.useState(0),x=V({queryKey:t?["wallet-topup-verify",t]:["wallet-topup-missing-ref"],queryFn:async()=>Ie(`/api/wallet/topup/verify/${t}`,{disableAutoLogout:!0}),enabled:!!t&&!l&&c<10,refetchInterval:p=>{var m;return(m=p.state.data)!=null&&m.success?!1:3e3}});return o.useEffect(()=>{!x.data||x.data.success||c>=10||d(p=>p+1)},[x.data]),o.useEffect(()=>{var p;(p=x.data)!=null&&p.success&&(r.invalidateQueries({queryKey:["/api/user/stats"]}),r.invalidateQueries({queryKey:["/api/auth/me"]}),r.invalidateQueries({queryKey:["/api/agent/transactions"]}),r.invalidateQueries({queryKey:["/api/agent/wallet"]}))},[x.data,r]),e.jsx(Wi,{reference:t,agent:n,authLoading:l,attempts:c,query:x,setLocation:s})}function Hi(){return e.jsx(Ki,{})}const bs=o.forwardRef(({className:s,...a},t)=>e.jsx("textarea",{className:L("flex min-h-[80px] w-full rounded-md border border-input bg-white px-3 py-2 text-base text-black ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...a}));bs.displayName="Textarea";const Dl=o.forwardRef(({className:s,...a},t)=>e.jsx(Or,{ref:t,className:L("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...a,children:e.jsx(gn,{className:L("flex items-center justify-center text-current"),children:e.jsx(Bt,{className:"h-4 w-4"})})}));Dl.displayName=Or.displayName;const Vi=Z.object({name:Z.string().min(2,"Name must be at least 2 characters"),email:Z.string().email("Invalid email address"),phone:Z.string().min(10,"Phone must be at least 10 digits"),password:Z.string().min(8,"Password must be at least 8 characters"),confirmPassword:Z.string(),businessName:Z.string().min(2,"Business name is required"),storefrontSlug:Z.string().min(3,"URL must be at least 3 characters").regex(/^[a-z0-9-]+$/,"Only lowercase letters, numbers, and hyphens"),businessDescription:Z.string().optional(),agreedToTerms:Z.boolean().refine(s=>s===!0,{message:"You must agree to the terms and conditions"})}).refine(s=>s.password===s.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function Yi(){const[s,a]=o.useState(!1),[t,n]=o.useState(()=>typeof window<"u"?!localStorage.getItem("agent-info-dialog-seen"):!0),{toast:l}=he(),{theme:r}=Bs(),c=h=>{navigator.clipboard.writeText(h),l({title:"Copied!",description:"URL copied to clipboard"})},d=gs({resolver:fs(Vi),mode:"onSubmit",defaultValues:{name:"",email:typeof window<"u"&&new URLSearchParams(window.location.search).get("email")||"",phone:"",password:"",confirmPassword:"",businessName:"",storefrontSlug:"",businessDescription:"",agreedToTerms:!1}}),x=re({mutationFn:async h=>await Y("POST","/api/agent/register",h),onSuccess:h=>{h.paymentUrl?(l({title:"Registration successful!",description:"Redirecting to payment..."}),window.location.href=h.paymentUrl):l({title:"Registration failed",description:"Payment initialization failed",variant:"destructive"})},onError:h=>{console.error("Mutation error:",h),h.message&&h.message.includes("rate limit")?l({title:"Too Many Attempts",description:h.message||"You've exceeded the registration attempt limit. Please wait a few minutes before trying again.",variant:"destructive",duration:8e3}):l({title:"Registration failed",description:h.message||"Something went wrong",variant:"destructive"})}}),p=h=>{x.mutate(h)},m=h=>{n(h),!h&&typeof window<"u"&&localStorage.setItem("agent-info-dialog-seen","true")},j=o.useMemo(()=>typeof window<"u"?window.location.origin:"",[]);return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background px-4 py-6",children:[e.jsx("nav",{className:"mb-6 px-2",children:e.jsx(G,{href:typeof window<"u"&&ps()?`/store/${ps()}`:"/","data-testid":"link-back-home",children:e.jsxs(g,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(Ft,{className:"h-4 w-4"}),"Back to Home"]})})}),e.jsx(ts,{open:t,onOpenChange:m,children:e.jsxs(_e,{className:"max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-black",children:[e.jsxs(Ge,{children:[e.jsxs(We,{className:"flex items-center gap-2 text-xl text-white",children:[e.jsx(wr,{className:"h-6 w-6 text-blue-600"}),"Important Information for Agents"]}),e.jsx(As,{className:"sr-only",children:"Read important information about agent registration and activation requirements"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx(lt,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-900",children:"Activation Fee"}),e.jsxs("p",{className:"text-sm text-blue-800",children:["A one-time payment of ",e.jsx("strong",{children:"GHâ‚µ60.00"})," is required to activate your agent account."]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx(lt,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-900",children:"Instant Activation"}),e.jsx("p",{className:"text-sm text-green-800",children:"Your account will be automatically activated once payment is confirmed."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx(lt,{className:"h-5 w-5 text-purple-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-purple-900",children:"Commission Structure"}),e.jsx("p",{className:"text-sm text-purple-800",children:"Earn competitive commissions on every transaction you process."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-indigo-50 rounded-lg border border-indigo-200",children:[e.jsx(lt,{className:"h-5 w-5 text-indigo-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-indigo-900",children:"Your Storefront"}),e.jsx("p",{className:"text-sm text-indigo-800",children:"Get a personalized storefront URL to share with your customers."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-cyan-50 rounded-lg border border-cyan-200",children:[e.jsx(lt,{className:"h-5 w-5 text-cyan-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-cyan-900",children:"Payment Methods"}),e.jsx("p",{className:"text-sm text-cyan-800",children:"Accept payments via Mobile Money, Cards, and Bank transfers."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx(os,{className:"h-5 w-5 text-orange-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-orange-900",children:"Requirements"}),e.jsx("p",{className:"text-sm text-orange-800",children:"Valid phone number, email address, and business information."})]})]})]})}),e.jsx(Sa,{children:e.jsx(g,{onClick:()=>n(!1),className:"w-full sm:w-auto",children:"I Understand, Proceed to Registration"})})]})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-4xl",children:e.jsxs(C,{className:"w-full shadow-xl border-2 border-yellow-400",children:[e.jsxs($,{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:r==="dark"?gt:tt,alt:"ResellersHub Pro",className:"h-12 w-auto"})}),e.jsx(B,{className:"text-2xl font-bold",children:"Become an Agent"}),e.jsxs(J,{children:["Create your ",Gs," agent account and start earning"]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mt-4",children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-900",children:"Activation Fee: GHâ‚µ60.00"}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Payment required after registration"})]})]}),e.jsxs(D,{children:[e.jsx(ws,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(p),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(me,{control:d.control,name:"name",render:({field:h})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Full Name"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(la,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(K,{placeholder:"John Doe",autoComplete:"name",className:"pl-10","data-testid":"input-name",...h})]})}),e.jsx(oe,{})]})}),e.jsx(me,{control:d.control,name:"phone",render:({field:h})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Phone Number"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(It,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(K,{placeholder:"0241234567",autoComplete:"tel",className:"pl-10","data-testid":"input-phone",...h})]})}),e.jsx(oe,{})]})})]}),e.jsx(me,{control:d.control,name:"email",render:({field:h})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Email"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Pt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(K,{placeholder:"you@example.com",type:"email",autoComplete:"email",className:"pl-10","data-testid":"input-email",...h})]})}),e.jsx(oe,{})]})}),e.jsx(me,{control:d.control,name:"businessName",render:({field:h})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Business Name"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(zs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(K,{placeholder:"My Data Store",className:"pl-10","data-testid":"input-business",...h})]})}),e.jsx(oe,{})]})}),e.jsx(me,{control:d.control,name:"storefrontSlug",render:({field:h})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Storefront URL"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(fn,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(K,{placeholder:"my-store",className:"pl-10","data-testid":"input-slug",...h})]})}),e.jsx(ss,{children:h.value&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("span",{children:["Your store: ",j,"/store/agent/",e.jsx("strong",{children:h.value})]}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>c(`${j}/store/agent/${h.value}`),children:e.jsx(_s,{className:"h-3 w-3"})})]})}),e.jsx(oe,{})]})}),e.jsx(me,{control:d.control,name:"businessDescription",render:({field:h})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Business Description (optional)"}),e.jsx(de,{children:e.jsx(bs,{placeholder:"Tell customers about your business...",className:"resize-none","data-testid":"input-description",...h})}),e.jsx(oe,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(me,{control:d.control,name:"password",render:({field:h})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Password"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(js,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(K,{type:s?"text":"password",autoComplete:"new-password",className:"pl-10 pr-10","data-testid":"input-password",...h}),e.jsx(g,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3",onClick:()=>a(!s),children:s?e.jsx(Js,{className:"h-4 w-4"}):e.jsx(Zs,{className:"h-4 w-4"})})]})}),e.jsx(oe,{})]})}),e.jsx(me,{control:d.control,name:"confirmPassword",render:({field:h})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Confirm Password"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(js,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(K,{type:s?"text":"password",autoComplete:"new-password",className:"pl-10","data-testid":"input-confirm",...h})]})}),e.jsx(oe,{})]})})]}),e.jsx(me,{control:d.control,name:"agreedToTerms",render:({field:h})=>e.jsxs(ce,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(de,{children:e.jsx(Dl,{checked:h.value,onCheckedChange:h.onChange,"data-testid":"checkbox-terms"})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(xe,{className:"text-sm font-medium",children:"I agree to pay the GHâ‚µ60.00 activation fee and accept the terms and conditions"}),e.jsx(ss,{className:"text-xs",children:"By checking this box, you confirm that you understand the activation fee is required and agree to our terms of service."}),e.jsx(oe,{})]})]})}),e.jsxs(g,{type:"submit",className:"w-full",disabled:x.isPending,"data-testid":"button-submit",children:[x.isPending&&e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Proceed to Payment (GHâ‚µ60.00)"]})]})}),e.jsxs("div",{className:"mt-6 text-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground dark:text-gray-300",children:"Already have an account? "}),e.jsx(G,{href:"/login",className:"text-primary hover:underline font-medium",children:"Sign in"})]})]})]})})})]})}function Qi(){const[s,a]=o.useState("processing"),[t,n]=o.useState(""),[l,r]=o.useState(""),[,c]=Ke(),[d,x]=o.useState(6);je();const{theme:p}=Bs();return o.useEffect(()=>{const m=new URLSearchParams(window.location.search),j=m.get("reference"),h=m.get("mock")==="true";if(!j){a("failed");return}if(h){a("success"),r("test@example.com"),setTimeout(()=>{const b=setInterval(()=>{x(i=>i<=1?(clearInterval(b),c("/login"),0):i-1)},1e3)},1e3);return}const f=async()=>{var b,i;try{const F=await(await fetch(`/api/paystack/verify?reference=${j}`)).json();F.status==="success"?(a("success"),(i=(b=F.data)==null?void 0:b.user)!=null&&i.email&&r(F.data.user.email),setTimeout(()=>{const R=setInterval(()=>{x(P=>P<=1?(clearInterval(R),c("/login"),0):P-1)},1e3)},1500)):F.status==="cancelled"?(a("cancelled"),n(F.message||"Payment was cancelled")):(a("failed"),n(F.message||F.error||"Payment verification failed"))}catch(u){console.error("Payment verification error:",u),a("failed"),n("Network error. Please check your connection and try again.")}};setTimeout(()=>{f()},3e3)},[c]),e.jsx("div",{className:"min-h-screen flex flex-col bg-background px-4 py-6",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs(C,{className:"w-full max-w-lg shadow-xl border-2 bg-white dark:bg-black border-gray-200",children:[e.jsxs($,{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:p==="dark"?gt:tt,alt:"ResellersHub Pro",className:"h-12 w-auto"})}),e.jsx(B,{className:"text-2xl font-bold",children:"Agent Activation"}),e.jsx(J,{children:"Processing your payment"})]}),e.jsxs(D,{className:"space-y-6",children:[s==="processing"&&e.jsxs(ms,{className:"bg-white dark:bg-black border border-blue-200",children:[e.jsx(Q,{className:"h-5 w-5 text-blue-600 animate-spin"}),e.jsx(kt,{className:"text-blue-900",children:"Processing Payment..."}),e.jsx(xs,{className:"text-blue-800",children:"Please wait while we verify your payment. This may take a few moments."})]}),s==="success"&&e.jsxs(e.Fragment,{children:[e.jsxs(ms,{className:"bg-white dark:bg-black border border-green-200",children:[e.jsx(lt,{className:"h-5 w-5 text-green-600"}),e.jsx(kt,{className:"text-green-900 text-lg font-semibold",children:"ðŸŽ‰ Account Activated Successfully!"}),e.jsxs(xs,{className:"text-green-800 space-y-3 mt-2",children:[e.jsx("p",{className:"font-semibold",children:"Congratulations! Your agent account has been successfully created and activated."}),e.jsxs("div",{className:"bg-white/80 dark:bg-black/80 p-3 rounded-md border border-green-300",children:[e.jsx("p",{className:"font-semibold text-sm mb-2",children:"âœ‰ï¸ Account Details:"}),l&&e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",l]}),e.jsx("p",{className:"text-sm mt-1 text-green-900",children:"Please use your registration email and password to login."})]}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsx("p",{className:"font-semibold",children:"ðŸš€ What's next?"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[e.jsx("li",{children:"Login to access your agent dashboard"}),e.jsx("li",{children:"Set up your storefront preferences"}),e.jsx("li",{children:"Start selling and earning commissions"}),e.jsx("li",{children:"Share your storefront URL with customers"})]})]})]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(G,{href:"/login",children:e.jsx(g,{className:"w-full",size:"lg",children:"Login to Your Dashboard"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use your email and password to access your account"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Redirecting to login in ",d,"sâ€¦"]})]})]}),s==="cancelled"&&e.jsxs(e.Fragment,{children:[e.jsxs(ms,{className:"bg-white dark:bg-black border border-amber-200",children:[e.jsx(os,{className:"h-5 w-5 text-amber-600"}),e.jsx(kt,{className:"text-amber-900 text-lg font-semibold",children:"Payment Cancelled"}),e.jsxs(xs,{className:"text-amber-800",children:[e.jsx("p",{className:"font-semibold",children:t||"You cancelled the payment."}),e.jsx("p",{className:"mt-2",children:"Your registration was not completed because payment was cancelled. No charges have been made to your account."}),e.jsx("p",{className:"mt-2 text-sm",children:"You can try again whenever you're ready to complete your agent registration."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(G,{href:"/agent/register",className:"flex-1",children:e.jsx(g,{className:"w-full",children:"Try Again"})}),e.jsx(G,{href:typeof window<"u"&&ps()?`/store/${ps()}`:"/",className:"flex-1",children:e.jsx(g,{variant:"outline",className:"w-full",children:"Back to Home"})})]})]}),s==="failed"&&e.jsxs(e.Fragment,{children:[e.jsxs(ms,{className:"bg-white dark:bg-black border border-red-200",children:[e.jsx(is,{className:"h-5 w-5 text-red-600"}),e.jsx(kt,{className:"text-red-900 text-lg font-semibold",children:"Activation Failed"}),e.jsxs(xs,{className:"text-red-800",children:[e.jsx("p",{className:"font-semibold",children:t||"We couldn't verify your payment."}),e.jsx("p",{className:"mt-2",children:"This could be due to:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 ml-2 space-y-1 text-sm",children:[e.jsx("li",{children:"Payment failed to process"}),e.jsx("li",{children:"Network connection issues"}),e.jsx("li",{children:"Invalid payment reference"})]}),e.jsx("p",{className:"mt-3 text-sm font-semibold",children:"Please try registering again or contact support if you were charged."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(G,{href:"/agent/register",className:"flex-1",children:e.jsx(g,{variant:"outline",className:"w-full",children:"Try Again"})}),e.jsx(G,{href:typeof window<"u"&&ps()?`/store/${ps()}`:"/",className:"flex-1",children:e.jsx(g,{className:"w-full",children:"Back to Home"})})]})]})]})]})})})}function Xi(){const{theme:s}=Bs();return e.jsx("div",{className:"min-h-screen flex flex-col bg-background px-4 py-6",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs(C,{className:"w-full max-w-2xl shadow-xl border-2",children:[e.jsxs($,{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:s==="dark"?gt:tt,alt:"ResellersHub Pro",className:"h-12 w-auto"})}),e.jsx(B,{className:"text-2xl font-bold",children:"Upgrade to Agent"}),e.jsx(J,{children:"Become an agent and start earning commissions"})]}),e.jsx(D,{children:e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(G,{href:"/user/dashboard?upgrade=true",children:e.jsx(g,{variant:"outline",children:"Use Same Account"})}),e.jsx(G,{href:"/agent/register",children:e.jsx(g,{variant:"default",children:"Create New Agent Account"})})]})})]})})})}const st=o.forwardRef(({className:s,children:a,...t},n)=>e.jsxs(Br,{ref:n,className:L("relative overflow-hidden",s),...t,children:[e.jsx(Nn,{className:"h-full w-full rounded-[inherit]",children:a}),e.jsx(El,{}),e.jsx(bn,{})]}));st.displayName=Br.displayName;const El=o.forwardRef(({className:s,orientation:a="vertical",...t},n)=>e.jsx(qr,{ref:n,orientation:a,className:L("flex touch-none select-none transition-colors",a==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",a==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...t,children:e.jsx(vn,{className:"relative flex-1 rounded-full bg-border"})}));El.displayName=qr.displayName;function Rt({open:s,onOpenChange:a}){const{user:t}=je(),{toast:n}=he(),l=Fs(),[r,c]=o.useState(""),[d,x]=o.useState(!1),[p,m]=o.useState(null),[j,h]=o.useState(null),{data:f,isLoading:b}=V({queryKey:["/api/user/api-keys"],enabled:!!t&&s}),i=re({mutationFn:async v=>await Y("POST","/api/user/api-keys",{name:v}),onSuccess:v=>{m(v.key),c(""),x(!1),l.invalidateQueries({queryKey:["/api/user/api-keys"]}),n({title:"API Key Created",description:"Your new API key has been generated. Copy it now - it won't be shown again."})},onError:v=>{n({title:"Error",description:v.message||"Failed to create API key",variant:"destructive"})}}),u=re({mutationFn:async v=>{await Y("DELETE",`/api/user/api-keys/${v}`)},onSuccess:()=>{l.invalidateQueries({queryKey:["/api/user/api-keys"]}),n({title:"API Key Revoked",description:"The API key has been permanently deleted."})},onError:v=>{n({title:"Error",description:v.message||"Failed to revoke API key",variant:"destructive"})}}),F=async(v,U)=>{try{await navigator.clipboard.writeText(v),h(U),setTimeout(()=>h(null),2e3),n({title:"Copied",description:"API key copied to clipboard"})}catch{n({title:"Error",description:"Failed to copy to clipboard",variant:"destructive"})}},R=()=>{r.trim()&&i.mutate(r.trim())},P=v=>{confirm("Are you sure you want to revoke this API key? This action cannot be undone.")&&u.mutate(v)};return e.jsx(ts,{open:s,onOpenChange:a,children:e.jsxs(_e,{className:"max-w-[95vw] sm:max-w-md md:max-w-2xl lg:max-w-4xl max-h-[95vh] overflow-y-auto",children:[e.jsxs(Ge,{className:"pb-3 sm:pb-4",children:[e.jsxs(We,{className:"flex items-center gap-2 text-base sm:text-lg md:text-xl",children:[e.jsx(Ns,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"API & Integrations"})]}),e.jsx(As,{className:"text-xs sm:text-sm leading-relaxed",children:"Generate secure API keys to connect your app or third-party services."})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4 md:space-y-6",children:[p&&e.jsxs(ms,{className:"border-yellow-200 bg-yellow-50 p-3 sm:p-4",children:[e.jsx(os,{className:"h-3 w-3 sm:h-4 sm:w-4 text-yellow-600 flex-shrink-0"}),e.jsxs(xs,{className:"text-yellow-800 text-xs sm:text-sm leading-relaxed",children:[e.jsx("strong",{children:"New API Key Created:"})," ",p,e.jsxs(g,{variant:"outline",size:"sm",className:"ml-2 mt-2 sm:mt-0 h-6 px-2 text-xs sm:h-7 sm:px-3",onClick:()=>F(p,"created"),children:[j==="created"?e.jsx(Bt,{className:"h-2.5 w-2.5"}):e.jsx(_s,{className:"h-2.5 w-2.5"}),e.jsx("span",{className:"ml-1 hidden sm:inline",children:"Copy"})]})]})]}),e.jsxs(C,{className:"p-3 sm:p-4 md:p-6",children:[e.jsx($,{className:"pb-2 sm:pb-3 px-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(B,{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx($t,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),"API Keys"]}),e.jsx(J,{className:"text-xs sm:text-sm mt-1",children:"Manage your API keys for secure access to our platform"})]}),e.jsxs(ts,{open:d,onOpenChange:x,children:[e.jsx(Ws,{asChild:!0,children:e.jsxs(g,{size:"sm",className:"w-full sm:w-auto h-8 px-3 text-xs sm:h-9 sm:px-4 sm:text-sm",children:[e.jsx(hs,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{children:"Create API Key"})]})}),e.jsxs(_e,{className:"w-[95vw] sm:w-full max-w-md mx-4 sm:mx-auto",children:[e.jsxs(Ge,{className:"pb-3 sm:pb-4",children:[e.jsx(We,{className:"text-sm sm:text-base",children:"Create New API Key"}),e.jsx(As,{className:"text-xs sm:text-sm leading-relaxed",children:"Enter a name for your API key. This will help you identify it later."})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"keyName",className:"text-xs sm:text-sm font-medium",children:"API Key Name"}),e.jsx(K,{id:"keyName",placeholder:"e.g., My App, Production API",value:r,onChange:v=>c(v.target.value),onKeyDown:v=>v.key==="Enter"&&R(),className:"h-9 sm:h-10 text-sm"})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row sm:justify-end gap-2 sm:gap-3",children:[e.jsx(g,{variant:"outline",onClick:()=>x(!1),size:"sm",className:"w-full sm:w-auto h-8 px-3 text-xs sm:h-9 sm:px-4 sm:text-sm",children:"Cancel"}),e.jsxs(g,{onClick:R,disabled:!r.trim()||i.isPending,size:"sm",className:"w-full sm:w-auto h-8 px-3 text-xs sm:h-9 sm:px-4 sm:text-sm",children:[i.isPending&&e.jsx(Q,{className:"h-3 w-3 mr-1 animate-spin"}),"Create Key"]})]})]})]})]})]})}),e.jsx(D,{className:"px-0 pt-0",children:b?e.jsx("div",{className:"flex items-center justify-center py-6 sm:py-8",children:e.jsx(Q,{className:"h-6 w-6 sm:h-8 sm:w-8 animate-spin"})}):f&&f.length>0?e.jsx("div",{className:"space-y-2 sm:space-y-3 md:space-y-4",children:f.map(v=>e.jsx("div",{className:"flex flex-col gap-3 p-3 sm:p-4 border rounded-lg bg-card hover:bg-accent/50 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"space-y-2 flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm sm:text-base truncate",children:v.name}),e.jsx(X,{variant:v.isActive?"default":"secondary",className:"text-xs px-2 py-0.5",children:v.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["Created ",new Date(v.createdAt).toLocaleDateString()]}),v.lastUsed&&e.jsxs("div",{children:["Last used ",new Date(v.lastUsed).toLocaleDateString()]})]}),e.jsx("div",{className:"font-mono text-xs sm:text-sm bg-muted px-2 py-1.5 rounded break-all sm:break-normal",children:"sk_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>F("sk_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",v.id),className:"h-8 w-8 p-0 sm:h-9 sm:w-9 sm:p-2",title:"Copy API Key",children:j===v.id?e.jsx(Bt,{className:"h-3 w-3 sm:h-4 sm:w-4"}):e.jsx(_s,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>P(v.id),disabled:u.isPending,className:"h-8 w-8 p-0 sm:h-9 sm:w-9 sm:p-2 text-destructive hover:text-destructive",title:"Delete API Key",children:e.jsx(Ts,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]})]})},v.id))}):e.jsxs("div",{className:"text-center py-6 sm:py-8 text-muted-foreground",children:[e.jsx(Ns,{className:"h-8 w-8 sm:h-12 sm:w-12 mx-auto mb-3 sm:mb-4 opacity-50"}),e.jsx("p",{className:"text-xs sm:text-sm",children:"No API keys yet. Create your first key to get started."})]})})]}),e.jsxs(C,{className:"p-3 sm:p-4 md:p-6",children:[e.jsxs($,{className:"pb-2 sm:pb-3 px-0",children:[e.jsx(B,{className:"text-sm sm:text-base",children:"API Documentation"}),e.jsx(J,{className:"text-xs sm:text-sm leading-relaxed",children:"Example API calls using your API keys"})]}),e.jsxs(D,{className:"px-0 pt-0 space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-sm sm:text-base",children:"Get Account Balance"}),e.jsxs("div",{className:"bg-muted p-3 sm:p-4 rounded-md font-mono text-xs sm:text-sm overflow-x-auto",children:[e.jsx("div",{className:"whitespace-nowrap sm:whitespace-normal",children:"GET /api/v1/user/balance"}),e.jsx("div",{className:"text-muted-foreground mt-1 whitespace-nowrap sm:whitespace-normal",children:"Authorization: Bearer YOUR_API_KEY"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-sm sm:text-base",children:"Get Transaction History"}),e.jsxs("div",{className:"bg-muted p-3 sm:p-4 rounded-md font-mono text-xs sm:text-sm overflow-x-auto",children:[e.jsx("div",{className:"whitespace-nowrap sm:whitespace-normal",children:"GET /api/v1/user/transactions?limit=10&offset=0"}),e.jsx("div",{className:"text-muted-foreground mt-1 whitespace-nowrap sm:whitespace-normal",children:"Authorization: Bearer YOUR_API_KEY"})]})]})]}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed pt-2 border-t",children:"All API endpoints require Bearer token authentication with your API key."})]})]})]})]})})}const Ba=[{title:"Dashboard",href:"/agent/dashboard",icon:aa},{title:"My Storefront",href:"/agent/storefront",icon:zs},{title:"Pricing",href:"/agent/pricing",icon:ct},{title:"Transactions",href:"/agent/transactions",icon:Es},{title:"MTN Bundles",href:"/agent/bundles/mtn",icon:Le},{title:"AT iShare Bundles",href:"/agent/bundles/at_ishare",icon:Le},{title:"AT BIG TIME Bundles",href:"/agent/bundles/at_bigtime",icon:Le},{title:"TELECEL Bundles",href:"/agent/bundles/telecel",icon:Le},{title:"Top Up Wallet",href:"/agent/wallet",icon:Me},{title:"API Keys & Integrations",href:"/dashboard/api-integrations",icon:Ns},{title:"Withdrawals",href:"/agent/withdrawals",icon:ge},{title:"Settings",href:"/agent/settings",icon:et},{title:"Support Chat",href:"/agent/support",icon:Rs}];function $e({onClose:s}={}){var f;const[a]=Ke(),{logout:t,isLoggingOut:n,user:l}=je(),{theme:r}=Bs(),[c,d]=o.useState(!1),{data:x}=V({queryKey:["user-rank"],queryFn:()=>Y("GET","/api/user/rank"),enabled:!!l}),{data:p,error:m}=V({queryKey:["/api/profile"]}),{data:j=0}=V({queryKey:["/api/support/admin/unread-count"],enabled:(l==null?void 0:l.role)==="admin",queryFn:async()=>{try{return(await(await Y("GET","/api/support/admin/unread-count")).json()).count||0}catch{return 0}},refetchInterval:3e4}),h=p==null?void 0:p.profile;return m?e.jsxs("div",{className:`flex h-full w-64 flex-col border-r text-sidebar-foreground relative ${s?"bg-white":"bg-sidebar"}`,children:[e.jsx("div",{className:`flex h-16 items-center justify-center border-b px-6 ${s?"pr-4":""}`,children:e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-primary text-primary-foreground font-bold text-xs",children:((f=l==null?void 0:l.name)==null?void 0:f.charAt(0).toUpperCase())||"A"})}),e.jsx(st,{className:"flex-1 px-3 py-4",children:e.jsx("nav",{className:"flex flex-col gap-1",children:Ba.map(b=>{const i=a===b.href||b.href!=="/agent/dashboard"&&a.startsWith(b.href),u=b.href==="/agent/support";return e.jsx(G,{href:b.href,children:e.jsxs(g,{size:"sm",variant:i?"default":"ghost",className:L("w-full justify-start gap-2 px-2 py-1.5 text-xs font-normal relative",i&&"bg-yellow-500 text-white font-medium shadow-sm"),onClick:()=>s&&s(),children:[e.jsx(b.icon,{className:"h-4 w-4"}),e.jsx("span",{className:"flex-1 text-left",children:b.title}),u&&j>0&&e.jsx(X,{variant:"destructive",className:"ml-auto",children:j})]})},b.href)})})}),e.jsx("div",{className:"border-t p-3",children:e.jsxs(g,{size:"sm",variant:"ghost",className:"w-full justify-start gap-2 px-2 py-1.5 text-xs text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>{s&&s(),t()},disabled:n,children:[e.jsx(qt,{className:"h-4 w-4"}),n?"Logging out...":"Log out"]})})]}):e.jsxs("div",{className:`flex h-full w-64 flex-col border-r text-sidebar-foreground relative ${s?"bg-white dark:bg-black dark:text-white":"bg-sidebar dark:bg-black dark:text-white"}`,children:[e.jsx("div",{className:`flex h-16 items-center justify-center border-b px-6 ${s?"pr-4":""} dark:border-gray-700`,children:e.jsx("div",{className:"flex flex-col items-center text-center w-full",children:e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-1 w-full",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-sm font-medium dark:text-white",children:(l==null?void 0:l.name)||"Agent"}),e.jsx("p",{className:"text-xs text-muted-foreground dark:text-gray-300",children:l==null?void 0:l.email})]}),x&&e.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-green-500 px-2 py-0.5 text-xs font-medium text-white border border-green-600 dark:bg-green-600 dark:border-green-700",children:[e.jsx(vs,{className:"h-2.5 w-2.5"}),e.jsx("span",{children:x.rank&&x.rank>0?`#${x.rank}`:"Unranked"})]})]})})}),h&&e.jsx("div",{className:"border-b p-3 dark:border-gray-700",children:e.jsxs("div",{className:"rounded-lg bg-green-500 p-3 dark:bg-green-600",children:[e.jsx("p",{className:"text-xs text-white mb-1",children:"Profit Balance"}),e.jsx("p",{className:"text-xl font-bold tabular-nums text-white","data-testid":"text-agent-profit-balance",children:ae(h.profitBalance)}),e.jsxs("p",{className:"text-xs text-white mt-1",children:["Wallet Balance: ",ae(h.walletBalance)]}),e.jsxs("p",{className:"text-xs text-white mt-1",children:["Total Withdrawals: ",ae(h.totalWithdrawals)]})]})}),e.jsx(st,{className:"flex-1 px-3 py-4",children:e.jsxs("nav",{className:"flex flex-col gap-1",children:[Ba.map(b=>{const i=a===b.href||b.href!=="/agent/dashboard"&&a.startsWith(b.href),u=b.href==="/agent/support";return e.jsx(G,{href:b.href,children:e.jsxs(g,{variant:i?"default":"ghost",className:L("w-full justify-start gap-3 font-normal relative dark:text-white dark:hover:bg-gray-700",i&&"bg-yellow-500 text-white font-medium shadow-sm dark:bg-yellow-600"),"data-testid":`link-agent-${b.title.toLowerCase().replace(/ /g,"-")}`,onClick:()=>s&&s(),children:[e.jsx(b.icon,{className:"h-4 w-4 dark:text-white"}),e.jsx("span",{className:"flex-1 text-left dark:text-white",children:b.title}),u&&j>0&&(l==null?void 0:l.role)==="admin"&&e.jsx(X,{variant:"destructive",className:"ml-auto dark:bg-red-600 dark:text-white",children:j})]})},b.href)}),h&&e.jsx("a",{href:`/store/agent/${h.storefrontSlug}`,target:"_blank",rel:"noopener noreferrer",className:"mt-2",children:e.jsxs(g,{variant:"outline",className:"w-full justify-start gap-3 bg-green-600 hover:bg-green-700 text-white border-green-600 dark:border-green-600 dark:bg-green-600 dark:hover:bg-green-700","data-testid":"link-view-storefront",onClick:()=>s&&s(),children:[e.jsx(nt,{className:"h-4 w-4"}),"View Public Store"]})})]})}),e.jsxs("div",{className:"border-t p-3 dark:border-gray-700",children:[e.jsxs(g,{variant:"ghost",className:"w-full justify-start gap-3 text-destructive hover:text-destructive hover:bg-destructive/10 dark:text-red-400 dark:hover:bg-red-900/20",onClick:()=>{s&&s(),t()},disabled:n,children:[e.jsx(qt,{className:"h-4 w-4 dark:text-red-400"}),n?"Logging out...":"Log out"]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-border/50 dark:border-gray-600",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center dark:text-gray-400",children:["Developed by"," ",e.jsx("a",{href:"https://bm-portfolio-up2x.onrender.com",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 font-medium dark:text-blue-400 dark:hover:text-blue-300",children:"BlusMotif"})]})})]}),e.jsx(Rt,{open:c,onOpenChange:d})]})}function we({title:s,value:a,description:t,icon:n,trend:l,trendLabel:r,className:c}){return e.jsxs(C,{className:L("bg-green-500 border border-yellow-500 text-white",c),children:[e.jsxs($,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium text-white",children:s}),n&&e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-white/20",children:e.jsx(n,{className:"h-4 w-4 text-white"})})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold tabular-nums",children:a}),(t||l)&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[l&&e.jsx("span",{className:"text-xs font-medium text-white",children:l}),r&&e.jsx("span",{className:"text-xs text-white",children:r}),t&&!l&&!r&&e.jsx("p",{className:"text-xs text-white",children:t})]})]})]})}const Ji=({stats:s})=>{const{data:a,isLoading:t}=V({queryKey:["/api/agent/performance-history"],refetchInterval:3e4,refetchOnWindowFocus:!0});if(t)return e.jsx("div",{className:"w-full h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});const n=Array.isArray(a)?a:[{day:"Mon",profit:25.5,transactions:3},{day:"Tue",profit:45.2,transactions:5},{day:"Wed",profit:32.8,transactions:4},{day:"Thu",profit:67.9,transactions:8},{day:"Fri",profit:89.3,transactions:12},{day:"Sat",profit:54.6,transactions:7},{day:"Sun",profit:(s==null?void 0:s.todayProfit)||42.1,transactions:(s==null?void 0:s.todayTransactions)||5}];return e.jsxs("div",{className:"w-full",children:[e.jsx("h4",{className:"text-sm font-medium mb-4 text-muted-foreground",children:"Weekly Performance"}),e.jsx(Ur,{width:"100%",height:200,children:e.jsxs(zr,{data:n,children:[e.jsx(_r,{strokeDasharray:"3 3",className:"opacity-30"}),e.jsx(Gr,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:12,fill:"hsl(var(--muted-foreground))"}}),e.jsx(Wr,{axisLine:!1,tickLine:!1,tick:{fontSize:12,fill:"hsl(var(--muted-foreground))"},tickFormatter:l=>`GHâ‚µ${l}`}),e.jsx(Kr,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px",fontSize:"12px"},formatter:(l,r)=>[r==="profit"?`GHâ‚µ${l.toFixed(2)}`:l,r==="profit"?"Profit":"Transactions"],labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(Hr,{dataKey:"profit",fill:"hsl(var(--primary))",radius:[4,4,0,0],name:"profit"})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4 text-xs text-muted-foreground",children:[e.jsx("span",{children:"Daily profit over the last 7 days"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-primary rounded"}),e.jsx("span",{children:"Profit"})]})})]})]})};function Zi(){var i,u;const[s,a]=o.useState(!1),[t,n]=o.useState(!1),[,l]=Ke(),r=o.useRef(!1),{user:c}=je(),{data:d}=V({queryKey:["/api/profile"],refetchInterval:3e4,refetchOnWindowFocus:!0,refetchOnReconnect:!0}),x=d==null?void 0:d.profile,[p]=Ke();o.useEffect(()=>{x&&!x.isApproved&&p!=="/agent/activation-complete"&&!r.current&&(r.current=!0,console.log("Redirecting to activation page - agent not approved"),l("/agent/activation-complete"))},[x,p,l]);const{data:m,isLoading:j,error:h}=V({queryKey:["/api/agent/stats"],refetchInterval:5e3,refetchOnWindowFocus:!0,refetchOnReconnect:!0,staleTime:0}),[f,b]=o.useState(0);return o.useEffect(()=>{(m==null?void 0:m.totalProfit)!==void 0&&b(m.totalProfit)},[m==null?void 0:m.totalProfit]),console.log("[Dashboard] Stats data:",m),console.log("[Dashboard] Stats error:",h),console.log("[Dashboard] totalProfit:",m==null?void 0:m.totalProfit),console.log("[Dashboard] displayProfit:",f),V({queryKey:["/api/agent/transactions/recent"],refetchInterval:5e3,refetchOnWindowFocus:!0,refetchOnReconnect:!0,staleTime:0}),e.jsxs("div",{className:"flex h-screen bg-background",children:[s&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx($e,{onClose:()=>a(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx($e,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b bg-background px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>a(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Agent Dashboard"}),e.jsxs("p",{className:"text-sm text-muted-foreground hidden sm:block",children:["Welcome back, ",((i=x==null?void 0:x.user)==null?void 0:i.name)||"Agent"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x&&e.jsx("a",{href:`/store/agent/${x.storefrontSlug}`,target:"_blank",rel:"noopener noreferrer",children:e.jsxs(g,{variant:"outline",size:"sm",className:"gap-2 hidden sm:flex",children:[e.jsx(nt,{className:"h-4 w-4"}),"View Store"]})}),e.jsx(Ne,{})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs(C,{className:"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 border-yellow-600 shadow-xl overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 sm:w-24 sm:h-24 lg:w-32 lg:h-32 bg-white/10 rounded-full -translate-y-10 sm:-translate-y-12 lg:-translate-y-16 translate-x-10 sm:translate-x-12 lg:translate-x-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 bg-white/5 rounded-full translate-y-8 sm:translate-y-10 lg:translate-y-12 -translate-x-8 sm:-translate-x-10 lg:-translate-x-12"}),e.jsx(D,{className:"p-3 sm:p-4 md:p-6 relative",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 bg-white/20 rounded-full shadow-lg backdrop-blur-sm flex-shrink-0",children:e.jsx("span",{className:"text-lg sm:text-xl md:text-2xl animate-bounce",children:"ðŸ‘‹"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-white mb-1 drop-shadow-sm leading-tight",children:["Welcome back, ",((u=c==null?void 0:c.name)==null?void 0:u.toUpperCase())||"AGENT","!"]}),e.jsx("p",{className:"text-yellow-100 text-xs sm:text-sm md:text-base font-medium leading-relaxed",children:"Here's what's happening with your business today âœ¨"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 sm:gap-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-white/90",children:[e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium",children:"Live Dashboard"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-white/90",children:[e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-blue-400 rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),e.jsx("span",{className:"text-xs font-medium",children:"Real-time Updates"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-4",children:[e.jsx("div",{className:"flex items-center gap-2 bg-white/10 rounded-full px-2 sm:px-3 py-1 backdrop-blur-sm w-fit",children:e.jsx("span",{className:"text-xs text-white font-medium",children:new Date().toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})}),e.jsxs("div",{className:"flex items-center gap-1 text-white/80",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-xs",children:"All systems operational"})]})]})]})})]}),j?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:4}).map((F,R)=>e.jsx(C,{className:"animate-pulse",children:e.jsxs(D,{className:"pt-6",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mb-4"}),e.jsx("div",{className:"h-8 bg-muted rounded w-3/4"})]})},R))}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(we,{title:"Available Balance",value:ae((m==null?void 0:m.balance)||0),icon:ge,description:"Ready for withdrawal",trend:"+12%",trendLabel:"vs last month"}),e.jsx(we,{title:"Today's Profit",value:ae((m==null?void 0:m.todayProfit)||0),icon:Ls,description:`${(m==null?void 0:m.todayTransactions)||0} transactions`,trend:"+8%",trendLabel:"vs yesterday"}),e.jsx(we,{title:"Total Profit",value:ae(f),icon:ct,description:`All-time earnings - Raw value: ${f}`,trend:"+24%",trendLabel:"vs last month"},`profit-${f}`),e.jsx(we,{title:"Active Orders",value:(m==null?void 0:m.totalTransactions)||0,icon:ys,description:"Completed transactions",trend:"+15%",trendLabel:"vs last month"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-5 w-5"}),"Performance Overview"]}),e.jsx(J,{children:"Your business metrics at a glance"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsx("div",{className:"h-64 w-full",children:e.jsx(Ji,{stats:m})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(yr,{className:"h-4 w-4"}),"Quick Actions"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(G,{href:"/agent/bundles/mtn",children:e.jsxs(g,{variant:"outline",size:"sm",className:"w-full h-auto py-4 flex-col gap-2 text-xs md:text-sm",children:[e.jsx(Se,{className:"h-5 w-5"}),e.jsx("span",{children:"MTN"})]})}),e.jsx(G,{href:"/agent/bundles/telecel",children:e.jsxs(g,{variant:"outline",size:"sm",className:"w-full h-auto py-4 flex-col gap-2 text-xs md:text-sm",children:[e.jsx(Se,{className:"h-5 w-5"}),e.jsx("span",{children:"Telecel"})]})}),e.jsx(G,{href:"/agent/bundles/at-bigtime",children:e.jsxs(g,{variant:"outline",size:"sm",className:"w-full h-auto py-4 flex-col gap-2 text-xs md:text-sm",children:[e.jsx(Se,{className:"h-5 w-5"}),e.jsx("span",{children:"AT BigTime"})]})}),e.jsx(G,{href:"/agent/wallet",children:e.jsxs(g,{variant:"outline",size:"sm",className:"w-full h-auto py-4 flex-col gap-2 text-xs md:text-sm",children:[e.jsx(ge,{className:"h-5 w-5"}),e.jsx("span",{children:"Top Up"})]})})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[x&&e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(es,{className:"h-5 w-5"}),"Your Storefront"]}),e.jsx(J,{children:"Share your store link with customers"})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-500 text-white rounded-lg border border-green-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:x.businessName}),e.jsx(X,{variant:"outline",className:"bg-white text-green-600 border-green-700",children:"Live"})]}),e.jsx("p",{className:"text-xs text-white/90 mb-3",children:"Share this link with your customers:"}),e.jsxs("code",{className:"text-xs sm:text-sm bg-white text-green-600 px-2 py-1 rounded mt-2 block sm:inline-block border border-green-700 break-all sm:break-normal",children:[window.location.origin,"/store/agent/",x.storefrontSlug]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(`${window.location.origin}/store/agent/${x.storefrontSlug}`),className:"w-full sm:w-auto",children:"Copy Link"}),e.jsx("a",{href:`/store/agent/${x.storefrontSlug}`,target:"_blank",rel:"noopener noreferrer",className:"w-full sm:w-auto",children:e.jsxs(g,{size:"sm",className:"w-full",children:[e.jsx(nt,{className:"h-4 w-4 mr-1"}),"Visit"]})})]})]})})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),"Order Tracker"]}),e.jsx(J,{children:"Monitor your customers' purchase status"})]}),e.jsx(D,{children:e.jsx(bt,{})})]})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"h-5 w-5"}),"API & Tools"]}),e.jsx(J,{children:"Automate your business operations"})]}),e.jsx(D,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(g,{variant:"outline",className:"justify-start h-auto p-4 text-left",onClick:()=>n(!0),children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm md:text-base",children:"API Keys"}),e.jsx("div",{className:"text-xs md:text-sm text-muted-foreground",children:"Integrate with external systems"})]})}),e.jsx(G,{href:"/agent/settings",children:e.jsx(g,{variant:"outline",className:"justify-start h-auto p-4 w-full text-left",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm md:text-base",children:"Settings"}),e.jsx("div",{className:"text-xs md:text-sm text-muted-foreground",children:"Manage your profile & links"})]})})})]})})]})]})})]}),e.jsx(Rt,{open:t,onOpenChange:n})]})}function ec(){const{user:s}=je();he();const[a,t]=o.useState(!1),[n,l]=o.useState(!1),{data:r,isLoading:c}=V({queryKey:["/api/dealer/stats"],queryFn:()=>Ie("/api/dealer/stats",{disableAutoLogout:!0}),refetchInterval:1e4}),{data:d,isLoading:x}=V({queryKey:["/api/transactions"],queryFn:()=>Ie("/api/transactions"),refetchInterval:1e4,select:p=>p.slice(0,5)});return s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(He,{open:a,onOpenChange:t,children:e.jsx(qe,{side:"left",className:"w-64 p-0 bg-sidebar",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx(Ve,{children:"Dealer Dashboard"}),e.jsx(Ye,{children:e.jsx(as,{children:"Navigation menu for dealer dashboard"})})]}),e.jsxs("nav",{className:"flex-1 p-4 space-y-2",children:[e.jsxs(G,{href:"/dealer/dashboard",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(es,{className:"inline w-4 h-4 mr-2"}),"Dashboard"]}),e.jsxs(G,{href:"/dealer/bundles",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Se,{className:"inline w-4 h-4 mr-2"}),"Data Bundles"]}),e.jsxs(G,{href:"/dealer/wallet",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(ge,{className:"inline w-4 h-4 mr-2"}),"Wallet"]}),e.jsxs(G,{href:"/dealer/transactions",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Me,{className:"inline w-4 h-4 mr-2"}),"Transactions"]})]})]})})}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"hidden md:flex md:w-64 md:flex-col md:fixed md:inset-y-0 bg-white border-r",children:e.jsxs("div",{className:"flex flex-col flex-grow pt-5 pb-4 overflow-y-auto",children:[e.jsx("div",{className:"flex items-center flex-shrink-0 px-4",children:e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Dealer Dashboard"})}),e.jsx("div",{className:"mt-5 flex-grow flex flex-col",children:e.jsxs("nav",{className:"flex-1 px-2 space-y-1",children:[e.jsxs(G,{href:"/dealer/dashboard",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md bg-gray-100 text-gray-900",children:[e.jsx(es,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Dashboard"]}),e.jsxs(G,{href:"/dealer/bundles",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(Se,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Data Bundles"]}),e.jsxs(G,{href:"/dealer/wallet",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(ge,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Wallet"]}),e.jsxs(G,{href:"/dealer/transactions",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(Me,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Transactions"]})]})})]})}),e.jsxs("div",{className:"md:pl-64 flex flex-col flex-1",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-white shadow md:hidden",children:[e.jsx("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 md:hidden",onClick:()=>t(!0),children:e.jsx(pe,{className:"h-6 w-6"})}),e.jsx("div",{className:"flex-1 px-4 flex justify-between",children:e.jsx("div",{className:"flex-1 flex",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Dealer Dashboard"})})})]}),e.jsx("main",{className:"flex-1",children:e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8",children:[e.jsxs("h1",{className:"text-base sm:text-2xl font-semibold text-gray-900",children:["Welcome back, ",s.name,"!"]}),e.jsx("p",{className:"mt-1 text-xs sm:text-sm text-gray-600",children:"Here's what's happening with your dealer account today."}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Wallet Balance"}),e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(r==null?void 0:r.walletBalance)||"0.00"}`}),e.jsx(G,{href:"/dealer/wallet",children:e.jsx(g,{variant:"outline",size:"sm",className:"mt-2",children:"Top Up Wallet"})})]})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Sales"}),e.jsx(ys,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):(r==null?void 0:r.totalSales)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+20.1% from last month"})]})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Profit"}),e.jsx(Ls,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(r==null?void 0:r.totalProfit)||"0.00"}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+15.3% from last month"})]})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Active Agents"}),e.jsx(es,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):(r==null?void 0:r.activeAgents)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Agents under your management"})]})]})]}),e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Recent Transactions"}),e.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Your latest transaction activity"})]}),e.jsx("ul",{className:"divide-y divide-gray-200",children:x?e.jsx("li",{className:"px-4 py-4",children:e.jsx(Q,{className:"h-5 w-5 animate-spin"})}):(d==null?void 0:d.length)>0?d.map(p=>e.jsx("li",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"flex-shrink-0 h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:p.type==="purchase"?"Data Purchase":"Wallet Top-up"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(p.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{variant:p.status==="completed"?"default":"secondary",children:p.status}),e.jsxs("span",{className:"ml-2 text-sm font-medium text-gray-900",children:["GHâ‚µ",p.amount]})]})]})},p.id)):e.jsx("li",{className:"px-4 py-4 text-center text-gray-500",children:"No recent transactions"})})]})}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(C,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Sell Data Bundles"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage your data bundle offerings"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(G,{href:"/dealer/bundles",children:e.jsx(g,{className:"w-full",children:"View Bundles"})})})]})}),e.jsx(C,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Wallet Management"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Top up and manage your wallet"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(G,{href:"/dealer/wallet",children:e.jsx(g,{variant:"outline",className:"w-full",children:"Manage Wallet"})})})]})}),e.jsx(C,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ns,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"API Integrations"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Integrate with external systems"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(g,{variant:"outline",className:"w-full",onClick:()=>l(!0),children:"API Settings"})})]})})]})]})]})})})]})]}),e.jsx(Rt,{isOpen:n,onClose:()=>l(!1)}),e.jsx(bt,{})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})})}function sc(){const{user:s}=je();he();const[a,t]=o.useState(!1),[n,l]=o.useState(!1),{data:r,isLoading:c}=V({queryKey:["/api/super-dealer/stats"],queryFn:()=>Ie("/api/super-dealer/stats",{disableAutoLogout:!0}),refetchInterval:1e4}),{data:d,isLoading:x}=V({queryKey:["/api/transactions"],queryFn:()=>Ie("/api/transactions"),refetchInterval:1e4,select:p=>p.slice(0,5)});return s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(He,{open:a,onOpenChange:t,children:e.jsx(qe,{side:"left",className:"w-64 p-0 bg-sidebar",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx(Ve,{children:"Super Dealer Dashboard"}),e.jsx(Ye,{children:e.jsx(as,{children:"Navigation menu for super dealer dashboard"})})]}),e.jsxs("nav",{className:"flex-1 p-4 space-y-2",children:[e.jsxs(G,{href:"/super-dealer/dashboard",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(yt,{className:"inline w-4 h-4 mr-2"}),"Dashboard"]}),e.jsxs(G,{href:"/super-dealer/bundles",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Se,{className:"inline w-4 h-4 mr-2"}),"Data Bundles"]}),e.jsxs(G,{href:"/super-dealer/wallet",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(ge,{className:"inline w-4 h-4 mr-2"}),"Wallet"]}),e.jsxs(G,{href:"/super-dealer/transactions",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Me,{className:"inline w-4 h-4 mr-2"}),"Transactions"]}),e.jsxs(G,{href:"/super-dealer/dealers",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(es,{className:"inline w-4 h-4 mr-2"}),"Manage Dealers"]})]})]})})}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"hidden md:flex md:w-64 md:flex-col md:fixed md:inset-y-0 bg-white border-r",children:e.jsxs("div",{className:"flex flex-col flex-grow pt-5 pb-4 overflow-y-auto",children:[e.jsx("div",{className:"flex items-center flex-shrink-0 px-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(yt,{className:"w-8 h-8 text-yellow-500 mr-2"}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Super Dealer"})]})}),e.jsx("div",{className:"mt-5 flex-grow flex flex-col",children:e.jsxs("nav",{className:"flex-1 px-2 space-y-1",children:[e.jsxs(G,{href:"/super-dealer/dashboard",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md bg-gray-100 text-gray-900",children:[e.jsx(yt,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Dashboard"]}),e.jsxs(G,{href:"/super-dealer/bundles",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(Se,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Data Bundles"]}),e.jsxs(G,{href:"/super-dealer/wallet",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(ge,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Wallet"]}),e.jsxs(G,{href:"/super-dealer/transactions",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(Me,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Transactions"]}),e.jsxs(G,{href:"/super-dealer/dealers",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(es,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Manage Dealers"]})]})})]})}),e.jsxs("div",{className:"md:pl-64 flex flex-col flex-1",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-white shadow md:hidden",children:[e.jsx("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 md:hidden",onClick:()=>t(!0),children:e.jsx(pe,{className:"h-6 w-6"})}),e.jsx("div",{className:"flex-1 px-4 flex justify-between",children:e.jsx("div",{className:"flex-1 flex",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Super Dealer Dashboard"})})})]}),e.jsx("main",{className:"flex-1",children:e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(yt,{className:"w-4 sm:w-8 h-4 sm:h-8 text-yellow-500 mr-3"}),e.jsxs("h1",{className:"text-lg sm:text-2xl font-semibold text-gray-900",children:["Welcome back, ",s.name,"!"]})]}),e.jsx("p",{className:"mt-1 text-xs sm:text-sm text-gray-600",children:"Super Dealer Dashboard - Advanced management and analytics."}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Wallet Balance"}),e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(r==null?void 0:r.walletBalance)||"0.00"}`}),e.jsx(G,{href:"/super-dealer/wallet",children:e.jsx(g,{variant:"outline",size:"sm",className:"mt-2",children:"Top Up Wallet"})})]})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Sales"}),e.jsx(ys,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):(r==null?void 0:r.totalSales)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+25.5% from last month"})]})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Profit"}),e.jsx(Ls,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(r==null?void 0:r.totalProfit)||"0.00"}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+22.1% from last month"})]})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Managed Dealers"}),e.jsx(es,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):(r==null?void 0:r.managedDealers)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dealers under your supervision"})]})]})]}),e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Recent Transactions"}),e.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Your latest transaction activity"})]}),e.jsx("ul",{className:"divide-y divide-gray-200",children:x?e.jsx("li",{className:"px-4 py-4",children:e.jsx(Q,{className:"h-5 w-5 animate-spin"})}):(d==null?void 0:d.length)>0?d.map(p=>e.jsx("li",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"flex-shrink-0 h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:p.type==="purchase"?"Data Purchase":"Wallet Top-up"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(p.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{variant:p.status==="completed"?"default":"secondary",children:p.status}),e.jsxs("span",{className:"ml-2 text-sm font-medium text-gray-900",children:["GHâ‚µ",p.amount]})]})]})},p.id)):e.jsx("li",{className:"px-4 py-4 text-center text-gray-500",children:"No recent transactions"})})]})}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(C,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Sell Data Bundles"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage your data bundle offerings"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(G,{href:"/super-dealer/bundles",children:e.jsx(g,{className:"w-full",children:"View Bundles"})})})]})}),e.jsx(C,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Wallet Management"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Top up and manage your wallet"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(G,{href:"/super-dealer/wallet",children:e.jsx(g,{variant:"outline",className:"w-full",children:"Manage Wallet"})})})]})}),e.jsx(C,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(es,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Manage Dealers"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Oversee your dealer network"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(G,{href:"/super-dealer/dealers",children:e.jsx(g,{variant:"outline",className:"w-full",children:"Manage Dealers"})})})]})}),e.jsx(C,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ns,{className:"h-8 w-8 text-indigo-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"API Integrations"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Integrate with external systems"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(g,{variant:"outline",className:"w-full",onClick:()=>l(!0),children:"API Settings"})})]})})]})]})]})})})]})]}),e.jsx(Rt,{isOpen:n,onClose:()=>l(!1)}),e.jsx(bt,{})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})})}function tc(){const{user:s}=je();he();const[a,t]=o.useState(!1),[n,l]=o.useState(!1),{data:r,isLoading:c}=V({queryKey:["/api/master/stats"],queryFn:()=>Ie("/api/master/stats",{disableAutoLogout:!0}),refetchInterval:1e4}),{data:d,isLoading:x}=V({queryKey:["/api/transactions"],queryFn:()=>Ie("/api/transactions"),refetchInterval:1e4,select:p=>p.slice(0,5)});return s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(He,{open:a,onOpenChange:t,children:e.jsx(qe,{side:"left",className:"w-64 p-0 bg-sidebar",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx(Ve,{children:"Master Dashboard"}),e.jsx(Ye,{children:e.jsx(as,{children:"Navigation menu for master dashboard"})})]}),e.jsxs("nav",{className:"flex-1 p-4 space-y-2",children:[e.jsxs(G,{href:"/master/dashboard",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Us,{className:"inline w-4 h-4 mr-2"}),"Dashboard"]}),e.jsxs(G,{href:"/master/bundles",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Se,{className:"inline w-4 h-4 mr-2"}),"Data Bundles"]}),e.jsxs(G,{href:"/master/wallet",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(ge,{className:"inline w-4 h-4 mr-2"}),"Wallet"]}),e.jsxs(G,{href:"/master/transactions",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Me,{className:"inline w-4 h-4 mr-2"}),"Transactions"]}),e.jsxs(G,{href:"/master/network",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(es,{className:"inline w-4 h-4 mr-2"}),"Network Management"]}),e.jsxs(G,{href:"/master/analytics",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Es,{className:"inline w-4 h-4 mr-2"}),"Analytics"]})]})]})})}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"hidden md:flex md:w-64 md:flex-col md:fixed md:inset-y-0 bg-white border-r",children:e.jsxs("div",{className:"flex flex-col flex-grow pt-5 pb-4 overflow-y-auto",children:[e.jsx("div",{className:"flex items-center flex-shrink-0 px-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Us,{className:"w-8 h-8 text-red-500 mr-2"}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Master"})]})}),e.jsx("div",{className:"mt-5 flex-grow flex flex-col",children:e.jsxs("nav",{className:"flex-1 px-2 space-y-1",children:[e.jsxs(G,{href:"/master/dashboard",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md bg-gray-100 text-gray-900",children:[e.jsx(Us,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Dashboard"]}),e.jsxs(G,{href:"/master/bundles",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(Se,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Data Bundles"]}),e.jsxs(G,{href:"/master/wallet",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(ge,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Wallet"]}),e.jsxs(G,{href:"/master/transactions",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(Me,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Transactions"]}),e.jsxs(G,{href:"/master/network",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(es,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Network Management"]}),e.jsxs(G,{href:"/master/analytics",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(Es,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Analytics"]})]})})]})}),e.jsxs("div",{className:"md:pl-64 flex flex-col flex-1",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-white shadow md:hidden",children:[e.jsx("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 md:hidden",onClick:()=>t(!0),children:e.jsx(pe,{className:"h-6 w-6"})}),e.jsx("div",{className:"flex-1 px-4 flex justify-between",children:e.jsx("div",{className:"flex-1 flex",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Master Dashboard"})})})]}),e.jsx("main",{className:"flex-1",children:e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Us,{className:"w-4 sm:w-8 h-4 sm:h-8 text-red-500 mr-3"}),e.jsxs("h1",{className:"text-base sm:text-2xl font-semibold text-gray-900",children:["Welcome back, ",s.name,"!"]})]}),e.jsx("p",{className:"mt-1 text-xs sm:text-sm text-gray-600",children:"Master Dashboard - Complete system oversight and management."}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Wallet Balance"}),e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(r==null?void 0:r.walletBalance)||"0.00"}`}),e.jsx(G,{href:"/master/wallet",children:e.jsx(g,{variant:"outline",size:"sm",className:"mt-2",children:"Top Up Wallet"})})]})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Sales"}),e.jsx(ys,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):(r==null?void 0:r.totalSales)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+30.2% from last month"})]})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Profit"}),e.jsx(Ls,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(r==null?void 0:r.totalProfit)||"0.00"}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+28.7% from last month"})]})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Network Size"}),e.jsx(es,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):(r==null?void 0:r.networkSize)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total agents in network"})]})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"System Health"}),e.jsx(Es,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):"98.5%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Uptime this month"})]})]})]}),e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Recent Transactions"}),e.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Your latest transaction activity"})]}),e.jsx("ul",{className:"divide-y divide-gray-200",children:x?e.jsx("li",{className:"px-4 py-4",children:e.jsx(Q,{className:"h-5 w-5 animate-spin"})}):(d==null?void 0:d.length)>0?d.map(p=>e.jsx("li",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"flex-shrink-0 h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:p.type==="purchase"?"Data Purchase":"Wallet Top-up"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(p.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{variant:p.status==="completed"?"default":"secondary",children:p.status}),e.jsxs("span",{className:"ml-2 text-sm font-medium text-gray-900",children:["GHâ‚µ",p.amount]})]})]})},p.id)):e.jsx("li",{className:"px-4 py-4 text-center text-gray-500",children:"No recent transactions"})})]})}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsx(C,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Sell Data Bundles"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage your data bundle offerings"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(G,{href:"/master/bundles",children:e.jsx(g,{className:"w-full",children:"View Bundles"})})})]})}),e.jsx(C,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Wallet Management"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Top up and manage your wallet"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(G,{href:"/master/wallet",children:e.jsx(g,{variant:"outline",className:"w-full",children:"Manage Wallet"})})})]})}),e.jsx(C,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(es,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Network Management"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage your entire agent network"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(G,{href:"/master/network",children:e.jsx(g,{variant:"outline",className:"w-full",children:"Manage Network"})})})]})}),e.jsx(C,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Es,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Analytics"}),e.jsx("p",{className:"text-sm text-gray-500",children:"View detailed analytics and reports"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(G,{href:"/master/analytics",children:e.jsx(g,{variant:"outline",className:"w-full",children:"View Analytics"})})})]})}),e.jsx(C,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ns,{className:"h-8 w-8 text-indigo-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"API Integrations"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Integrate with external systems"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(g,{variant:"outline",className:"w-full",onClick:()=>l(!0),children:"API Settings"})})]})})]})]})]})})})]})]}),e.jsx(Rt,{isOpen:n,onClose:()=>l(!1)}),e.jsx(bt,{})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})})}const Xe=o.forwardRef(({className:s,...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:L("w-full caption-bottom text-sm",s),...a})}));Xe.displayName="Table";const Je=o.forwardRef(({className:s,...a},t)=>e.jsx("thead",{ref:t,className:L("[&_tr]:border-b",s),...a}));Je.displayName="TableHeader";const Ze=o.forwardRef(({className:s,...a},t)=>e.jsx("tbody",{ref:t,className:L("[&_tr:last-child]:border-0",s),...a}));Ze.displayName="TableBody";const ac=o.forwardRef(({className:s,...a},t)=>e.jsx("tfoot",{ref:t,className:L("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a}));ac.displayName="TableFooter";const fe=o.forwardRef(({className:s,...a},t)=>e.jsx("tr",{ref:t,className:L("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a}));fe.displayName="TableRow";const O=o.forwardRef(({className:s,...a},t)=>e.jsx("th",{ref:t,className:L("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...a}));O.displayName="TableHead";const M=o.forwardRef(({className:s,...a},t)=>e.jsx("td",{ref:t,className:L("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...a}));M.displayName="TableCell";const rc=o.forwardRef(({className:s,...a},t)=>e.jsx("caption",{ref:t,className:L("mt-4 text-sm text-muted-foreground",s),...a}));rc.displayName="TableCaption";const qa={pending:{label:"Pending",color:"bg-amber-500 text-white",icon:ze},processing:{label:"Processing",color:"bg-blue-500 text-white",icon:Et},confirmed:{label:"Confirmed",color:"bg-blue-600 text-white",icon:be},completed:{label:"Completed",color:"bg-green-500 text-white",icon:be},delivered:{label:"Delivered",color:"bg-green-500 text-white",icon:be},cancelled:{label:"Cancelled",color:"bg-red-500 text-white",icon:is},failed:{label:"Failed",color:"bg-red-500 text-white",icon:is},refunded:{label:"Refunded",color:"bg-blue-500 text-white",icon:pa},approved:{label:"Approved",color:"bg-blue-500 text-white",icon:be},rejected:{label:"Rejected",color:"bg-red-500 text-white",icon:is},sent:{label:"Sent",color:"bg-green-500 text-white",icon:be},retrying:{label:"Retrying",color:"bg-yellow-500 text-white",icon:pa}};function Ca({status:s,statusConfig:a,className:t}){var r;const n=(a==null?void 0:a[s])||qa[s]||{label:s,color:"bg-gray-100 text-gray-700 dark:bg-white dark:text-gray-300"},l=(r=qa[s])==null?void 0:r.icon;return e.jsxs(X,{variant:"outline",className:L("gap-1 border-0 font-medium",n.color,t),children:[l&&e.jsx(l,{className:"h-3 w-3"}),n.label]})}function lc(){const[s,a]=o.useState("all"),[t,n]=o.useState("all"),[l,r]=o.useState(""),[c,d]=o.useState(!1),{data:x,isLoading:p}=V({queryKey:["/api/agent/transactions"],refetchInterval:3e4,refetchOnWindowFocus:!0}),{data:m}=V({queryKey:["/api/agent/transactions/stats"],refetchInterval:3e4,refetchOnWindowFocus:!0}),j=x==null?void 0:x.filter(h=>{if(s!=="all"&&h.status!==s||t!=="all"&&h.type!==t)return!1;if(l){const f=l.toLowerCase();if(!h.reference.toLowerCase().includes(f)&&!h.productName.toLowerCase().includes(f)&&!(h.customerPhone&&h.customerPhone.toLowerCase().includes(f)))return!1}return!0});return e.jsxs("div",{className:"flex h-screen bg-background",children:[c&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>d(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx($e,{onClose:()=>d(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx($e,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>d(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"My Transactions"})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6",children:[e.jsx(we,{title:"Total Transactions",value:(m==null?void 0:m.totalTransactions)||0,icon:ys,description:"All time",className:"text-sm md:text-base"}),e.jsx(we,{title:"Total Revenue",value:ae((m==null?void 0:m.totalRevenue)||0),icon:ct,description:"From sales",className:"text-sm md:text-base"}),e.jsx(we,{title:"Total Profit",value:ae((m==null?void 0:m.totalProfit)||0),icon:Ls,description:"Your earnings",className:"text-sm md:text-base"}),e.jsx(we,{title:"Today",value:(m==null?void 0:m.todayTransactions)||0,icon:Es,description:"Transactions today",className:"text-sm md:text-base"})]}),e.jsxs(C,{className:"bg-white text-black border-gray-200 md:col-span-2 lg:col-span-3",children:[e.jsxs($,{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-3 pb-3 md:pb-6",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(B,{className:"flex items-center gap-2 text-base md:text-lg text-black",children:[e.jsx(Es,{className:"h-4 w-4 md:h-5 md:w-5"}),e.jsx("span",{className:"truncate",children:"Transaction History"})]}),e.jsx(J,{className:"text-sm md:text-base text-gray-600",children:"View all your customer orders and earnings"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-2 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-1 sm:flex-initial",children:[e.jsx(Gt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(K,{placeholder:"Search...",value:l,onChange:h=>r(h.target.value),className:"pl-9 w-full sm:w-48 text-sm","data-testid":"input-search"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ae,{value:s,onValueChange:a,children:[e.jsx(Pe,{className:"w-full sm:w-32 text-xs md:text-sm","data-testid":"filter-status",children:e.jsx(Te,{placeholder:"Status"})}),e.jsxs(Ce,{children:[e.jsx(H,{value:"all",children:"All Status"}),e.jsx(H,{value:"pending",children:"Pending"}),e.jsx(H,{value:"confirmed",children:"Confirmed"}),e.jsx(H,{value:"completed",children:"Completed"}),e.jsx(H,{value:"delivered",children:"Delivered"}),e.jsx(H,{value:"cancelled",children:"Cancelled"}),e.jsx(H,{value:"failed",children:"Failed"}),e.jsx(H,{value:"refunded",children:"Refunded"})]})]}),e.jsxs(Ae,{value:t,onValueChange:n,children:[e.jsx(Pe,{className:"w-full sm:w-36 md:w-40 text-xs md:text-sm","data-testid":"filter-type",children:e.jsx(Te,{placeholder:"Type"})}),e.jsxs(Ce,{children:[e.jsx(H,{value:"all",children:"All Types"}),e.jsx(H,{value:"data_bundle",children:"Data Bundles"}),e.jsx(H,{value:"result_checker",children:"Result Checkers"}),e.jsx(H,{value:"wallet_topup",children:"Wallet Top-up"})]})]})]})]})]}),e.jsxs(D,{className:"px-3 md:px-6",children:[p?e.jsx(us,{rows:5}):j&&j.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{className:"text-xs md:text-sm",children:"Reference"}),e.jsx(O,{className:"text-xs md:text-sm",children:"Product"}),e.jsx(O,{className:"hidden sm:table-cell text-xs md:text-sm",children:"Network"}),e.jsx(O,{className:"text-xs md:text-sm",children:"Amount"}),e.jsx(O,{className:"hidden md:table-cell text-xs md:text-sm",children:"My Profit"}),e.jsx(O,{className:"hidden lg:table-cell text-xs md:text-sm",children:"Customer"}),e.jsx(O,{className:"hidden xl:table-cell text-xs md:text-sm",children:"Payment"}),e.jsx(O,{className:"text-xs md:text-sm",children:"Status"}),e.jsx(O,{className:"hidden md:table-cell text-xs md:text-sm",children:"Date"})]})}),e.jsx(Ze,{children:j.slice(0,20).map(h=>{var R;const f=Xs.find(P=>P.id===h.network),b=h.isBulkOrder,i=h.phoneNumbers,u=i?typeof i=="string"?JSON.parse(i):i:void 0,F=h.type==="wallet_topup";return e.jsxs(fe,{"data-testid":`row-transaction-${h.id}`,children:[e.jsx(M,{className:"font-mono text-xs md:text-sm",children:h.reference}),e.jsxs(M,{className:"max-w-[150px] md:max-w-[200px]",children:[e.jsx("div",{className:"font-medium truncate text-xs md:text-sm",children:h.productName}),e.jsxs("div",{className:"flex gap-1 mt-1 flex-wrap",children:[e.jsx(X,{variant:"outline",className:"text-xs px-1 py-0",children:h.type==="data_bundle"?"Data":h.type==="result_checker"?"Result":h.type==="wallet_topup"?"Wallet":h.type}),b&&e.jsxs(X,{variant:"secondary",className:"text-xs px-1 py-0 flex items-center gap-1",children:[e.jsx(Et,{className:"h-2.5 w-2.5"}),(u==null?void 0:u.length)||0]})]})]}),e.jsx(M,{className:"hidden sm:table-cell",children:F?e.jsx("span",{className:"text-muted-foreground",children:"-"}):f?e.jsx(X,{style:{backgroundColor:f.color,color:f.textColor},className:"text-xs px-1 py-0",children:f.name}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsxs(M,{className:"font-medium tabular-nums text-xs md:text-sm",children:[e.jsx("div",{children:ae(h.amount)}),b&&u&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[ae(parseFloat(h.amount)/u.length)," each"]})]}),e.jsxs(M,{className:"hidden md:table-cell text-green-600 tabular-nums font-medium text-xs md:text-sm",children:[F?e.jsx("span",{className:"text-muted-foreground",children:"-"}):e.jsxs("div",{children:["+",ae(h.agentProfit||0)]}),b&&u&&!F&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[ae(parseFloat(h.agentProfit||"0")/u.length)," each"]})]}),e.jsx(M,{className:"hidden lg:table-cell text-muted-foreground text-xs md:text-sm",children:F?e.jsx("span",{className:"text-muted-foreground",children:"Self"}):b&&u?e.jsxs(wn,{children:[e.jsx(yn,{asChild:!0,children:e.jsxs(g,{variant:"ghost",size:"sm",className:"h-auto p-1 text-left justify-start text-muted-foreground hover:text-foreground",children:[e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:"font-semibold",children:[u.length," numbers"]}),e.jsx("div",{className:"truncate max-w-[80px] md:max-w-[100px]",children:(R=u[0])==null?void 0:R.phone})]}),e.jsx(na,{className:"h-3 w-3 ml-1"})]})}),e.jsx(kn,{className:"w-80",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Bulk Order Numbers"}),e.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:u.map((P,v)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-mono",children:P.phone}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:[P.bundleName," - ",P.dataAmount]})]},v))})]})})]}):h.customerPhone}),e.jsx(M,{className:"hidden xl:table-cell",children:e.jsx(X,{variant:h.paymentStatus==="paid"?"default":h.paymentStatus==="failed"?"destructive":h.paymentStatus==="cancelled"?"outline":"secondary",className:"text-xs",children:h.paymentStatus||"pending"})}),e.jsx(M,{children:e.jsx(Ca,{status:h.status})}),e.jsx(M,{className:"hidden md:table-cell text-muted-foreground text-xs md:text-sm",children:Qe(h.createdAt)})]},h.id)})})]})}):e.jsx("div",{className:"text-center py-6 md:py-12 text-muted-foreground text-sm md:text-base",children:"No transactions found. Share your store link to start making sales!"}),j&&j.length>20&&e.jsxs("div",{className:"text-center py-2 md:py-4 text-xs md:text-sm text-muted-foreground",children:["Showing 20 of ",j.length," items"]})]})]})]})})]})]})}const nc=Z.object({amount:Z.string().min(1,"Amount is required").refine(s=>parseFloat(s)>=10,"Minimum withdrawal amount is GHâ‚µ10").refine(s=>parseFloat(s)<=1e5,"Maximum withdrawal amount is GHâ‚µ100,000"),paymentMethod:Z.enum(["mtn_momo","telecel_cash","airtel_tigo_cash","vodafone_cash"],{required_error:"Please select a payment method"}),accountNumber:Z.string().min(5,"Phone number is required"),accountName:Z.string().min(2,"Account name is required")});function ic(){const{toast:s}=he(),[a,t]=o.useState(!1),[n,l]=o.useState(!1),{data:r}=V({queryKey:["/api/profile"],refetchInterval:3e4,refetchOnWindowFocus:!0,refetchOnReconnect:!0,staleTime:0}),c=r==null?void 0:r.profile,{data:d,isLoading:x}=V({queryKey:["/api/agent/withdrawals"],refetchInterval:3e4,refetchOnWindowFocus:!0,refetchOnReconnect:!0,staleTime:0}),p=gs({resolver:fs(nc),defaultValues:{amount:"",paymentMethod:"mtn_momo",accountNumber:"",accountName:""}}),m=[{value:"mtn_momo",label:"MTN Mobile Money",icon:Le,description:"Send to MTN MoMo number"},{value:"telecel_cash",label:"Telecel Cash",icon:Le,description:"Send to Telecel Cash number"},{value:"airtel_tigo_cash",label:"AirtelTigo Cash",icon:Le,description:"Send to AirtelTigo Cash number"},{value:"vodafone_cash",label:"Vodafone Cash",icon:Le,description:"Send to Vodafone Cash number"}],j=re({mutationFn:i=>Y("POST","/api/agent/withdrawals",{...i,amount:parseFloat(i.amount)}),onSuccess:i=>{ke.invalidateQueries({queryKey:["/api/agent/withdrawals"]}),ke.invalidateQueries({queryKey:["/api/agent/profile"]}),l(!1),p.reset(),s({title:"Withdrawal Requested!",description:i.message||"Your withdrawal request has been submitted and is pending admin approval."})},onError:i=>{s({title:"Withdrawal failed",description:i.message,variant:"destructive"})}}),h=i=>{const u=parseFloat(i.amount),F=(c==null?void 0:c.profitBalance)||0;if(u<10){s({title:"Amount too low",description:"Minimum withdrawal amount is GHâ‚µ10",variant:"destructive"});return}if(u>F){s({title:"Insufficient balance",description:`Available balance: ${ae(F)}`,variant:"destructive"});return}j.mutate(i)},f={pending:(d==null?void 0:d.filter(i=>i.status==="pending").length)||0,approved:(d==null?void 0:d.filter(i=>i.status==="approved"||i.status==="paid").length)||0,totalWithdrawn:(d==null?void 0:d.filter(i=>i.status==="paid").reduce((i,u)=>i+parseFloat(u.amount),0))||0},b=i=>{const u=gl[i];return e.jsx(X,{className:(u==null?void 0:u.color)||"",children:(u==null?void 0:u.label)||i})};return e.jsxs("div",{className:"flex h-screen bg-background",children:[a&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>t(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx($e,{onClose:()=>t(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx($e,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>t(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-xs md:text-lg lg:text-xl font-semibold",children:"Withdrawals"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(ts,{open:n,onOpenChange:l,children:[e.jsx(Ws,{asChild:!0,children:e.jsxs(g,{"data-testid":"button-request-withdrawal",className:"flex items-center text-xs px-1 py-0.5 h-6 md:text-sm md:px-3 md:py-2 md:h-10 lg:text-base lg:px-4 lg:py-2 lg:h-10",children:[e.jsx(hs,{className:"h-2.5 w-2.5 mr-0.5 md:h-4 md:w-4 md:mr-2"}),"Request Withdrawal"]})}),e.jsxs(_e,{className:"bg-white",children:[e.jsxs(Ge,{children:[e.jsx(We,{children:"Request Profit Withdrawal"}),e.jsx(As,{children:"Request profit withdrawal (Minimum: GHâ‚µ10). Funds will be transferred after admin approval."})]}),e.jsx(ws,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(h),className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg mb-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Profit Balance"}),e.jsx("p",{className:"text-2xl font-bold",children:ae((c==null?void 0:c.profitBalance)||0)})]}),e.jsx(me,{control:p.control,name:"amount",render:({field:i})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Amount (GHS) - Minimum GHâ‚µ10"}),e.jsx(de,{children:e.jsx(K,{type:"number",step:"0.01",min:"10",placeholder:"10.00","data-testid":"input-amount",...i})}),e.jsx(oe,{})]})}),e.jsx(me,{control:p.control,name:"paymentMethod",render:({field:i})=>e.jsxs(ce,{children:[e.jsx(Kt,{children:"Payment Method"}),e.jsxs(Ae,{onValueChange:i.onChange,defaultValue:i.value,children:[e.jsx(de,{children:e.jsx(Pe,{children:e.jsx(Te,{placeholder:"Select payment method"})})}),e.jsx(Ce,{children:m.map(u=>e.jsx(H,{value:u.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u.icon,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:u.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:u.description})]})]})},u.value))})]}),e.jsx(oe,{})]})}),e.jsx(me,{control:p.control,name:"accountNumber",render:({field:i})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Phone Number"}),e.jsx(de,{children:e.jsx(K,{placeholder:"Enter phone number (e.g., 0241234567)","data-testid":"input-account-number",...i})}),e.jsx(oe,{})]})}),e.jsx(me,{control:p.control,name:"accountName",render:({field:i})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Account Name"}),e.jsx(de,{children:e.jsx(K,{placeholder:"Name on account","data-testid":"input-account-name",...i})}),e.jsx(oe,{})]})}),e.jsx(g,{type:"submit",className:"w-full",disabled:j.isPending,"data-testid":"button-submit-withdrawal",children:j.isPending?"Submitting...":"Submit Request"})]})})]})]}),e.jsx(Ne,{})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(we,{title:"Profit Balance",value:ae((c==null?void 0:c.profitBalance)||0),icon:ge,description:"Ready to withdraw"}),e.jsx(we,{title:"Pending Requests",value:f.pending,icon:ze,description:"Awaiting approval"}),e.jsx(we,{title:"Approved",value:f.approved,icon:be,description:"Processed requests"}),e.jsx(we,{title:"Total Withdrawn",value:ae(f.totalWithdrawn),icon:ct,description:"All time"})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"Withdrawal History"]}),e.jsx(J,{children:"Track your withdrawal requests and their status"})]}),e.jsx(D,{children:x?e.jsx(us,{rows:8}):d&&d.length>0?e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{children:"Amount"}),e.jsx(O,{children:"Payment Method"}),e.jsx(O,{children:"Account Details"}),e.jsx(O,{children:"Status"}),e.jsx(O,{children:"Requested"}),e.jsx(O,{children:"Processed"}),e.jsx(O,{children:"Note"})]})}),e.jsx(Ze,{children:d.map(i=>{var u;return e.jsxs(fe,{"data-testid":`row-withdrawal-${i.id}`,children:[e.jsx(M,{className:"font-bold tabular-nums text-lg",children:ae(i.amount)}),e.jsx(M,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[i.paymentMethod==="bank"?e.jsx(Sn,{className:"h-4 w-4 text-blue-600"}):e.jsx(Le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium capitalize",children:((u=i.paymentMethod)==null?void 0:u.replace("_"," "))||"Bank"})]})}),e.jsx(M,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:i.accountName}),e.jsx("div",{className:"text-muted-foreground",children:i.accountNumber}),i.paymentMethod==="bank"&&i.bankName&&e.jsx("div",{className:"text-muted-foreground text-xs",children:i.bankName})]})}),e.jsx(M,{children:b(i.status)}),e.jsx(M,{className:"text-muted-foreground text-sm",children:Qe(i.createdAt)}),e.jsx(M,{className:"text-muted-foreground text-sm",children:i.paidAt?Qe(i.paidAt):"-"}),e.jsx(M,{className:"text-muted-foreground text-sm max-w-[150px] truncate",children:i.adminNote||"-"})]},i.id)})})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:'No withdrawal requests yet. Click "Request Withdrawal" to submit a withdrawal request (Min: GHâ‚µ10).'})})]})]})})]})]})}const cc=Z.object({businessName:Z.string().min(2,"Business name must be at least 2 characters"),businessDescription:Z.string().optional(),whatsappSupportLink:Z.string().url("Please enter a valid WhatsApp link").optional().or(Z.literal("")),whatsappChannelLink:Z.string().url("Please enter a valid WhatsApp Channel link").optional().or(Z.literal(""))});function dc(){const{toast:s}=he(),[a,t]=o.useState(!1),{data:n,isLoading:l}=V({queryKey:["/api/profile"],refetchInterval:3e4,refetchOnWindowFocus:!0}),r=n==null?void 0:n.profile,c=gs({resolver:fs(cc),defaultValues:{businessName:"",businessDescription:"",whatsappSupportLink:"",whatsappChannelLink:""}});o.useEffect(()=>{r&&c.reset({businessName:r.businessName||"",businessDescription:r.businessDescription||"",whatsappSupportLink:r.whatsappSupportLink||"",whatsappChannelLink:r.whatsappChannelLink||""})},[r,c]);const d=re({mutationFn:m=>Y("PATCH","/api/agent/storefront",m),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/profile"]}),s({title:"Store details updated successfully"})},onError:m=>{s({title:"Failed to update store",description:m.message,variant:"destructive"})}}),x=m=>{d.mutate(m)},p=()=>{if(r){const m=`${window.location.origin}/store/agent/${r.storefrontSlug}`;navigator.clipboard.writeText(m),s({title:"Store link copied to clipboard!"})}};return e.jsxs("div",{className:"flex h-screen bg-background",children:[a&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>t(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx($e,{onClose:()=>t(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx($e,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>t(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"My Storefront"})]}),e.jsx(Ne,{})]}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:[e.jsx("div",{className:"max-w-4xl mx-auto mb-8",children:e.jsxs("div",{className:"relative bg-green-500 rounded-lg p-8 border border-green-600",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"p-3 bg-white/20 rounded-full",children:e.jsx(zs,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:(r==null?void 0:r.businessName)||"Your Storefront"}),e.jsx("p",{className:"text-green-100",children:"Manage and customize your online store"})]})]}),e.jsx("div",{className:"bg-white/10 rounded-md p-4 border border-white/20",children:e.jsx("p",{className:"text-white/90 leading-relaxed",children:(r==null?void 0:r.businessDescription)||"No business description provided. Update it below to tell customers about your store."})}),e.jsxs("div",{className:"flex items-center gap-4 mt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/90",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{children:"Active Storefront"})]}),(r==null?void 0:r.storefrontSlug)&&e.jsxs(X,{variant:"secondary",className:"text-xs bg-white/20 text-white border-white/30",children:["/",r.storefrontSlug]})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(zs,{className:"h-5 w-5"}),"Store Link"]}),e.jsx(J,{children:"Share this link with your customers"})]}),e.jsx(D,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsx(K,{value:r?`${window.location.origin}/store/agent/${r.storefrontSlug}`:"",readOnly:!0,className:"font-mono text-sm flex-1 min-w-0","data-testid":"input-store-url"}),e.jsxs("div",{className:"flex items-center gap-2 sm:shrink-0",children:[e.jsx(g,{variant:"outline",size:"icon",onClick:p,"data-testid":"button-copy-link",children:e.jsx(_s,{className:"h-4 w-4"})}),r&&e.jsx("a",{href:`/store/agent/${r.storefrontSlug}`,target:"_blank",rel:"noopener noreferrer","aria-label":"Open storefront in new tab",children:e.jsx(g,{variant:"outline",size:"icon","data-testid":"button-open-store",children:e.jsx(nt,{className:"h-4 w-4"})})})]})]})})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Store Details"}),e.jsx(J,{children:"Customize how your store appears to customers"})]}),e.jsx(D,{children:e.jsx(ws,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(x),className:"space-y-4",children:[e.jsx(me,{control:c.control,name:"businessName",render:({field:m})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Business Name"}),e.jsx(de,{children:e.jsx(K,{placeholder:"Your business name",disabled:l,"data-testid":"input-business-name",...m})}),e.jsx(oe,{})]})}),e.jsx(me,{control:c.control,name:"businessDescription",render:({field:m})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Description"}),e.jsx(de,{children:e.jsx(bs,{placeholder:"Tell customers about your business...",className:"resize-none",rows:3,disabled:l,"data-testid":"input-business-description",...m})}),e.jsx(ss,{children:"This will be shown on your storefront page"}),e.jsx(oe,{})]})}),e.jsx(me,{control:c.control,name:"whatsappSupportLink",render:({field:m})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"WhatsApp Support Link"}),e.jsx(de,{children:e.jsx(K,{placeholder:"https://wa.me/1234567890",disabled:l,"data-testid":"input-whatsapp-support",...m})}),e.jsx(ss,{children:"Link to your WhatsApp for customer support. Leave empty to hide from storefront."}),e.jsx(oe,{})]})}),e.jsx(me,{control:c.control,name:"whatsappChannelLink",render:({field:m})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"WhatsApp Channel Link"}),e.jsx(de,{children:e.jsx(K,{placeholder:"https://whatsapp.com/channel/...",disabled:l,"data-testid":"input-whatsapp-channel",...m})}),e.jsx(ss,{children:"Link to your WhatsApp Channel. Leave empty to hide from storefront."}),e.jsx(oe,{})]})}),e.jsxs(g,{type:"submit",disabled:d.isPending||l,"data-testid":"button-save-details",children:[e.jsx(St,{className:"h-4 w-4 mr-2"}),d.isPending?"Saving...":l?"Loading...":"Save Changes to my storefront page"]})]})})})]})]})]})]})]})}const oc=Z.object({name:Z.string().min(2,"Name must be at least 2 characters"),email:Z.string().email("Invalid email address"),phone:Z.string().optional(),whatsappSupportLink:Z.string().url("Must be a valid URL").optional().or(Z.literal("")),whatsappChannelLink:Z.string().url("Must be a valid URL").optional().or(Z.literal(""))}),mc=Z.object({currentPassword:Z.string().min(6,"Password must be at least 6 characters"),newPassword:Z.string().min(6,"Password must be at least 6 characters"),confirmPassword:Z.string()}).refine(s=>s.newPassword===s.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function xc(){const{toast:s}=he(),[a,t]=o.useState(!1),{data:n}=V({queryKey:["/api/profile"]}),l=n==null?void 0:n.profile,r=gs({resolver:fs(oc),defaultValues:{name:"",email:"",phone:"",whatsappSupportLink:"",whatsappChannelLink:""}});o.useEffect(()=>{var j,h,f;l&&r.reset({name:((j=l.user)==null?void 0:j.name)||"",email:((h=l.user)==null?void 0:h.email)||"",phone:((f=l.user)==null?void 0:f.phone)||"",whatsappSupportLink:l.whatsappSupportLink||"",whatsappChannelLink:l.whatsappChannelLink||""})},[l,r]);const c=gs({resolver:fs(mc),defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}}),d=re({mutationFn:j=>Y("PATCH","/api/agent/profile",j),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/agent/profile"]}),s({title:"Profile updated successfully"})},onError:j=>{s({title:"Failed to update profile",description:j.message,variant:"destructive"})}}),x=re({mutationFn:j=>Y("POST","/api/agent/password",j),onSuccess:()=>{c.reset(),s({title:"Password updated successfully"})},onError:j=>{s({title:"Failed to update password",description:j.message,variant:"destructive"})}}),p=j=>{d.mutate(j)},m=j=>{x.mutate(j)};return e.jsxs("div",{className:"flex h-screen bg-background",children:[a&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>t(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx($e,{onClose:()=>t(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx($e,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>t(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Settings"})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(la,{className:"h-5 w-5"}),"Profile Information"]}),e.jsx(J,{children:"Update your personal details"})]}),e.jsx(D,{children:e.jsx(ws,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(p),className:"space-y-4",children:[e.jsx(me,{control:r.control,name:"name",render:({field:j})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Full Name"}),e.jsx(de,{children:e.jsx(K,{placeholder:"Your full name","data-testid":"input-name",...j})}),e.jsx(oe,{})]})}),e.jsx(me,{control:r.control,name:"email",render:({field:j})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Email Address"}),e.jsx(de,{children:e.jsx(K,{type:"email",placeholder:"your@email.com","data-testid":"input-email",...j})}),e.jsx(oe,{})]})}),e.jsx(me,{control:r.control,name:"phone",render:({field:j})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Phone Number"}),e.jsx(de,{children:e.jsx(K,{placeholder:"+233 XX XXX XXXX","data-testid":"input-phone",...j})}),e.jsx(ss,{children:"Used for account recovery and notifications"}),e.jsx(oe,{})]})}),e.jsx(me,{control:r.control,name:"whatsappSupportLink",render:({field:j})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"WhatsApp Support Link"}),e.jsx(de,{children:e.jsx(K,{placeholder:"https://wa.me/1234567890",...j})}),e.jsx(ss,{children:"Link to your WhatsApp for customer support. Leave empty to hide from storefront."}),e.jsx(oe,{})]})}),e.jsx(me,{control:r.control,name:"whatsappChannelLink",render:({field:j})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"WhatsApp Channel Link"}),e.jsx(de,{children:e.jsx(K,{placeholder:"https://whatsapp.com/channel/...",...j})}),e.jsx(ss,{children:"Link to your WhatsApp Channel. Leave empty to hide from storefront."}),e.jsx(oe,{})]})}),e.jsxs(g,{type:"submit",disabled:d.isPending,"data-testid":"button-save-profile",children:[e.jsx(St,{className:"h-4 w-4 mr-2"}),d.isPending?"Saving...":"Save Changes"]})]})})})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-5 w-5"}),"Change Password"]}),e.jsx(J,{children:"Update your account password"})]}),e.jsx(D,{children:e.jsx(ws,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(m),className:"space-y-4",children:[e.jsx(me,{control:c.control,name:"currentPassword",render:({field:j})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Current Password"}),e.jsx(de,{children:e.jsx(K,{type:"password",placeholder:"Enter current password","data-testid":"input-current-password",...j})}),e.jsx(oe,{})]})}),e.jsx(_t,{}),e.jsx(me,{control:c.control,name:"newPassword",render:({field:j})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"New Password"}),e.jsx(de,{children:e.jsx(K,{type:"password",placeholder:"Enter new password","data-testid":"input-new-password",...j})}),e.jsx(oe,{})]})}),e.jsx(me,{control:c.control,name:"confirmPassword",render:({field:j})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Confirm New Password"}),e.jsx(de,{children:e.jsx(K,{type:"password",placeholder:"Confirm new password","data-testid":"input-confirm-password",...j})}),e.jsx(oe,{})]})}),e.jsxs(g,{type:"submit",disabled:x.isPending,"data-testid":"button-change-password",children:[e.jsx(js,{className:"h-4 w-4 mr-2"}),x.isPending?"Updating...":"Change Password"]})]})})})]})]})})]})]})}function Rl(){const[s,a]=o.useState(""),[t,n]=o.useState(null),[l,r]=o.useState("chat"),c=o.useRef(null),d=Fs(),{toast:x}=he(),{data:p}=V({queryKey:["/api/support/chats"],queryFn:async()=>(await Y("GET","/api/support/chats")).json()}),m=re({mutationFn:async()=>(await Y("POST","/api/support/chat/create",{})).json(),onSuccess:R=>{console.log("Chat created successfully:",R),n(R.chatId),d.invalidateQueries({queryKey:["/api/support/chats"]})},onError:R=>{console.error("Failed to create chat:",R),x({title:"Failed to create chat",description:R.message,variant:"destructive"})}}),{data:j,isLoading:h}=V({queryKey:["/api/support/chat",t],queryFn:async()=>(await Y("GET",`/api/support/chat/${t}`)).json(),enabled:!!t,refetchInterval:5e3});o.useEffect(()=>{if(console.log("useEffect triggered - chats:",p,"chatId:",t,"createChatMutation.isPending:",m.isPending),p&&!t&&!m.isPending){const R=p.find(P=>P.status==="open");console.log("Found open chat:",R),R?(console.log("Setting chatId to existing chat:",R.id),n(R.id)):(console.log("Chats exist but none open, creating new chat"),m.mutate())}else p&&p.length===0&&!t&&!m.isPending&&(console.log("No chats exist, creating new chat"),m.mutate())},[p,t,m.isPending]);const f=re({mutationFn:async R=>(await Y("POST",`/api/support/chat/${t}/message`,{message:R})).json(),onSuccess:()=>{d.invalidateQueries({queryKey:["/api/support/chat",t]}),a("")},onError:R=>{x({title:"Failed to send message",description:R.message,variant:"destructive"})}}),b=R=>{R.preventDefault(),!(!s.trim()||!t)&&f.mutate(s)},i=()=>{r("whatsapp");const R="+233501234567",P=encodeURIComponent("Hi, I need help with my data bundle purchase.");window.open(`https://wa.me/${R}?text=${P}`,"_blank")},u=()=>{var R;r("chat"),(R=document.getElementById("chat-section"))==null||R.scrollIntoView({behavior:"smooth"})};o.useEffect(()=>{c.current&&(c.current.scrollTop=c.current.scrollHeight)},[j==null?void 0:j.messages]),o.useEffect(()=>{if(j!=null&&j.messages&&t){const R=j.messages.filter(P=>P.senderType==="admin"&&!P.isRead);R.forEach(async P=>{try{await Y("PUT",`/api/support/message/${P.id}/read`,{})}catch(v){console.error("Failed to mark message as read:",v)}}),R.length>0&&d.invalidateQueries({queryKey:["/api/support/unread-count"]})}},[j==null?void 0:j.messages,t,d]);const F=(j==null?void 0:j.messages)||[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Customer Support"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Choose your preferred support channel"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs(g,{onClick:i,className:`h-auto py-4 text-sm flex-col gap-2 ${l==="whatsapp"?"bg-yellow-500 text-white font-medium shadow-sm":"bg-green-600 hover:bg-green-700 text-white"}`,children:[e.jsx(Rs,{className:"h-6 w-6"}),e.jsx("span",{children:"WhatsApp Support"}),e.jsx("span",{className:"text-xs opacity-90",children:"Get instant help via WhatsApp"})]}),e.jsxs(g,{onClick:u,className:`h-auto py-4 text-sm flex-col gap-2 ${l==="chat"?"bg-yellow-500 text-white font-medium shadow-sm":"border hover:bg-accent"}`,children:[e.jsx(Rs,{className:"h-6 w-6"}),e.jsx("span",{children:"Live Chat"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Chat with our support team"})]})]})]}),e.jsxs(C,{id:"chat-section",children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(Rs,{className:"h-4 w-4 md:h-5 md:w-5"}),"Live Chat",t?e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:"Connected"}):e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full",children:m.isPending?"Connecting...":"Initializing..."})]}),e.jsx(J,{className:"text-xs md:text-sm",children:"Send us a message and we'll respond as soon as possible"})]}),e.jsx(D,{className:"space-y-4",children:e.jsxs("div",{className:"border rounded-lg h-[600px] flex flex-col",children:[e.jsx(st,{className:"flex-1 p-4",ref:c,children:h?e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading messages..."}):F.length===0?e.jsx("div",{className:"text-center text-muted-foreground",children:"No messages yet. Start a conversation!"}):e.jsx("div",{className:"space-y-4",children:F.map(R=>e.jsxs("div",{className:`flex gap-3 ${R.senderType==="user"?"justify-end":"justify-start"}`,children:[R.senderType==="admin"&&e.jsx(Ut,{className:"h-8 w-8",children:e.jsx(zt,{className:"text-xs",children:"ST"})}),e.jsxs("div",{className:`max-w-[70%] rounded-lg px-3 py-2 ${R.senderType==="user"?"bg-primary text-primary-foreground":"bg-muted"}`,children:[e.jsx("p",{className:"text-sm",children:R.message}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:new Date(R.createdAt).toLocaleTimeString()})]}),R.senderType==="user"&&e.jsx(Ut,{className:"h-8 w-8",children:e.jsx(zt,{children:"ME"})})]},R.id))})}),e.jsx("form",{onSubmit:b,className:"p-4 border-t",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{value:s,onChange:R=>a(R.target.value),placeholder:"Type your message...",disabled:f.isPending}),e.jsxs(g,{type:"submit",size:"sm",disabled:f.isPending||!s.trim()||!t,title:t?s.trim()?f.isPending?"Sending message...":"Send message":"Message cannot be empty":"Chat not initialized",children:[e.jsx(Vr,{className:"h-4 w-4"}),f.isPending&&"Sending..."]})]})})]})})]})]})}function hc(){const[s,a]=o.useState(!1);return e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx($e,{})}),e.jsx(He,{open:s,onOpenChange:a,children:e.jsxs(qe,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(as,{children:[e.jsx(Ve,{children:"Navigation Menu"}),e.jsx(Ye,{children:"Main navigation for support"})]}),e.jsx($e,{onClose:()=>a(!1)})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(He,{open:s,onOpenChange:a,children:[e.jsx(Is,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(pe,{className:"h-5 w-5"})})}),e.jsxs(qe,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(as,{children:[e.jsx(Ve,{children:"Navigation Menu"}),e.jsx(Ye,{children:"Main navigation for support"})]}),e.jsx($e,{onClose:()=>a(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Support Chat"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get help from our support team"})]})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(Rl,{})})})]})]})}const uc={mtn:{name:"MTN",color:"bg-yellow-400",logo:ft},at_ishare:{name:"AirtelTigo iShare",color:"bg-red-500",logo:cs},at_bigtime:{name:"AirtelTigo BIG TIME",color:"bg-red-600",logo:cs},telecel:{name:"Telecel",color:"bg-green-500",logo:Nt}};function pc(){var N;const{network:s}=Dt(),{user:a}=je(),{toast:t}=he(),n=Fs(),[l,r]=o.useState(!1),[c,d]=o.useState(null),[x,p]=o.useState(""),[m,j]=o.useState("paystack"),[h,f]=o.useState(""),[b,i]=o.useState("paystack"),{data:u,isLoading:F}=V({queryKey:["/api/products/data-bundles",s],queryFn:async()=>{const y=s==null?void 0:s.replace(/-/g,"_");return await Y("GET",`/api/products/data-bundles?network=${y}`)},enabled:!!s}),{data:R}=V({queryKey:["/api/profile"],queryFn:async()=>Y("GET","/api/profile")}),{data:P}=V({queryKey:["/api/auth/me"],enabled:!0}),v=(N=P==null?void 0:P.user)!=null&&N.walletBalance?parseFloat(P.user.walletBalance):0,U=o.useMemo(()=>{if(!h.trim()||!u)return null;const y=h.split(`
`).filter(k=>k.trim());let I=0,T=0;for(const k of y){const S=k.trim().split(/\s+/);if(S.length===2){const A=parseFloat(S[1]);if(!isNaN(A)&&A>0){const W=u.find(_=>{const ie=_.dataAmount.toLowerCase().match(/(\d+(?:\.\d+)?)/);return ie?parseFloat(ie[1])===A:!1});if(W){const _=parseFloat(W.effective_price);I+=_,T++}}}}return T>0?{total:I,count:T}:null},[h,u]),E=re({mutationFn:async y=>{const I=u==null?void 0:u.find(A=>A.id===y.bundleId);if(!I)throw new Error("Bundle not found");const T=[y.phoneNumber],k=parseFloat(I.effective_price),S=!1;if(console.log("[Frontend] Single order payment initialization"),console.log("[Frontend] Phone numbers:",T),console.log("[Frontend] Is bulk:",S),y.paymentMethod==="wallet"){const A={productType:"data_bundle",productId:I.id,productName:I.name,network:I.network,amount:k.toFixed(2),customerPhone:T[0],phoneNumbers:void 0,isBulkOrder:S};return console.log("[Frontend] Wallet payload:",JSON.stringify(A,null,2)),await Y("POST","/api/wallet/pay",A)}else{const A={productType:"data_bundle",productId:I.id,customerPhone:T[0],phoneNumbers:void 0,isBulkOrder:S,customerEmail:(a==null?void 0:a.email)||void 0};return console.log("[Frontend] Paystack payload:",JSON.stringify(A,null,2)),await Y("POST","/api/checkout/initialize",A)}},onSuccess:(y,I)=>{I.paymentMethod==="wallet"?(t({title:"âœ… Payment Successful!",description:`Your purchase has been confirmed. New wallet balance: GHâ‚µ${y.newBalance}. View Order History to download your receipt.`,duration:5e3}),d(null),p(""),n.invalidateQueries({queryKey:["/api/auth/me"]}),n.invalidateQueries({queryKey:["/api/transactions"]})):window.location.href=y.paymentUrl},onError:y=>{const I=y.message||"Unable to process payment",T=I.toLowerCase().includes("insufficient");t({title:T?"âš ï¸ Insufficient Wallet Balance":"âŒ Payment Failed",description:T?"Your wallet balance is too low for this purchase. Please top up your wallet or use Paystack.":`${I}. Please try again or contact support if the problem persists.`,variant:"destructive",duration:6e3})}}),se=re({mutationFn:async y=>{var T;if(y.orderItems&&y.totalAmount!==void 0){const k=y.orderItems.map(A=>A.phone),S=y.totalAmount;if(console.log("[Frontend] ========== NEW BULK FORMAT PAYMENT =========="),console.log("[Frontend] Order items:",y.orderItems),console.log("[Frontend] Total amount:",S),console.log("[Frontend] ================================================"),y.paymentMethod==="wallet"){const A={productType:"data_bundle",productName:`Bulk Order - ${y.orderItems.length} items`,network:s,amount:S.toFixed(2),customerPhone:k[0],isBulkOrder:!0,orderItems:y.orderItems};return console.log("[Frontend] Wallet payload:",JSON.stringify(A,null,2)),await Y("POST","/api/wallet/pay",A)}else{const A={productType:"data_bundle",network:s,customerPhone:k[0],isBulkOrder:!0,orderItems:y.orderItems,totalAmount:S,customerEmail:(a==null?void 0:a.email)||void 0};console.log("[Frontend] Paystack payload:",JSON.stringify(A,null,2));const W=await Y("POST","/api/checkout/initialize",A);return console.log("[Frontend] ===== SERVER RESPONSE ====="),console.log("[Frontend] Result:",W),console.log("[Frontend] ================================"),W}}else{const k=u==null?void 0:u.find(ie=>ie.id===y.bundleId);if(!k)throw new Error("Bundle not found");const S=y.phoneNumbers,A=parseFloat(k.basePrice),W=((T=R==null?void 0:R.profile)==null?void 0:T.markupPercentage)||0,te=(A+A*W/100)*S.length;if(console.log("[Frontend] ========== LEGACY BULK FORMAT =========="),console.log("[Frontend] Phone numbers:",S),console.log("[Frontend] Total amount:",te),console.log("[Frontend] ================================================"),y.paymentMethod==="wallet"){const ie={productType:"data_bundle",productId:k.id,productName:k.name,network:k.network,amount:te.toFixed(2),customerPhone:S[0],phoneNumbers:S,isBulkOrder:!0};return await Y("POST","/api/wallet/pay",ie)}else{const ie={productType:"data_bundle",productId:k.id,customerPhone:S[0],phoneNumbers:S,isBulkOrder:!0,customerEmail:(a==null?void 0:a.email)||void 0};return await Y("POST","/api/checkout/initialize",ie)}}},onSuccess:(y,I)=>{I.paymentMethod==="wallet"?(t({title:"âœ… Payment Successful!",description:`Your bulk purchase has been confirmed. New wallet balance: GHâ‚µ${y.newBalance}. View Order History to download your receipt.`,duration:5e3}),f(""),n.invalidateQueries({queryKey:["/api/auth/me"]}),n.invalidateQueries({queryKey:["/api/transactions"]})):window.location.href=y.paymentUrl},onError:y=>{const I=y.message||"Unable to process payment",T=I.toLowerCase().includes("insufficient");t({title:T?"âš ï¸ Insufficient Wallet Balance":"âŒ Payment Failed",description:T?"Your wallet balance is too low for this purchase. Please top up your wallet or use Paystack.":`${I}. Please try again or contact support if the problem persists.`,variant:"destructive",duration:6e3})}}),ee=()=>{if(!c||!x)return;const y=parseFloat(c.effective_price);if(m==="wallet"&&y>v){t({title:"âš ï¸ Insufficient Wallet Balance",description:`You need GHâ‚µ${(y-v).toFixed(2)} more. Please top up your wallet or use Paystack.`,variant:"destructive",duration:6e3});return}if(!m){t({title:"âŒ Payment Method Required",description:"Please select a payment method",variant:"destructive"});return}E.mutate({bundleId:c.id,phoneNumber:x,paymentMethod:m})},le=()=>{var S;if(!h.trim()){t({title:"âŒ Missing Information",description:"Please enter phone numbers with GB amounts",variant:"destructive"});return}const y=h.split(`
`).filter(A=>A.trim()),I=[];for(const A of y){const W=A.trim().split(/\s+/);if(W.length!==2){t({title:"âŒ Invalid Format",description:`Line "${A}" must have format: phone_number GB_amount (e.g., "0241234567 2")`,variant:"destructive",duration:8e3});return}let _=W[0];const te=parseFloat(W[1]);if(isNaN(te)||te<=0){t({title:"âŒ Invalid GB Amount",description:`GB amount "${W[1]}" must be a positive number`,variant:"destructive",duration:8e3});return}_=_.replace(/^\+/,""),_.startsWith("233")&&(_="0"+_.substring(3));const ie=$s(_),q=Ks(ie);if(!q.isValid){const ne=ns(s);t({title:"âŒ Phone Number Mismatch",description:`${_}: ${q.error||`Must be for ${w==null?void 0:w.name} network. Valid prefixes: ${ne.join(", ")}`}`,variant:"destructive",duration:8e3});return}I.push({phone:ie,gb:te})}if(I.length===0){t({title:"No Data",description:"Please enter at least one phone number with GB amount",variant:"destructive"});return}const T=[];let k=0;for(const A of I){const W=u==null?void 0:u.find(ie=>{const ne=ie.dataAmount.match(/(\d+(?:\.\d+)?)\s*gb/i);return ne?parseFloat(ne[1])===A.gb:!1});if(!W){t({title:"âŒ Bundle Not Found",description:`No ${A.gb}GB bundle available for ${w==null?void 0:w.name}. Please check available bundles.`,variant:"destructive",duration:8e3});return}const _=Ks(A.phone);_.isValid||t({title:"âš ï¸ Network Mismatch",description:`${A.phone}: ${_.error}. Purchase will proceed but may fail if network doesn't match.`,variant:"default",duration:6e3});const te=W.agentPrice?parseFloat(W.agentPrice):parseFloat(W.basePrice)+parseFloat(W.basePrice)*(((S=R==null?void 0:R.profile)==null?void 0:S.markupPercentage)||0)/100;T.push({phone:A.phone,bundleId:W.id,bundleName:W.name,price:te}),k+=te}if(b==="wallet"&&v<k){t({title:"âš ï¸ Insufficient Wallet Balance",description:`You need GHâ‚µ${(k-v).toFixed(2)} more. Please top up your wallet or use Paystack.`,variant:"destructive",duration:6e3});return}if(!b){t({title:"âŒ Payment Method Required",description:"Please select a payment method",variant:"destructive"});return}se.mutate({bundleId:"",phoneNumbers:[],paymentMethod:b,orderItems:T,totalAmount:k})};if(!a)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})});const w=uc[s==null?void 0:s.replace(/-/g,"_")];return w?e.jsxs("div",{className:"fixed inset-0 flex",children:[e.jsx("aside",{className:"hidden md:block flex-shrink-0",children:e.jsx($e,{})}),e.jsx(He,{open:l,onOpenChange:r,children:e.jsxs(qe,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(as,{children:[e.jsx(Ve,{children:"Navigation Menu"}),e.jsx(Ye,{children:"Main navigation for your dashboard"})]}),e.jsx($e,{onClose:()=>r(!1)})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(He,{open:l,onOpenChange:r,children:[e.jsx(Is,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(pe,{className:"h-5 w-5"})})}),e.jsxs(qe,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(as,{children:[e.jsx(Ve,{children:"Navigation Menu"}),e.jsx(Ye,{children:"Main navigation for your dashboard"})]}),e.jsx($e,{onClose:()=>r(!1)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:w.logo,alt:w.name,className:"h-8 w-8 rounded"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold",children:[w.name," Bundles"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Purchase data bundles for your customers"})]})]})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx(C,{children:e.jsx(D,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${w.color}`}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold",children:[w.name," Data Bundles"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Purchase data bundles for your customers with your markup pricing"})]})]})})}),e.jsxs(Hs,{defaultValue:"single",className:"w-full",children:[e.jsxs(qs,{className:"grid w-full grid-cols-2",children:[e.jsxs(Ee,{value:"single",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Single Purchase"]}),s!=="at_ishare"&&e.jsxs(Ee,{value:"bulk",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Bulk Purchase"]})]}),e.jsx(Be,{value:"single",className:"space-y-6",children:e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Purchase Data Bundle"}),e.jsx(J,{children:"Select a bundle and enter recipient details"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Select Bundle"}),F?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(Q,{className:"h-5 w-5 animate-spin"})}):e.jsxs(Ae,{value:(c==null?void 0:c.id)||"",onValueChange:y=>{const I=u==null?void 0:u.find(T=>T.id===y);d(I||null)},children:[e.jsx(Pe,{children:e.jsx(Te,{placeholder:"Choose a data bundle"})}),e.jsx(Ce,{children:u&&u.length>0?u.map(y=>{const I=parseFloat(y.effective_price);return e.jsxs(H,{value:y.id,children:[y.name," - ",y.validity," - GHâ‚µ",I.toFixed(2)]},y.id)}):e.jsx(H,{value:"no-bundles",disabled:!0,children:"No bundles available"})})]})]}),c&&e.jsxs("div",{className:"p-2 bg-yellow-500 text-white rounded-lg border border-yellow-600",children:[e.jsx("p",{className:"text-sm text-white",children:"Selected Bundle"}),e.jsx("p",{className:"font-medium text-lg text-white",children:c.name}),e.jsx("p",{className:"text-sm text-white",children:c.validity}),c.description&&e.jsx("p",{className:"text-xs text-white mt-1",children:c.description}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsxs("span",{className:"text-2xl font-bold text-white",children:["GHâ‚µ",parseFloat(c.effective_price).toFixed(2)]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"phone",children:"Beneficiary Number"}),e.jsx(K,{id:"phone",placeholder:"0241234567",value:x,onChange:y=>p(y.target.value)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["For ",e.jsx("strong",{children:w==null?void 0:w.name})," network only. Valid prefixes: ",e.jsx("strong",{children:c?ns(c.network).join(", "):""})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(z,{children:"Payment Method"}),e.jsxs(dt,{value:m||"",onValueChange:y=>j(y),className:"grid gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Cs,{value:"wallet",id:"wallet-single",disabled:c?parseFloat(c.effective_price)>v:!1,className:"peer sr-only"}),e.jsxs(z,{htmlFor:"wallet-single",className:`flex items-center justify-between rounded-lg border-2 border-muted bg-white p-4 hover:border-green-500 hover:shadow-md peer-checked:border-green-500 peer-checked:bg-green-50 peer-checked:shadow-md cursor-pointer transition-all ${c?parseFloat(c.effective_price)>v:""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Wallet Balance"}),e.jsxs("div",{className:"text-sm text-green-600",children:["Available: GHâ‚µ",v.toFixed(2)]})]})]}),m==="wallet"&&e.jsx(be,{className:"h-5 w-5 text-green-600"})]}),c?parseFloat(c.effective_price)>v:!1]}),e.jsxs("div",{children:[e.jsx(Cs,{value:"paystack",id:"paystack-single",className:"peer sr-only"}),e.jsxs(z,{htmlFor:"paystack-single",className:"flex items-center justify-between rounded-lg border-2 border-muted bg-white p-4 hover:border-green-500 hover:shadow-md peer-checked:border-green-500 peer-checked:bg-green-50 peer-checked:shadow-md cursor-pointer transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Pay with MoMo"}),e.jsx("div",{className:"text-sm text-green-600",children:"Secure payment via Paystack"})]})]}),m==="paystack"&&e.jsx(be,{className:"h-5 w-5 text-green-600"})]})]})]})]}),c&&m==="wallet"&&parseFloat(c.effective_price)>v&&e.jsxs(ms,{variant:"default",className:"border-destructive bg-white text-destructive",children:[e.jsx(os,{className:"h-4 w-4"}),e.jsxs(xs,{className:"text-sm",children:[e.jsx("strong",{children:"Insufficient Balance:"})," You need GHâ‚µ",(parseFloat(c.effective_price)-v).toFixed(2)," more.",e.jsx("a",{href:"/agent/wallet",className:"underline ml-1 font-medium hover:text-destructive-foreground",children:"Top up wallet"})," or select Paystack."]})]}),e.jsx(g,{className:"w-full",size:"lg",onClick:ee,disabled:!c||!x||!m||E.isPending||m==="wallet"&&c&&parseFloat(c.effective_price)>v,children:E.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),"Purchase Bundle"]})})]})]})}),s!=="at_ishare"&&e.jsx(Be,{value:"bulk",className:"space-y-6",children:e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Bulk Purchase"}),e.jsxs(J,{children:["Enter phone numbers with GB amounts for ",w==null?void 0:w.name]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(z,{htmlFor:"bulk-phones",children:"Beneficiary Numbers and GB Amounts"}),h.trim()&&e.jsxs(X,{variant:"outline",className:"text-xs",children:[h.split(`
`).filter(y=>y.trim()).length," entries"]})]}),e.jsx(bs,{id:"bulk-phones",placeholder:`0546591622 1
0247064874 3
0245696072 2
233547897522 10
...add as many as you need (no limit)`,rows:20,value:h,onChange:y=>f(y.target.value),className:"font-mono text-sm"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:['Enter one number per line with GB amount (e.g., "0241234567 2" for 2GB). Supports formats: 0241234567 or 233241234567 (no + sign).',e.jsx("strong",{className:"text-green-600",children:"âœ“ No limit - add 100+ numbers!"}),e.jsx("br",{}),"All numbers must be for ",e.jsx("strong",{children:w==null?void 0:w.name})," network. Valid prefixes: ",e.jsx("strong",{children:s?ns(s).join(", "):""})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(z,{children:"Payment Method"}),e.jsxs(dt,{value:b||"",onValueChange:y=>i(y),className:"grid gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Cs,{value:"wallet",id:"wallet-bulk",disabled:U?v<U.total:!1,className:"peer sr-only"}),e.jsxs(z,{htmlFor:"wallet-bulk",className:`flex items-center justify-between rounded-lg border-2 border-muted !bg-white p-4 hover:border-green-500 hover:shadow-md peer-checked:border-green-500 peer-checked:bg-green-50 peer-checked:shadow-md cursor-pointer transition-all ${U?v<U.total:""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Wallet Balance"}),e.jsxs("div",{className:"text-sm text-green-600",children:["Available: GHâ‚µ",v.toFixed(2)]})]})]}),b==="wallet"&&e.jsx(be,{className:"h-5 w-5 text-green-600"})]}),U?v<U.total:!1]}),e.jsxs("div",{children:[e.jsx(Cs,{value:"paystack",id:"paystack-bulk",className:"peer sr-only"}),e.jsxs(z,{htmlFor:"paystack-bulk",className:"flex items-center justify-between rounded-lg border-2 border-muted bg-white p-4 hover:border-green-500 hover:shadow-md peer-checked:border-green-500 peer-checked:bg-green-50 peer-checked:shadow-md cursor-pointer transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Pay with MoMo"}),e.jsx("div",{className:"text-sm text-green-600",children:"Secure payment via Paystack"})]})]}),b==="paystack"&&e.jsx(be,{className:"h-5 w-5 text-green-600"})]})]})]})]}),U&&b==="wallet"&&v<U.total&&e.jsxs(ms,{variant:"default",className:"border-destructive bg-white text-destructive",children:[e.jsx(os,{className:"h-4 w-4"}),e.jsxs(xs,{className:"text-sm",children:[e.jsx("strong",{children:"Insufficient Balance:"})," You need GHâ‚µ",(U.total-v).toFixed(2)," more.",e.jsx("a",{href:"/agent/wallet",className:"underline ml-1 font-medium hover:text-destructive-foreground",children:"Top up wallet"})," or select Paystack."]})]}),e.jsx(g,{className:"w-full",size:"lg",onClick:le,disabled:!h.trim()||!b||se.isPending||b==="wallet"&&U!==null&&v<U.total,children:se.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Yr,{className:"mr-2 h-4 w-4"}),U?`Purchase for GHâ‚µ${U.total.toFixed(2)} (${U.count} items)`:"Purchase Data Bundles"]})})]})]})})]})]})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Network Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"The requested network is not available."})]})})}const jc=Z.object({amount:Z.string().refine(s=>{const a=parseFloat(s);return!isNaN(a)&&a>=1},"Minimum top-up amount is GHS 1"),paymentMethod:Z.enum(["paystack"],{required_error:"Please select a payment method"})});function Ll(){const[s,a]=o.useState(!1),[t,n]=o.useState(!1),{toast:l}=he(),{user:r}=je();Fs();const{data:c}=V({queryKey:["user-stats"],queryFn:()=>Ie("/api/user/stats"),enabled:!!r}),d=gs({resolver:fs(jc),defaultValues:{amount:"",paymentMethod:"paystack"}});c!=null&&c.walletBalance&&parseFloat(c.walletBalance),parseFloat(d.watch("amount")||"0"),o.useEffect(()=>{s&&d.reset({amount:"",paymentMethod:"paystack"})},[s,d]);const x=re({mutationFn:async j=>await Ie("/api/wallet/topup/initialize",{method:"POST",body:JSON.stringify({amount:j.amount,paymentMethod:j.paymentMethod})}),onSuccess:j=>{j.authorizationUrl&&(window.location.href=j.authorizationUrl)},onError:j=>{const h=j.message||"Unable to initialize payment";l({title:"âŒ Wallet Top-up Failed",description:`${h}. Please check your connection and try again. If the issue persists, contact support.`,variant:"destructive",duration:6e3}),n(!1)}}),p=j=>{n(!0),x.mutate(j)},m=[10,20,50,100,200,500];return e.jsxs(ts,{open:s,onOpenChange:a,children:[e.jsx(Ws,{asChild:!0,children:e.jsxs(g,{variant:"default",size:"sm",children:[e.jsx(hs,{className:"w-4 h-4 mr-2"}),"Top Up Wallet"]})}),e.jsxs(_e,{className:"sm:max-w-md bg-white text-black",children:[e.jsxs(Ge,{children:[e.jsxs(We,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5"}),"Top Up Wallet"]}),e.jsx(As,{children:"Add money to your wallet to make instant purchases"})]}),e.jsx(ws,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(p),className:"space-y-4",children:[e.jsx(me,{control:d.control,name:"amount",render:({field:j})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Amount (GHS)"}),e.jsx(de,{children:e.jsx(K,{type:"number",placeholder:"Enter amount",step:"0.01",min:"1",...j,disabled:t})}),e.jsx(oe,{})]})}),e.jsx(me,{control:d.control,name:"paymentMethod",render:({field:j})=>e.jsxs(ce,{className:"space-y-3",children:[e.jsx(Kt,{className:"text-green-700",children:"Payment Method"}),e.jsx(de,{children:e.jsx(dt,{onValueChange:j.onChange,value:j.value,className:"grid gap-3",children:e.jsxs("div",{className:"flex items-center space-x-3 p-4 rounded-lg border-2 border-black !bg-white hover:border-green-500 hover:shadow-md cursor-pointer transition-all",children:[e.jsx(Cs,{value:"paystack",id:"paystack"}),e.jsxs("div",{className:"flex items-center justify-between flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Pay with MoMo"}),e.jsx("div",{className:"text-sm text-green-600",children:"Secure payment via Paystack"})]})]}),j.value==="paystack"&&e.jsx(be,{className:"h-5 w-5 text-green-600"})]})]})})}),e.jsx(oe,{})]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Quick amounts:"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:m.map(j=>e.jsxs(g,{type:"button",variant:"outline",size:"sm",onClick:()=>d.setValue("amount",j.toString()),disabled:t,children:["GHS ",j]},j))})]}),e.jsx(g,{type:"submit",className:"w-full",disabled:t,children:t?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Continue to Payment"]})})]})}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1 mt-4",children:[e.jsx("p",{children:"â€¢ Secure payment via Paystack"}),e.jsx("p",{children:"â€¢ Funds reflect instantly after payment"}),e.jsx("p",{children:"â€¢ Use wallet for faster checkout"})]})]})]})}const gc=s=>{switch(s.toLowerCase()){case"completed":case"delivered":return{variant:"default",icon:be,color:"text-white",bgColor:"bg-green-500",label:s==="completed"?"Completed":"Delivered"};case"confirmed":return{variant:"secondary",icon:ze,color:"text-white",bgColor:"bg-blue-500",label:"Confirmed"};case"pending":return{variant:"secondary",icon:ze,color:"text-white",bgColor:"bg-amber-500",label:"Pending"};case"failed":return{variant:"destructive",icon:is,color:"text-white",bgColor:"bg-red-500",label:"Failed"};default:return{variant:"outline",icon:ze,color:"text-white",bgColor:"bg-gray-500",label:s}}};function fc(){const{user:s}=je(),[a,t]=o.useState(!1),{data:n,isLoading:l}=V({queryKey:["/api/agent/wallet"],queryFn:()=>Ie("/api/agent/wallet",{disableAutoLogout:!0}),refetchInterval:3e4}),{data:r,isLoading:c}=V({queryKey:["/api/agent/transactions"],queryFn:()=>Ie("/api/agent/transactions",{disableAutoLogout:!0}),refetchInterval:3e4,select:d=>d.slice(0,10)});return s?e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx($e,{})}),e.jsx(He,{open:a,onOpenChange:t,children:e.jsxs(qe,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(as,{children:[e.jsx(Ve,{children:"Navigation Menu"}),e.jsx(Ye,{children:"Main navigation for your dashboard"})]}),e.jsx($e,{onClose:()=>t(!1)})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(He,{open:a,onOpenChange:t,children:[e.jsx(Is,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(pe,{className:"h-5 w-5"})})}),e.jsxs(qe,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(as,{children:[e.jsx(Ve,{children:"Navigation Menu"}),e.jsx(Ye,{children:"Main navigation for your dashboard"})]}),e.jsx($e,{onClose:()=>t(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-base sm:text-lg font-bold",children:"Agent Wallet"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage your wallet balance and transactions"})]})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(C,{className:"bg-blue-500 border-blue-600",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium text-white",children:"User Wallet Balance"}),e.jsx(ge,{className:"h-4 w-4 text-white/80"})]}),e.jsxs(D,{children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:["GHâ‚µ",(s==null?void 0:s.walletBalance)||"0.00"]}),e.jsx("p",{className:"text-xs text-white/70 mt-2",children:"Available for purchases"})]})]}),e.jsxs(C,{className:"bg-green-500 border-green-600",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium text-white",children:"Agent Profit Balance"}),e.jsx(Ls,{className:"h-4 w-4 text-white/80"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:l?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(n==null?void 0:n.balance)||"0.00"}`}),e.jsx("p",{className:"text-xs text-white/70 mt-2",children:"Withdrawable earnings"})]})]}),e.jsxs(C,{className:"bg-purple-500 border-purple-600",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium text-white",children:"Total Top-ups"}),e.jsx(Me,{className:"h-4 w-4 text-white/80"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:l?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):(n==null?void 0:n.totalTopups)||0}),e.jsx("p",{className:"text-xs text-white/70 mt-2",children:"Wallet top-up transactions"})]})]}),e.jsxs(C,{className:"bg-red-500 border-red-600",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium text-white",children:"Total Spent"}),e.jsx(ga,{className:"h-4 w-4 text-white/80"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:l?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(n==null?void 0:n.totalSpent)||"0.00"}`}),e.jsx("p",{className:"text-xs text-white/70 mt-2",children:"Total amount spent"})]})]})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Top Up User Wallet"}),e.jsx(J,{children:"Add funds to your user wallet to purchase data bundles and make instant payments"})]}),e.jsx(D,{children:e.jsx(Ll,{})})]}),e.jsxs(C,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(B,{children:"Recent Transactions"}),e.jsx(J,{children:"Your latest wallet transactions"})]}),e.jsx(G,{href:"/agent/transactions",children:e.jsx(g,{variant:"outline",size:"sm",children:"View All"})})]})}),e.jsx(D,{children:c?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Q,{className:"h-6 w-6 animate-spin"})}):r&&r.length>0?e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{children:"Reference"}),e.jsx(O,{children:"Type"}),e.jsx(O,{children:"Product"}),e.jsx(O,{children:"Amount"}),e.jsx(O,{children:"Status"}),e.jsx(O,{children:"Date"})]})}),e.jsx(Ze,{children:r.map(d=>{const x=gc(d.status),p=x.icon;return e.jsxs(fe,{children:[e.jsx(M,{className:"font-mono text-sm",children:d.reference}),e.jsx(M,{children:e.jsx(X,{variant:"outline",className:"capitalize",children:d.type.replace("_"," ")})}),e.jsx(M,{className:"max-w-[200px] truncate",children:d.productName}),e.jsxs(M,{className:"font-medium tabular-nums",children:["GHâ‚µ",d.amount]}),e.jsx(M,{children:e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${x.bgColor}`,children:[e.jsx(p,{className:`h-3 w-3 ${x.color}`}),e.jsx("span",{className:x.color,children:x.label})]})}),e.jsx(M,{className:"text-muted-foreground text-sm",children:new Date(d.createdAt).toLocaleString()})]},d.id)})})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No transactions yet. Start by topping up your wallet."})})]})]})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})})}function Nc(){const{toast:s}=he();je();const[a,t]=o.useState(!1),[n,l]=o.useState({}),{data:r,isLoading:c}=V({queryKey:["/api/agent/pricing"]}),{data:d}=V({queryKey:["/api/products/data-bundles"]}),x=re({mutationFn:b=>Y("POST","/api/agent/pricing",{prices:b}),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/agent/pricing"]}),l({}),s({title:"Pricing updated successfully"})},onError:b=>{s({title:"Failed to update pricing",description:b.message,variant:"destructive"})}}),p=b=>{const i=d==null?void 0:d.find(u=>u.id===b);return i?`${i.network.toUpperCase()} ${i.dataAmount} - ${i.validity}`:b},m=b=>{const i=r==null?void 0:r.find(F=>F.bundleId===b),u=n[b];return{agentPrice:(u==null?void 0:u.agentPrice)||(i==null?void 0:i.agentPrice)||"0.00",agentProfit:(u==null?void 0:u.agentProfit)||(i==null?void 0:i.agentProfit)||"0.00",adminBasePrice:(i==null?void 0:i.adminBasePrice)||"0.00"}},j=(b,i,u)=>{const F=m(b),R=parseFloat(u)||0;if(i==="agentPrice"){const P=parseFloat(F.adminBasePrice),v=Math.max(0,R-P);l(U=>({...U,[b]:{agentPrice:u,agentProfit:v.toFixed(2)}}))}else{const v=parseFloat(F.adminBasePrice)+R;l(U=>({...U,[b]:{agentPrice:v.toFixed(2),agentProfit:u}}))}},h=()=>{if(Object.keys(n).length===0){s({title:"No changes to save"});return}x.mutate(n)},f=Object.keys(n).length>0;return e.jsxs("div",{className:"flex h-screen bg-background",children:[a&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>t(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx($e,{onClose:()=>t(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx($e,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>t(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-sm lg:text-base font-semibold",children:"Pricing Management"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[f&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-600",children:[e.jsx(os,{className:"h-4 w-4"}),"Unsaved changes"]}),e.jsx(g,{onClick:h,disabled:x.isPending||!f,children:x.isPending?"Saving...":"Save Changes"}),e.jsx(Ne,{})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Ls,{className:"h-5 w-5"}),"Set Your Selling Prices"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Set your selling prices for data bundles. Your profit margin will be calculated automatically."})]}),e.jsx(D,{children:c?e.jsx(us,{rows:8}):r&&r.length>0?e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{children:"Data Bundle"}),e.jsx(O,{children:"Base Price"}),e.jsx(O,{children:"Your Price"}),e.jsx(O,{children:"Your Profit"})]})}),e.jsx(Ze,{children:r.map(b=>{const i=m(b.bundleId),u=n[b.bundleId];return e.jsxs(fe,{className:u?"bg-blue-50":"",children:[e.jsx(M,{className:"font-medium",children:p(b.bundleId)}),e.jsx(M,{className:"tabular-nums",children:ae(i.adminBasePrice)}),e.jsx(M,{children:e.jsx(K,{type:"number",step:"0.01",value:i.agentPrice,onChange:F=>j(b.bundleId,"agentPrice",F.target.value),className:"w-24 tabular-nums",min:i.adminBasePrice})}),e.jsx(M,{children:e.jsx(K,{type:"number",step:"0.01",value:i.agentProfit,onChange:F=>j(b.bundleId,"agentProfit",F.target.value),className:"w-24 tabular-nums",min:"0"})})]},b.bundleId)})})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No pricing data available. Please contact admin to set up base prices."})})]}),e.jsxs(C,{children:[e.jsx($,{children:e.jsx(B,{children:"How Pricing Works"})}),e.jsx(D,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Base Price"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"The minimum price set by admin for each role. You cannot sell below this price."})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Your Price"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"The price you charge customers. Must be at least the base price."})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Your Profit"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your Price minus Base Price. This is your profit margin per sale."})]})]})})]})]})})]})]})}function bc(){var l;const[s,a]=o.useState(null),{data:t,isLoading:n}=V({queryKey:["/api/dealer/pricing"],queryFn:()=>Ie("/api/dealer/pricing")});return n?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(yt,{className:"mx-auto h-12 w-12 text-yellow-500"}),e.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900",children:"Dealer Pricing Plans"}),e.jsx("p",{className:"mt-2 text-lg text-gray-600",children:"Choose the perfect plan for your dealer business"})]}),e.jsx("div",{className:"mt-16 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:(l=t==null?void 0:t.plans)==null?void 0:l.map(r=>{var c;return e.jsxs(C,{className:`relative ${s===r.id?"ring-2 ring-blue-500":""}`,children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center justify-between",children:[r.name,r.recommended&&e.jsx(X,{variant:"default",children:"Recommended"})]}),e.jsx(J,{children:r.description}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("span",{className:"text-3xl font-bold",children:["GHâ‚µ",r.price]}),e.jsxs("span",{className:"text-gray-500",children:["/",r.interval]})]})]}),e.jsxs(D,{children:[e.jsx("ul",{className:"space-y-2",children:(c=r.features)==null?void 0:c.map((d,x)=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"text-green-500 mr-2",children:"âœ“"}),d]},x))}),e.jsx(g,{className:"w-full mt-6",variant:s===r.id?"default":"outline",onClick:()=>a(r.id),children:s===r.id?"Selected":"Select Plan"})]})]},r.id)})}),s&&e.jsx("div",{className:"mt-12 text-center",children:e.jsx(g,{size:"lg",className:"px-8",children:"Upgrade to Selected Plan"})})]})})}function vc(){var l;const[s,a]=o.useState(null),{data:t,isLoading:n}=V({queryKey:["/api/super-dealer/pricing"],queryFn:()=>Ie("/api/super-dealer/pricing")});return n?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(yt,{className:"mx-auto h-12 w-12 text-yellow-500"}),e.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900",children:"Super Dealer Pricing Plans"}),e.jsx("p",{className:"mt-2 text-lg text-gray-600",children:"Advanced plans for managing dealer networks"})]}),e.jsx("div",{className:"mt-16 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:(l=t==null?void 0:t.plans)==null?void 0:l.map(r=>{var c;return e.jsxs(C,{className:`relative ${s===r.id?"ring-2 ring-blue-500":""}`,children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center justify-between",children:[r.name,r.recommended&&e.jsx(X,{variant:"default",children:"Recommended"})]}),e.jsx(J,{children:r.description}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("span",{className:"text-3xl font-bold",children:["GHâ‚µ",r.price]}),e.jsxs("span",{className:"text-gray-500",children:["/",r.interval]})]})]}),e.jsxs(D,{children:[e.jsx("ul",{className:"space-y-2",children:(c=r.features)==null?void 0:c.map((d,x)=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"text-green-500 mr-2",children:"âœ“"}),d]},x))}),e.jsx(g,{className:"w-full mt-6",variant:s===r.id?"default":"outline",onClick:()=>a(r.id),children:s===r.id?"Selected":"Select Plan"})]})]},r.id)})}),s&&e.jsx("div",{className:"mt-12 text-center",children:e.jsx(g,{size:"lg",className:"px-8",children:"Upgrade to Selected Plan"})})]})})}function wc(){var l;const[s,a]=o.useState(null),{data:t,isLoading:n}=V({queryKey:["/api/master/pricing"],queryFn:()=>Ie("/api/master/pricing")});return n?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(Us,{className:"mx-auto h-12 w-12 text-red-500"}),e.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900",children:"Master Pricing Plans"}),e.jsx("p",{className:"mt-2 text-lg text-gray-600",children:"Enterprise-level plans for complete system management"})]}),e.jsx("div",{className:"mt-16 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:(l=t==null?void 0:t.plans)==null?void 0:l.map(r=>{var c;return e.jsxs(C,{className:`relative ${s===r.id?"ring-2 ring-blue-500":""}`,children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center justify-between",children:[r.name,r.recommended&&e.jsx(X,{variant:"default",children:"Recommended"})]}),e.jsx(J,{children:r.description}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("span",{className:"text-3xl font-bold",children:["GHâ‚µ",r.price]}),e.jsxs("span",{className:"text-gray-500",children:["/",r.interval]})]})]}),e.jsxs(D,{children:[e.jsx("ul",{className:"space-y-2",children:(c=r.features)==null?void 0:c.map((d,x)=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"text-green-500 mr-2",children:"âœ“"}),d]},x))}),e.jsx(g,{className:"w-full mt-6",variant:s===r.id?"default":"outline",onClick:()=>a(r.id),children:s===r.id?"Selected":"Select Plan"})]})]},r.id)})}),s&&e.jsx("div",{className:"mt-12 text-center",children:e.jsx(g,{size:"lg",className:"px-8",children:"Upgrade to Selected Plan"})})]})})}const yc=[{title:"Dashboard",href:"/admin",icon:aa},{title:"Data Bundles",href:"/admin/data-bundles",icon:Le},{title:"Role Base Prices",href:"/admin/role-base-prices",icon:et},{title:"Result Checkers",href:"/admin/result-checkers",icon:it},{title:"Transactions",href:"/admin/transactions",icon:Es},{title:"Users",href:"/admin/users",icon:Ss},{title:"Agents",href:"/admin/agents",icon:es},{title:"User Rankings",href:"/admin/rankings",icon:vs},{title:"Withdrawals",href:"/admin/withdrawals",icon:ge},{title:"Chat Support",href:"/admin/chat-support",icon:Rs},{title:"Announcements",href:"/admin/announcements",icon:Jt},{title:"Video Guides",href:"/admin/guides",icon:vr},{title:"External API Providers",href:"/admin/external-api-providers",icon:Ns},{title:"API Keys & Integrations",href:"/dashboard/api-integrations",icon:Ns},{title:"Break Settings",href:"/admin/break-settings",icon:Ct},{title:"Settings",href:"/admin/settings",icon:et}];function ye({onClose:s}={}){const[a]=Ke(),{user:t,logout:n,isLoggingOut:l}=je(),{data:r=0}=V({queryKey:["/api/support/admin/unread-count"],queryFn:async()=>{try{return(await Y("GET","/api/support/admin/unread-count")).count||0}catch{return 0}},refetchInterval:5e3});return e.jsxs("div",{className:"flex h-screen w-64 flex-col border-r text-white relative overflow-hidden bg-black",children:[s&&e.jsx("div",{className:"absolute top-4 right-4 md:hidden",children:e.jsx(g,{variant:"ghost",size:"icon",onClick:s,children:e.jsx(Ms,{className:"h-4 w-4"})})}),e.jsx("div",{className:`flex h-16 items-center gap-2 border-b px-6 bg-black ${s?"pr-16":""}`,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-sm text-white",children:(t==null?void 0:t.name)||"Admin"}),e.jsx("span",{className:"text-xs text-gray-400",children:"Admin Panel"})]})}),e.jsx(st,{className:"flex-1 px-3 py-4",children:e.jsx("nav",{className:"flex flex-col gap-1",children:yc.map(c=>{const d=a===c.href||c.href!=="/admin"&&a.startsWith(c.href),x=c.href==="/admin/chat-support";return e.jsx(G,{href:c.href,children:e.jsxs(g,{variant:d?"default":"ghost",className:L("w-full justify-start gap-2 px-2 py-1.5 text-xs font-normal relative",d&&"bg-yellow-500 text-white font-medium shadow-sm"),onClick:s,"data-testid":`link-admin-${c.title.toLowerCase().replace(" ","-")}`,children:[e.jsx(c.icon,{className:"h-4 w-4"}),e.jsx("span",{className:"flex-1 text-left",children:c.title}),x&&r>0&&e.jsx(X,{variant:"destructive",className:"ml-auto",children:r})]})},c.href)})})}),e.jsx("div",{className:"border-t p-3",children:e.jsxs(g,{variant:"ghost",className:"w-full justify-start gap-2 px-2 py-1.5 text-xs bg-black text-red-500 hover:bg-gray-800",onClick:()=>n(),disabled:l,"data-testid":"button-admin-logout",children:[e.jsx(qt,{className:"h-4 w-4"}),l?"Logging out...":"Log out"]})})]})}const kc=[{title:"Dashboard",href:"/user/dashboard",icon:aa},{title:"MTN Bundles",href:"/user/bundles/mtn",icon:Le},{title:"AT iShare Bundles",href:"/user/bundles/at_ishare",icon:Le},{title:"AT BIG TIME Bundles",href:"/user/bundles/at_bigtime",icon:Le},{title:"TELECEL Bundles",href:"/user/bundles/telecel",icon:Le},{title:"Top Up Wallet",href:"/user/wallet",icon:ge},{title:"API Keys & Integrations",href:"/dashboard/api-integrations",icon:Ns},{title:"Settings",href:"/user/settings",icon:et},{title:"Order History",href:"/user/history",icon:Pn},{title:"Support",href:"/user/support",icon:Rs}];function ds({onClose:s}={}){const[a]=Ke(),{logout:t,isLoggingOut:n,user:l,agent:r}=je(),{theme:c}=Bs(),{data:d}=V({queryKey:["user-rank"],queryFn:()=>Y("GET","/api/user/rank"),enabled:!!l});return e.jsxs("div",{className:`flex h-full w-64 flex-col border-r text-sidebar-foreground relative ${s?"bg-white dark:bg-black dark:text-white":"bg-sidebar dark:bg-black dark:text-white"}`,children:[e.jsx("div",{className:`flex h-16 items-center justify-center border-b px-6 ${s?"pr-4":""} dark:border-gray-700`,children:e.jsx("div",{className:"flex flex-col items-center text-center w-full",children:e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-1 w-full",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-sm font-medium dark:text-white",children:(l==null?void 0:l.name)||"User"}),e.jsx("p",{className:"text-xs text-muted-foreground dark:text-gray-300",children:l==null?void 0:l.email})]}),d&&e.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-green-500 px-2 py-0.5 text-xs font-medium text-white border border-green-600 dark:bg-green-600 dark:border-green-700",children:[e.jsx(vs,{className:"h-2.5 w-2.5"}),e.jsx("span",{children:d.rank&&d.rank>0?`#${d.rank}`:"Unranked"})]})]})})}),e.jsx(st,{className:"flex-1 px-3 py-4",children:e.jsxs("nav",{className:"flex flex-col gap-1",children:[kc.map(x=>{const p=a===x.href||x.href!=="/user/dashboard"&&a.startsWith(x.href);return e.jsx(G,{href:x.href,children:e.jsxs(g,{variant:p?"default":"ghost",className:L("w-full justify-start gap-3 font-normal relative dark:text-white dark:hover:bg-gray-700",p&&"bg-yellow-500 text-white font-medium shadow-sm dark:bg-yellow-600"),onClick:()=>s&&s(),children:[e.jsx(x.icon,{className:"h-4 w-4 dark:text-white"}),e.jsx("span",{className:"flex-1 text-left dark:text-white",children:x.title})]})},x.href)}),!r&&e.jsx(G,{href:"/agent/register",children:e.jsxs(g,{variant:"outline",className:"w-full justify-start gap-3 mt-2 bg-green-500 text-white border-green-500 hover:bg-green-600 hover:border-green-600 dark:bg-green-600 dark:border-green-600 dark:hover:bg-green-700",onClick:()=>s&&s(),children:[e.jsx(Le,{className:"h-4 w-4"}),"Become an Agent"]})})]})}),e.jsxs("div",{className:"border-t p-3 dark:border-gray-700",children:[e.jsxs(g,{variant:"ghost",className:"w-full justify-start gap-3 text-destructive hover:text-destructive hover:bg-destructive/10 dark:text-red-400 dark:hover:bg-red-900/20",onClick:()=>{s&&s(),t()},disabled:n,children:[e.jsx(qt,{className:"h-4 w-4 dark:text-red-400"}),n?"Logging out...":"Log out"]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-border/50 dark:border-gray-600",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center dark:text-gray-400",children:["Developed by"," ",e.jsx("a",{href:"https://bm-portfolio-up2x.onrender.com",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 font-medium dark:text-blue-400 dark:hover:text-blue-300",children:"BlusMotif"})]})})]})]})}const Os=o.forwardRef(({className:s,...a},t)=>e.jsx(Qr,{className:L("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...a,ref:t,children:e.jsx(Cn,{className:L("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Os.displayName=Qr.displayName;const At=Tn,Sc=Fn,Pc=An,Ml=o.forwardRef(({className:s,...a},t)=>e.jsx(Xr,{className:L("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:t}));Ml.displayName=Xr.displayName;const ot=o.forwardRef(({className:s,...a},t)=>e.jsxs(Pc,{children:[e.jsx(Ml,{}),e.jsx(Jr,{ref:t,className:L("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a})]}));ot.displayName=Jr.displayName;const mt=({className:s,...a})=>e.jsx("div",{className:L("flex flex-col space-y-2 text-center sm:text-left",s),...a});mt.displayName="AlertDialogHeader";const xt=({className:s,...a})=>e.jsx("div",{className:L("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});xt.displayName="AlertDialogFooter";const ht=o.forwardRef(({className:s,...a},t)=>e.jsx(Zr,{ref:t,className:L("text-lg font-semibold",s),...a}));ht.displayName=Zr.displayName;const ut=o.forwardRef(({className:s,...a},t)=>e.jsx(el,{ref:t,className:L("text-sm text-muted-foreground",s),...a}));ut.displayName=el.displayName;const pt=o.forwardRef(({className:s,...a},t)=>e.jsx(sl,{ref:t,className:L(wa(),s),...a}));pt.displayName=sl.displayName;const jt=o.forwardRef(({className:s,...a},t)=>e.jsx(tl,{ref:t,className:L(wa({variant:"outline"}),"mt-2 sm:mt-0",s),...a}));jt.displayName=tl.displayName;const Cc=()=>{const{user:s}=je(),[a,t]=o.useState([]),[n,l]=o.useState(!0),[r,c]=o.useState(!1),[d,x]=o.useState(""),[p,m]=o.useState(!1),[j,h]=o.useState(""),[f,b]=o.useState(!1),[i,u]=o.useState(new Set),[F,R]=o.useState(!1);o.useEffect(()=>{P()},[]);const P=async()=>{try{const I=await fetch("/api/user/api-keys");if(I.ok){const T=await I.json();t(T)}else De.error("Failed to fetch API keys")}catch{De.error("Error fetching API keys")}finally{l(!1)}},v=async()=>{if(!d.trim()){De.error("Please enter a name for your API key");return}c(!0);try{const I=await fetch("/api/user/api-keys",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:d.trim()})});if(I.ok){const T=await I.json();h(T.key),b(!0),x(""),m(!1),P(),De.success("API key created successfully")}else{const T=await I.json();De.error(T.error||"Failed to create API key")}}catch{De.error("Error creating API key")}finally{c(!1)}},U=async I=>{try{const T=await fetch(`/api/user/api-keys/${I}/toggle`,{method:"PUT"});if(T.ok){const k=await T.json();t(S=>S.map(A=>A.id===I?{...A,isActive:k.isActive}:A)),De.success(`API key ${k.isActive?"activated":"deactivated"}`)}else De.error("Failed to update API key status")}catch{De.error("Error updating API key status")}},E=async I=>{try{(await fetch(`/api/user/api-keys/${I}`,{method:"DELETE"})).ok?(t(k=>k.filter(S=>S.id!==I)),De.success("API key deleted successfully")):De.error("Failed to delete API key")}catch{De.error("Error deleting API key")}},se=async(I,T)=>{try{(await fetch(`/api/user/api-keys/${I}/permissions`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({permissions:T})})).ok?(t(S=>S.map(A=>A.id===I?{...A,permissions:JSON.stringify(T)}:A)),De.success("Permissions updated successfully")):De.error("Failed to update permissions")}catch{De.error("Error updating permissions")}},ee=I=>{navigator.clipboard.writeText(I),De.success("Copied to clipboard")},le=I=>`${I.substring(0,8)}****${I.substring(I.length-4)}`,w=I=>{u(T=>{const k=new Set(T);return k.has(I)?k.delete(I):k.add(I),k})},N=I=>{try{return JSON.parse(I)}catch{return{}}},y=()=>{if(!s)return null;switch(s.role){case"admin":return e.jsx(ye,{onClose:()=>R(!1)});case"agent":case"dealer":case"super_dealer":case"master":return e.jsx($e,{onClose:()=>R(!1)});case"user":return e.jsx(ds,{onClose:()=>R(!1)});default:return e.jsx(ye,{onClose:()=>R(!1)})}};return n?e.jsxs("div",{className:"flex h-screen bg-background",children:[y(),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-lg",children:"Loading..."})})]}):e.jsxs("div",{className:"flex h-screen bg-background",children:[F&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>R(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:y()})]}),e.jsx("div",{className:"hidden md:block",children:y()}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>R(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"API Keys & Integrations"})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground",children:"Manage your API keys and integrate with third-party services"})}),e.jsxs(ts,{open:p,onOpenChange:m,children:[e.jsx(Ws,{asChild:!0,children:e.jsxs(g,{children:[e.jsx(hs,{className:"w-4 h-4 mr-2"}),"Create API Key"]})}),e.jsxs(_e,{className:"bg-black text-white border-gray-700",children:[e.jsxs(Ge,{children:[e.jsx(We,{className:"text-white",children:"Create New API Key"}),e.jsx(As,{className:"text-gray-300",children:"Create a new API key to access our services programmatically."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(z,{htmlFor:"keyName",className:"text-white",children:"API Key Name"}),e.jsx(K,{id:"keyName",placeholder:"e.g., Production App, Development",value:d,onChange:I=>x(I.target.value),className:"bg-gray-800 border-gray-600 text-white placeholder:text-gray-400"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(g,{variant:"outline",onClick:()=>m(!1),className:"border-gray-600 text-white hover:bg-gray-800",children:"Cancel"}),e.jsx(g,{onClick:v,disabled:r,className:"bg-yellow-500 text-black hover:bg-yellow-600",children:r?"Creating...":"Create Key"})]})]})]})]})]}),e.jsx(ts,{open:f,onOpenChange:b,children:e.jsxs(_e,{children:[e.jsxs(Ge,{children:[e.jsx(We,{children:"API Key Created"}),e.jsx(As,{children:"Your new API key has been created. Copy it now - you won't be able to see it again!"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsx("code",{className:"text-sm break-all",children:j})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs(g,{variant:"outline",onClick:()=>ee(j),children:[e.jsx(_s,{className:"w-4 h-4 mr-2"}),"Copy Key"]}),e.jsx(g,{onClick:()=>b(!1),children:"Done"})]})]})]})}),e.jsxs(Hs,{defaultValue:"keys",className:"space-y-6",children:[e.jsxs(qs,{className:"grid w-full grid-cols-4",children:[e.jsx(Ee,{value:"keys",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:"API Keys"}),e.jsx(Ee,{value:"integrations",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:"Integrations"}),e.jsx(Ee,{value:"webhooks",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:"Webhooks"}),e.jsx(Ee,{value:"docs",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:"Documentation"})]}),e.jsx(Be,{value:"keys",className:"space-y-6",children:a.length===0?e.jsx(C,{children:e.jsxs(D,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx($t,{className:"w-12 h-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No API Keys Yet"}),e.jsx("p",{className:"text-muted-foreground text-center mb-4",children:"Create your first API key to start integrating with our services."}),e.jsxs(g,{onClick:()=>m(!0),children:[e.jsx(hs,{className:"w-4 h-4 mr-2"}),"Create Your First API Key"]})]})}):e.jsx("div",{className:"grid gap-4",children:a.map(I=>e.jsxs(C,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($t,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx(B,{className:"text-lg",children:I.name}),e.jsxs(J,{children:["Created ",new Date(I.createdAt).toLocaleDateString(),I.lastUsed&&` â€¢ Last used ${new Date(I.lastUsed).toLocaleDateString()}`]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{variant:I.isActive?"default":"secondary",children:I.isActive?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-3 h-3 mr-1"})," Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(is,{className:"w-3 h-3 mr-1"})," Inactive"]})}),e.jsx(Os,{checked:I.isActive,onCheckedChange:()=>U(I.id),className:"data-[state=checked]:bg-green-500 data-[state=unchecked]:bg-red-500 [&_[data-radix-switch-thumb]]:bg-white"})]})]})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(z,{className:"text-sm font-medium",children:"API Key"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono",children:i.has(I.id)?I.key:le(I.key)}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>w(I.id),children:i.has(I.id)?e.jsx(Js,{className:"w-4 h-4"}):e.jsx(Zs,{className:"w-4 h-4"})}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>ee(I.key),children:e.jsx(_s,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(ts,{children:[e.jsx(Ws,{asChild:!0,children:e.jsxs(g,{variant:"outline",size:"sm",children:[e.jsx(et,{className:"w-4 h-4 mr-2"}),"Permissions"]})}),e.jsxs(_e,{children:[e.jsxs(Ge,{children:[e.jsx(We,{children:"API Key Permissions"}),e.jsx(As,{children:"Configure what this API key can access."})]}),e.jsx(Ac,{permissions:N(I.permissions),onSave:T=>se(I.id,T)})]})]}),e.jsxs(At,{children:[e.jsx(Sc,{asChild:!0,children:e.jsxs(g,{variant:"destructive",size:"sm",children:[e.jsx(Ts,{className:"w-4 h-4 mr-2"}),"Delete"]})}),e.jsxs(ot,{children:[e.jsxs(mt,{children:[e.jsx(ht,{children:"Delete API Key"}),e.jsx(ut,{children:"Are you sure you want to delete this API key? This action cannot be undone."})]}),e.jsxs(xt,{children:[e.jsx(jt,{children:"Cancel"}),e.jsx(pt,{onClick:()=>E(I.id),children:"Delete"})]})]})]})]})})]})})]},I.id))})}),e.jsx(Be,{value:"integrations",className:"space-y-6",children:e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Third-Party Integrations"}),e.jsx(J,{children:"Connect your applications and services to our platform"})]}),e.jsx(D,{className:"space-y-6",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(C,{children:[e.jsx($,{children:e.jsxs(B,{className:"text-lg flex items-center",children:[e.jsx(Ns,{className:"w-5 h-5 mr-2"}),"REST API"]})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Use our REST API to programmatically access data bundles, result checkers, and transactions."}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>De.info("View API Docs - Coming Soon!"),children:"View API Docs"})]})]}),e.jsxs(C,{children:[e.jsx($,{children:e.jsxs(B,{className:"text-lg flex items-center",children:[e.jsx(Da,{className:"w-5 h-5 mr-2"}),"Webhooks"]})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Receive real-time notifications about transaction status changes and other events."}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>De.info("Configure Webhooks - Coming Soon!"),children:"Configure Webhooks"})]})]})]})})]})}),e.jsx(Be,{value:"webhooks",className:"space-y-6",children:e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Webhook Configuration"}),e.jsx(J,{children:"Set up webhooks to receive real-time notifications"})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(z,{htmlFor:"webhookUrl",children:"Webhook URL"}),e.jsx(K,{id:"webhookUrl",placeholder:"https://your-app.com/webhooks/resellers-hub-gh-pro"})]}),e.jsxs("div",{children:[e.jsx(z,{children:"Events to Subscribe"}),e.jsx("div",{className:"space-y-2 mt-2",children:["transaction.completed","transaction.failed","bundle.delivered"].map(I=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Os,{id:I,className:"data-[state=checked]:bg-green-500 data-[state=unchecked]:bg-red-500 [&_[data-radix-switch-thumb]]:bg-white"}),e.jsx(z,{htmlFor:I,className:"text-sm",children:I})]},I))})]}),e.jsx(g,{onClick:()=>De.info("Save Webhook Configuration - Coming Soon!"),children:"Save Webhook Configuration"})]})})]})}),e.jsx(Be,{value:"docs",className:"space-y-6",children:e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"API Documentation"}),e.jsx(J,{children:"Complete documentation for integrating with our platform"})]}),e.jsx(D,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(g,{variant:"outline",className:"justify-start",onClick:()=>De.info("REST API Reference - Coming Soon!"),children:[e.jsx(Ns,{className:"w-4 h-4 mr-2"}),"REST API Reference"]}),e.jsxs(g,{variant:"outline",className:"justify-start",onClick:()=>De.info("Webhook Documentation - Coming Soon!"),children:[e.jsx(Da,{className:"w-4 h-4 mr-2"}),"Webhook Documentation"]}),e.jsxs(g,{variant:"outline",className:"justify-start",onClick:()=>De.info("Authentication Guide - Coming Soon!"),children:[e.jsx($t,{className:"w-4 h-4 mr-2"}),"Authentication Guide"]}),e.jsx(g,{variant:"outline",className:"justify-start",onClick:()=>De.info("Download Postman Collection - Coming Soon!"),children:"Download Postman Collection"})]})})]})})]})]})})]})]})},Ac=({permissions:s,onSave:a})=>{const[t,n]=o.useState(s),l=[{key:"read",label:"Read Data",description:"Access bundles, transactions, and user data"},{key:"purchase",label:"Make Purchases",description:"Purchase data bundles and result checkers"},{key:"webhook",label:"Receive Webhooks",description:"Receive webhook notifications"}];return e.jsxs("div",{className:"space-y-4",children:[l.map(r=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Os,{id:r.key,checked:t[r.key]||!1,onCheckedChange:c=>n(d=>({...d,[r.key]:c})),className:"data-[state=checked]:bg-green-500 data-[state=unchecked]:bg-red-500 [&_[data-radix-switch-thumb]]:bg-white"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(z,{htmlFor:r.key,className:"font-medium",children:r.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.description})]})]},r.key)),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(g,{variant:"outline",onClick:()=>n(s),children:"Reset"}),e.jsx(g,{onClick:()=>a(t),children:"Save Permissions"})]})]})};function Tc(){var i;const[s,a]=o.useState(!1),[t,n]=o.useState(!1),{user:l}=je(),{data:r,isLoading:c}=V({queryKey:["/api/admin/stats"],refetchInterval:3e4}),{data:d,isLoading:x}=V({queryKey:["/api/admin/transactions/recent"],refetchInterval:3e4}),{data:p,isLoading:m}=V({queryKey:["/api/admin/rankings/customers"],refetchInterval:6e4}),{data:j,isLoading:h}=V({queryKey:["/api/admin/analytics/revenue"],refetchInterval:3e5}),f=j?j.map(u=>({name:new Date(u.date).toLocaleDateString("en-US",{weekday:"short"}),revenue:u.revenue,transactions:u.transactions})):[],b=u=>u===0?e.jsx(vs,{className:"h-5 w-5 text-yellow-500"}):u===1?e.jsx(ba,{className:"h-5 w-5 text-gray-400"}):u===2?e.jsx(ra,{className:"h-5 w-5 text-amber-600"}):e.jsxs("span",{className:"text-sm font-semibold text-muted-foreground",children:["#",u+1]});return e.jsxs("div",{className:"flex h-screen bg-background",children:[s&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>a(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>a(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Dashboard"})]}),e.jsx(Ne,{})]}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4 lg:space-y-6",children:[e.jsxs(C,{className:"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 border-yellow-600 shadow-xl overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-12 -translate-x-12"}),e.jsx(D,{className:"p-6 relative",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-14 h-14 bg-white/20 rounded-full shadow-lg backdrop-blur-sm",children:e.jsx("span",{className:"text-3xl animate-bounce",children:"ðŸ‘‹"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl lg:text-3xl font-bold text-white mb-1 drop-shadow-sm",children:["Welcome back, ",((i=l==null?void 0:l.name)==null?void 0:i.toUpperCase())||"ADMIN","!"]}),e.jsx("p",{className:"text-yellow-100 text-sm lg:text-base font-medium",children:"Here's what's happening with your business today âœ¨"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-white/90",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium",children:"Live Dashboard"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-white/90",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),e.jsx("span",{className:"text-xs font-medium",children:"Real-time Updates"})]})]})]})]}),e.jsxs("div",{className:"hidden lg:flex flex-col items-end gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 bg-white/10 rounded-full px-3 py-1 backdrop-blur-sm",children:e.jsx("span",{className:"text-xs text-white font-medium",children:new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})}),e.jsxs("div",{className:"flex items-center gap-1 text-white/80",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-xs",children:"All systems operational"})]})]})]})})]}),c?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6",children:Array.from({length:4}).map((u,F)=>e.jsx(C,{className:"animate-pulse",children:e.jsxs(D,{className:"pt-4 lg:pt-6",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mb-4"}),e.jsx("div",{className:"h-8 bg-muted rounded w-3/4"})]})},F))}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 lg:gap-6",children:[e.jsx(we,{title:"Total Revenue",value:ae((r==null?void 0:r.totalRevenue)||0),icon:ct,description:"All time"}),e.jsx(we,{title:"Total Transactions",value:(r==null?void 0:r.totalTransactions)||0,icon:ys,description:"Completed orders"}),e.jsx(we,{title:"Active Agents",value:(r==null?void 0:r.totalAgents)||0,icon:es,description:"Registered agents"}),e.jsx(we,{title:"Total Agent Profits",value:ae((r==null?void 0:r.totalAgentProfits)||0),icon:Ls,description:"Combined agent earnings"}),e.jsx(we,{title:"Pending Withdrawals",value:(r==null?void 0:r.pendingWithdrawals)||0,icon:ge,description:"Awaiting approval"})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ls,{className:"h-5 w-5 text-blue-500"}),"Revenue Analytics"]}),e.jsx(J,{children:"Weekly revenue and transaction trends"})]}),e.jsx(D,{children:h?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Loading analytics..."})}):f.length>0?e.jsx("div",{className:"h-64",children:e.jsx(Ur,{width:"100%",height:"100%",children:e.jsxs(zr,{data:f,children:[e.jsx(_r,{strokeDasharray:"3 3"}),e.jsx(Gr,{dataKey:"name"}),e.jsx(Wr,{}),e.jsx(Kr,{formatter:(u,F)=>[F==="revenue"?ae(Number(u)):u,F==="revenue"?"Revenue":"Transactions"]}),e.jsx(Hr,{dataKey:"revenue",fill:"#10b981",radius:[4,4,0,0]})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"No analytics data available"})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(C,{className:"lg:col-span-2",children:[e.jsx($,{className:"flex flex-row items-center justify-between gap-2",children:e.jsx(B,{className:"text-lg",children:"Recent Transactions"})}),e.jsx(D,{children:x?e.jsx(us,{rows:5}):d&&d.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{children:"Reference"}),e.jsx(O,{children:"Product"}),e.jsx(O,{children:"Amount"}),e.jsx(O,{children:"Status"}),e.jsx(O,{children:"Date"})]})}),e.jsx(Ze,{children:d.slice(0,10).map(u=>e.jsxs(fe,{"data-testid":`row-transaction-${u.id}`,children:[e.jsx(M,{className:"font-mono text-sm",children:u.reference}),e.jsx(M,{className:"max-w-[200px] truncate",children:u.productName}),e.jsx(M,{className:"font-medium tabular-nums",children:ae(u.amount)}),e.jsx(M,{children:e.jsx(Ca,{status:u.status})}),e.jsx(M,{className:"text-muted-foreground text-sm",children:Qe(u.createdAt)})]},u.id))})]})}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No transactions yet"})})]}),e.jsxs(C,{children:[e.jsx($,{children:e.jsx(B,{className:"text-lg",children:"Quick Stats"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-500 text-white rounded-lg border border-green-600",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ls,{className:"h-5 w-5 text-white"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Today's Revenue"})]}),e.jsx("span",{className:"font-bold text-white",children:ae((r==null?void 0:r.todayRevenue)||0)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-500 text-white rounded-lg border border-blue-600",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Se,{className:"h-5 w-5 text-white"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Today's Orders"})]}),e.jsx("span",{className:"font-bold text-white",children:(r==null?void 0:r.todayTransactions)||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-500 text-white rounded-lg border border-purple-600",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ct,{className:"h-5 w-5 text-white"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Activation Revenue"})]}),e.jsx("span",{className:"font-bold text-white",children:ae((r==null?void 0:r.activationRevenue)||0)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-100 dark:bg-orange-900 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(es,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"}),e.jsx("span",{className:"text-sm font-medium text-orange-900 dark:text-orange-100",children:"Pending Agents"})]}),e.jsx("span",{className:"font-bold text-orange-700 dark:text-orange-300",children:(r==null?void 0:r.pendingAgents)||0})]})]})]})]}),e.jsxs(C,{children:[e.jsx($,{className:"flex flex-row items-center justify-between gap-2",children:e.jsxs("div",{children:[e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(vs,{className:"h-5 w-5 text-yellow-500"}),"Top Customers"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Highest spending customers"})]})}),e.jsx(D,{children:m?e.jsx(us,{rows:5}):p&&p.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{className:"w-16",children:"Rank"}),e.jsx(O,{children:"Customer"}),e.jsx(O,{className:"text-right",children:"Total Spent"}),e.jsx(O,{className:"text-right",children:"Purchases"}),e.jsx(O,{className:"text-right",children:"Last Purchase"})]})}),e.jsx(Ze,{children:p.map((u,F)=>e.jsxs(fe,{children:[e.jsx(M,{className:"text-center",children:b(F)}),e.jsx(M,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:u.customerName||u.customerEmail}),u.customerPhone&&e.jsx("span",{className:"text-xs text-muted-foreground",children:u.customerPhone}),e.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:u.customerEmail})]})}),e.jsx(M,{className:"text-right",children:e.jsx("span",{className:"font-bold text-green-600 dark:text-green-400",children:ae(u.totalSpent)})}),e.jsx(M,{className:"text-right",children:e.jsxs(X,{variant:"secondary",children:[u.totalPurchases," ",u.totalPurchases===1?"order":"orders"]})}),e.jsx(M,{className:"text-right text-sm text-muted-foreground",children:Qe(u.lastPurchase)})]},u.rank))})]})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(vs,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No customer rankings yet"})]})})]})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Track Orders"}),e.jsx(J,{children:"Search and monitor order status across the platform"})]}),e.jsx(D,{children:e.jsx(bt,{})})]})]})]}),e.jsx(Rt,{open:t,onOpenChange:n})]})}function Fc(){const{toast:s}=he(),{user:a}=je(),[t,n]=o.useState(!1),[l,r]=o.useState(null),[c,d]=o.useState(!1),{data:x,isLoading:p}=V({queryKey:["/api/admin/data-bundles"],refetchInterval:6e4,refetchOnWindowFocus:!0}),{data:m}=V({queryKey:["/api/admin/role-base-prices"],enabled:(a==null?void 0:a.role)==="admin"}),j=re({mutationFn:i=>Y("POST","/api/admin/data-bundles",i),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/data-bundles"]}),n(!1),s({title:"Data bundle created successfully"})},onError:i=>{s({title:"Failed to create bundle",description:i.message,variant:"destructive"})}}),h=re({mutationFn:({id:i,data:u})=>Y("PATCH",`/api/admin/data-bundles/${i}`,u),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/data-bundles"]}),r(null),s({title:"Data bundle updated successfully"})},onError:i=>{s({title:"Failed to update bundle",description:i.message,variant:"destructive"})}}),f=re({mutationFn:i=>Y("DELETE",`/api/admin/data-bundles/${i}`),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/data-bundles"]}),s({title:"Data bundle deleted successfully"})},onError:i=>{s({title:"Failed to delete bundle",description:i.message,variant:"destructive"})}}),b=(i,u)=>{const F=m==null?void 0:m.find(R=>R.bundleId===i&&R.role===u);return F?ae(F.basePrice):"-"};return e.jsxs("div",{className:"flex h-screen bg-background",children:[c&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>d(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>d(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>d(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Data Bundles"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(ts,{open:t,onOpenChange:n,children:[e.jsx(Ws,{asChild:!0,children:e.jsxs(g,{"data-testid":"button-create-bundle",children:[e.jsx(hs,{className:"h-4 w-4 mr-2"}),"Add Bundle"]})}),e.jsxs(_e,{className:"bg-white text-blue-800",children:[e.jsx(Ge,{children:e.jsx(We,{className:"text-blue-800",children:"Create Data Bundle"})}),e.jsx(Ua,{onSubmit:i=>j.mutate(i),isLoading:j.isPending})]})]}),e.jsx(Ne,{})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5"}),"All Data Bundles"]}),e.jsxs(X,{variant:"secondary",children:[(x==null?void 0:x.length)||0," bundles"]})]}),e.jsx(D,{children:p?e.jsx(us,{rows:8}):x&&x.length>0?e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{children:"Network"}),e.jsx(O,{children:"Name"}),e.jsx(O,{children:"Data"}),e.jsx(O,{children:"Validity"}),e.jsx(O,{children:"Base Price"}),e.jsx(O,{children:"Agent Base"}),e.jsx(O,{children:"Dealer Base"}),e.jsx(O,{children:"Super Dealer Base"}),e.jsx(O,{children:"Master Base"}),e.jsx(O,{children:"Admin Price"}),e.jsx(O,{children:"Status"}),e.jsx(O,{className:"text-right",children:"Actions"})]})}),e.jsx(Ze,{children:x.map(i=>{const u=Xs.find(F=>F.id===i.network);return e.jsxs(fe,{"data-testid":`row-bundle-${i.id}`,children:[e.jsx(M,{children:e.jsx(X,{style:{backgroundColor:u==null?void 0:u.color,color:u==null?void 0:u.textColor},children:(u==null?void 0:u.name)||i.network.toUpperCase()})}),e.jsxs(M,{className:"font-medium",children:[i.network.toUpperCase()," ",i.dataAmount," - ",i.validity]}),e.jsx(M,{children:i.dataAmount}),e.jsx(M,{children:i.validity}),e.jsx(M,{className:"font-medium tabular-nums",children:ae(i.basePrice)}),e.jsx(M,{className:"tabular-nums",children:b(i.id,"agent")}),e.jsx(M,{className:"tabular-nums",children:b(i.id,"dealer")}),e.jsx(M,{className:"tabular-nums",children:b(i.id,"super_dealer")}),e.jsx(M,{className:"tabular-nums",children:b(i.id,"master")}),e.jsx(M,{className:"tabular-nums",children:i.adminPrice?ae(i.adminPrice):"-"}),e.jsx(M,{children:e.jsx(X,{variant:i.isActive?"default":"secondary",children:i.isActive?"Active":"Inactive"})}),e.jsx(M,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{size:"icon",variant:"ghost",onClick:()=>r(i),"data-testid":`button-edit-${i.id}`,children:e.jsx(al,{className:"h-4 w-4"})}),e.jsx(g,{size:"icon",variant:"ghost",onClick:()=>{confirm("Are you sure you want to delete this bundle?")&&f.mutate(i.id)},"data-testid":`button-delete-${i.id}`,children:e.jsx(Ts,{className:"h-4 w-4 text-destructive"})})]})})]},i.id)})})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:'No data bundles found. Click "Add Bundle" to create one.'})})]})})})]}),e.jsx(ts,{open:!!l,onOpenChange:i=>!i&&r(null),children:e.jsxs(_e,{className:"bg-white text-blue-800",children:[e.jsx(Ge,{children:e.jsx(We,{className:"text-blue-800",children:"Edit Data Bundle"})}),l&&e.jsx(Ua,{bundle:l,onSubmit:i=>h.mutate({id:l.id,data:i}),isLoading:h.isPending})]})})]})}function Ua({bundle:s,onSubmit:a,isLoading:t}){const{user:n}=je(),[l,r]=o.useState({name:(s==null?void 0:s.name)||"",network:(s==null?void 0:s.network)||"mtn",dataAmount:(s==null?void 0:s.dataAmount)||"",validity:(s==null?void 0:s.validity)||"",basePrice:(s==null?void 0:s.basePrice)||"",adminPrice:(s==null?void 0:s.adminPrice)||"",isActive:(s==null?void 0:s.isActive)??!0}),c=d=>{d.preventDefault();const x={...l,basePrice:l.basePrice===""?void 0:l.basePrice,adminPrice:l.adminPrice===""?void 0:l.adminPrice};a(x)};return e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"name",className:"text-blue-800",children:"Name"}),e.jsx(K,{id:"name",value:l.name,onChange:d=>r({...l,name:d.target.value}),placeholder:"e.g., MTN 1GB Daily",required:!0,"data-testid":"input-bundle-name",className:"text-blue-800 placeholder-blue-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{className:"text-blue-800",children:"Network"}),e.jsxs(Ae,{value:l.network,onValueChange:d=>r({...l,network:d}),children:[e.jsx(Pe,{"data-testid":"select-bundle-network",className:"text-blue-800",children:e.jsx(Te,{})}),e.jsx(Ce,{children:Xs.map(d=>e.jsx(H,{value:d.id,className:"text-blue-800",children:d.name},d.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"dataAmount",className:"text-blue-800",children:"Data Amount"}),e.jsx(K,{id:"dataAmount",value:l.dataAmount,onChange:d=>r({...l,dataAmount:d.target.value}),placeholder:"e.g., 1GB, 500MB",required:!0,"data-testid":"input-bundle-data",className:"text-blue-800 placeholder-blue-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"validity",className:"text-blue-800",children:"Validity"}),e.jsx(K,{id:"validity",value:l.validity,onChange:d=>r({...l,validity:d.target.value}),placeholder:"e.g., 1 Day, 30 Days",required:!0,"data-testid":"input-bundle-validity",className:"text-blue-800 placeholder-blue-400"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"basePrice",className:"text-blue-800",children:"Base Price (GHS)"}),e.jsx(K,{id:"basePrice",type:"number",step:"0.01",value:l.basePrice,onChange:d=>r({...l,basePrice:d.target.value}),placeholder:"0.00",required:!0,"data-testid":"input-bundle-price",className:"text-blue-800 placeholder-blue-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"adminPrice",className:"text-blue-800",children:"Admin Price (GHS)"}),e.jsx(K,{id:"adminPrice",type:"number",step:"0.01",value:l.adminPrice,onChange:d=>r({...l,adminPrice:d.target.value}),placeholder:"0.00","data-testid":"input-bundle-admin-price",className:"text-blue-800 placeholder-blue-400"})]})]}),(n==null?void 0:n.role)==="admin"&&e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ct,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Role-Based Pricing System"}),e.jsx("p",{className:"text-blue-700 mt-1",children:'Role-specific base prices are now managed separately. Use the "Role Base Prices" section in the admin panel to set minimum prices for each role (agent, dealer, super_dealer, master). Roles can then set their own profit margins above these base prices.'})]})]})}),l.network&&l.dataAmount&&l.validity&&l.basePrice&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg border",children:[e.jsx(z,{className:"text-sm font-medium text-blue-800 mb-2 block",children:"Preview (How users will see this bundle)"}),e.jsxs("div",{className:"text-sm font-medium",children:[l.network.toUpperCase()," ",l.dataAmount," - ",l.validity," - GHâ‚µ",l.basePrice]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Os,{id:"isActive",checked:l.isActive,onCheckedChange:d=>r({...l,isActive:d}),"data-testid":"switch-bundle-active",className:"data-[state=checked]:bg-green-500 data-[state=unchecked]:bg-red-500 [&_[data-radix-switch-thumb]]:bg-white"}),e.jsx(z,{className:"text-blue-800",children:"Active"})]}),e.jsx(g,{type:"submit",disabled:t,"data-testid":"button-submit-bundle",children:t?"Saving...":s?"Update Bundle":"Create Bundle"})]})]})}function Ic(){const{toast:s}=he(),[a,t]=o.useState(!1),[n,l]=o.useState(null),[r,c]=o.useState(!1),{data:d,isLoading:x}=V({queryKey:["/api/admin/role-base-prices"]}),{data:p}=V({queryKey:["/api/admin/data-bundles"]}),m=re({mutationFn:i=>Y("POST","/api/admin/role-base-prices",i),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/role-base-prices"]}),t(!1),s({title:"Role base price set successfully"})},onError:i=>{s({title:"Failed to set role base price",description:i.message,variant:"destructive"})}}),j=re({mutationFn:({bundleId:i,role:u,basePrice:F})=>Y("POST","/api/admin/role-base-prices",{bundleId:i,role:u,basePrice:F}),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/role-base-prices"]}),l(null),s({title:"Role base price updated successfully"})},onError:i=>{s({title:"Failed to update role base price",description:i.message,variant:"destructive"})}}),h=re({mutationFn:({bundleId:i,role:u})=>Y("DELETE",`/api/admin/role-base-prices/${i}/${u}`),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/role-base-prices"]}),s({title:"Role base price deleted successfully"})},onError:i=>{s({title:"Failed to delete role base price",description:i.message,variant:"destructive"})}}),f=i=>{const u=p==null?void 0:p.find(F=>F.id===i);return u?`${u.network.toUpperCase()} ${u.dataAmount} - ${u.validity}`:i},b=i=>({agent:"Agent",dealer:"Dealer",super_dealer:"Super Dealer",master:"Master"})[i]||i;return e.jsxs("div",{className:"flex h-screen bg-background",children:[r&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>c(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>c(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>c(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Role Base Prices"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(ts,{open:a,onOpenChange:t,children:[e.jsx(Ws,{asChild:!0,children:e.jsxs(g,{"data-testid":"button-create-price",children:[e.jsx(hs,{className:"h-4 w-4 mr-2"}),"Set Base Price"]})}),e.jsxs(_e,{className:"bg-white text-blue-800",children:[e.jsx(Ge,{children:e.jsx(We,{className:"text-blue-800",children:"Set Role Base Price"})}),e.jsx(za,{onSubmit:i=>m.mutate(i),isLoading:m.isPending,bundles:p})]})]}),e.jsx(Ne,{})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(et,{className:"h-5 w-5"}),"Role Base Prices"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[(d==null?void 0:d.length)||0," prices configured"]})]}),e.jsx(D,{children:x?e.jsx(us,{rows:8}):d&&d.length>0?e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{children:"Data Bundle"}),e.jsx(O,{children:"Role"}),e.jsx(O,{children:"Base Price"}),e.jsx(O,{className:"text-right",children:"Actions"})]})}),e.jsx(Ze,{children:d.map((i,u)=>e.jsxs(fe,{children:[e.jsx(M,{className:"font-medium",children:f(i.bundleId)}),e.jsx(M,{children:b(i.role)}),e.jsx(M,{className:"font-medium tabular-nums",children:ae(i.basePrice)}),e.jsx(M,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{size:"icon",variant:"ghost",onClick:()=>l(i),children:e.jsx(al,{className:"h-4 w-4"})}),e.jsx(g,{size:"icon",variant:"ghost",onClick:()=>{confirm("Are you sure you want to delete this base price?")&&h.mutate({bundleId:i.bundleId,role:i.role})},children:e.jsx(Ts,{className:"h-4 w-4 text-destructive"})})]})})]},`${i.bundleId}-${i.role}-${u}`))})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:'No role base prices configured. Click "Set Base Price" to create one.'})})]})})})]}),e.jsx(ts,{open:!!n,onOpenChange:i=>!i&&l(null),children:e.jsxs(_e,{className:"bg-white text-blue-800",children:[e.jsx(Ge,{children:e.jsx(We,{className:"text-blue-800",children:"Edit Role Base Price"})}),n&&e.jsx(za,{price:n,onSubmit:i=>j.mutate(i),isLoading:j.isPending,bundles:p})]})})]})}function za({price:s,onSubmit:a,isLoading:t,bundles:n}){const[l,r]=o.useState({bundleId:(s==null?void 0:s.bundleId)||"",role:(s==null?void 0:s.role)||"agent",basePrice:(s==null?void 0:s.basePrice)||""}),c=d=>{d.preventDefault();const x=parseFloat(l.basePrice);isNaN(x)||x<0||a({bundleId:l.bundleId,role:l.role,basePrice:x.toFixed(2)})};return e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{className:"text-blue-800",children:"Data Bundle"}),e.jsxs(Ae,{value:l.bundleId,onValueChange:d=>r({...l,bundleId:d}),children:[e.jsx(Pe,{className:"text-blue-800",children:e.jsx(Te,{placeholder:"Select a data bundle"})}),e.jsx(Ce,{children:n==null?void 0:n.map(d=>e.jsxs(H,{value:d.id,className:"text-blue-800",children:[d.network.toUpperCase()," ",d.dataAmount," - ",d.validity]},d.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{className:"text-blue-800",children:"Role"}),e.jsxs(Ae,{value:l.role,onValueChange:d=>r({...l,role:d}),children:[e.jsx(Pe,{className:"text-blue-800",children:e.jsx(Te,{})}),e.jsxs(Ce,{children:[e.jsx(H,{value:"agent",className:"text-blue-800",children:"Agent"}),e.jsx(H,{value:"dealer",className:"text-blue-800",children:"Dealer"}),e.jsx(H,{value:"super_dealer",className:"text-blue-800",children:"Super Dealer"}),e.jsx(H,{value:"master",className:"text-blue-800",children:"Master"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"basePrice",className:"text-blue-800",children:"Base Price (GHS)"}),e.jsx(K,{id:"basePrice",type:"number",step:"0.01",value:l.basePrice,onChange:d=>r({...l,basePrice:d.target.value}),className:"text-blue-800 placeholder-blue-400",placeholder:"0.00",required:!0})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(g,{type:"submit",disabled:t,children:t?"Saving...":s?"Update Price":"Set Price"})})]})}function Dc(){const{toast:s}=he(),[a,t]=o.useState(!1),[n,l]=o.useState(!1),[r,c]=o.useState(null),[d,x]=o.useState("all"),[p,m]=o.useState("all"),[j,h]=o.useState(!1),{data:f,isLoading:b}=V({queryKey:["/api/admin/result-checkers"],refetchInterval:6e4,refetchOnWindowFocus:!0}),{data:i}=V({queryKey:["/api/admin/result-checkers/summary"],refetchInterval:6e4,refetchOnWindowFocus:!0}),u=re({mutationFn:async N=>{if(N.file){const y=new FormData;y.append("type",N.type),y.append("year",N.year.toString()),y.append("basePrice",N.basePrice),y.append("costPrice",N.costPrice),y.append("file",N.file);const I=await fetch("/api/admin/result-checkers/bulk-upload",{method:"POST",body:y,credentials:"include",headers:await(async()=>{var A;const{data:T}=await Ds.auth.getSession(),k=(A=T.session)==null?void 0:A.access_token,S={};return k&&(S.Authorization=`Bearer ${k}`),S})()});if(!I.ok){const T=await I.json().catch(()=>({message:"Upload failed"}));throw new Error(T.message||"Upload failed")}return I.json()}else return await Y("POST","/api/admin/result-checkers/bulk",{type:N.type,year:N.year,basePrice:N.basePrice,costPrice:N.costPrice,checkers:N.checkers})},onSuccess:N=>{ke.invalidateQueries({queryKey:["/api/admin/result-checkers"]}),ke.invalidateQueries({queryKey:["/api/admin/result-checkers/summary"]}),t(!1),s({title:`${N.added} result checkers added successfully`})},onError:N=>{s({title:"Failed to add checkers",description:N.message,variant:"destructive"})}}),F=re({mutationFn:async N=>await Y("PUT",`/api/admin/result-checkers/${N.id}`,N.updates),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/result-checkers"]}),ke.invalidateQueries({queryKey:["/api/admin/result-checkers/summary"]}),l(!1),c(null),s({title:"Result checker updated successfully"})},onError:N=>{s({title:"Failed to update checker",description:N.message,variant:"destructive"})}}),R=re({mutationFn:async N=>{await Y("DELETE",`/api/admin/result-checkers/${N}`)},onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/result-checkers"]}),ke.invalidateQueries({queryKey:["/api/admin/result-checkers/summary"]}),s({title:"Result checker deleted successfully"})},onError:N=>{s({title:"Failed to delete checker",description:N.message,variant:"destructive"})}}),P=f==null?void 0:f.filter(N=>!(d!=="all"&&N.type!==d||p!=="all"&&N.year.toString()!==p)),v=new Date().getFullYear(),U=[v,v-1,v-2],E=(i==null?void 0:i.reduce((N,y)=>N+y.total,0))||0,se=(i==null?void 0:i.reduce((N,y)=>N+y.available,0))||0,ee=(i==null?void 0:i.reduce((N,y)=>N+y.sold,0))||0,le=N=>{c(N),l(!0)},w=N=>{confirm("Are you sure you want to delete this result checker?")&&R.mutate(N)};return e.jsxs("div",{className:"flex h-screen bg-background",children:[j&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>h(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>h(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>h(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Result Checkers"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(ts,{open:a,onOpenChange:t,children:[e.jsx(Ws,{asChild:!0,children:e.jsxs(g,{"data-testid":"button-bulk-add",children:[e.jsx(hs,{className:"h-4 w-4 mr-2"}),"Bulk Add"]})}),e.jsxs(_e,{className:"max-w-lg bg-black",children:[e.jsx(Ge,{children:e.jsx(We,{className:"text-white",children:"Bulk Add Result Checkers"})}),e.jsx(Ec,{onSubmit:N=>u.mutate(N),isLoading:u.isPending})]})]}),e.jsx(ts,{open:n,onOpenChange:l,children:e.jsxs(_e,{className:"max-w-lg",children:[e.jsx(Ge,{children:e.jsx(We,{children:"Edit Result Checker"})}),r&&e.jsx(Rc,{checker:r,onSubmit:N=>F.mutate({id:r.id,updates:N}),isLoading:F.isPending})]})}),e.jsx(Ne,{})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(we,{title:"Total Stock",value:E,icon:Se,description:"All result checkers"}),e.jsx(we,{title:"Available",value:se,icon:it,description:"Ready for sale"}),e.jsx(we,{title:"Sold",value:ee,icon:os,description:"Delivered to customers"})]}),i&&i.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:i.map(N=>e.jsxs(C,{children:[e.jsx($,{className:"pb-2",children:e.jsxs(B,{className:"text-sm font-medium",children:[N.type.toUpperCase()," ",N.year]})}),e.jsxs(D,{children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("span",{className:"text-2xl font-bold",children:N.available}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["/ ",N.total," total"]})]}),e.jsx("div",{className:"mt-2 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${Math.min(N.available/N.total*100,100)}%`}})})]})]},`${N.type}-${N.year}`))}),e.jsxs(C,{className:"md:col-span-2 lg:col-span-3",children:[e.jsxs($,{className:"flex flex-row items-center justify-between gap-2 pb-3 md:pb-6",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(B,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(it,{className:"h-4 w-4 md:h-5 md:w-5"}),e.jsx("span",{className:"truncate",children:"Result Checker Inventory"})]}),e.jsx(J,{className:"text-sm md:text-base",children:"View and manage PIN/Serial inventory"})]}),e.jsxs("div",{className:"flex gap-1 md:gap-2 flex-shrink-0",children:[e.jsxs(Ae,{value:d,onValueChange:x,children:[e.jsx(Pe,{className:"w-24 md:w-32 text-xs md:text-sm","data-testid":"filter-type",children:e.jsx(Te,{placeholder:"Type"})}),e.jsxs(Ce,{children:[e.jsx(H,{value:"all",children:"All Types"}),ka.map(N=>e.jsx(H,{value:N.id,children:N.name},N.id))]})]}),e.jsxs(Ae,{value:p,onValueChange:m,children:[e.jsx(Pe,{className:"w-20 md:w-32 text-xs md:text-sm","data-testid":"filter-year",children:e.jsx(Te,{placeholder:"Year"})}),e.jsxs(Ce,{children:[e.jsx(H,{value:"all",children:"All Years"}),U.map(N=>e.jsx(H,{value:N.toString(),children:N},N))]})]})]})]}),e.jsxs(D,{className:"px-3 md:px-6",children:[b?e.jsx(us,{rows:5}):P&&P.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{className:"text-xs md:text-sm",children:"Type"}),e.jsx(O,{className:"text-xs md:text-sm",children:"Year"}),e.jsx(O,{className:"text-xs md:text-sm",children:"Serial"}),e.jsx(O,{className:"text-xs md:text-sm",children:"PIN"}),e.jsx(O,{className:"text-xs md:text-sm",children:"Price"}),e.jsx(O,{className:"text-xs md:text-sm",children:"Status"}),e.jsx(O,{className:"hidden md:table-cell text-xs md:text-sm",children:"Sold To"}),e.jsx(O,{className:"hidden lg:table-cell text-xs md:text-sm",children:"Date"}),e.jsx(O,{className:"text-xs md:text-sm",children:"Actions"})]})}),e.jsx(Ze,{children:P.slice(0,20).map(N=>e.jsxs(fe,{"data-testid":`row-checker-${N.id}`,children:[e.jsx(M,{className:"text-xs md:text-sm",children:e.jsx(X,{variant:"outline",className:"text-xs",children:N.type.toUpperCase()})}),e.jsx(M,{className:"font-medium text-xs md:text-sm",children:N.year}),e.jsx(M,{className:"font-mono text-xs md:text-sm",children:N.serialNumber}),e.jsx(M,{className:"font-mono text-xs md:text-sm",children:N.isSold?N.pin:"****"}),e.jsx(M,{className:"tabular-nums text-xs md:text-sm",children:ae(N.basePrice)}),e.jsx(M,{children:e.jsx(X,{variant:N.isSold?"secondary":"default",className:"text-xs",children:N.isSold?"Sold":"Available"})}),e.jsx(M,{className:"hidden md:table-cell text-muted-foreground text-xs md:text-sm",children:N.soldToPhone||"-"}),e.jsx(M,{className:"hidden lg:table-cell text-muted-foreground text-xs",children:N.soldAt?Qe(N.soldAt):Qe(N.createdAt)}),e.jsx(M,{children:e.jsxs("div",{className:"flex gap-1 md:gap-2",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>le(N),disabled:N.isSold,className:"text-xs px-2 py-1 h-7",children:"Edit"}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>w(N.id),className:"text-destructive hover:text-destructive text-xs px-2 py-1 h-7",children:"Delete"})]})})]},N.id))})]})}):e.jsx("div",{className:"text-center py-6 md:py-12 text-muted-foreground text-sm md:text-base",children:'No result checkers found. Use "Bulk Add" to add inventory.'}),P&&P.length>20&&e.jsxs("div",{className:"text-center py-2 md:py-4 text-xs md:text-sm text-muted-foreground",children:["Showing 20 of ",P.length," items"]})]})]})]})})]})]})}function Ec({onSubmit:s,isLoading:a}){const t=new Date().getFullYear(),[n,l]=o.useState({type:"bece",year:t.toString(),basePrice:"",costPrice:"",checkers:""}),[r,c]=o.useState(null),d=p=>{p.preventDefault(),s({...n,year:parseInt(n.year),file:r||void 0})},x=p=>{var j;const m=(j=p.target.files)==null?void 0:j[0];m&&(c(m),l({...n,checkers:""}))};return e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{className:"text-white",children:"Type"}),e.jsxs(Ae,{value:n.type,onValueChange:p=>l({...n,type:p}),children:[e.jsx(Pe,{"data-testid":"select-checker-type",children:e.jsx(Te,{})}),e.jsx(Ce,{children:ka.map(p=>e.jsx(H,{value:p.id,children:p.name},p.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{className:"text-white",children:"Year"}),e.jsxs(Ae,{value:n.year,onValueChange:p=>l({...n,year:p}),children:[e.jsx(Pe,{"data-testid":"select-checker-year",children:e.jsx(Te,{})}),e.jsx(Ce,{children:[t,t+1,t-1].map(p=>e.jsx(H,{value:p.toString(),children:p},p))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"costPrice",className:"text-white",children:"Cost Price (GHS)"}),e.jsx(K,{id:"costPrice",type:"number",step:"0.01",value:n.costPrice,onChange:p=>l({...n,costPrice:p.target.value}),placeholder:"0.00",required:!0,"data-testid":"input-checker-cost"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"basePrice",className:"text-white",children:"Selling Price (GHS)"}),e.jsx(K,{id:"basePrice",type:"number",step:"0.01",value:n.basePrice,onChange:p=>l({...n,basePrice:p.target.value}),placeholder:"0.00",required:!0,"data-testid":"input-checker-price"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"checkers",className:"text-white",children:"PIN/Serial Pairs"}),e.jsx(bs,{id:"checkers",value:n.checkers,onChange:p=>l({...n,checkers:p.target.value}),placeholder:`Enter one per line in format: SERIAL,PIN
e.g.,
ABC123456,1234567890
DEF789012,0987654321`,rows:8,required:!r,disabled:!!r,"data-testid":"input-checker-pairs"}),e.jsx("p",{className:"text-xs text-gray-300",children:"Format: SERIAL,PIN (one per line) - OR upload a CSV file below"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"file",className:"text-white",children:"Upload CSV File (Optional)"}),e.jsx(K,{id:"file",type:"file",accept:".csv",onChange:x,"data-testid":"input-checker-file"}),e.jsx("p",{className:"text-xs text-gray-300",children:"CSV format: SERIAL,PIN (one pair per line, no headers)"}),r&&e.jsxs("p",{className:"text-sm text-green-400",children:["File selected: ",r.name]})]}),e.jsx(g,{type:"submit",className:"w-full",disabled:a,"data-testid":"button-submit-checkers",children:a?"Adding...":"Add Result Checkers"})]})}function Rc({checker:s,onSubmit:a,isLoading:t}){const[n,l]=o.useState({type:s.type,year:s.year.toString(),serialNumber:s.serialNumber,pin:s.pin,basePrice:s.basePrice}),r=x=>{x.preventDefault(),a({type:n.type,year:parseInt(n.year),serialNumber:n.serialNumber,pin:n.pin,basePrice:n.basePrice})},c=new Date().getFullYear(),d=[c,c-1,c-2];return e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(z,{children:"Type"}),e.jsxs(Ae,{value:n.type,onValueChange:x=>l({...n,type:x}),children:[e.jsx(Pe,{children:e.jsx(Te,{})}),e.jsx(Ce,{children:ka.map(x=>e.jsx(H,{value:x.id,children:x.name},x.id))})]})]}),e.jsxs("div",{children:[e.jsx(z,{children:"Year"}),e.jsxs(Ae,{value:n.year,onValueChange:x=>l({...n,year:x}),children:[e.jsx(Pe,{children:e.jsx(Te,{})}),e.jsx(Ce,{children:d.map(x=>e.jsx(H,{value:x.toString(),children:x},x))})]})]})]}),e.jsxs("div",{children:[e.jsx(z,{htmlFor:"edit-serial",children:"Serial Number"}),e.jsx(K,{id:"edit-serial",value:n.serialNumber,onChange:x=>l({...n,serialNumber:x.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(z,{htmlFor:"edit-pin",children:"PIN"}),e.jsx(K,{id:"edit-pin",value:n.pin,onChange:x=>l({...n,pin:x.target.value}),required:!0})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(z,{htmlFor:"edit-base-price",children:"Base Price"}),e.jsx(K,{id:"edit-base-price",type:"number",step:"0.01",value:n.basePrice,onChange:x=>l({...n,basePrice:x.target.value}),required:!0})]})}),e.jsx(g,{type:"submit",className:"w-full",disabled:t,children:t?"Updating...":"Update Result Checker"})]})}function Ht({field:s,children:a,sortField:t,sortDirection:n,onSort:l}){return e.jsx(O,{className:"cursor-pointer select-none hover:bg-muted/50 transition-colors",onClick:()=>l(s),children:e.jsxs("div",{className:"flex items-center gap-1",children:[a,t===s&&(n==="asc"?e.jsx(Fr,{className:"h-4 w-4"}):e.jsx(na,{className:"h-4 w-4"}))]})})}function Lc(){const{toast:s}=he(),a=Fs(),[t,n]=o.useState("all"),[l,r]=o.useState("all"),[c,d]=o.useState(""),[x,p]=o.useState(!1),[m,j]=o.useState(null),[h,f]=o.useState(""),[b,i]=o.useState("all"),[u,F]=o.useState("createdAt"),[R,P]=o.useState("desc"),[v,U]=o.useState(new Set),[E,se]=o.useState({}),{data:ee,isLoading:le}=V({queryKey:["/api/admin/transactions"],refetchInterval:15e3,refetchOnWindowFocus:!0}),w=re({mutationFn:async({transactionId:q,deliveryStatus:ne})=>Y("PATCH",`/api/admin/transactions/${q}/delivery-status`,{deliveryStatus:ne}),onSuccess:()=>{a.invalidateQueries({queryKey:["/api/admin/transactions"]}),s({title:"Delivery status updated successfully"}),j(null),f("")},onError:q=>{s({title:"Failed to update delivery status",description:(q==null?void 0:q.message)||"Unknown error",variant:"destructive"})}}),N=async q=>{const ne=new Set(v);if(ne.has(q))ne.delete(q);else if(ne.add(q),!E[q])try{const ve=await Y("GET",`/api/admin/result-checker/${q}`);se(Fe=>({...Fe,[q]:ve}))}catch(ve){s({title:"Failed to fetch result checker details",description:(ve==null?void 0:ve.message)||"Unknown error",variant:"destructive"});return}U(ne)},y=re({mutationFn:async()=>{const q=new URLSearchParams;return b!=="all"&&q.append("paymentStatus",b),await Y("GET",`/api/admin/transactions/export?${q.toString()}`)},onSuccess:q=>{if(q&&Array.isArray(q)){const ne=A(q);W(ne,`transactions-${b==="all"?"all":b}-${new Date().toISOString().split("T")[0]}.csv`),s({title:"Transactions exported successfully"})}},onError:q=>{s({title:"Failed to export transactions",description:(q==null?void 0:q.message)||"Unknown error",variant:"destructive"})}}),I=ee==null?void 0:ee.filter(q=>{if(t!=="all"&&q.status!==t||l!=="all"&&q.type!==l)return!1;if(c){const ne=c.toLowerCase();if(!q.reference.toLowerCase().includes(ne)&&!q.productName.toLowerCase().includes(ne)&&(!q.customerPhone||!q.customerPhone.includes(ne)))return!1}return!0}),T={total:(ee==null?void 0:ee.length)||0,completed:(ee==null?void 0:ee.filter(q=>q.status==="completed").length)||0,pending:(ee==null?void 0:ee.filter(q=>q.status==="pending").length)||0,failed:(ee==null?void 0:ee.filter(q=>q.status==="failed").length)||0},k=q=>{u===q?P(R==="asc"?"desc":"asc"):(F(q),P("asc"))},S=I==null?void 0:I.sort((q,ne)=>{let ve=q[u],Fe=ne[u];return u==="amount"||u==="profit"?(ve=parseFloat(ve),Fe=parseFloat(Fe)):u==="createdAt"?(ve=new Date(ve).getTime(),Fe=new Date(Fe).getTime()):(u==="productName"||u==="customerPhone")&&(ve=ve.toLowerCase(),Fe=Fe.toLowerCase()),ve<Fe?R==="asc"?-1:1:ve>Fe?R==="asc"?1:-1:0}),A=q=>{if(q.length===0)return"";const ne=Object.keys(q[0]),ve=[];ve.push(ne.join(","));for(const Fe of q){const Ue=ne.map(Vs=>{const ks=Fe[Vs];if(Array.isArray(ks))return`"${ks.map(Qs=>typeof Qs=="object"?JSON.stringify(Qs):Qs).join("; ")}"`;if(typeof ks=="object"&&ks!==null)return`"${JSON.stringify(ks)}"`;const Ys=String(ks||"");return Ys.includes(",")||Ys.includes('"')?`"${Ys.replace(/"/g,'""')}"`:Ys});ve.push(Ue.join(","))}return ve.join(`
`)},W=(q,ne)=>{const ve=new Blob([q],{type:"text/csv;charset=utf-8;"}),Fe=document.createElement("a"),Ue=URL.createObjectURL(ve);Fe.setAttribute("href",Ue),Fe.setAttribute("download",ne),Fe.style.visibility="hidden",document.body.appendChild(Fe),Fe.click(),document.body.removeChild(Fe)},_=(q,ne)=>{j(q),f(ne)},te=q=>{h&&w.mutate({transactionId:q,deliveryStatus:h})},ie=()=>{j(null),f("")};return e.jsxs("div",{className:"flex h-screen bg-background",children:[x&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>p(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>p(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>p(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Transactions"})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4",children:[e.jsx(C,{className:"text-sm md:text-base",children:e.jsxs(D,{className:"pt-4 md:pt-6",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold",children:T.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Transactions"})]})}),e.jsx(C,{className:"text-sm md:text-base",children:e.jsxs(D,{className:"pt-4 md:pt-6",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold text-green-600",children:T.completed}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Completed"})]})}),e.jsx(C,{className:"text-sm md:text-base",children:e.jsxs(D,{className:"pt-4 md:pt-6",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold text-orange-600",children:T.pending}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pending"})]})}),e.jsx(C,{className:"text-sm md:text-base",children:e.jsxs(D,{className:"pt-4 md:pt-6",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold text-red-600",children:T.failed}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Failed"})]})})]}),e.jsxs(C,{className:"md:col-span-2 lg:col-span-3",children:[e.jsxs($,{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-3 pb-3 md:pb-6",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(B,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(Es,{className:"h-4 w-4 md:h-5 md:w-5"}),e.jsx("span",{className:"truncate",children:"All Transactions"})]}),e.jsx(J,{className:"text-sm md:text-base",children:"View and track all customer orders"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-2 w-full lg:w-auto",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ae,{value:b,onValueChange:i,children:[e.jsx(Pe,{className:"w-full sm:w-36 md:w-40 text-xs md:text-sm","data-testid":"export-payment-status",children:e.jsx(Te,{placeholder:"Export Filter"})}),e.jsxs(Ce,{children:[e.jsx(H,{value:"all",children:"All Payments"}),e.jsx(H,{value:"paid",children:"Paid Only"}),e.jsx(H,{value:"pending",children:"Pending Only"})]})]}),e.jsxs(g,{onClick:()=>y.mutate(),disabled:y.isPending,variant:"outline",size:"sm",className:"gap-2 text-xs px-2 py-1 h-8",children:[e.jsx(rl,{className:"h-3 w-3 md:h-4 md:w-4"}),y.isPending?"Exporting...":"Export CSV"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 sm:flex-initial",children:[e.jsx(Gt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(K,{placeholder:"Search...",value:c,onChange:q=>d(q.target.value),className:"pl-9 w-full sm:w-48 text-sm","data-testid":"input-search"})]}),e.jsxs(Ae,{value:t,onValueChange:n,children:[e.jsx(Pe,{className:"w-full sm:w-32 text-xs md:text-sm","data-testid":"filter-status",children:e.jsx(Te,{placeholder:"Status"})}),e.jsxs(Ce,{children:[e.jsx(H,{value:"all",children:"All Status"}),e.jsx(H,{value:"completed",children:"Completed"}),e.jsx(H,{value:"pending",children:"Pending"}),e.jsx(H,{value:"failed",children:"Failed"}),e.jsx(H,{value:"refunded",children:"Refunded"})]})]}),e.jsxs(Ae,{value:l,onValueChange:r,children:[e.jsx(Pe,{className:"w-full sm:w-36 md:w-40 text-xs md:text-sm","data-testid":"filter-type",children:e.jsx(Te,{placeholder:"Type"})}),e.jsxs(Ce,{children:[e.jsx(H,{value:"all",children:"All Types"}),e.jsx(H,{value:"data_bundle",children:"Data Bundles"}),e.jsx(H,{value:"result_checker",children:"Result Checkers"})]})]})]})]})]}),e.jsx(D,{className:"px-3 md:px-6",children:le?e.jsx(us,{rows:5}):S&&S.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{className:"text-xs md:text-sm",children:"Reference"}),e.jsx(Ht,{field:"productName",sortField:u,sortDirection:R,onSort:k,children:e.jsx("span",{className:"text-xs md:text-sm",children:"Product"})}),e.jsx(O,{className:"hidden sm:table-cell text-xs md:text-sm",children:"Network"}),e.jsx(Ht,{field:"amount",sortField:u,sortDirection:R,onSort:k,children:e.jsx("span",{className:"text-xs md:text-sm",children:"Amount"})}),e.jsx(Ht,{field:"profit",sortField:u,sortDirection:R,onSort:k,children:e.jsx("span",{className:"text-xs md:text-sm",children:"Profit"})}),e.jsx(O,{className:"hidden lg:table-cell text-xs md:text-sm",children:"Customer"}),e.jsx(O,{className:"hidden xl:table-cell text-xs md:text-sm",children:"Payment"}),e.jsx(O,{className:"text-xs md:text-sm",children:"Status"}),e.jsx(O,{className:"hidden md:table-cell text-xs md:text-sm",children:"Delivery"}),e.jsx(Ht,{field:"createdAt",sortField:u,sortDirection:R,onSort:k,children:e.jsx("span",{className:"text-xs md:text-sm",children:"Date"})}),e.jsx(O,{className:"text-xs md:text-sm",children:"Actions"})]})}),e.jsx(Ze,{children:S.map(q=>{var Aa,Ta,Fa,Ia;let ne=Xs.find(rs=>rs.id===q.network);const ve=q.isBulkOrder,Fe=q.phoneNumbers,Ue=Fe?typeof Fe=="string"?(()=>{try{return JSON.parse(Fe)}catch(rs){return console.error("Failed to parse phoneNumbers:",rs,Fe),[]}})():Fe:void 0,Vs=q.deliveryStatus||"pending";if(!ne&&ve&&Ue&&Ue.length>0){const rs=Ue[0].bundleName;if(rs){const vt=rs.toLowerCase();vt.includes("mtn")?ne=Xs.find(at=>at.id==="mtn"):vt.includes("telecel")?ne=Xs.find(at=>at.id==="telecel"):vt.includes("bigtime")?ne=Xs.find(at=>at.id==="at_bigtime"):vt.includes("ishare")&&(ne=Xs.find(at=>at.id==="at_ishare"))}}const ks=q.type==="result_checker",Ys=v.has(q.id),Qs=E[q.id],Lt=q.quantity||1;return e.jsxs(e.Fragment,{children:[e.jsxs(fe,{"data-testid":`row-transaction-${q.id}`,children:[e.jsx(M,{className:"font-mono text-xs md:text-sm",children:q.reference}),e.jsxs(M,{className:"max-w-[150px] md:max-w-[200px]",children:[e.jsx("div",{className:"font-medium truncate text-xs md:text-sm",children:q.productName}),e.jsxs("div",{className:"flex gap-1 mt-1 flex-wrap",children:[e.jsx(X,{variant:"outline",className:"text-xs px-1 py-0",children:q.type==="data_bundle"?"Data":"Result"}),(ve||ks&&Lt>1)&&e.jsxs(X,{variant:"secondary",className:"text-xs px-1 py-0 flex items-center gap-1",children:[e.jsx(Et,{className:"h-2.5 w-2.5"}),(Ue==null?void 0:Ue.length)||Lt]})]})]}),e.jsx(M,{className:"hidden sm:table-cell",children:ne?e.jsx(X,{style:{backgroundColor:ne.color,color:ne.textColor},className:"text-xs px-1 py-0",children:ne.name}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsxs(M,{className:"font-medium tabular-nums text-xs md:text-sm",children:[e.jsx("div",{children:ae(q.amount)}),(ve&&Ue||ks&&Lt>1)&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[ae(parseFloat(q.amount)/((Ue==null?void 0:Ue.length)||Lt))," each"]})]}),e.jsx(M,{className:"text-green-600 tabular-nums text-xs md:text-sm",children:ae(q.profit)}),e.jsx(M,{className:"hidden lg:table-cell text-muted-foreground text-xs md:text-sm",children:ve&&Ue?e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:"font-semibold",children:[Ue.length," items: ",Ue.map(rs=>rs.dataAmount).join(", ")]}),e.jsx("div",{className:"text-muted-foreground truncate max-w-[80px] md:max-w-[120px]",children:((Aa=Ue[0])==null?void 0:Aa.phone)||"Unknown"})]}):q.customerPhone}),e.jsx(M,{className:"hidden xl:table-cell",children:e.jsx(X,{variant:q.paymentStatus==="paid"?"default":q.paymentStatus==="failed"?"destructive":q.paymentStatus==="cancelled"?"outline":"secondary",className:"text-xs",children:q.paymentStatus||"pending"})}),e.jsx(M,{children:e.jsx(Ca,{status:q.status})}),e.jsx(M,{className:"hidden md:table-cell",children:m===q.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Ae,{value:h,onValueChange:f,children:[e.jsx(Pe,{className:"w-24 md:w-32 h-7 md:h-8 text-xs",children:e.jsx(Te,{})}),e.jsxs(Ce,{children:[e.jsx(H,{value:"pending",children:"Pending"}),e.jsx(H,{value:"processing",children:"Processing"}),e.jsx(H,{value:"delivered",children:"Delivered"}),e.jsx(H,{value:"failed",children:"Failed"})]})]}),e.jsx(g,{size:"sm",onClick:()=>te(q.id),disabled:w.isPending,className:"h-7 px-2 text-xs",children:w.isPending?"...":"Save"}),e.jsx(g,{size:"sm",variant:"outline",onClick:ie,className:"h-7 px-2 text-xs",children:"Cancel"})]}):e.jsx(X,{variant:Vs==="delivered"?"default":Vs==="processing"?"secondary":Vs==="failed"?"destructive":"outline",className:"cursor-pointer text-xs",onClick:()=>_(q.id,Vs),children:Vs})}),e.jsx(M,{className:"text-muted-foreground text-xs md:text-sm",children:Qe(q.createdAt)}),e.jsx(M,{children:e.jsxs("div",{className:"flex gap-1",children:[ks&&Lt>1&&e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>N(q.id),className:"h-6 w-6 p-0",title:Ys?"Collapse PINs":"View all PINs",children:e.jsx(Na,{className:`h-4 w-4 transition-transform ${Ys?"rotate-90":""}`})}),e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>_(q.id,Vs),disabled:m===q.id,className:"h-6 w-6 p-0",children:e.jsx(va,{className:"h-3 w-3"})})]})})]},q.id),ks&&Ys&&Qs&&e.jsx(fe,{children:e.jsx(M,{colSpan:11,className:"bg-muted/30 p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-semibold",children:["Result Checker PINs (",((Ta=Qs.checkers)==null?void 0:Ta.length)||0,")"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Customer: ",((Fa=Qs.transaction)==null?void 0:Fa.customerPhone)||"N/A"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:(Ia=Qs.checkers)==null?void 0:Ia.map((rs,vt)=>e.jsxs("div",{className:"p-3 rounded-lg border bg-card text-card-foreground",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(X,{variant:"outline",className:"text-xs",children:["PIN #",vt+1]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[rs.type.toUpperCase()," ",rs.year]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Serial Number:"}),e.jsx("span",{className:"font-mono text-sm font-medium",children:rs.serialNumber})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"PIN:"}),e.jsx("span",{className:"font-mono text-sm font-medium",children:rs.pin})]}),rs.soldAt&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["Sold: ",Qe(rs.soldAt)]})]})]},rs.id))})]})})},`${q.id}-expanded`)]})})})]})}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No transactions found matching your criteria."})})]})]})})]})]})}function Mc(){const{toast:s}=he(),[a,t]=o.useState("all"),[n,l]=o.useState(""),[r,c]=o.useState(!1),[d,x]=o.useState(null),[p,m]=o.useState(null),[j,h]=o.useState(!1),[f,b]=o.useState({}),{data:i,isLoading:u}=V({queryKey:["/api/admin/users"],refetchInterval:3e4,refetchOnWindowFocus:!0}),F=re({mutationFn:E=>Y("DELETE",`/api/admin/users/${E}`,{}),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/users"]}),ke.invalidateQueries({queryKey:["/api/admin/stats"]}),s({title:"âœ… User deleted successfully"}),x(null)},onError:E=>{s({title:"Failed to delete user",description:E.message,variant:"destructive"})}}),R=re({mutationFn:E=>Y("DELETE",`/api/admin/users/delete-inactive?days=${E}`,{}),onSuccess:E=>{ke.invalidateQueries({queryKey:["/api/admin/users"]}),ke.invalidateQueries({queryKey:["/api/admin/stats"]}),s({title:`âœ… Deleted ${E.deletedCount} inactive users`,description:E.errors?`Errors: ${E.errors.join(", ")}`:void 0}),m(null)},onError:E=>{s({title:"Failed to delete inactive users",description:E.message,variant:"destructive"})}}),P=re({mutationFn:({id:E,role:se})=>Y("PATCH",`/api/admin/users/${E}/role`,{role:se}),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/users"]}),s({title:"âœ… User role updated successfully"})},onError:E=>{s({title:"Failed to update user role",description:E.message,variant:"destructive"})}}),v=i==null?void 0:i.filter(E=>{const se=a==="all"||a==="guest"&&E.role==="guest"||a==="user"&&E.role==="user"||a==="agent"&&E.role==="agent"||a==="dealer"&&E.role==="dealer"||a==="super_dealer"&&E.role==="super_dealer"||a==="master"&&E.role==="master"||a==="admin"&&E.role==="admin",ee=!n||E.name.toLowerCase().includes(n.toLowerCase())||E.email.toLowerCase().includes(n.toLowerCase())||E.phone&&E.phone.includes(n);return se&&ee}),U={total:(i==null?void 0:i.length)||0,guests:(i==null?void 0:i.filter(E=>E.role==="guest").length)||0,users:(i==null?void 0:i.filter(E=>E.role==="user").length)||0,agents:(i==null?void 0:i.filter(E=>E.role==="agent").length)||0,dealers:(i==null?void 0:i.filter(E=>E.role==="dealer").length)||0,superDealers:(i==null?void 0:i.filter(E=>E.role==="super_dealer").length)||0,masters:(i==null?void 0:i.filter(E=>E.role==="master").length)||0,admins:(i==null?void 0:i.filter(E=>E.role==="admin").length)||0};return e.jsxs("div",{className:"flex h-screen bg-background",children:[r&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>c(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>c(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>c(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Users"})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(we,{title:"Total Users",value:U.total,icon:Ss,description:"All registered users"}),e.jsx(we,{title:"Users",value:U.users,icon:Ss,description:"Regular users"}),e.jsx(we,{title:"Agents",value:U.agents,icon:Ss,description:"Agent accounts"}),e.jsx(we,{title:"Dealers",value:U.dealers,icon:Ss,description:"Dealer accounts"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(we,{title:"Super Dealers",value:U.superDealers,icon:Ss,description:"Super dealer accounts"}),e.jsx(we,{title:"Guests",value:U.guests,icon:Ss,description:"Guest accounts"}),e.jsx(we,{title:"Admins",value:U.admins,icon:Ss,description:"Administrator accounts"})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"h-5 w-5"}),"All Users"]}),e.jsx(J,{children:"Manage user accounts and track purchases"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{type:"number",placeholder:"Days",className:"w-20",value:p||"",onChange:E=>m(parseInt(E.target.value)||null)}),e.jsx(g,{size:"sm",variant:"destructive",onClick:()=>h(!0),disabled:!p,children:"Delete Inactive"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(K,{placeholder:"Search users...",className:"w-64 pl-10",value:n,onChange:E=>l(E.target.value)})]}),e.jsxs(Ae,{value:a,onValueChange:t,children:[e.jsx(Pe,{className:"w-40",children:e.jsx(Te,{placeholder:"Role"})}),e.jsxs(Ce,{className:"bg-white dark:bg-black border-2 border-gray-300 dark:border-gray-600 text-black dark:text-white",children:[e.jsx(H,{value:"all",children:"All Users"}),e.jsx(H,{value:"guest",children:"Guests"}),e.jsx(H,{value:"user",children:"Users"}),e.jsx(H,{value:"agent",children:"Agents"}),e.jsx(H,{value:"dealer",children:"Dealers"}),e.jsx(H,{value:"super_dealer",children:"Super Dealers"}),e.jsx(H,{value:"master",children:"Master"}),e.jsx(H,{value:"admin",children:"Admins"})]})]})]})]}),e.jsx(D,{children:u?e.jsx(us,{rows:10}):v&&v.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{children:"Name"}),e.jsx(O,{children:"Email"}),e.jsx(O,{children:"Phone"}),e.jsx(O,{children:"Role"}),e.jsx(O,{children:"Last Purchase"}),e.jsx(O,{children:"Total Purchases"}),e.jsx(O,{children:"Total Spent"}),e.jsx(O,{children:"Joined"}),e.jsx(O,{className:"text-right",children:"Actions"})]})}),e.jsx(Ze,{children:v.map(E=>e.jsxs(fe,{children:[e.jsx(M,{children:e.jsx("div",{className:"font-medium",children:E.name})}),e.jsx(M,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:E.email})}),e.jsx(M,{children:e.jsx("div",{className:"text-sm",children:E.phone||"â€”"})}),e.jsxs(M,{children:[e.jsxs(Ae,{value:f[E.id]||E.role,onValueChange:se=>{b(ee=>({...ee,[E.id]:se}))},disabled:P.isPending,children:[e.jsx(Pe,{className:"w-32",children:e.jsx(Te,{})}),e.jsxs(Ce,{className:"bg-white dark:bg-black border-2 border-gray-300 dark:border-gray-600 text-black dark:text-white",children:[e.jsx(H,{value:"guest",children:"Guest"}),e.jsx(H,{value:"user",children:"User"}),e.jsx(H,{value:"agent",children:"Agent"}),e.jsx(H,{value:"dealer",children:"Dealer"}),e.jsx(H,{value:"super_dealer",children:"Super Dealer"}),e.jsx(H,{value:"master",children:"Master"}),e.jsx(H,{value:"admin",children:"Admin"})]})]}),f[E.id]&&f[E.id]!==E.role&&e.jsx(g,{size:"sm",variant:"outline",className:"ml-2",onClick:()=>{P.mutate({id:E.id,role:f[E.id]}),b(se=>{const ee={...se};return delete ee[E.id],ee})},disabled:P.isPending,children:"Save"})]}),e.jsx(M,{children:E.lastPurchase?e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:ae(E.lastPurchase.amount)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[E.lastPurchase.productType," â€¢ ",Qe(E.lastPurchase.date)]})]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"No purchases"})}),e.jsx(M,{className:"tabular-nums",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(In,{className:"h-3 w-3 text-muted-foreground"}),E.totalPurchases]})}),e.jsx(M,{className:"font-medium tabular-nums",children:ae(E.totalSpent)}),e.jsx(M,{className:"text-muted-foreground text-sm",children:Qe(E.createdAt)}),e.jsx(M,{className:"text-right",children:e.jsx(g,{size:"sm",variant:"ghost",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>x(E.id),disabled:E.role==="admin",children:e.jsx(Ts,{className:"h-4 w-4"})})})]},E.id))})]})}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No users found."})})]})]})})]}),e.jsx(At,{open:j,onOpenChange:h,children:e.jsxs(ot,{children:[e.jsxs(mt,{children:[e.jsx(ht,{children:"Delete Inactive Users"}),e.jsxs(ut,{children:["Are you sure you want to delete all users who haven't made a purchase in the last ",p," days? This action cannot be undone. All user data and transactions will be permanently removed."]})]}),e.jsxs(xt,{children:[e.jsx(jt,{children:"Cancel"}),e.jsx(pt,{onClick:()=>{p&&(R.mutate(p),h(!1))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:R.isPending,children:"Delete Inactive Users"})]})]})}),e.jsx(At,{open:!!d,onOpenChange:E=>!E&&x(null),children:e.jsxs(ot,{children:[e.jsxs(mt,{children:[e.jsx(ht,{children:"Delete User"}),e.jsx(ut,{children:"Are you sure you want to delete this user? This action cannot be undone. All user data and transactions will be permanently removed."})]}),e.jsxs(xt,{children:[e.jsx(jt,{children:"Cancel"}),e.jsx(pt,{onClick:()=>d&&F.mutate(d),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})}const $c=Z.object({whatsappSupportLink:Z.string().url("Must be a valid URL").optional().or(Z.literal("")),whatsappChannelLink:Z.string().url("Must be a valid URL").optional().or(Z.literal(""))});function Oc(){const{toast:s}=he(),[a,t]=o.useState("all"),[n,l]=o.useState(!1),[r,c]=o.useState(null),[d,x]=o.useState(null),p=gs({resolver:fs($c),defaultValues:{whatsappSupportLink:"",whatsappChannelLink:""}}),{data:m,isLoading:j}=V({queryKey:["/api/admin/agents"],refetchInterval:3e4,refetchOnWindowFocus:!0}),h=re({mutationFn:u=>Y("DELETE",`/api/admin/agents/${u}`,{}),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/agents"]}),ke.invalidateQueries({queryKey:["/api/admin/stats"]}),s({title:"âœ… Agent deleted successfully"}),c(null)},onError:u=>{s({title:"Failed to delete agent",description:u.message,variant:"destructive"})}}),f=re({mutationFn:({id:u,data:F})=>Y("PATCH",`/api/admin/agents/${u}/whatsapp`,F),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/agents"]}),s({title:"âœ… WhatsApp links updated successfully"}),x(null),p.reset()},onError:u=>{s({title:"Failed to update WhatsApp links",description:u.message,variant:"destructive"})}}),b=m==null?void 0:m.filter(u=>a==="approved"?u.isApproved:a==="pending"?!u.isApproved:!0),i={total:(m==null?void 0:m.length)||0,approved:(m==null?void 0:m.filter(u=>u.isApproved).length)||0,pending:(m==null?void 0:m.filter(u=>!u.isApproved).length)||0};return e.jsxs("div",{className:"flex h-screen bg-background",children:[n&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>l(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>l(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>l(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Agents"})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(we,{title:"Total Agents",value:i.total,icon:es,description:"Registered agents"}),e.jsx(we,{title:"Approved",value:i.approved,icon:be,description:"Active agents"}),e.jsx(we,{title:"Pending Approval",value:i.pending,icon:ze,description:"Awaiting review"})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(zs,{className:"h-5 w-5"}),"All Agents"]}),e.jsx(J,{children:"Manage agent accounts and approvals"})]}),e.jsxs(Ae,{value:a,onValueChange:t,children:[e.jsx(Pe,{className:"w-40","data-testid":"filter-status",children:e.jsx(Te,{placeholder:"Status"})}),e.jsxs(Ce,{children:[e.jsx(H,{value:"all",children:"All Agents"}),e.jsx(H,{value:"approved",children:"Approved"}),e.jsx(H,{value:"pending",children:"Pending"})]})]})]}),e.jsx(D,{children:j?e.jsx(us,{rows:8}):b&&b.length>0?e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{children:"Business Name"}),e.jsx(O,{children:"Contact"}),e.jsx(O,{children:"Storefront"}),e.jsx(O,{children:"Balance"}),e.jsx(O,{children:"Total Sales"}),e.jsx(O,{children:"Status"}),e.jsx(O,{children:"Joined"}),e.jsx(O,{className:"text-right",children:"Actions"})]})}),e.jsx(Ze,{children:b.map(u=>{var F,R,P;return e.jsxs(fe,{"data-testid":`row-agent-${u.id}`,children:[e.jsxs(M,{children:[e.jsx("div",{className:"font-medium",children:u.businessName}),u.businessDescription&&e.jsx("div",{className:"text-sm text-muted-foreground truncate max-w-[200px]",children:u.businessDescription})]}),e.jsxs(M,{children:[e.jsx("div",{className:"text-sm",children:(F=u.user)==null?void 0:F.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:(R=u.user)==null?void 0:R.email}),e.jsx("div",{className:"text-xs text-muted-foreground",children:(P=u.user)==null?void 0:P.phone})]}),e.jsx(M,{children:e.jsxs("a",{href:`/store/agent/${u.storefrontSlug}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline font-mono text-sm",children:["/store/agent/",u.storefrontSlug]})}),e.jsx(M,{className:"font-medium tabular-nums",children:ae(u.balance)}),e.jsx(M,{className:"tabular-nums",children:ae(u.totalSales)}),e.jsx(M,{children:e.jsx(X,{variant:u.isApproved?"default":"secondary",children:u.isApproved?"Approved":"Pending"})}),e.jsx(M,{className:"text-muted-foreground text-sm",children:Qe(u.createdAt)}),e.jsx(M,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>{x(u.id),p.reset({whatsappSupportLink:u.whatsappSupportLink||"",whatsappChannelLink:u.whatsappChannelLink||""})},children:e.jsx(va,{className:"h-4 w-4"})}),e.jsx(g,{size:"sm",variant:"ghost",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>c(u.id),children:e.jsx(Ts,{className:"h-4 w-4"})})]})})]},u.id)})})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No agents found."})})]})]})})]}),e.jsx(At,{open:!!r,onOpenChange:u=>!u&&c(null),children:e.jsxs(ot,{children:[e.jsxs(mt,{children:[e.jsx(ht,{children:"Delete Agent"}),e.jsx(ut,{children:"Are you sure you want to delete this agent? This action cannot be undone. The agent's storefront, transactions, and all related data will be permanently removed."})]}),e.jsxs(xt,{children:[e.jsx(jt,{children:"Cancel"}),e.jsx(pt,{onClick:()=>r&&h.mutate(r),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(ts,{open:!!d,onOpenChange:u=>!u&&x(null),children:e.jsxs(_e,{children:[e.jsx(Ge,{children:e.jsx(We,{children:"Edit WhatsApp Links"})}),e.jsxs("form",{onSubmit:p.handleSubmit(u=>{d&&f.mutate({id:d,data:u})}),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(z,{htmlFor:"whatsappSupportLink",children:"WhatsApp Support Link"}),e.jsx(K,{id:"whatsappSupportLink",placeholder:"https://wa.me/1234567890",...p.register("whatsappSupportLink")}),p.formState.errors.whatsappSupportLink&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:p.formState.errors.whatsappSupportLink.message})]}),e.jsxs("div",{children:[e.jsx(z,{htmlFor:"whatsappChannelLink",children:"WhatsApp Channel Link"}),e.jsx(K,{id:"whatsappChannelLink",placeholder:"https://whatsapp.com/channel/...",...p.register("whatsappChannelLink")}),p.formState.errors.whatsappChannelLink&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:p.formState.errors.whatsappChannelLink.message})]}),e.jsxs(Sa,{children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>x(null),children:"Cancel"}),e.jsx(g,{type:"submit",disabled:f.isPending,children:f.isPending?"Saving...":"Save Changes"})]})]})]})})]})}function Bc(){const{toast:s}=he(),[a,t]=o.useState("all"),[n,l]=o.useState(!1),{data:r,isLoading:c,error:d}=V({queryKey:["/api/admin/withdrawals"],refetchInterval:2e4,refetchOnWindowFocus:!0});if(d)return console.error("Error fetching withdrawals:",d),e.jsxs("div",{className:"flex h-screen bg-background",children:[e.jsx(ye,{}),e.jsx("div",{className:"flex-1 p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error Loading Withdrawals"}),e.jsx("p",{className:"text-muted-foreground",children:"Unable to fetch withdrawal requests. Please try again later."}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Error: ",d.message]})]})})]});const x=Array.isArray(r)&&r?r.filter(i=>a==="all"?!0:i.status===a):[],p={total:Array.isArray(r)&&r?r.length:0,pending:Array.isArray(r)&&r?r.filter(i=>i.status==="pending").length:0,approved:Array.isArray(r)&&r?r.filter(i=>i.status==="approved").length:0,rejected:Array.isArray(r)&&r?r.filter(i=>i.status==="rejected").length:0,paid:Array.isArray(r)&&r?r.filter(i=>i.status==="paid").length:0,totalAmount:Array.isArray(r)&&r?r.reduce((i,u)=>i+parseFloat(u.amount),0):0},m=i=>{const u=gl[i];return e.jsx(X,{className:(u==null?void 0:u.color)||"",children:(u==null?void 0:u.label)||i})},j=re({mutationFn:async({id:i,action:u})=>await Y("POST",`/api/admin/withdrawals/${i}/${u}`),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/withdrawals"]}),s({title:"Success",description:"Withdrawal request updated successfully"})},onError:i=>{s({title:"Error",description:i.message||"Failed to update withdrawal request",variant:"destructive"})}}),h=i=>{j.mutate({id:i,action:"approve"})},f=i=>{j.mutate({id:i,action:"reject"})},b=i=>{j.mutate({id:i,action:"mark_paid"})};return e.jsxs("div",{className:"flex h-screen bg-background",children:[n&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>l(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>l(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>l(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Withdrawals"})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(we,{title:"Total Requests",value:p.total,icon:ge,description:"All time"}),e.jsx(we,{title:"Pending",value:p.pending,icon:ze,description:"Awaiting approval"}),e.jsx(we,{title:"Approved",value:p.approved,icon:be,description:"Ready for manual payout"}),e.jsx(we,{title:"Paid",value:p.paid,icon:be,description:"Manually paid out"})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"Withdrawal Requests"]}),e.jsx(J,{children:"Track all agent withdrawal requests and their transfer status"})]}),e.jsxs(Ae,{value:a,onValueChange:t,children:[e.jsx(Pe,{className:"w-40","data-testid":"filter-status",children:e.jsx(Te,{placeholder:"Status"})}),e.jsxs(Ce,{children:[e.jsx(H,{value:"all",children:"All Status"}),e.jsx(H,{value:"pending",children:"Pending"}),e.jsx(H,{value:"approved",children:"Approved"}),e.jsx(H,{value:"rejected",children:"Rejected"}),e.jsx(H,{value:"paid",children:"Paid"})]})]})]}),e.jsx(D,{children:c?e.jsx(us,{rows:8}):x&&x.length>0?e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{children:"Agent"}),e.jsx(O,{children:"Amount"}),e.jsx(O,{children:"Payment Method"}),e.jsx(O,{children:"Account Details"}),e.jsx(O,{children:"Status"}),e.jsx(O,{children:"Requested"}),e.jsx(O,{children:"Actions"})]})}),e.jsx(Ze,{children:x.map(i=>{var u,F,R;return e.jsxs(fe,{"data-testid":`row-withdrawal-${i.id}`,children:[e.jsxs(M,{children:[e.jsx("div",{className:"font-medium",children:(u=i.agent)==null?void 0:u.businessName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:(F=i.user)==null?void 0:F.name})]}),e.jsx(M,{className:"font-bold tabular-nums text-lg",children:ae(i.amount)}),e.jsx(M,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[i.paymentMethod==="bank"?e.jsx(Dn,{className:"h-4 w-4 text-blue-600"}):e.jsx(ge,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium capitalize",children:((R=i.paymentMethod)==null?void 0:R.replace("_"," "))||"Bank"})]})}),e.jsx(M,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:i.accountName}),e.jsx("div",{className:"text-muted-foreground",children:i.accountNumber}),i.paymentMethod==="bank"&&i.bankName&&e.jsx("div",{className:"text-muted-foreground text-xs",children:i.bankName})]})}),e.jsx(M,{children:m(i.status)}),e.jsx(M,{className:"text-muted-foreground text-sm",children:Qe(i.createdAt)}),e.jsxs(M,{children:[i.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{size:"sm",variant:"default",onClick:()=>h(i.id),disabled:j.isPending,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(g,{size:"sm",variant:"destructive",onClick:()=>f(i.id),disabled:j.isPending,children:[e.jsx(is,{className:"h-4 w-4 mr-1"}),"Reject"]})]}),i.status==="approved"&&e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>b(i.id),disabled:j.isPending,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Mark as Paid"]})]})]},i.id)})})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No withdrawal requests found."})})]})]})})]})]})}function qc(){const[s,a]=o.useState(null),[t,n]=o.useState(""),[l,r]=o.useState("open"),[c,d]=o.useState(!1),x=o.useRef(null),{toast:p}=he(),m=Fs(),{data:j=0}=V({queryKey:["/api/support/admin/unread-count"],queryFn:async()=>{try{return(await Y("GET","/api/support/admin/unread-count")).count||0}catch{return 0}},refetchInterval:5e3}),{data:h,isLoading:f}=V({queryKey:[`/api/admin/support/chats?status=${l}`],refetchInterval:1e4}),{data:b}=V({queryKey:[`/api/support/chat/${s}`],enabled:!!s,refetchInterval:5e3}),i=re({mutationFn:v=>Y("POST",`/api/support/chat/${s}/message`,{message:v}),onSuccess:()=>{n(""),m.invalidateQueries({queryKey:[`/api/support/chat/${s}`]}),m.invalidateQueries({queryKey:["/api/admin/support/chats"],exact:!1})},onError:()=>{p({title:"âŒ Error",description:"Failed to send message",variant:"destructive",duration:4e3})}}),u=re({mutationFn:v=>Y("PUT",`/api/admin/support/chat/${v}/assign`,{}),onSuccess:()=>{m.invalidateQueries({queryKey:["/api/admin/support/chats"],exact:!1}),m.invalidateQueries({queryKey:[`/api/support/chat/${s}`]}),p({title:"âœ… Assigned",description:"Chat assigned to you",duration:3e3})}}),F=re({mutationFn:v=>Y("PUT",`/api/support/chat/${v}/close`,{}),onSuccess:()=>{m.invalidateQueries({queryKey:["/api/admin/support/chats"],exact:!1}),a(null),p({title:"âœ… Chat Closed",description:"The chat has been closed",duration:3e3})}});o.useEffect(()=>{x.current&&(x.current.scrollTop=x.current.scrollHeight)},[b==null?void 0:b.messages]),o.useEffect(()=>{if(b!=null&&b.messages&&s){const v=b.messages.filter(U=>U.senderType==="user"&&!U.isRead);v.forEach(async U=>{try{await Y("PUT",`/api/support/message/${U.id}/read`,{})}catch(E){console.error("Failed to mark message as read:",E)}}),v.length>0&&m.invalidateQueries({queryKey:["/api/support/admin/unread-count"]})}},[b==null?void 0:b.messages,s,m]);const R=()=>{!t.trim()||!s||i.mutate(t)},P=v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),R())};return e.jsxs("div",{className:"flex h-screen bg-background",children:[c&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>d(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>d(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"lg:hidden border-b px-4 py-3 flex items-center justify-between bg-background",children:[e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>d(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Support Chat"}),j>0&&e.jsx(X,{variant:"destructive",className:"h-5 min-w-5 flex items-center justify-center px-1.5",children:j})]}),e.jsx("div",{className:"w-10"})," "]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 md:p-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6 hidden lg:block",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Support Chat"}),j>0&&e.jsxs(X,{variant:"destructive",className:"text-sm px-2.5 py-1",children:[j," New ",j===1?"Message":"Messages"]})]}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"Manage customer support conversations"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 h-[calc(100vh-140px)] md:h-[calc(100vh-200px)]",children:[e.jsxs(C,{className:"lg:col-span-1 max-h-[40vh] lg:max-h-none",children:[e.jsx($,{className:"border-b p-3 md:p-6",children:e.jsx(Hs,{value:l,onValueChange:v=>r(v),children:e.jsxs(qs,{className:"grid w-full grid-cols-2",children:[e.jsx(Ee,{value:"open",className:"text-xs md:text-sm data-[state=active]:bg-yellow-500 data-[state=active]:text-white data-[state=active]:font-medium data-[state=active]:shadow-sm",children:"Open"}),e.jsx(Ee,{value:"closed",className:"text-xs md:text-sm data-[state=active]:bg-yellow-500 data-[state=active]:text-white data-[state=active]:font-medium data-[state=active]:shadow-sm",children:"Closed"})]})})}),e.jsx(D,{className:"p-0",children:e.jsx(st,{className:"h-[calc(40vh-100px)] lg:h-[calc(100vh-340px)]",children:f?e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"Loading..."}):!h||h.length===0?e.jsxs("div",{className:"p-4 md:p-8 text-center text-muted-foreground",children:[e.jsx(Rs,{className:"h-8 w-8 md:h-12 md:w-12 mx-auto mb-3 opacity-50"}),e.jsxs("p",{className:"text-xs md:text-sm",children:["No ",l," chats"]})]}):e.jsx("div",{className:"divide-y",children:h.map(v=>e.jsxs("button",{onClick:()=>a(v.id),className:`w-full p-3 md:p-4 text-left hover:bg-muted/50 transition-colors ${s===v.id?"bg-muted":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm",children:v.userName})]}),v.status==="open"&&e.jsx(X,{variant:"default",className:"text-xs",children:"Open"})]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:v.userEmail}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-muted-foreground",children:[e.jsx(ze,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(v.lastMessageAt).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]},v.id))})})})]}),e.jsx(C,{className:"lg:col-span-2 flex flex-col min-h-[55vh] lg:min-h-0",children:!s||!b?e.jsx(D,{className:"flex-1 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(Rs,{className:"h-12 w-12 md:h-16 md:w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm md:text-base",children:"Select a chat to view conversation"})]})}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"border-b p-3 md:p-6",children:e.jsxs("div",{className:"flex items-start md:items-center justify-between gap-2 flex-col md:flex-row",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs(B,{className:"text-base md:text-lg flex items-center gap-2",children:[e.jsx(Ss,{className:"h-4 w-4 md:h-5 md:w-5 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:b.chat.userName})]}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mt-1 truncate",children:b.chat.userEmail})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap w-full md:w-auto",children:[!b.chat.assignedToAdminId&&b.chat.status==="open"&&e.jsx(g,{variant:"outline",size:"sm",onClick:()=>u.mutate(b.chat.id),disabled:u.isPending,className:"text-xs flex-1 md:flex-initial",children:"Assign to Me"}),b.chat.status==="open"&&e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>F.mutate(b.chat.id),disabled:F.isPending,className:"text-xs flex-1 md:flex-initial",children:[e.jsx(be,{className:"h-3 w-3 md:h-4 md:w-4 mr-1"}),"Close Chat"]}),b.chat.status==="closed"&&e.jsx(X,{variant:"secondary",className:"text-xs",children:"Closed"})]})]})}),e.jsx(D,{className:"flex-1 p-0 overflow-hidden",children:e.jsx(st,{className:"h-[calc(55vh-150px)] lg:h-[calc(100vh-380px)] p-3 md:p-4",ref:x,children:b.messages.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-8",children:e.jsx("p",{className:"text-xs md:text-sm",children:"No messages yet"})}):e.jsx("div",{className:"space-y-2 md:space-y-3",children:b.messages.map(v=>e.jsx("div",{className:`flex ${v.senderType==="admin"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] md:max-w-[80%] rounded-lg p-2 md:p-3 ${v.senderType==="admin"?"bg-primary text-primary-foreground":"bg-muted"}`,children:[v.senderType==="user"&&e.jsx("p",{className:"text-[10px] md:text-xs font-semibold mb-1 opacity-80",children:"Customer"}),e.jsx("p",{className:"text-xs md:text-sm whitespace-pre-wrap break-words",children:v.message}),e.jsx("p",{className:"text-[10px] md:text-xs opacity-70 mt-1",children:new Date(v.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},v.id))})})}),e.jsx("div",{className:"border-t p-3 md:p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{placeholder:"Type your message...",value:t,onChange:v=>n(v.target.value),onKeyPress:P,disabled:i.isPending||b.chat.status==="closed",className:"flex-1 text-sm"}),e.jsx(g,{onClick:R,disabled:!t.trim()||i.isPending||b.chat.status==="closed",size:"icon",className:"flex-shrink-0",children:e.jsx(Vr,{className:"h-4 w-4"})})]})})]})})]})]})]})]})}function Uc(s){const a=/(https?:\/\/[^\s]+)/g;return s.split(a).map((n,l)=>a.test(n)?e.jsxs("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-flex items-center gap-1",children:[n,e.jsx(nt,{className:"h-3 w-3"})]},l):n)}function zc(){const{toast:s}=he(),a=Fs(),[t,n]=o.useState(!1),[l,r]=o.useState({data_bundle_auto_processing:"false"}),[c,d]=o.useState([]),[x,p]=o.useState(null),[m,j]=o.useState({email:"",password:"",name:"",phone:""}),[h,f]=o.useState({title:"",message:""}),[b,i]=o.useState([]),{data:u}=V({queryKey:["/api/admin/settings"],refetchInterval:3e4}),{data:F}=V({queryKey:["/api/admin/users"],refetchInterval:3e4}),{data:R}=V({queryKey:["/api/admin/announcements"],refetchInterval:3e4}),P=re({mutationFn:async({key:k,value:S,description:A})=>Y("PUT",`/api/admin/settings/${k}`,{value:S,description:A}),onMutate:async({key:k,value:S})=>{await a.cancelQueries({queryKey:["/api/admin/settings"]});const A=a.getQueryData(["/api/admin/settings"]);return a.setQueryData(["/api/admin/settings"],W=>W&&W.map(_=>_.key===k?{..._,value:S}:_)),r(W=>({...W,[k]:S})),{previousSettings:A}},onError:(k,S,A)=>{if(A!=null&&A.previousSettings){a.setQueryData(["/api/admin/settings"],A.previousSettings);const W={};A.previousSettings.forEach(_=>{W[_.key]=_.value}),r(W)}s({title:"Failed to update setting",description:k.message,variant:"destructive"})},onSuccess:()=>{s({title:"Setting updated successfully"})},onSettled:()=>{a.invalidateQueries({queryKey:["/api/admin/settings"]})}}),v=re({mutationFn:async({userId:k,data:S})=>Y("PUT",`/api/admin/users/${k}/credentials`,S),onSuccess:()=>{a.invalidateQueries({queryKey:["/api/admin/users"]}),p(null),j({email:"",password:"",name:"",phone:""}),s({title:"User credentials updated successfully"})},onError:k=>{s({title:"Failed to update credentials",description:k.message,variant:"destructive"})}}),U=re({mutationFn:async k=>Y("POST","/api/admin/announcements",k),onSuccess:()=>{a.invalidateQueries({queryKey:["/api/admin/announcements"]}),f({title:"",message:""}),s({title:"Announcement created successfully"})},onError:k=>{s({title:"Failed to create announcement",description:k.message,variant:"destructive"})}}),E=re({mutationFn:async({id:k,isActive:S})=>Y("PATCH",`/api/admin/announcements/${k}`,{isActive:S}),onSuccess:()=>{a.invalidateQueries({queryKey:["/api/admin/announcements"]}),s({title:"Announcement updated successfully"})},onError:k=>{s({title:"Failed to update announcement",description:k.message,variant:"destructive"})}}),se=re({mutationFn:async k=>Y("DELETE",`/api/admin/announcements/${k}`),onSuccess:()=>{a.invalidateQueries({queryKey:["/api/admin/announcements"]}),s({title:"Announcement deleted successfully"})},onError:k=>{s({title:"Failed to delete announcement",description:k.message,variant:"destructive"})}});o.useEffect(()=>{if(u){const k={data_bundle_auto_processing:"false"};u.forEach(S=>{k[S.key]=S.value}),r(k)}},[u]),o.useEffect(()=>{F&&d(F)},[F]),o.useEffect(()=>{R&&i(R)},[R]);const ee=(k,S)=>{r(A=>({...A,[k]:S}))},le=(k,S)=>{const A=l[k];A!==void 0&&P.mutate({key:k,value:A,description:S})},w=k=>{p(k),j({email:k.email,password:"",name:k.name,phone:k.phone||""})},N=()=>{if(!x)return;const k={};if(m.email&&m.email!==x.email&&(k.email=m.email),m.password&&(k.password=m.password),m.name&&m.name!==x.name&&(k.name=m.name),m.phone!==x.phone&&(k.phone=m.phone),Object.keys(k).length===0){s({title:"No changes detected",variant:"destructive"});return}v.mutate({userId:x.id,data:k})},y=()=>{if(!h.title.trim()||!h.message.trim()){s({title:"Title and message are required",variant:"destructive"});return}U.mutate({title:h.title.trim(),message:h.message.trim()})},I=(k,S)=>{E.mutate({id:k,isActive:!S})},T=k=>{confirm("Are you sure you want to delete this announcement?")&&se.mutate(k)};return e.jsxs("div",{className:"flex h-screen bg-background",children:[t&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>n(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>n(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>n(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Settings"})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(et,{className:"h-5 w-5"}),"General Settings"]}),e.jsx(J,{children:"Configure basic application settings"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"appName",children:"Application Name"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{id:"appName",value:l.app_name||"",onChange:k=>ee("app_name",k.target.value),placeholder:"CLECTECH"}),e.jsx(g,{size:"sm",onClick:()=>le("app_name","Application name displayed in the UI"),disabled:P.isPending,children:e.jsx(St,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"supportEmail",children:"Support Email"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{id:"supportEmail",type:"email",autoComplete:"email",value:l.support_email||"",onChange:k=>ee("support_email",k.target.value),placeholder:"support@clectech.com"}),e.jsx(g,{size:"sm",onClick:()=>le("support_email","Support email for customer inquiries"),disabled:P.isPending,children:e.jsx(St,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"supportPhone",children:"Support Phone"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{id:"supportPhone",autoComplete:"tel",value:l.support_phone||"",onChange:k=>ee("support_phone",k.target.value),placeholder:"+233 XX XXX XXXX"}),e.jsx(g,{size:"sm",onClick:()=>le("support_phone","Support phone number"),disabled:P.isPending,children:e.jsx(St,{className:"h-4 w-4"})})]})]})]})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx($t,{className:"h-5 w-5"}),"User Credential Management"]}),e.jsx(J,{children:"Manage user credentials and account information"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs(z,{children:["Select User to Manage",e.jsxs("select",{className:"w-full p-2 border rounded-md mt-1",value:(x==null?void 0:x.id)||"",onChange:k=>{const S=c.find(A=>A.id===k.target.value);S&&w(S)},children:[e.jsx("option",{value:"",children:"Choose a user..."}),c.map(k=>e.jsxs("option",{value:k.id,children:[k.name," (",k.email,") - ",k.role]},k.id))]})]})}),x&&e.jsxs(e.Fragment,{children:[e.jsx(_t,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-medium",children:["Update Credentials for ",x.name]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"userEmail",children:"Email"}),e.jsx(K,{id:"userEmail",type:"email",autoComplete:"email",value:m.email,onChange:k=>j(S=>({...S,email:k.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"userName",children:"Name"}),e.jsx(K,{id:"userName",autoComplete:"name",value:m.name,onChange:k=>j(S=>({...S,name:k.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"userPhone",children:"Phone"}),e.jsx(K,{id:"userPhone",autoComplete:"tel",value:m.phone,onChange:k=>j(S=>({...S,phone:k.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"userPassword",children:"New Password (leave empty to keep current)"}),e.jsx(K,{id:"userPassword",type:"password",autoComplete:"new-password",value:m.password,onChange:k=>j(S=>({...S,password:k.target.value})),placeholder:"Enter new password"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{onClick:N,disabled:v.isPending,children:v.isPending?"Updating...":"Update Credentials"}),e.jsxs(g,{variant:"outline",onClick:()=>{p(null),j({email:"",password:"",name:"",phone:""})},children:[e.jsx(Ms,{className:"h-4 w-4 mr-2"}),"Cancel"]})]})]})]})]})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Jt,{className:"h-5 w-5"}),"Announcement Management"]}),e.jsx(J,{children:"Create and manage system announcements for users"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"announcementTitle",children:"Title"}),e.jsx(K,{id:"announcementTitle",value:h.title,onChange:k=>f(S=>({...S,title:k.target.value})),placeholder:"Announcement title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"announcementMessage",children:"Message"}),e.jsx("textarea",{id:"announcementMessage",className:"w-full p-2 border rounded-md resize-none",rows:3,value:h.message,onChange:k=>f(S=>({...S,message:k.target.value})),placeholder:"Announcement message"})]}),e.jsxs(g,{onClick:y,disabled:U.isPending,className:"gap-2",children:[e.jsx(hs,{className:"h-4 w-4"}),U.isPending?"Creating...":"Create Announcement"]})]}),e.jsx(_t,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Existing Announcements"}),b.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No announcements yet"}):e.jsx("div",{className:"space-y-2",children:b.map(k=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:k.title}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Uc(k.message)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["By ",k.createdBy," â€¢ ",new Date(k.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Os,{checked:k.isActive,onCheckedChange:()=>I(k.id,k.isActive),className:"data-[state=checked]:bg-green-500 data-[state=unchecked]:bg-red-500 [&_[data-radix-switch-thumb]]:bg-white"}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>T(k.id),className:"text-red-600 hover:text-red-700",children:e.jsx(Ts,{className:"h-4 w-4"})})]})]},k.id))})]})]})]})]})})]})]})}function _c(){const[s,a]=o.useState(!1),{data:t,isLoading:n}=V({queryKey:["/api/admin/rankings/customers"],refetchInterval:6e4}),l=r=>r===0?e.jsx(vs,{className:"h-5 w-5 text-yellow-500"}):r===1?e.jsx(ba,{className:"h-5 w-5 text-gray-400"}):r===2?e.jsx(ra,{className:"h-5 w-5 text-amber-600"}):e.jsxs("span",{className:"text-sm font-semibold text-muted-foreground",children:["#",r+1]});return e.jsxs("div",{className:"flex h-screen bg-background",children:[s&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>a(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>a(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Users Ranking"})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs(C,{children:[e.jsx($,{children:e.jsxs("div",{children:[e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(vs,{className:"h-5 w-5 text-yellow-500"}),"Top Customers"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Highest spending customers"})]})}),e.jsx(D,{children:n?e.jsx(us,{rows:10}):t&&t.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{className:"w-16",children:"Rank"}),e.jsx(O,{children:"Customer"}),e.jsx(O,{className:"text-right",children:"Total Spent"}),e.jsx(O,{className:"text-right",children:"Purchases"}),e.jsx(O,{className:"text-right",children:"Last Purchase"})]})}),e.jsx(Ze,{children:t.map((r,c)=>e.jsxs(fe,{children:[e.jsx(M,{className:"text-center",children:l(c)}),e.jsx(M,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:r.customerName||r.customerEmail}),r.customerPhone&&e.jsx("span",{className:"text-xs text-muted-foreground",children:r.customerPhone}),e.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:r.customerEmail})]})}),e.jsx(M,{className:"text-right",children:e.jsx("span",{className:"font-bold text-green-600 dark:text-green-400",children:ae(r.totalSpent)})}),e.jsx(M,{className:"text-right",children:e.jsxs(X,{variant:"secondary",children:[r.totalPurchases," ",r.totalPurchases===1?"order":"orders"]})}),e.jsx(M,{className:"text-right text-sm text-muted-foreground",children:Qe(r.lastPurchase)})]},r.rank))})]})}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(vs,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No customer rankings yet"}),e.jsx("p",{className:"text-sm",children:"Customer rankings will appear here once transactions are completed"})]})})]})})})]})]})}function Gc(){const{toast:s}=he(),a=Fs(),{user:t,isLoading:n}=je(),[l,r]=o.useState(!1),[c,d]=o.useState(!1),[x,p]=o.useState(""),{data:m}=V({queryKey:["/api/admin/break-settings"],enabled:!!t});o.useEffect(()=>{m&&(d(m.isEnabled),p(m.message))},[m]);const j=re({mutationFn:async f=>await Y("POST","/api/admin/break-settings",f),onSuccess:f=>{a.invalidateQueries({queryKey:["/api/admin/break-settings"]}),a.invalidateQueries({queryKey:["/api/break-settings"]}),s({title:"Settings Updated",description:`Site break mode ${f.isEnabled?"enabled":"disabled"} successfully.`})},onError:f=>{s({title:"Update Failed",description:f.message||"Failed to update break settings.",variant:"destructive"})}}),h=()=>{if(c&&!x.trim()){s({title:"Validation Error",description:"Please enter a message when enabling break mode.",variant:"destructive"});return}j.mutate({isEnabled:c,message:x.trim()})};return n?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"flex h-screen bg-background",children:[l&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>r(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>r(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>r(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(et,{className:"h-5 w-5"}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Break Settings"})]})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 lg:p-8",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-8",children:[e.jsx("div",{className:"p-6 border-2 border-gray-200 dark:border-gray-700 rounded-lg bg-red-500",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs(z,{className:"text-lg font-bold flex items-center gap-3 text-white",children:[e.jsx(js,{className:"h-6 w-6 text-white drop-shadow-lg"}),"Enable Break Mode"]}),e.jsx("p",{className:"text-base leading-relaxed text-white",children:"âš ï¸ When enabled, the site will be completely unavailable to all users except administrators"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 lg:gap-6",children:[e.jsx("span",{className:`px-4 py-2 rounded-full text-sm font-bold min-w-[100px] text-center ${c?"bg-red-500 text-white shadow-lg":"bg-green-500 text-white shadow-md"}`,children:c?"ðŸš« ENABLED":"âœ… DISABLED"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(z,{htmlFor:"break-mode-toggle",className:"text-sm font-medium text-white",children:c?"ON":"OFF"}),e.jsx(Os,{id:"break-mode-toggle",checked:c,onCheckedChange:d,disabled:j.isPending,className:"data-[state=checked]:bg-green-500 data-[state=unchecked]:bg-red-500 [&_[data-radix-switch-thumb]]:bg-white"})]})]})]})}),e.jsxs("div",{className:"space-y-4 p-4 bg-white rounded-lg border-2 border-gray-300 text-black",children:[e.jsx(z,{htmlFor:"break-message",className:"text-lg font-semibold",children:"Maintenance Message"}),e.jsx(bs,{id:"break-message",placeholder:"Enter a message to display to users when the site is in break mode...",value:x,onChange:f=>p(f.target.value),disabled:!c||j.isPending,rows:5,className:"resize-none text-base p-4 border-2 border-gray-400"}),e.jsx("p",{className:"text-sm text-black leading-relaxed",children:"This message will be displayed to users when they try to access the site. Keep it clear and informative about when the site will be available again."})]}),c&&x&&e.jsxs("div",{className:"space-y-4 p-6 bg-blue-50 dark:bg-blue-950/20 rounded-lg border-2 border-blue-200 dark:border-blue-800",children:[e.jsx(z,{className:"text-lg font-semibold text-blue-900 dark:text-blue-100",children:"Preview"}),e.jsx("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-inner",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(js,{className:"h-10 w-10 text-red-600 dark:text-red-400"})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Ms,{className:"h-3 w-3 text-white"})})]})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 dark:text-red-400 mb-3",children:"Site Closed"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap text-base leading-relaxed",children:x})]})]})})]}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-center sm:justify-end gap-4 pt-6 mt-6 border-t border-gray-200 dark:border-gray-700",children:e.jsx(g,{onClick:h,disabled:j.isPending,className:"min-w-40 h-12 text-lg font-semibold",size:"lg",children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"Saving Changes..."]}):e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"h-5 w-5 mr-3"}),"Save Settings"]})})})]})})]})]})}function Wc(){const{toast:s}=he(),[a,t]=o.useState(!1),[n,l]=o.useState([]),[r,c]=o.useState(!0),[d,x]=o.useState(!1),[p,m]=o.useState(null),[j,h]=o.useState(!1),[f,b]=o.useState(null),[i,u]=o.useState({name:"",provider:"",apiKey:"",apiSecret:"",endpoint:"",isActive:!0,isDefault:!1,networkMappings:JSON.stringify({mtn:"MTN",telecel:"TELECEL",at_bigtime:"AIRTELTIGO",at_ishare:"AIRTELTIGO",airteltigo:"AIRTELTIGO"},null,2)}),[F,R]=o.useState({});o.useEffect(()=>{P()},[]);const P=async()=>{try{const N=await Y("GET","/api/admin/external-providers");l(N)}catch(N){console.error("Failed to load providers:",N),s({title:"Error",description:"Failed to load external API providers",variant:"destructive"})}finally{c(!1)}},v=()=>{u({name:"",provider:"",apiKey:"",apiSecret:"",endpoint:"",isActive:!0,isDefault:!1,networkMappings:JSON.stringify({mtn:"MTN",telecel:"TELECEL",at_bigtime:"AIRTELTIGO",at_ishare:"AIRTELTIGO",airteltigo:"AIRTELTIGO"},null,2)}),m(null)},U=N=>{u({name:N.name,provider:N.provider,apiKey:N.apiKey,apiSecret:N.apiSecret,endpoint:N.endpoint,isActive:N.isActive,isDefault:N.isDefault,networkMappings:N.networkMappings||JSON.stringify({mtn:"MTN",telecel:"TELECEL",at_bigtime:"AIRTELTIGO",at_ishare:"AIRTELTIGO",airteltigo:"AIRTELTIGO"},null,2)}),m(N),x(!0)},E=async N=>{N.preventDefault(),h(!0);try{JSON.parse(i.networkMappings);const y={...i,networkMappings:i.networkMappings};p?(await Y("PUT",`/api/admin/external-providers/${p.id}`,y),s({title:"Success",description:"External API provider updated successfully"})):(await Y("POST","/api/admin/external-providers",y),s({title:"Success",description:"External API provider created successfully"})),x(!1),v(),P()}catch(y){console.error("Failed to save provider:",y),s({title:"Error",description:y.message||"Failed to save external API provider",variant:"destructive"})}finally{h(!1)}},se=async N=>{if(confirm("Are you sure you want to delete this external API provider?"))try{await Y("DELETE",`/api/admin/external-providers/${N}`),s({title:"Success",description:"External API provider deleted successfully"}),P()}catch(y){console.error("Failed to delete provider:",y),s({title:"Error",description:"Failed to delete external API provider",variant:"destructive"})}},ee=async N=>{try{await Y("POST",`/api/admin/external-providers/${N}/set-default`),s({title:"Success",description:"Default external API provider updated successfully"}),P()}catch(y){console.error("Failed to set default provider:",y),s({title:"Error",description:"Failed to set default external API provider",variant:"destructive"})}},le=async N=>{b(N.id);try{const y=await Y("GET",`/api/admin/external-balance?providerId=${N.id}`);y.success?s({title:"Test Successful",description:`Balance check successful for ${N.name}`}):s({title:"Test Failed",description:y.error||"Balance check failed",variant:"destructive"})}catch(y){s({title:"Test Failed",description:y.message||"Balance check failed",variant:"destructive"})}finally{b(null)}},w=N=>{R(y=>({...y,[N]:!y[N]}))};return r?e.jsxs("div",{className:"flex h-screen bg-background",children:[e.jsx(ye,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-lg",children:"Loading..."})})]}):e.jsxs("div",{className:"flex h-screen bg-background",children:[a&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>t(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-white border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>t(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>t(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"External API Providers"})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsx("p",{className:"text-muted-foreground",children:"Manage external API providers for data bundle purchases"}),e.jsxs(ts,{open:d,onOpenChange:x,children:[e.jsx(Ws,{asChild:!0,children:e.jsxs(g,{children:[e.jsx(hs,{className:"h-4 w-4 mr-2"}),"Add Provider"]})}),e.jsxs(_e,{className:"max-w-2xl max-h-[90vh] overflow-y-auto bg-black text-white border-gray-700",children:[e.jsxs(Ge,{children:[e.jsxs(We,{className:"text-white",children:[p?"Edit":"Add"," External API Provider"]}),e.jsx(As,{className:"text-gray-300",children:p?"Update the external API provider configuration.":"Configure a new external API provider for data bundle purchases."})]}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(z,{htmlFor:"name",className:"text-white",children:"Provider Name"}),e.jsx(K,{id:"name",value:i.name,onChange:N=>u({...i,name:N.target.value}),placeholder:"e.g., SkyTech GH",required:!0,className:"bg-gray-800 border-gray-600 text-white placeholder:text-gray-400"})]}),e.jsxs("div",{children:[e.jsx(z,{htmlFor:"provider",className:"text-white",children:"Provider Type"}),e.jsxs(Ae,{value:i.provider,onValueChange:N=>u({...i,provider:N}),children:[e.jsx(Pe,{className:"bg-gray-800 border-gray-600 text-white",children:e.jsx(Te,{placeholder:"Select provider type"})}),e.jsxs(Ce,{className:"bg-gray-800 border-gray-600",children:[e.jsx(H,{value:"skytech",className:"text-white hover:bg-gray-700",children:"SkyTech"}),e.jsx(H,{value:"other",className:"text-white hover:bg-gray-700",children:"Other"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(z,{htmlFor:"endpoint",className:"text-white",children:"API Endpoint"}),e.jsx(K,{id:"endpoint",value:i.endpoint,onChange:N=>u({...i,endpoint:N.target.value}),placeholder:"https://api.example.com/v1/orders",required:!0,className:"bg-gray-800 border-gray-600 text-white placeholder:text-gray-400"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(z,{htmlFor:"apiKey",className:"text-white",children:"API Key"}),e.jsx(K,{id:"apiKey",type:"password",value:i.apiKey,onChange:N=>u({...i,apiKey:N.target.value}),required:!0,className:"bg-gray-800 border-gray-600 text-white placeholder:text-gray-400"})]}),e.jsxs("div",{children:[e.jsx(z,{htmlFor:"apiSecret",className:"text-white",children:"API Secret"}),e.jsx(K,{id:"apiSecret",type:"password",value:i.apiSecret,onChange:N=>u({...i,apiSecret:N.target.value}),required:!0,className:"bg-gray-800 border-gray-600 text-white placeholder:text-gray-400"})]})]}),e.jsxs("div",{children:[e.jsx(z,{htmlFor:"networkMappings",className:"text-white",children:"Network Mappings (JSON)"}),e.jsx(bs,{id:"networkMappings",value:i.networkMappings,onChange:N=>u({...i,networkMappings:N.target.value}),placeholder:'{"mtn": "MTN", "telecel": "TELECEL"}',rows:6,required:!0,className:"bg-gray-800 border-gray-600 text-white placeholder:text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:"JSON mapping of internal network names to external API network codes"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Os,{id:"isActive",checked:i.isActive,onCheckedChange:N=>u({...i,isActive:N}),className:"data-[state=checked]:bg-green-500 data-[state=unchecked]:bg-red-500 [&_[data-radix-switch-thumb]]:bg-white"}),e.jsx(z,{htmlFor:"isActive",className:"text-white",children:"Active"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Os,{id:"isDefault",checked:i.isDefault,onCheckedChange:N=>u({...i,isDefault:N}),className:"data-[state=checked]:bg-green-500 data-[state=unchecked]:bg-red-500 [&_[data-radix-switch-thumb]]:bg-white"}),e.jsx(z,{htmlFor:"isDefault",className:"text-white",children:"Set as Default"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 pt-4",children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>x(!1),className:"w-full sm:w-auto border-gray-600 text-white hover:bg-gray-700",children:"Cancel"}),e.jsx(g,{type:"submit",disabled:j,className:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white",children:j?"Saving...":p?"Update":"Create"})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 lg:gap-6",children:n.map(N=>e.jsxs(C,{className:"relative bg-black text-white",children:[e.jsx($,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"text-lg flex items-center space-x-2 flex-wrap text-white",children:[e.jsx("span",{className:"truncate",children:N.name}),N.isDefault&&e.jsxs(X,{variant:"default",className:"text-xs shrink-0 bg-yellow-500 text-black",children:[e.jsx(En,{className:"h-3 w-3 mr-1"}),"Default"]}),!N.isActive&&e.jsx(X,{variant:"secondary",className:"text-xs shrink-0 bg-gray-600 text-white",children:"Inactive"})]}),e.jsxs("div",{className:"flex space-x-1 shrink-0",children:[e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>le(N),disabled:f===N.id,title:"Test Provider",className:"h-8 w-8",children:e.jsx(Rn,{className:`h-4 w-4 ${f===N.id?"animate-pulse":""}`})}),!N.isDefault&&e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>ee(N.id),title:"Set as Default",className:"h-8 w-8",children:e.jsx(Ln,{className:"h-4 w-4"})}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>U(N),title:"Edit Provider",className:"h-8 w-8",children:e.jsx(va,{className:"h-4 w-4"})}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>se(N.id),title:"Delete Provider",className:"text-destructive hover:text-destructive h-8 w-8",children:e.jsx(Ts,{className:"h-4 w-4"})})]})]})}),e.jsxs(D,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(z,{className:"text-sm font-medium text-gray-300",children:"Provider Type"}),e.jsx("p",{className:"text-sm text-white",children:N.provider})]}),e.jsxs("div",{children:[e.jsx(z,{className:"text-sm font-medium text-gray-300",children:"Endpoint"}),e.jsx("p",{className:"font-mono break-all text-xs text-white",children:N.endpoint})]}),e.jsxs("div",{children:[e.jsx(z,{className:"text-sm font-medium text-gray-300",children:"API Key"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{value:F[N.id]?N.apiKey:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",readOnly:!0,className:"font-mono h-8 text-xs bg-gray-800 border-gray-600 text-white"}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>w(N.id),className:"h-8 w-8 shrink-0 text-white hover:bg-gray-700",children:F[N.id]?e.jsx(Js,{className:"h-4 w-4"}):e.jsx(Zs,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx(z,{className:"text-sm font-medium text-gray-300",children:"Network Mappings"}),e.jsx("div",{className:"text-xs bg-gray-800 p-2 rounded max-h-20 overflow-y-auto border border-gray-600",children:e.jsx("pre",{className:"whitespace-pre-wrap break-words text-white",children:N.networkMappings||"{}"})})]})]})]},N.id))}),n.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No external API providers configured"}),e.jsx("p",{className:"text-sm",children:"Add your first provider to enable external data bundle purchases"})]})})]})})]})]})}function _a(s){const a=/(https?:\/\/[^\s]+)/g;return s.split(a).map((n,l)=>a.test(n)?e.jsxs("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-flex items-center gap-1",children:[n,e.jsx(nt,{className:"h-3 w-3"})]},l):n)}function Kc(){const{toast:s}=he(),[a,t]=o.useState(!1),[n,l]=o.useState({title:"",message:""}),[r,c]=o.useState(null),{data:d,isLoading:x}=V({queryKey:["/api/admin/announcements"],refetchInterval:3e4}),p=re({mutationFn:i=>Y("POST","/api/admin/announcements",i),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/announcements"]}),s({title:"âœ… Announcement created successfully"}),l({title:"",message:""})},onError:i=>{s({title:"Failed to create announcement",description:i.message,variant:"destructive"})}}),m=re({mutationFn:({id:i,isActive:u})=>Y("PATCH",`/api/admin/announcements/${i}`,{isActive:u}),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/announcements"]}),s({title:"âœ… Announcement updated successfully"})},onError:i=>{s({title:"Failed to update announcement",description:i.message,variant:"destructive"})}}),j=re({mutationFn:i=>Y("DELETE",`/api/admin/announcements/${i}`,{}),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/announcements"]}),s({title:"âœ… Announcement deleted successfully"}),c(null)},onError:i=>{s({title:"Failed to delete announcement",description:i.message,variant:"destructive"})}}),h=()=>{if(!n.title.trim()||!n.message.trim()){s({title:"Validation Error",description:"Please fill in both title and message",variant:"destructive"});return}p.mutate(n)},f=(d==null?void 0:d.filter(i=>i.isActive))||[],b=(d==null?void 0:d.filter(i=>!i.isActive))||[];return e.jsxs("div",{className:"flex h-screen bg-background",children:[a&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>t(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>t(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>t(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Announcements"})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(hs,{className:"h-5 w-5"}),"Create New Announcement"]}),e.jsx(J,{children:"Create announcements that will be shown to all registered users when they login"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"title",children:"Title"}),e.jsx(bs,{id:"title",value:n.title,onChange:i=>l({...n,title:i.target.value}),placeholder:"Enter announcement title",rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"message",children:"Message"}),e.jsx(bs,{id:"message",value:n.message,onChange:i=>l({...n,message:i.target.value}),placeholder:"Enter announcement message",rows:4})]}),e.jsx(g,{onClick:h,disabled:p.isPending,className:"w-full",children:p.isPending?"Creating...":"Create Announcement"})]})]}),f.length>0&&e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Zs,{className:"h-5 w-5 text-green-600"}),"Active Announcements (",f.length,")"]}),e.jsx(J,{children:"These announcements are currently visible to users"})]}),e.jsx(D,{children:e.jsx("div",{className:"space-y-3 md:space-y-4",children:f.map(i=>e.jsx("div",{className:"border rounded-lg p-3 md:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm md:text-base leading-tight",children:i.title}),e.jsx("div",{className:"text-muted-foreground mt-1 md:mt-2 text-xs md:text-sm leading-relaxed",children:_a(i.message)}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-2 md:mt-3 text-xs md:text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Created: ",Qe(i.createdAt)]}),e.jsx(X,{variant:"secondary",className:"bg-green-100 text-green-800 text-xs w-fit",children:"Active"})]})]}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-shrink-0",children:[e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>m.mutate({id:i.id,isActive:!1}),disabled:m.isPending,className:"h-8 w-8 p-0 sm:h-9 sm:w-auto sm:px-3",children:[e.jsx(Js,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"sr-only sm:not-sr-only sm:ml-1",children:"Hide"})]}),e.jsxs(g,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive h-8 w-8 p-0 sm:h-9 sm:w-auto sm:px-3",onClick:()=>c(i.id),children:[e.jsx(Ts,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"sr-only sm:not-sr-only sm:ml-1",children:"Delete"})]})]})]})},i.id))})})]}),b.length>0&&e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Js,{className:"h-5 w-5 text-muted-foreground"}),"Inactive Announcements (",b.length,")"]}),e.jsx(J,{children:"These announcements are hidden from users"})]}),e.jsx(D,{children:e.jsx("div",{className:"space-y-3 md:space-y-4",children:b.map(i=>e.jsx("div",{className:"border rounded-lg p-3 md:p-4 opacity-75",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm md:text-base leading-tight",children:i.title}),e.jsx("div",{className:"text-muted-foreground mt-1 md:mt-2 text-xs md:text-sm leading-relaxed",children:_a(i.message)}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-2 md:mt-3 text-xs md:text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Created: ",Qe(i.createdAt)]}),e.jsx(X,{variant:"outline",className:"w-fit",children:"Inactive"})]})]}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-shrink-0",children:[e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>m.mutate({id:i.id,isActive:!0}),disabled:m.isPending,className:"h-8 w-8 p-0 sm:h-9 sm:w-auto sm:px-3",children:[e.jsx(Zs,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"sr-only sm:not-sr-only sm:ml-1",children:"Show"})]}),e.jsxs(g,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive h-8 w-8 p-0 sm:h-9 sm:w-auto sm:px-3",onClick:()=>c(i.id),children:[e.jsx(Ts,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"sr-only sm:not-sr-only sm:ml-1",children:"Delete"})]})]})]})},i.id))})})]}),(d==null?void 0:d.length)===0&&!x&&e.jsx(C,{children:e.jsxs(D,{className:"text-center py-12",children:[e.jsx(Jt,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Announcements Yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Create your first announcement to communicate with users"})]})})]})})]}),e.jsx(At,{open:!!r,onOpenChange:i=>!i&&c(null),children:e.jsxs(ot,{children:[e.jsxs(mt,{children:[e.jsx(ht,{children:"Delete Announcement"}),e.jsx(ut,{children:"Are you sure you want to delete this announcement? This action cannot be undone."})]}),e.jsxs(xt,{children:[e.jsx(jt,{children:"Cancel"}),e.jsx(pt,{onClick:()=>r&&j.mutate(r),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})}function Hc(){const{toast:s}=he(),[a,t]=o.useState(!1),[n,l]=o.useState({title:"",description:"",category:"guest",url:"",provider:void 0,isPublished:!0}),[r,c]=o.useState(null),{data:d}=V({queryKey:["/api/admin/guides"]}),x=re({mutationFn:h=>Y("POST","/api/admin/guides",h),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/guides"]}),s({title:"âœ… Guide created successfully"}),l({title:"",description:"",category:"guest",url:"",provider:void 0,isPublished:!0})},onError:h=>{s({title:"Failed to create guide",description:h.message,variant:"destructive"})}}),p=re({mutationFn:({id:h,data:f})=>Y("PATCH",`/api/admin/guides/${h}`,f),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/guides"]}),s({title:"âœ… Guide updated successfully"})},onError:h=>{s({title:"Failed to update guide",description:h.message,variant:"destructive"})}}),m=re({mutationFn:h=>Y("DELETE",`/api/admin/guides/${h}`,{}),onSuccess:()=>{ke.invalidateQueries({queryKey:["/api/admin/guides"]}),s({title:"âœ… Guide deleted successfully"}),c(null)},onError:h=>{s({title:"Failed to delete guide",description:h.message,variant:"destructive"})}}),j=()=>{var h,f;if(!((h=n.title)!=null&&h.trim())||!((f=n.url)!=null&&f.trim())||!n.category){s({title:"Validation Error",description:"Please fill in title, URL and category",variant:"destructive"});return}x.mutate(n)};return e.jsxs("div",{className:"flex h-screen bg-background",children:[a&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>t(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(ye,{onClose:()=>t(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(ye,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>t(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Video Guides"})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(hs,{className:"h-5 w-5"}),"Add New Guide"]}),e.jsxs(J,{children:["You can use any YouTube/Vimeo URL - it will be automatically converted to embed format.",e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-1 block",children:"âœ… Supported: youtube.com/watch, youtube.com/shorts, youtu.be, vimeo.com, or direct MP4 links"})]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"title",children:"Title"}),e.jsx(K,{id:"title",value:n.title||"",onChange:h=>l({...n,title:h.target.value}),placeholder:"Guide title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"category",children:"Category"}),e.jsxs(Ae,{value:n.category,onValueChange:h=>l({...n,category:h}),children:[e.jsx(Pe,{id:"category",children:e.jsx(Te,{placeholder:"Select category"})}),e.jsxs(Ce,{children:[e.jsx(H,{value:"guest",children:"Guest"}),e.jsx(H,{value:"customer",children:"Customer"}),e.jsx(H,{value:"agent",children:"Agent"})]})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(z,{htmlFor:"url",children:"Video URL"}),e.jsx(K,{id:"url",value:n.url||"",onChange:h=>l({...n,url:h.target.value}),placeholder:"Paste any YouTube or Vimeo link (e.g., youtube.com/watch?v=xxx or youtube.com/shorts/xxx)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"The URL will be automatically converted to the correct embed format"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(z,{htmlFor:"description",children:"Description"}),e.jsx(bs,{id:"description",value:n.description||"",onChange:h=>l({...n,description:h.target.value}),placeholder:"Optional description",rows:3})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Os,{id:"published",checked:n.isPublished??!0,onCheckedChange:h=>l({...n,isPublished:h})}),e.jsx(z,{htmlFor:"published",children:"Published"})]})]}),e.jsx(g,{onClick:j,disabled:x.isPending,className:"w-full",children:x.isPending?"Creating...":"Create Guide"})]})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ja,{className:"h-5 w-5"}),"All Guides (",(d==null?void 0:d.length)||0,")"]}),e.jsx(J,{children:"Manage visibility and update details."})]}),e.jsx(D,{children:e.jsx("div",{className:"space-y-3",children:(d||[]).map(h=>e.jsx("div",{className:"border rounded-lg p-3 md:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{variant:"secondary",className:"capitalize",children:h.category}),h.isPublished?e.jsx(X,{variant:"secondary",className:"bg-green-100 text-green-800 text-xs",children:"Published"}):e.jsx(X,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 text-xs",children:"Draft"})]}),e.jsx("h3",{className:"font-semibold text-sm md:text-base leading-tight mt-1",children:h.title}),h.description&&e.jsx("div",{className:"text-muted-foreground mt-1 text-xs md:text-sm leading-relaxed",children:h.description}),h.createdAt&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["Created: ",Qe(h.createdAt)]})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0 items-center",children:[e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>p.mutate({id:h.id,data:{isPublished:!h.isPublished}}),disabled:p.isPending,children:[h.isPublished?e.jsx(Js,{className:"h-4 w-4"}):e.jsx(Zs,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1 hidden sm:inline",children:h.isPublished?"Unpublish":"Publish"})]}),e.jsxs(g,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>c(h.id),children:[e.jsx(Ts,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1 hidden sm:inline",children:"Delete"})]})]})]})},h.id))})})]})]})})]}),e.jsx(At,{open:!!r,onOpenChange:h=>!h&&c(null),children:e.jsxs(ot,{children:[e.jsxs(mt,{children:[e.jsx(ht,{children:"Delete Guide"}),e.jsx(ut,{children:"This action cannot be undone. This will permanently delete the guide."})]}),e.jsxs(xt,{children:[e.jsx(jt,{children:"Cancel"}),e.jsx(pt,{onClick:()=>r&&m.mutate(r),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})}function Vc(){const[s,a]=o.useState(!1);je();const{data:t,isLoading:n}=V({queryKey:["/api/rankings/customers"],refetchInterval:6e4}),l=r=>r===0?e.jsx(vs,{className:"h-5 w-5 text-yellow-500"}):r===1?e.jsx(ba,{className:"h-5 w-5 text-gray-400"}):r===2?e.jsx(ra,{className:"h-5 w-5 text-amber-600"}):e.jsxs("span",{className:"text-sm font-semibold text-muted-foreground",children:["#",r+1]});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background",children:[e.jsx("header",{className:"border-b",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between h-16 px-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>a(!0),children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Users Ranking"})]}),e.jsx(Ne,{})]})}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(C,{children:[e.jsx($,{children:e.jsxs("div",{children:[e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(vs,{className:"h-5 w-5 text-yellow-500"}),"Top Customers"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Highest spending customers"})]})}),e.jsx(D,{children:n?e.jsx(us,{rows:10}):t&&t.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{className:"w-16",children:"Rank"}),e.jsx(O,{children:"Customer"}),e.jsx(O,{className:"text-right",children:"Purchases"}),e.jsx(O,{className:"text-right",children:"Total Spent"})]})}),e.jsx(Ze,{children:t.map((r,c)=>e.jsxs(fe,{children:[e.jsx(M,{className:"text-center",children:l(c)}),e.jsx(M,{children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium",children:r.displayName}),r.displayPhone&&e.jsx("span",{className:"text-xs text-muted-foreground",children:r.displayPhone})]})}),e.jsx(M,{className:"text-right font-medium",children:r.totalPurchases}),e.jsxs(M,{className:"text-right font-medium",children:["â‚µ",r.totalSpent.toFixed(2)]})]},r.rank))})]})}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(vs,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No customer rankings yet"}),e.jsx("p",{className:"text-sm",children:"Customer rankings will appear here once transactions are completed"})]})})]})})})]})}const Yc={mtn:{name:"MTN",logo:ft},telecel:{name:"Telecel",logo:Nt},airteltigo:{name:"AirtelTigo",logo:cs},at_bigtime:{name:"AT BIG TIME",logo:cs},at_ishare:{name:"AT iShare",logo:cs}},Qc=Z.object({customerPhone:Z.string().min(10,"Phone number must be exactly 10 digits").max(10,"Phone number must be exactly 10 digits").regex(/^0[0-9]{9}$/,"Phone number must start with 0 and be 10 digits (e.g., 0241234567)"),customerEmail:Z.string().email("Invalid email")}),Xc=Z.object({phoneNumbers:Z.string().min(10,"Enter at least one phone number with GB amount").refine(s=>s.split(/\n/).map(t=>t.trim()).filter(t=>t).every(t=>{const n=t.split(/\s+/);if(n.length!==2)return!1;let l=n[0].replace(/^\+/,"");l.startsWith("233")&&(l="0"+l.substring(3));const r=/^0[0-9]{9}$/.test(l),c=parseFloat(n[1]),d=!isNaN(c)&&c>0;return r&&d}),"Each line must have format: phone_number GB_amount (e.g., '0241234567 2' or '233241234567 2')"),customerEmail:Z.string().email("Invalid email")});function Jc(){var le;const{role:s,slug:a,network:t}=Dt(),[,n]=Ke(),{toast:l}=he(),[r,c]=o.useState(""),[d,x]=o.useState(!1),[p,m]=o.useState("single"),j=o.useRef(!1);o.useEffect(()=>{t==="at_ishare"&&p==="bulk"&&m("single")},[t,p]),o.useEffect(()=>{const w=()=>{n(`/store/${s}/${a}`)};return window.addEventListener("popstate",w),()=>window.removeEventListener("popstate",w)},[s,a,n]);const h=Yc[t||""]||{name:"Unknown",logo:""},{data:f,isLoading:b}=V({queryKey:[`/api/store/${s}/${a}`],enabled:!!s&&!!a}),i=(f==null?void 0:f.dataBundles)||[],u=i==null?void 0:i.filter(w=>w.network===t&&w.isActive),F=u==null?void 0:u.sort((w,N)=>parseFloat(w.price)-parseFloat(N.price)),R=F==null?void 0:F.find(w=>w.id===r),P=R?parseFloat(R.price):0,v=gs({resolver:fs(Qc),defaultValues:{customerPhone:"",customerEmail:""}}),U=gs({resolver:fs(Xc),defaultValues:{phoneNumbers:"",customerEmail:""}}),E=o.useMemo(()=>{const w=U.watch("phoneNumbers");if(!(w!=null&&w.trim())||!F||!(f!=null&&f.store))return{total:0,count:0};const N=w.split(`
`).filter(T=>T.trim());let y=0,I=0;for(const T of N){const k=T.trim().split(/\s+/);if(k.length===2){const S=parseFloat(k[1]);if(!isNaN(S)&&S>0){const A=F.find(W=>{const _=W.dataAmount.match(/(\d+(?:\.\d+)?)\s*gb/i);return _?parseFloat(_[1])===S:!1});if(A){const W=parseFloat(A.price);y+=W,I++}}}}return{total:y,count:I}},[U.watch("phoneNumbers"),F,f==null?void 0:f.store]),se=re({mutationFn:async w=>{console.log("[Agent Frontend] Payment mutation called with:",w);const N="phoneNumbers"in w;if("orderItems"in w&&w.orderItems){const T=w.orderItems.map(W=>W.phone),k=w.totalAmount;console.log("[Agent Frontend] ========== NEW BULK FORMAT PAYMENT =========="),console.log("[Agent Frontend] Order items:",w.orderItems),console.log("[Agent Frontend] Total amount:",k),console.log("[Agent Frontend] ================================================");const S={productType:"data_bundle",network:t,customerPhone:T[0],isBulkOrder:!0,orderItems:w.orderItems,totalAmount:k,customerEmail:w.customerEmail||void 0,agentSlug:a||void 0};console.log("[Agent Frontend] Paystack payload:",JSON.stringify(S,null,2));const A=await Y("POST","/api/checkout/initialize",S);return console.log("[Agent Frontend] ===== SERVER RESPONSE ====="),console.log("[Agent Frontend] Result:",A),console.log("[Agent Frontend] ================================"),A}if(!R)throw new Error("No bundle selected");console.log("[Agent Frontend] Is bulk:",N),console.log("[Agent Frontend] Data:",w);const y=N?w.phoneNumbers.split(/[\n,]/).map(T=>T.trim()).filter(T=>T):[w.customerPhone];console.log("[Agent Frontend] Phone numbers array:",y),console.log("[Agent Frontend] First phone:",y[0]);const I={productType:"data_bundle",productId:R.id,customerPhone:y[0],phoneNumbers:N?y:void 0,isBulkOrder:N,customerEmail:w.customerEmail||void 0,agentSlug:a||void 0};return console.log("[Agent Frontend] Single/Legacy payload:",JSON.stringify(I,null,2)),await Y("POST","/api/checkout/initialize",I)},onSuccess:w=>{j.current=!1,localStorage.setItem("agentStorefront",JSON.stringify({role:s,slug:a,network:t})),window.location.href=w.paymentUrl},onError:w=>{j.current=!1,l({title:"âŒ Payment Failed",description:w.message||"Unable to process payment",variant:"destructive"}),x(!1)}}),ee=w=>{if(j.current)return;if(j.current=!0,x(!0),!("phoneNumbers"in w)){if(!R){l({title:"No Bundle Selected",description:"Please select a data bundle to continue",variant:"destructive"});return}let W=w.customerPhone.trim();W=W.replace(/^\+/,""),W.startsWith("233")&&(W="0"+W.substring(3));const _=$s(W),te=Ks(_,R.network);if(!te.isValid){const ie=ns(R.network);l({title:"âŒ Phone Number Mismatch",description:te.error||`Valid prefixes: ${ie.join(", ")}`,variant:"destructive",duration:8e3});return}x(!0),se.mutate({customerPhone:_,customerEmail:w.customerEmail});return}const y=w;if(!y.phoneNumbers.trim()){l({title:"Missing Information",description:"Please enter phone numbers with GB amounts",variant:"destructive"});return}const I=y.phoneNumbers.split(`
`).filter(W=>W.trim()),T=[];for(const W of I){const _=W.trim().split(/\s+/);if(_.length!==2){l({title:"âŒ Invalid Format",description:`Line "${W}" must have format: phone_number GB_amount (e.g., "0241234567 2")`,variant:"destructive",duration:8e3});return}let te=_[0];const ie=parseFloat(_[1]);if(isNaN(ie)||ie<=0){l({title:"âŒ Invalid GB Amount",description:`GB amount "${_[1]}" must be a positive number`,variant:"destructive",duration:8e3});return}te=te.replace(/^\+/,""),te.startsWith("233")&&(te="0"+te.substring(3));const q=$s(te),ne=Ks(q);if(!ne.isValid){const ve=ns(t||"");l({title:"âŒ Phone Number Mismatch",description:`${te}: ${ne.error||`Valid prefixes: ${ve.join(", ")}`}`,variant:"destructive",duration:8e3});return}T.push({phone:q,gb:ie})}if(T.length===0){l({title:"No Data",description:"Please enter at least one phone number with GB amount",variant:"destructive"});return}if(new Set(T.map(W=>W.phone)).size!==T.length){l({title:"Duplicate Numbers",description:"Phone numbers must be unique",variant:"destructive"});return}const S=[];let A=0;for(const W of T){const _=F==null?void 0:F.find(ie=>{const q=ie.dataAmount.match(/(\d+(?:\.\d+)?)\s*gb/i);return q?parseFloat(q[1])===W.gb:!1});if(!_){l({title:"âŒ Bundle Not Found",description:`No ${W.gb}GB bundle available for ${h.name}. Please check available bundles.`,variant:"destructive",duration:8e3});return}const te=parseFloat(_.price);S.push({phone:W.phone,bundleId:_.id,bundleName:_.name,price:te}),A+=te}console.log("[Agent Frontend] Prepared order items:",S),console.log("[Agent Frontend] Total amount:",A),x(!0),se.mutate({orderItems:S,totalAmount:A,customerEmail:y.customerEmail})};return b?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):f!=null&&f.store?e.jsxs("div",{className:"fixed inset-0 flex flex-col bg-background",children:[e.jsx("header",{className:"flex-none sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsxs("div",{className:"container flex h-16 items-center justify-between px-4",children:[e.jsx(G,{href:`/store/${s}/${a}`,children:e.jsxs(g,{variant:"ghost",className:"gap-2",children:[e.jsx(Ft,{className:"h-4 w-4"}),"Back"]})}),e.jsx("h1",{className:"text-xl font-bold truncate mx-4",children:f==null?void 0:f.store.businessName}),e.jsx("div",{className:"w-20"})," "]})}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"py-8 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-4xl pb-12",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[h.logo&&e.jsx("img",{src:h.logo,alt:h.name,className:"w-16 h-16 object-contain rounded-lg"}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[h.name," Data Bundles"]}),e.jsx("p",{className:"text-muted-foreground",children:"Complete your purchase below"})]})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5"}),"Complete Your Purchase"]}),e.jsx(J,{children:"Enter order details and checkout"})]}),e.jsx(D,{className:"space-y-6",children:e.jsxs(Hs,{value:p,onValueChange:w=>{m(w)},className:"w-full",children:[e.jsxs(qs,{className:"grid w-full grid-cols-2",children:[e.jsxs(Ee,{value:"single",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(ys,{className:"h-4 w-4 mr-2"}),"Single Purchase"]}),e.jsxs(Ee,{value:"bulk",disabled:t==="at_ishare",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Bulk Purchase",t==="at_ishare"&&e.jsx("span",{className:"text-xs text-muted-foreground ml-1",children:"(Disabled)"})]})]}),t==="at_ishare"&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Bulk purchases are not available for AT iShare network."}),e.jsx(Be,{value:"single",className:"space-y-4 mt-4",children:e.jsx(ws,{...v,children:e.jsxs("form",{onSubmit:v.handleSubmit(ee),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Select Data Bundle"}),e.jsxs(Ae,{value:r,onValueChange:w=>{c(w)},children:[e.jsx(Pe,{className:"w-full",children:e.jsx(Te,{placeholder:"Choose a data bundle..."})}),e.jsx(Ce,{children:F==null?void 0:F.map(w=>e.jsxs(H,{value:w.id,children:[w.name," - ",w.validity," - ",ae(parseFloat(w.price))]},w.id))})]})]}),e.jsx(me,{control:v.control,name:"customerPhone",render:({field:w})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Beneficiary Number *"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(It,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(K,{placeholder:"0241234567",className:"pl-10",...w})]})}),e.jsxs(ss,{children:["Network prefixes: ",ns(t||"").join(", ")]}),e.jsx(oe,{})]})}),e.jsx(me,{control:v.control,name:"customerEmail",render:({field:w})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Email *"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(K,{type:"email",placeholder:"your@email.com",className:"pl-10",...w})]})}),e.jsx(ss,{children:"Required for receipt and order updates"}),e.jsx(oe,{})]})}),e.jsxs("div",{className:"pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 p-4 bg-muted rounded-lg",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Total Amount:"}),e.jsx("span",{className:"text-2xl font-bold text-primary",children:ae(P)})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx(z,{className:"text-base font-semibold",children:"Payment Method"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs("div",{className:"p-4 border-2 border-blue-500 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-center",children:[e.jsx(Me,{className:"h-6 w-6 mx-auto mb-2 text-blue-600"}),e.jsx("div",{className:"font-semibold",children:"Paystack"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Pay with card/mobile money"})]})})]}),e.jsx(g,{type:"submit",className:"w-full gap-2",size:"lg",disabled:d||!r,children:d?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-5 w-5 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"h-5 w-5"}),"Proceed to Payment"]})})]})]})})}),e.jsx(Be,{value:"bulk",className:"space-y-4 mt-4",children:e.jsx(ws,{...U,children:e.jsxs("form",{onSubmit:U.handleSubmit(ee),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(z,{htmlFor:"bulk-phones",children:"Beneficiary Numbers and GB Amounts"}),U.watch("phoneNumbers")&&U.watch("phoneNumbers").trim()&&e.jsxs(X,{variant:"outline",className:"text-xs",children:[U.watch("phoneNumbers").split(`
`).filter(w=>w.trim()).length," entries"]})]}),e.jsx(me,{control:U.control,name:"phoneNumbers",render:({field:w})=>e.jsxs(ce,{children:[e.jsx(de,{children:e.jsx(bs,{id:"bulk-phones",placeholder:`0546591622 1
0247064874 3
0245696072 2
233547897522 10
...add as many as you need (no limit)`,rows:20,className:"font-mono text-sm",...w})}),e.jsxs(ss,{className:"text-xs",children:['Enter one number per line with GB amount (e.g., "0241234567 2" for 2GB). Supports formats: 0241234567 or 233241234567 (no + sign).',e.jsx("strong",{className:"text-green-600",children:"âœ“ No limit - add 100+ numbers!"}),e.jsx("br",{}),"All numbers must be for ",e.jsx("strong",{children:h.name})," network. Valid prefixes: ",e.jsx("strong",{children:ns(t||"").join(", ")})]}),e.jsx(oe,{})]})})]}),e.jsx(me,{control:U.control,name:"customerEmail",render:({field:w})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Email *"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Pt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(K,{type:"email",placeholder:"your@email.com",className:"pl-10",...w})]})}),e.jsx(ss,{children:"Required for receipt and order updates"}),e.jsx(oe,{})]})}),E&&E.count>0&&e.jsx("div",{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between mb-4 p-4 bg-muted rounded-lg",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Total Amount:"}),e.jsx("span",{className:"text-2xl font-bold text-primary",children:ae(E.total)})]})}),e.jsx(g,{type:"submit",className:"w-full gap-2",size:"lg",disabled:d||!((le=U.watch("phoneNumbers"))!=null&&le.trim()),children:d?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-5 w-5 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"h-5 w-5"}),E?e.jsxs(e.Fragment,{children:["Pay ",ae(E.total)," with Paystack"]}):"Purchase Data Bundles"]})})]})})})]})})]}),e.jsxs("div",{className:"mt-8 space-y-4",children:[e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ze,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Data Delivery Time"}),e.jsx("p",{className:"text-muted-foreground",children:"All data orders are delivered within 5â€“45 minutes. Please note that delivery times may vary during network downtime"})]})]})}),e.jsx(C,{className:"p-6 border-red-200 bg-white text-black dark:bg-black dark:text-white dark:border-red-600",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ct,{className:"h-5 w-5 text-red-600 dark:text-red-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 text-red-900 dark:text-red-100",children:"Our DATA REQUEST DOES NOT support:"}),e.jsxs("ul",{className:"text-red-800 dark:text-red-200 space-y-1 ml-4 opacity-90",children:[e.jsx("li",{children:"â€¢ Turbonet SIM"}),e.jsx("li",{children:"â€¢ Merchant SIM"}),e.jsx("li",{children:"â€¢ EVD SIM"}),e.jsx("li",{children:"â€¢ Broadband SIM"}),e.jsx("li",{children:"â€¢ Blacklisted SIM"}),e.jsx("li",{children:"â€¢ Roaming SIM"}),e.jsx("li",{children:"â€¢ Different Network"}),e.jsx("li",{children:"â€¢ Wrong Number"}),e.jsx("li",{children:"â€¢ Inactive Number"})]}),e.jsx("p",{className:"text-red-800 dark:text-red-200 font-medium mt-3 opacity-95",children:"Important Notice: Any data transferred to the above SIM types is burnt and irreversible."})]})]})}),e.jsx(C,{className:"p-6 border-amber-200 bg-white text-black dark:bg-black dark:text-white dark:border-amber-600",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ct,{className:"h-5 w-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 text-amber-900 dark:text-amber-100",children:"Complaint Resolution Policy"}),e.jsxs("div",{className:"text-amber-800 dark:text-amber-200 space-y-2",children:[e.jsx("p",{children:"Complaints can only be resolved within 24 hours."}),e.jsx("p",{children:"If you purchase data and do not receive it, kindly report the issue within 24 hours."}),e.jsx("p",{className:"font-medium",children:"Reports made after 24 hours will not be attended to."})]})]})]})})]})]})})})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(C,{className:"p-6 max-w-md",children:e.jsx("p",{className:"text-center text-muted-foreground",children:"Agent store not found"})})})}const fa={mtn:{name:"MTN",logo:ft},telecel:{name:"Telecel",logo:Nt},at_bigtime:{name:"AT BIG TIME",logo:cs},at_ishare:{name:"AT iShare",logo:cs}};function Zc(){const{network:s}=Dt(),a=s==="bigtime"?"at_bigtime":s==="ishare"?"at_ishare":s,t=a==null?void 0:a.replace(/-/g,"_"),n=fa[t||""]||{name:"Unknown",logo:""},r=new URLSearchParams(window.location.search).get("agent")||ps(),c=typeof window<"u"?ps():null;return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(ls,{}),e.jsx("main",{className:"flex-1 py-8 px-4 pt-16",children:e.jsxs("div",{className:"container mx-auto max-w-4xl",children:[e.jsx(G,{href:c?`/store/${c}`:"/",children:e.jsxs(g,{variant:"ghost",className:"gap-2 mb-6","data-testid":"button-back",children:[e.jsx(Ft,{className:"h-4 w-4"}),"Back to Products"]})}),e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[n.logo&&e.jsx("img",{src:n.logo,alt:n.name,className:"w-16 h-16 object-contain rounded-lg","data-testid":"img-network-logo"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold","data-testid":"text-network-name",children:[n.name," Data Bundles"]}),e.jsx("p",{className:"text-muted-foreground",children:"Complete your purchase in one easy flow"})]})]}),e.jsx(ed,{network:t||"",agentSlug:r}),e.jsxs("div",{className:"mt-12 space-y-6",children:[e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ze,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Data Delivery Time"}),e.jsx("p",{className:"text-muted-foreground",children:"All data orders are delivered within 5â€“45 minutes. Please note that delivery times may vary during network downtime"})]})]})}),e.jsx(C,{className:"p-6 border-red-200 bg-white text-black dark:bg-black dark:text-white dark:border-red-600",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ct,{className:"h-5 w-5 text-red-600 dark:text-red-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 text-red-900 dark:text-red-100",children:"Our DATA REQUEST DOES NOT support:"}),e.jsxs("ul",{className:"text-red-800 dark:text-red-200 space-y-1 ml-4 opacity-90",children:[e.jsx("li",{children:"â€¢ Turbonet SIM"}),e.jsx("li",{children:"â€¢ Merchant SIM"}),e.jsx("li",{children:"â€¢ EVD SIM"}),e.jsx("li",{children:"â€¢ Broadband SIM"}),e.jsx("li",{children:"â€¢ Blacklisted SIM"}),e.jsx("li",{children:"â€¢ Roaming SIM"}),e.jsx("li",{children:"â€¢ Different Network"}),e.jsx("li",{children:"â€¢ Wrong Number"}),e.jsx("li",{children:"â€¢ Inactive Number"})]}),e.jsx("p",{className:"text-red-800 dark:text-red-200 font-medium mt-3 opacity-95",children:"Important Notice: Any data transferred to the above SIM types is burnt and irreversible."})]})]})}),e.jsx(C,{className:"p-6 border-amber-200 bg-white text-black dark:bg-black dark:text-white dark:border-amber-600",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ct,{className:"h-5 w-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 text-amber-900 dark:text-amber-100",children:"Complaint Resolution Policy"}),e.jsxs("div",{className:"text-amber-800 dark:text-amber-200 space-y-2",children:[e.jsx("p",{children:"Complaints can only be resolved within 24 hours."}),e.jsx("p",{children:"If you purchase data and do not receive it, kindly report the issue within 24 hours."}),e.jsx("p",{className:"font-medium",children:"Reports made after 24 hours will not be attended to."})]})]})]})})]})]})}),e.jsx(Ps,{})]})}function ed({network:s,agentSlug:a}){const{toast:t}=he(),{user:n}=je(),[l,r]=o.useState(""),[c,d]=o.useState("single"),[x,p]=o.useState(""),[m,j]=o.useState(""),[h,f]=o.useState("paystack"),[b,i]=o.useState(!1),u=o.useRef(!1),F=()=>{const y={top:0,behavior:"smooth"};window.requestAnimationFrame(()=>{var I,T,k,S;window.scrollTo(y),(T=(I=document.documentElement)==null?void 0:I.scrollTo)==null||T.call(I,y),(S=(k=document.body)==null?void 0:k.scrollTo)==null||S.call(k,y)})};o.useEffect(()=>{s==="at_ishare"&&c==="bulk"&&d("single")},[s,c]),o.useEffect(()=>{F()},[]);const{data:R}=V({queryKey:["/api/user/stats"],enabled:!!n}),P=R!=null&&R.walletBalance?parseFloat(R.walletBalance):0,{data:v,isLoading:U}=V({queryKey:["/api/products/data-bundles",s,a],queryFn:async()=>{const I=`/api/products/data-bundles?network=${s}`;return await Y("GET",I)},refetchOnMount:!0,staleTime:0});V({queryKey:["/api/store/agent",a],queryFn:async()=>a?(await Y("GET",`/api/store/agent/${a}`)).json():null,enabled:!!a});const E=v==null?void 0:v.filter(y=>y.network===s&&y.isActive).sort((y,I)=>{const T=parseFloat(y.effective_price),k=parseFloat(I.effective_price);return T-k}),se=(E==null?void 0:E.find(y=>y.id===l))||null,ee=o.useMemo(()=>{if(!(m!=null&&m.trim())||!E)return{total:0,count:0,invalidCount:0};const y=m.split(`
`).filter(S=>S.trim());let I=0,T=0,k=0;for(const S of y){const A=S.trim().split(/\s+/);if(A.length===2){const W=parseFloat(A[1]);if(!isNaN(W)&&W>0){const _=E.find(te=>{const ie=te.dataAmount.match(/(\d+(?:\.\d+)?)\s*gb/i);return ie?parseFloat(ie[1])===W:!1});if(_){const te=parseFloat(_.effective_price);I+=te,T++}else k++}}}return{total:I,count:T,invalidCount:k}},[m,E]),le=re({mutationFn:async y=>y.paymentMethod==="wallet"?await Y("POST","/api/wallet/pay",y):await Y("POST","/api/checkout/initialize",y)}),w=async()=>{if(u.current)return;if(u.current=!0,i(!0),!se){t({title:"No bundle selected",variant:"destructive"});return}const y=$s(x.trim());if(!y){t({title:"Invalid phone",variant:"destructive"});return}const I=Ks(y,se.network);if(!I.isValid){t({title:"Phone mismatch",description:I.error||"Network mismatch",variant:"destructive"});return}if(h==="wallet"){if(!n){t({title:"Login required",description:"Please log in to pay with wallet",variant:"destructive"});return}const T=parseFloat(se.effective_price);if(P<T){t({title:"Insufficient balance",description:"Your wallet balance is not enough",variant:"destructive"});return}}i(!0);try{const T=parseFloat(se.effective_price),k={productType:"data_bundle",productId:se.id,customerPhone:y,amount:T.toFixed(2),isBulkOrder:!1,agentSlug:a,paymentMethod:h,productName:se.name,network:se.network};le.mutate(k,{onSuccess:S=>{u.current=!1,i(!1),h==="wallet"?t({title:"âœ… Payment Successful!",description:`Your purchase has been confirmed. New wallet balance: GHâ‚µ${S.newBalance}. Processing your order...`,duration:5e3}):S.paymentUrl?window.location.href=S.paymentUrl:t({title:"Payment init failed",variant:"destructive"})},onError:S=>{u.current=!1,i(!1);const A=S.message||"Checkout failed";A.includes("wait")&&A.includes("minute")?(console.log("[Checkout Error] Cooldown triggered:",A),t({title:"â³ Purchase Limit",description:A,variant:"destructive",duration:8e3})):t({title:"Error",description:A,variant:"destructive"})}})}catch{i(!1),t({title:"Error",description:"Failed to process payment",variant:"destructive"})}},N=()=>{var W;if(u.current)return;if(u.current=!0,i(!0),!m.trim()){t({title:"Missing Information",description:"Enter phone numbers with GB amounts",variant:"destructive"});return}if(!E){t({title:"No bundles",variant:"destructive"});return}const y=m.split(`
`).filter(_=>_.trim()),I=[];for(const _ of y){const te=_.trim().split(/\s+/);if(te.length!==2){t({title:"Invalid Format",description:`Line "${_}" must be "phone GB"`,variant:"destructive"});return}let ie=te[0].replace(/^\+/,"");ie.startsWith("233")&&(ie="0"+ie.substring(3));const q=parseFloat(te[1]);if(isNaN(q)||q<=0){t({title:"Invalid GB",variant:"destructive"});return}const ne=$s(ie);if(!ne){t({title:"Invalid phone",description:ie,variant:"destructive"});return}const ve=Ks(ne);if(!ve.isValid){t({title:"Phone mismatch",description:`${ie}: ${ve.error}`,variant:"destructive"});return}I.push({phone:ne,gb:q})}if(new Set(I.map(_=>_.phone)).size!==I.length){t({title:"Duplicate Numbers",description:"Phone numbers must be unique",variant:"destructive"});return}const k=[];let S=0;for(const _ of I){const te=E.find(q=>{const ne=q.dataAmount.match(/(\d+(?:\.\d+)?)\s*gb/i);return ne?parseFloat(ne[1])===_.gb:!1});if(!te){t({title:"Bundle Not Found",description:`No ${_.gb}GB bundle for ${s}`,variant:"destructive"});return}const ie=parseFloat(te.effective_price);k.push({phone:_.phone,bundleId:te.id,bundleName:te.name,price:ie}),S+=ie}const A={productType:"data_bundle",network:s,customerPhone:(W=k[0])==null?void 0:W.phone,isBulkOrder:!0,orderItems:k,totalAmount:S,agentSlug:a,paymentMethod:"paystack"};le.mutate(A,{onSuccess:_=>{u.current=!1,i(!1),_.paymentUrl?window.location.href=_.paymentUrl:t({title:"Payment init failed",variant:"destructive"})},onError:_=>{u.current=!1,i(!1),t({title:"Error",description:_.message||"Checkout failed",variant:"destructive"})}})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(C,{children:e.jsxs(D,{className:"flex items-center gap-4 p-4",children:[e.jsx("img",{src:(fa[s]||{logo:""}).logo,alt:s,className:"h-12 w-12 rounded-lg object-contain"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-lg",children:(fa[s]||{name:s}).name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose from our available data bundles"})]})]})}),e.jsxs(Hs,{defaultValue:"single",className:"w-full",onValueChange:y=>d(y),children:[e.jsxs(qs,{className:"grid w-full grid-cols-2",children:[e.jsxs(Ee,{value:"single",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(ys,{className:"h-4 w-4 mr-2"}),"Single Purchase"]}),e.jsxs(Ee,{value:"bulk",disabled:s==="at_ishare",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Bulk Purchase",s==="at_ishare"&&e.jsx("span",{className:"text-xs text-muted-foreground ml-1",children:"(Disabled)"})]})]}),s==="at_ishare"&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Bulk purchases are not available for AT iShare network."}),e.jsx(Be,{value:"single",className:"space-y-4",children:e.jsx(C,{children:e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(z,{children:"Select Bundle"}),U?e.jsx("div",{children:"Loading..."}):e.jsxs(Ae,{value:l,onValueChange:y=>r(y),children:[e.jsx(Pe,{className:"w-full",children:e.jsx(Te,{placeholder:"Choose a data bundle"})}),e.jsx(Ce,{children:E==null?void 0:E.map(y=>{const I=parseFloat(y.effective_price);return e.jsxs(H,{value:y.id,children:[y.network.toUpperCase()," ",y.dataAmount," - ",y.validity," - GHâ‚µ",I.toFixed(2)]},y.id)})})]})]}),se&&e.jsxs("div",{className:"p-2 bg-yellow-500 text-white rounded-lg border border-yellow-600",children:[e.jsx("p",{className:"text-sm text-white",children:"Selected Bundle"}),e.jsxs("p",{className:"font-medium text-lg text-white",children:[se.network.toUpperCase()," ",se.dataAmount," - ",se.validity," - GHâ‚µ",parseFloat(se.effective_price).toFixed(2)]}),e.jsxs("p",{className:"text-2xl font-bold text-white mt-2",children:["GHâ‚µ",parseFloat(se.effective_price).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx(z,{htmlFor:"beneficiary-phone",children:"Beneficiary Number"}),e.jsx(K,{id:"beneficiary-phone",autoComplete:"tel",placeholder:"0241234567",value:x,onChange:y=>p(y.target.value)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Enter one number. Supports 0241234567 or 233241234567 (no +). Valid prefixes: ",ns(s).join(", ")]})]}),e.jsxs("div",{children:[e.jsx(z,{children:"Payment Method"}),e.jsxs(dt,{value:h,onValueChange:y=>f(y),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Cs,{value:"paystack",id:"paystack"}),e.jsxs(z,{htmlFor:"paystack",className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4"}),"Paystack"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Cs,{value:"wallet",id:"wallet",disabled:!n}),e.jsxs(z,{htmlFor:"wallet",className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Wallet ",n?`(Balance: GHâ‚µ${P.toFixed(2)})`:"(Login required)"]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(g,{onClick:w,disabled:b||!se||b||h==="wallet"&&(!n||P<parseFloat((se==null?void 0:se.effective_price)||"0")),children:b?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):h==="wallet"?"Pay with Wallet":"Pay with Paystack"})})]})})}),e.jsx(Be,{value:"bulk",className:"space-y-4",children:e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Bulk Purchase"}),e.jsxs(J,{children:["Enter phone numbers with GB amounts for ",s.toUpperCase()]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsx(bs,{placeholder:`0546591622 1
0247064874 3
233547897522 10`,value:m,onChange:y=>j(y.target.value),rows:8}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:['Enter one number per line with GB amount (e.g., "0241234567 2"). Supports 0241234567 or 233241234567 (no +). No limit - add 100+ numbers! All numbers must be for ',s.toUpperCase(),". Valid prefixes: ",ns(s).join(", ")]}),ee&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"font-medium",children:[ee.count," items â€¢ GHâ‚µ",ee.total.toFixed(2)]}),ee.invalidCount>0&&e.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400",children:["âš ï¸ ",ee.invalidCount," bundle(s) not found for this network. Please check the GB amounts."]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(g,{onClick:N,disabled:b||ee.count===0||ee.invalidCount>0,children:b?"Processing...":`Pay with Paystack ${ee.count>0?` ${ee.count} Bundles - GHâ‚µ${ee.total.toFixed(2)}`:""}`})})]})]})})]})]})}const sd=Z.object({customerPhone:Z.string().min(10,"Invalid phone number").regex(/^[0-9+\-\s()]*$/,"Phone number must contain only numbers and valid characters"),paymentMethod:Z.enum(["paystack","wallet"],{required_error:"Please select a payment method"})});function td({agentSlug:s}){const[,a]=Ke(),{toast:t}=he(),{user:n}=je(),[l,r]=o.useState(""),[c,d]=o.useState(1),[x,p]=o.useState(!1),[m,j]=o.useState(!1),[h,f]=o.useState(null),b=()=>{const T={top:0,behavior:"smooth"};window.requestAnimationFrame(()=>{var k,S,A,W;window.scrollTo(T),(S=(k=document.documentElement)==null?void 0:k.scrollTo)==null||S.call(k,T),(W=(A=document.body)==null?void 0:A.scrollTo)==null||W.call(A,T)})},{data:i,isLoading:u}=V({queryKey:["/api/products/result-checkers/stock"],queryFn:()=>Ie("/api/products/result-checkers/stock"),refetchInterval:3e4,refetchOnWindowFocus:!0});o.useEffect(()=>{b()},[]);const{data:F,isLoading:R}=V({queryKey:["/api/user/stats"],queryFn:()=>Ie("/api/user/stats"),enabled:!!n,refetchInterval:1e4}),P=i==null?void 0:i.find(T=>`${T.type}-${T.year}`===l),v=F!=null&&F.walletBalance?parseFloat(F.walletBalance):0,U=P?P.price:0,E=U*c,se=!!(!R&&F&&E>0&&v<E),ee=T=>{r(T),d(1),j(!1),f(null),b()},le=T=>{if(P){const k=P.stock;T>=1&&T<=k?d(T):T>k&&t({title:"Quantity Exceeded",description:`Only ${k} PINs available for ${P.type.toUpperCase()} ${P.year}`,variant:"destructive"})}},w=()=>{if(!P||!h)return;const[T,k]=l.split("-"),S=new _n;let A=20;const W=S.internal.pageSize.getHeight(),_=15,te=7;S.setFontSize(18),S.setFont("helvetica","bold"),S.text("RESULT CHECKER PURCHASE RECEIPT",_,A),A+=12,S.setFontSize(10),S.setFont("helvetica","normal"),S.text(`Receipt Date: ${new Date().toLocaleString()}`,_,A),A+=te,S.text(`Transaction ID: ${h.transactionId||"RCP"+Date.now()}`,_,A),A+=12,S.setFont("helvetica","bold"),S.setFontSize(12),S.text("PURCHASE DETAILS",_,A),A+=8,S.setFont("helvetica","normal"),S.setFontSize(10),S.text(`Product: ${T.toUpperCase()} Result Checker ${k}`,_,A),A+=te,S.text(`Quantity: ${c}`,_,A),A+=te,S.text(`Unit Price: GHâ‚µ${P.price.toFixed(2)}`,_,A),A+=te,S.setFont("helvetica","bold"),S.text(`Total Amount: GHâ‚µ${E.toFixed(2)}`,_,A),A+=12,S.setFont("helvetica","bold"),S.setFontSize(12),S.text("RESULT CHECKER DETAILS",_,A),A+=8,S.setFont("helvetica","normal"),S.setFontSize(10);const ie=h.pinsData||[];ie.length>0?ie.forEach((q,ne)=>{A>W-30&&(S.addPage(),A=_),S.text(`PIN ${ne+1}:`,_,A),A+=te,S.text(`Serial number: ${q.serialNumber||q.serial||"XXXXX-XXXXX-XXXXX"}`,_+5,A),A+=te,S.text(`Pin: ${q.pin||"XXXX-XXXX-XXXX-XXXX"}`,_+5,A),A+=10}):h.deliveredPin&&(S.text(`Serial number: ${h.serialNumber||h.deliveredPin.split("-")[0]||"XXXXX-XXXXX-XXXXX"}`,_+5,A),A+=te,S.text(`Pin: ${h.deliveredPin}`,_+5,A),A+=12),A>W-40&&(S.addPage(),A=_),S.setFont("helvetica","bold"),S.setFontSize(12),S.text("CUSTOMER INFORMATION",_,A),A+=8,S.setFont("helvetica","normal"),S.setFontSize(10),S.text(`Phone: ${(n==null?void 0:n.phone)||"N/A"}`,_,A),A+=te,S.text(`Email: ${(n==null?void 0:n.email)||"N/A"}`,_,A),A+=12,S.setFont("helvetica","bold"),S.setFontSize(12),S.text("DELIVERY STATUS",_,A),A+=8,S.setFont("helvetica","normal"),S.setFontSize(10),S.text("Status: Completed",_,A),A+=te,S.text(`PINs Delivered: ${c}`,_,A),A+=12,S.setFontSize(9),S.setFont("helvetica","italic"),S.text("Keep this receipt safe for your records. Use the provided PINs to check WAEC results.",_,W-20),S.text(`Generated: ${new Date().toISOString()}`,_,W-10),S.save(`result-checker-receipt-${Date.now()}.pdf`),t({title:"âœ… Downloaded",description:"Your receipt has been downloaded successfully"})},N=gs({resolver:fs(sd),defaultValues:{customerPhone:""}}),y=re({mutationFn:async T=>{if(!P)throw new Error("No checker selected");const[k,S]=l.split("-");if(T.paymentMethod==="wallet"){const A={productType:"result_checker",productId:`${k}-${S}`,productName:`${c} x ${k.toUpperCase()} Result Checker ${S}`,amount:E.toFixed(2),agentSlug:s||void 0,quantity:c};return await Ie("/api/wallet/pay",{method:"POST",body:JSON.stringify(A)})}else{const A={productType:"result_checker",productId:`${k}-${S}`,productName:`${c} x ${k.toUpperCase()} Result Checker ${S}`,amount:E.toFixed(2),customerPhone:T.customerPhone,customerEmail:(n==null?void 0:n.email)||void 0,agentSlug:s||void 0,quantity:c};return console.log("[Result Checker] Paystack payment payload:",{amount:A.amount,quantity:A.quantity,unitPrice:U,totalPrice:E}),await Ie("/api/checkout/initialize",{method:"POST",body:JSON.stringify(A)})}},onSuccess:(T,k)=>{var S;if(p(!1),k.paymentMethod==="wallet")f(T),j(!0),t({title:"âœ… Payment Successful!",description:"Your result checker purchase is complete",duration:3e3});else{const A=T.paymentUrl||T.authorizationUrl||T.authorization_url||((S=T.data)==null?void 0:S.authorization_url);A?window.location.href=A:(console.error("Payment response:",T),t({title:"âŒ Payment Initialization Failed",description:T.message||"Unable to redirect to payment page. Please try again.",variant:"destructive"}))}},onError:T=>{const k=T.message||"Unable to process payment",S=k.toLowerCase().includes("insufficient");t({title:S?"âš ï¸ Insufficient Wallet Balance":"âŒ Payment Failed",description:S?"Your wallet balance is too low for this purchase. Please top up your wallet or use Paystack.":`${k}. Please try again or contact support if the problem persists.`,variant:"destructive",duration:6e3}),p(!1)}}),I=T=>{if(!P){t({title:"No Checker Selected",description:"Please select a result checker to continue",variant:"destructive"});return}if(P.stock<c){t({title:"Insufficient Stock",description:`Only ${P.stock} PINs available. Please reduce quantity or select another checker.`,variant:"destructive"});return}if(T.paymentMethod==="wallet"&&se){const k=E-v;t({title:"âš ï¸ Insufficient Wallet Balance",description:`You need GHâ‚µ${k.toFixed(2)} more to complete this purchase. Current balance: GHâ‚µ${v.toFixed(2)}, Required: GHâ‚µ${E.toFixed(2)}. Please top up or use Paystack.`,variant:"destructive",duration:7e3});return}p(!0),y.mutate(T)};if(u)return e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(!i||i.length===0)return e.jsx(C,{className:"p-6",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No result checkers available at the moment."})})});if(m&&P){const[T,k]=l.split("-");return e.jsxs(C,{className:"border-green-500 bg-white dark:bg-black",children:[e.jsx($,{className:"bg-green-50 dark:bg-green-900/20 border-b border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-green-600",children:e.jsx(be,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx(B,{className:"text-green-700 dark:text-green-300 text-2xl",children:"Payment Successful! ðŸŽ‰"}),e.jsx(J,{className:"text-green-600 dark:text-green-400 mt-1",children:"Your result checkers have been delivered"})]})]})}),e.jsxs(D,{className:"pt-6 space-y-6",children:[e.jsxs("div",{className:"bg-muted dark:bg-black/20 rounded-lg p-4 space-y-3",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Purchase Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Product:"}),e.jsxs("span",{className:"font-medium",children:[T.toUpperCase()," Result Checker ",k]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Quantity:"}),e.jsxs("span",{className:"font-medium",children:[c," PIN(s)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Unit Price:"}),e.jsx("span",{className:"font-medium",children:ae(P.price)})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Total Amount Paid:"}),e.jsx("span",{className:"font-bold text-primary text-lg",children:ae(E)})]})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:[e.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-300 mb-2",children:"ðŸ“§ Delivery Details"}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-400",children:"Your result checker PINs have been sent to your email. Check your inbox (and spam folder) for the delivery details."}),(h==null?void 0:h.deliveredPin)&&e.jsxs("p",{className:"text-sm font-mono bg-white dark:bg-black rounded p-2 mt-2 text-muted-foreground",children:["Reference: ",h.deliveredPin]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsxs(g,{onClick:w,className:"flex-1 gap-2 bg-green-600 hover:bg-green-700",size:"lg",children:[e.jsx(rl,{className:"h-4 w-4"}),"Download Receipt"]}),e.jsx(g,{onClick:()=>a("/user/dashboard"),variant:"outline",className:"flex-1 gap-2",size:"lg",children:"Go to Dashboard"})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border border-amber-200 dark:border-amber-800",children:[e.jsx("h3",{className:"font-semibold text-amber-900 dark:text-amber-300 mb-2",children:"ðŸ“ Next Steps"}),e.jsxs("ol",{className:"text-sm text-amber-800 dark:text-amber-400 list-decimal list-inside space-y-1",children:[e.jsx("li",{children:"Use the PINs to check WAEC result on the official website"}),e.jsx("li",{children:"Keep your receipt safe for your records"}),e.jsx("li",{children:"Contact support if you encounter any issues"})]})]})]})]})}return e.jsxs(C,{children:[e.jsxs($,{className:"space-y-2",children:[e.jsx(B,{children:"Result Checker Purchase"}),e.jsx(J,{children:"Select, review, and pay in one card."})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{className:"text-sm font-medium",children:"Result Checker"}),e.jsxs(Ae,{value:l,onValueChange:ee,children:[e.jsx(Pe,{className:"w-full",children:e.jsx(Te,{placeholder:"Choose a result checker..."})}),e.jsx(Ce,{children:i.map(T=>e.jsx(H,{value:`${T.type}-${T.year}`,disabled:T.stock<=0,children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-4",children:[e.jsxs("span",{className:"font-medium uppercase",children:[T.type," ",T.year]}),e.jsx("span",{className:"text-muted-foreground text-sm",children:T.stock>0?`${T.stock} in stock`:"Out of stock"}),e.jsx("span",{className:"font-bold text-primary",children:ae(T.price)})]})},`${T.type}-${T.year}`))})]})]}),P&&e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg uppercase",children:[P.type," Result Checker ",P.year]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(it,{className:"h-4 w-4 text-primary"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[P.stock," PINs available"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Unit Price"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:ae(U)})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-3 bg-background rounded-lg p-2",children:[e.jsx("button",{type:"button",onClick:()=>le(c-1),className:"p-1 hover:bg-muted rounded transition-colors disabled:opacity-50",disabled:c<=1,"aria-label":"Decrease quantity",title:"Decrease quantity",children:e.jsx(Mn,{className:"h-4 w-4"})}),e.jsx("input",{type:"number",min:"1",max:P.stock,value:c,onChange:T=>le(parseInt(T.target.value)||1),className:"w-12 text-center font-semibold border rounded px-2 py-1 text-black",placeholder:"1","aria-label":"Quantity of result checkers",title:"Enter quantity"}),e.jsx("button",{type:"button",onClick:()=>le(c+1),className:"p-1 hover:bg-muted rounded transition-colors disabled:opacity-50",disabled:c>=P.stock,"aria-label":"Increase quantity",title:"Increase quantity",children:e.jsx(hs,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"pt-3 bg-white dark:bg-black/20 p-3 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Subtotal (",c,"x @ ",ae(U),")"]}),e.jsx("span",{className:"font-medium",children:ae(U*c)})]}),e.jsxs("div",{className:"flex items-center justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total Amount"}),e.jsx("span",{className:"text-primary text-2xl",children:ae(E)})]})]})]})]}),e.jsx(ws,{...N,children:e.jsxs("form",{onSubmit:N.handleSubmit(I),className:"space-y-6",children:[e.jsx(me,{control:N.control,name:"paymentMethod",render:({field:T})=>e.jsxs(ce,{className:"space-y-3",children:[e.jsx(Kt,{className:"text-green-700",children:"Payment Method"}),e.jsx(de,{children:e.jsxs(dt,{onValueChange:T.onChange,value:T.value,className:"grid gap-3",children:[n&&e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:`flex items-center space-x-2 p-4 rounded-lg border-2 border-muted !bg-white hover:border-green-500 cursor-pointer transition-all ${se?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(Cs,{value:"wallet",id:"wallet",disabled:se}),e.jsxs(z,{htmlFor:"wallet",className:"flex items-center justify-between flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Wallet Balance"}),e.jsxs("div",{className:"text-sm text-green-600",children:["Available: GHâ‚µ",v.toFixed(2)]})]})]}),T.value==="wallet"&&e.jsx(be,{className:"h-5 w-5 text-green-600"})]})]}),se&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"text-xs bg-destructive text-destructive-foreground px-2 py-1 rounded",children:"Insufficient"})})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 rounded-lg border-2 border-muted !bg-white hover:border-green-500 cursor-pointer transition-all",children:[e.jsx(Cs,{value:"paystack",id:"paystack"}),e.jsxs(z,{htmlFor:"paystack",className:"flex items-center justify-between flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Paystack"}),e.jsx("div",{className:"text-sm text-green-600",children:"Pay with card, bank transfer"})]})]}),T.value==="paystack"&&e.jsx(be,{className:"h-5 w-5 text-green-600"})]})]})]})}),e.jsx(oe,{})]})}),se&&N.watch("paymentMethod")==="wallet"&&e.jsxs(ms,{variant:"default",className:"border-destructive/50 bg-white text-destructive",children:[e.jsx(os,{className:"h-4 w-4"}),e.jsxs(xs,{className:"text-sm",children:[e.jsx("strong",{children:"Insufficient Balance:"})," You need GHâ‚µ",(E-v).toFixed(2)," more.",e.jsx("a",{href:"/user/wallet",className:"underline ml-1 font-medium hover:text-destructive-foreground",children:"Top up wallet"})," or select Paystack."]})]}),e.jsx(me,{control:N.control,name:"customerPhone",render:({field:T})=>e.jsxs(ce,{children:[e.jsx(xe,{children:"Phone Number *"}),e.jsx(de,{children:e.jsxs("div",{className:"relative",children:[e.jsx(It,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(K,{placeholder:"+233 XX XXX XXXX",type:"tel",className:"pl-10",...T})]})}),e.jsx(ss,{children:"We'll use this number to deliver your result checker PINs"}),e.jsx(oe,{})]})}),e.jsxs("div",{className:"bg-green-600 dark:bg-green-700 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(Mr,{className:"h-5 w-5 text-white dark:text-white mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-white dark:text-white",children:N.watch("paymentMethod")==="wallet"?"Instant Purchase":"Secure Payment"}),e.jsx("p",{className:"text-white dark:text-white",children:N.watch("paymentMethod")==="wallet"?"Your result checker PIN and serial number will be generated instantly and available for download.":"Your payment is processed securely through Paystack. Your result checker will be available for download after payment."})]})]}),e.jsx(g,{type:"submit",size:"lg",className:"w-full gap-2",disabled:x||!N.watch("paymentMethod")||N.watch("paymentMethod")==="wallet"&&se||!P,children:x?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 animate-spin"}),"Processing..."]}):e.jsx(e.Fragment,{children:N.watch("paymentMethod")==="wallet"?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-4 w-4"}),"Pay from Wallet - ",ae(E)]}):e.jsxs(e.Fragment,{children:[e.jsx(ys,{className:"h-4 w-4"}),"Complete Purchase - ",ae(E)]})})})]})})]})]})}function Ga(){const s=new URLSearchParams(window.location.search).get("agent"),a=typeof window<"u"?ps():null;return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(ls,{}),e.jsx("main",{className:"flex-1 py-8 px-4 pt-16",children:e.jsxs("div",{className:"container mx-auto max-w-4xl",children:[e.jsx(G,{href:a?`/store/${a}`:"/",children:e.jsxs(g,{variant:"ghost",className:"gap-2 mb-6","data-testid":"button-back",children:[e.jsx(Ft,{className:"h-4 w-4"}),"Back to Products"]})}),e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("img",{src:Pa,alt:"Result Checkers",className:"w-16 h-16 object-contain rounded-lg","data-testid":"img-result-logo"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold","data-testid":"text-page-title",children:"WAEC Result Checkers"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete your purchase in one easy flow"})]})]}),e.jsx(td,{agentSlug:s})]})}),e.jsx(Ps,{})]})}const ad=[{id:"mtn",name:"MTN Data",logo:ft,href:"/products/mtn",description:"MTN Data Bundles"},{id:"telecel",name:"Telecel Data",logo:Nt,href:"/products/telecel",description:"Telecel Data Bundles"},{id:"at_bigtime",name:"AT BIG TIME Data",logo:cs,href:"/products/at_bigtime",description:"AT BIG TIME Data Bundles"},{id:"at_ishare",name:"AT iShare Data",logo:cs,href:"/products/at_ishare",description:"AT iShare Data Bundles"}];function Wa(){return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(ls,{}),e.jsx("main",{className:"flex-1 pt-16",children:e.jsx("section",{id:"products",className:"py-12 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-4xl space-y-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-center",children:"Select a Data Bundle"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto",children:ad.map(s=>e.jsx(G,{href:s.href,children:e.jsxs(C,{className:"p-0.5 md:p-1 hover-elevate cursor-pointer transition-all aspect-square flex flex-col items-center justify-center gap-3 dark:border-2 dark:border-white","data-testid":`card-product-${s.id}`,children:[e.jsx("img",{src:s.logo,alt:s.name,className:"w-20 h-20 md:w-24 md:h-24 object-contain rounded-lg","data-testid":`img-product-${s.id}`}),e.jsx("p",{className:"text-sm font-medium text-center text-muted-foreground",children:s.description})]})},s.id))})]})})}),e.jsx(Ps,{})]})}function rd(){var x;const{user:s}=je();he();const[a,t]=o.useState(!1),[,n]=o.useState(!1),{data:l,isLoading:r}=V({queryKey:["/api/user/stats"],queryFn:()=>Ie("/api/user/stats",{disableAutoLogout:!0}),refetchInterval:1e4}),{data:c,isLoading:d}=V({queryKey:["/api/transactions"],queryFn:()=>Ie("/api/transactions"),refetchInterval:1e4,select:p=>p.slice(0,5)});return s?e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx(ds,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(He,{open:a,onOpenChange:t,children:[e.jsx(Is,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(pe,{className:"h-5 w-5"})})}),e.jsxs(qe,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(as,{children:[e.jsx(Ve,{children:"Navigation Menu"}),e.jsx(Ye,{children:"Main navigation for your dashboard"})]}),e.jsx(ds,{onClose:()=>t(!1)})]})]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-sm sm:text-xl font-bold",children:["Welcome back, ",s.name,"!"]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Here's your account overview"})]})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 mt-4",children:[e.jsxs(C,{className:"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 border-yellow-600 shadow-xl overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-12 -translate-x-12"}),e.jsx(D,{className:"p-6 relative",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-14 h-14 bg-white/20 rounded-full shadow-lg backdrop-blur-sm",children:e.jsx("span",{className:"text-3xl animate-bounce",children:"ðŸ‘‹"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl lg:text-3xl font-bold text-white mb-1 drop-shadow-sm",children:["Welcome back, ",((x=s==null?void 0:s.name)==null?void 0:x.toUpperCase())||"USER","!"]}),e.jsx("p",{className:"text-yellow-100 text-sm lg:text-base font-medium",children:"Here's what's happening with your account today âœ¨"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-white/90",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium",children:"Live Dashboard"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-white/90",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),e.jsx("span",{className:"text-xs font-medium",children:"Real-time Updates"})]})]})]})]}),e.jsxs("div",{className:"hidden lg:flex flex-col items-end gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 bg-white/10 rounded-full px-3 py-1 backdrop-blur-sm",children:e.jsx("span",{className:"text-xs text-white font-medium",children:new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})}),e.jsxs("div",{className:"flex items-center gap-1 text-white/80",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-xs",children:"All systems operational"})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Wallet Balance"}),e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:r?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(l==null?void 0:l.walletBalance)||"0.00"}`}),e.jsx(G,{href:"/user/wallet",children:e.jsx(g,{variant:"outline",size:"sm",className:"text-xs mt-3",children:"Top Up Wallet"})})]})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Orders"}),e.jsx(ys,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):(l==null?void 0:l.totalOrders)||0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"All time purchases"})]})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Spent"}),e.jsx(Me,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(l==null?void 0:l.totalSpent)||0}`}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"All time spending"})]})]})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Quick Actions"}),e.jsx(J,{children:"Start purchasing data bundles"})]}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsx(G,{href:"/user/bundles/mtn",children:e.jsxs(g,{variant:"outline",className:"w-full h-auto py-4 flex-col gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"MTN Bundles"})]})}),e.jsx(G,{href:"/user/bundles/at-ishare",children:e.jsxs(g,{variant:"outline",className:"w-full h-auto py-4 flex-col gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"AT iShare"})]})}),e.jsx(G,{href:"/user/bundles/at-bigtime",children:e.jsxs(g,{variant:"outline",className:"w-full h-auto py-4 flex-col gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"AT BIG TIME"})]})}),e.jsx(G,{href:"/user/bundles/telecel",children:e.jsxs(g,{variant:"outline",className:"w-full h-auto py-4 flex-col gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"Telecel"})]})}),e.jsx(G,{href:"/user/vouchers",children:e.jsxs(g,{variant:"outline",className:"w-full h-auto py-4 flex-col gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"Vouchers"})]})}),e.jsxs(g,{variant:"outline",className:"w-full h-auto py-4 flex-col gap-2",onClick:()=>n(!0),children:[e.jsx(Ns,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"API & Integrations"})]})]})})]}),e.jsxs(C,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(B,{children:"Recent Transactions"}),e.jsx(J,{children:"Your latest 5 orders"})]}),e.jsx(G,{href:"/user/history",children:e.jsx(g,{variant:"outline",size:"sm",children:"View All"})})]})}),e.jsx(D,{children:d?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Q,{className:"h-6 w-6 animate-spin"})}):c&&c.length>0?e.jsx("div",{className:"space-y-3",children:c.map(p=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:p.productName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p.customerPhone}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(p.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:["GHâ‚µ",p.amount]}),e.jsx(X,{variant:p.status==="completed"?"default":"secondary",className:"text-xs",children:p.status})]})]},p.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground",children:"No transactions yet"}),e.jsx(G,{href:"/user/bundles/mtn",children:e.jsx(g,{variant:"ghost",className:"mt-2",children:"Start Shopping"})})]})})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Track Your Orders"}),e.jsx(J,{children:"Check the status of your data bundle purchases"})]}),e.jsx(D,{children:e.jsx(bt,{})})]})]})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})})}const ha=s=>{switch(s.toLowerCase()){case"completed":case"delivered":return{variant:"default",icon:be,color:"text-white",bgColor:"bg-emerald-600",borderColor:"border-emerald-500",label:"Completed"};case"processing":return{variant:"secondary",icon:Et,color:"text-white",bgColor:"bg-blue-500",borderColor:"border-blue-400",label:"Processing"};case"confirmed":return{variant:"secondary",icon:be,color:"text-white",bgColor:"bg-blue-600",borderColor:"border-blue-500",label:"Confirmed"};case"pending":return{variant:"secondary",icon:ze,color:"text-white",bgColor:"bg-amber-500",borderColor:"border-amber-400",label:"Pending"};case"cancelled":case"failed":return{variant:"destructive",icon:is,color:"text-white",bgColor:"bg-red-600",borderColor:"border-red-500",label:s==="cancelled"?"Cancelled":"Failed"};default:return{variant:"secondary",icon:ze,color:"text-white",bgColor:"bg-slate-600",borderColor:"border-slate-500",label:s.charAt(0).toUpperCase()+s.slice(1)}}};function ld(){const{user:s}=je(),[a,t]=o.useState("overview"),[n,l]=o.useState(!1),{data:r,isLoading:c}=V({queryKey:["/api/wallet/stats"],queryFn:()=>Ie("/api/wallet/stats",{disableAutoLogout:!0}),refetchInterval:1e4}),{data:d,isLoading:x}=V({queryKey:["/api/transactions"],queryFn:()=>Ie("/api/transactions",{disableAutoLogout:!0}),refetchInterval:1e4}),p=(d==null?void 0:d.filter(j=>j.type==="wallet_topup"))||[],m=(d==null?void 0:d.filter(j=>j.paymentMethod==="wallet"))||[];return s?e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx(ds,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(He,{open:n,onOpenChange:l,children:[e.jsx(Is,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(pe,{className:"h-5 w-5"})})}),e.jsxs(qe,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(as,{children:[e.jsx(Ve,{children:"Navigation Menu"}),e.jsx(Ye,{children:"Main navigation for your wallet"})]}),e.jsx(ds,{onClose:()=>l(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"My Wallet"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage your wallet balance"})]})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 mt-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ge,{className:"h-6 w-6"}),"Wallet Overview"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage your wallet balance and view transaction history"})]}),e.jsx(Ll,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs(C,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white border-0",children:[e.jsx($,{className:"pb-2",children:e.jsx(B,{className:"text-sm font-medium text-green-100",children:"Current Balance"})}),e.jsx(D,{children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-3xl font-bold",children:["GHâ‚µ",(r==null?void 0:r.walletBalance)||"0.00"]}),e.jsx("p",{className:"text-xs text-green-100 mt-1",children:"Available to spend"})]})})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Topups"}),e.jsx(da,{className:"h-4 w-4 text-green-600"})]}),e.jsx(D,{children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalTopups)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["GHâ‚µ",(r==null?void 0:r.totalTopupAmount)||"0.00"," total"]})]})})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Spent"}),e.jsx(ga,{className:"h-4 w-4 text-red-600"})]}),e.jsx(D,{children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["GHâ‚µ",(r==null?void 0:r.totalSpent)||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Via wallet payments"})]})})]}),e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Last Topup"}),e.jsx($n,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(D,{children:c?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["GHâ‚µ",(r==null?void 0:r.lastTopupAmount)||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r!=null&&r.lastTopupDate?new Date(r.lastTopupDate).toLocaleDateString():"No topups yet"})]})})]})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Transaction History"}),e.jsx(J,{children:"View your wallet topups and payment history"})]}),e.jsx(D,{children:e.jsxs(Hs,{value:a,onValueChange:t,children:[e.jsxs(qs,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsx(Ee,{value:"overview",children:"Overview"}),e.jsxs(Ee,{value:"topups",children:["Topups (",p.length,")"]}),e.jsxs(Ee,{value:"payments",children:["Payments (",m.length,")"]})]}),e.jsx(Be,{value:"overview",className:"space-y-4",children:x?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})}):d&&d.length>0?e.jsx("div",{className:"space-y-3",children:d.slice(0,10).map(j=>{const h=ha(j.status),f=h.icon,b=j.type==="wallet_topup",i=j.paymentMethod==="wallet";return e.jsx("div",{className:`p-4 border rounded-lg ${h.bgColor} ${h.borderColor} text-white`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[b?e.jsx(da,{className:"h-4 w-4 text-white shrink-0"}):e.jsx(ga,{className:"h-4 w-4 text-white shrink-0"}),e.jsx("p",{className:"font-medium text-sm break-words text-white",children:j.productName}),e.jsxs(X,{variant:h.variant,className:"ml-auto shrink-0 bg-white text-gray-800",children:[e.jsx(f,{className:"h-3 w-3 mr-1"}),h.label]})]}),e.jsxs("div",{className:"text-xs text-gray-200 space-y-1",children:[e.jsxs("p",{children:[b?"Topup":i?"Paid with wallet":"Paystack"," â€¢ ",new Date(j.createdAt).toLocaleDateString()]}),e.jsxs("p",{className:"text-xs font-mono break-all text-gray-300",children:["Ref: ",j.reference]})]})]}),e.jsx("div",{className:"text-right shrink-0",children:e.jsxs("p",{className:"text-lg font-bold text-white",children:[b?"+":"-","GHâ‚µ",j.amount]})})]})},j.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{className:"h-12 w-12 mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No transactions yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Top up your wallet to get started"})]})}),e.jsx(Be,{value:"topups",children:x?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})}):p.length>0?e.jsx("div",{className:"rounded-md border",children:e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{children:"Date"}),e.jsx(O,{children:"Reference"}),e.jsx(O,{children:"Amount"}),e.jsx(O,{children:"Status"})]})}),e.jsx(Ze,{children:p.map(j=>{const h=ha(j.status),f=h.icon;return e.jsxs(fe,{children:[e.jsxs(M,{className:"font-medium",children:[new Date(j.createdAt).toLocaleDateString(),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(j.createdAt).toLocaleTimeString()})]}),e.jsx(M,{className:"font-mono text-xs",children:j.reference}),e.jsx(M,{children:e.jsxs("span",{className:"text-green-600 font-bold",children:["+GHâ‚µ",j.amount]})}),e.jsx(M,{children:e.jsxs(X,{variant:h.variant,children:[e.jsx(f,{className:"h-3 w-3 mr-1"}),h.label]})})]},j.id)})})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(da,{className:"h-12 w-12 mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No topups yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:'Click the "Top Up Wallet" button to add funds'})]})}),e.jsx(Be,{value:"payments",children:x?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})}):m.length>0?e.jsx("div",{className:"rounded-md border",children:e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(fe,{children:[e.jsx(O,{children:"Date"}),e.jsx(O,{children:"Product"}),e.jsx(O,{children:"Amount"}),e.jsx(O,{children:"Status"})]})}),e.jsx(Ze,{children:m.map(j=>{const h=ha(j.status),f=h.icon;return e.jsxs(fe,{children:[e.jsxs(M,{className:"font-medium",children:[new Date(j.createdAt).toLocaleDateString(),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(j.createdAt).toLocaleTimeString()})]}),e.jsx(M,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:j.productName}),e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:j.reference})]})}),e.jsx(M,{children:e.jsxs("span",{className:"text-blue-600 font-bold",children:["-GHâ‚µ",j.amount]})}),e.jsx(M,{children:e.jsxs(X,{variant:h.variant,children:[e.jsx(f,{className:"h-3 w-3 mr-1"}),h.label]})})]},j.id)})})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Me,{className:"h-12 w-12 mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No wallet payments yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Use your wallet to pay for products and see your history here"})]})})]})})]})]})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})})}const nd={mtn:{name:"MTN",color:"bg-yellow-400",logo:ft},at_ishare:{name:"AirtelTigo iShare",color:"bg-red-500",logo:cs},at_bigtime:{name:"AirtelTigo BIG TIME",color:"bg-red-600",logo:cs},telecel:{name:"Telecel",color:"bg-blue-500",logo:Nt}};function id(){const{network:s}=Dt(),{user:a}=je(),{toast:t}=he(),n=Fs(),[l,r]=o.useState(!1),[c,d]=o.useState(null),[x,p]=o.useState(""),[m,j]=o.useState(void 0),[h,f]=o.useState(""),[b,i]=o.useState(void 0),u=s==null?void 0:s.replace(/-/g,"_"),F=nd[u],{data:R,isLoading:P}=V({queryKey:["/api/products/data-bundles",s],queryFn:async()=>{const w=s==null?void 0:s.replace(/-/g,"_");return await Y("GET",`/api/products/data-bundles?network=${w}`)}}),{data:v}=V({queryKey:["/api/user/stats"],queryFn:async()=>Y("GET","/api/user/stats")}),U=o.useMemo(()=>{if(!h.trim()||!R)return null;const w=h.split(`
`).filter(I=>I.trim());let N=0,y=0;for(const I of w){const T=I.trim().split(/\s+/);if(T.length===2){const k=parseFloat(T[1]);if(!isNaN(k)&&k>0){const S=R.find(A=>{const _=A.name.toLowerCase().match(/(\d+(?:\.\d+)?)\s*gb/i);return _?parseFloat(_[1])===k:!1});S&&(N+=parseFloat(S.effective_price),y++)}}}return y>0?{total:N,count:y}:null},[h,R]),E=re({mutationFn:async w=>w.paymentMethod==="wallet"?await Y("POST","/api/wallet/pay",w):await Y("POST","/api/checkout/initialize",w),onSuccess:(w,N)=>{N.paymentMethod==="wallet"?(t({title:"âœ… Payment Successful!",description:`Your purchase has been confirmed. New wallet balance: GHâ‚µ${w.newBalance}. View Order History to download your receipt.`,duration:5e3}),d(null),p(""),j(void 0),n.invalidateQueries({queryKey:["/api/user/stats"]}),n.invalidateQueries({queryKey:["/api/transactions"]})):window.location.href=w.paymentUrl},onError:w=>{const N=w.message||"Unable to process payment",y=N.toLowerCase().includes("insufficient");t({title:y?"âš ï¸ Insufficient Wallet Balance":"âŒ Payment Failed",description:y?"Your wallet balance is too low for this purchase. Please top up your wallet or use Paystack.":`${N}. Please try again or contact support if the problem persists.`,variant:"destructive",duration:6e3})}}),se=re({mutationFn:async w=>w.paymentMethod==="wallet"?await Y("POST","/api/wallet/pay",w):await Y("POST","/api/checkout/initialize",w),onSuccess:(w,N)=>{N.paymentMethod==="wallet"?(t({title:"âœ… Payment Successful!",description:`Your bulk purchase has been confirmed. New wallet balance: GHâ‚µ${w.newBalance}. View Order History to download your receipt.`,duration:5e3}),f(""),i(void 0),n.invalidateQueries({queryKey:["/api/user/stats"]}),n.invalidateQueries({queryKey:["/api/transactions"]})):window.location.href=w.paymentUrl},onError:w=>{const N=w.message||"Unable to process payment";t({title:"Payment Error",description:N,variant:"destructive"})}}),ee=async()=>{if(!c||!x){t({title:"Missing Information",description:"Please select a bundle and enter a phone number",variant:"destructive"});return}const w=$s(x.trim()),N=Ks(w,c.network);if(!N.isValid){const T=ns(c.network);t({title:"âŒ Phone Number Mismatch",description:N.error||`This bundle is for ${c.network.toUpperCase()} network. Valid prefixes: ${T.join(", ")}`,variant:"destructive",duration:8e3});return}const y=parseFloat(c.effective_price),I=v!=null&&v.walletBalance?parseFloat(v.walletBalance):0;if(m==="wallet"&&I<y){const T=y-I;t({title:"âš ï¸ Insufficient Wallet Balance",description:`You need GHâ‚µ${T.toFixed(2)} more. Current balance: GHâ‚µ${I.toFixed(2)}, Required: GHâ‚µ${y.toFixed(2)}. Please top up or use Paystack.`,variant:"destructive",duration:7e3});return}if(!m){t({title:"âŒ Payment Method Required",description:"Please select a payment method",variant:"destructive"});return}try{const T=await Y("GET",`/api/products/data-bundles/${c.id}`),k=parseFloat(T.effective_price),S={productType:"data_bundle",productId:c.id,customerPhone:w,amount:k.toFixed(2),isBulkOrder:!1,agentSlug:void 0,paymentMethod:m,productName:c.name,network:c.network};E.mutate(S)}catch{t({title:"Error",description:"Failed to fetch bundle details",variant:"destructive"})}},le=()=>{var k;if(console.log("[DEBUG] handleBulkPurchase called"),console.log("[DEBUG] bulkPhoneNumbers:",h),console.log("[DEBUG] bulkPaymentMethod:",b),console.log("[DEBUG] bundles:",R),!h.trim()){console.log("[DEBUG] No phone numbers entered"),t({title:"Missing Information",description:"Please enter phone numbers with GB amounts",variant:"destructive"});return}if(!b){t({title:"âŒ Payment Method Required",description:"Please select a payment method",variant:"destructive"});return}if(b==="wallet"&&U&&U.total>(v!=null&&v.walletBalance?parseFloat(v.walletBalance):0)){const S=U.total-(v!=null&&v.walletBalance?parseFloat(v.walletBalance):0);t({title:"âš ï¸ Insufficient Wallet Balance",description:`You need GHâ‚µ${S.toFixed(2)} more. Current balance: GHâ‚µ${(v==null?void 0:v.walletBalance)||"0.00"}, Required: GHâ‚µ${U.total.toFixed(2)}. Please top up or use Paystack.`,variant:"destructive",duration:7e3});return}const w=h.split(`
`).filter(S=>S.trim());console.log("[DEBUG] Parsed lines:",w);const N=[];for(const S of w){const A=S.trim().split(/\s+/);if(A.length!==2){console.log("[DEBUG] Invalid format for line:",S),t({title:"âŒ Invalid Format",description:`Line "${S}" must have format: phone_number GB_amount (e.g., "0241234567 2")`,variant:"destructive",duration:8e3});return}let W=A[0];const _=parseFloat(A[1]);if(isNaN(_)||_<=0){console.log("[DEBUG] Invalid GB amount:",A[1]),t({title:"âŒ Invalid GB Amount",description:`GB amount "${A[1]}" must be a positive number`,variant:"destructive",duration:8e3});return}W=W.replace(/^\+/,""),W.startsWith("233")&&(W="0"+W.substring(3));const te=$s(W);console.log("[DEBUG] Normalized phone:",te,"from:",W);const ie=Ks(te);if(!ie.isValid){console.log("[DEBUG] Phone validation failed:",ie);const q=ns(s);t({title:"âŒ Phone Number Mismatch",description:`${W}: ${ie.error||`Must be for ${F==null?void 0:F.name} network. Valid prefixes: ${q.join(", ")}`}`,variant:"destructive",duration:8e3});return}N.push({phone:te,gb:_})}if(console.log("[DEBUG] Parsed data:",N),N.length===0){console.log("[DEBUG] No valid data parsed"),t({title:"No Data",description:"Please enter at least one phone number with GB amount",variant:"destructive"});return}const y=[];let I=0;for(const S of N){console.log("[DEBUG] Finding bundle for GB:",S.gb);const A=R==null?void 0:R.find(W=>{const te=(W.dataAmount||W.name).match(/(\d+(?:\.\d+)?)\s*gb/i);if(te){const ie=parseFloat(te[1]);return console.log("[DEBUG] Bundle",W.name,"has GB:",ie),ie===S.gb}return!1});if(!A){console.log("[DEBUG] No matching bundle found for GB:",S.gb),t({title:"âŒ Bundle Not Found",description:`No ${S.gb}GB bundle available for ${F==null?void 0:F.name}. Please check available bundles.`,variant:"destructive",duration:8e3});return}console.log("[DEBUG] Found matching bundle:",A.name),y.push({phone:S.phone,bundleId:A.id,bundleName:A.name,price:parseFloat(A.effective_price)}),I+=parseFloat(A.effective_price)}console.log("[DEBUG] Order items:",y),console.log("[DEBUG] Total amount:",I);const T={productType:"data_bundle",network:s,customerPhone:(k=y[0])==null?void 0:k.phone,isBulkOrder:!0,orderItems:y,totalAmount:I,agentSlug:void 0,paymentMethod:b};se.mutate(T)};return a?e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx(ds,{})}),e.jsx(He,{open:l,onOpenChange:r,children:e.jsxs(qe,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(as,{children:[e.jsx(Ve,{children:"Navigation Menu"}),e.jsx(Ye,{children:"Main navigation for bundles"})]}),e.jsx(ds,{onClose:()=>r(!1)})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(He,{open:l,onOpenChange:r,children:[e.jsx(Is,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(pe,{className:"h-5 w-5"})})}),e.jsxs(qe,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(as,{children:[e.jsx(Ve,{children:"Navigation Menu"}),e.jsx(Ye,{children:"Main navigation for bundles"})]}),e.jsx(ds,{onClose:()=>r(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:(F==null?void 0:F.name)||"Data Bundles"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Purchase data bundles"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Wallet Balance"}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["GHâ‚µ",(v==null?void 0:v.walletBalance)||"0.00"]})]}),e.jsx(Ne,{})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx(C,{children:e.jsxs(D,{className:"flex items-center gap-4 p-4",children:[e.jsx("img",{src:F==null?void 0:F.logo,alt:F==null?void 0:F.name,className:"h-12 w-12 rounded-lg object-contain"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-lg",children:F==null?void 0:F.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose from our available data bundles"})]})]})}),e.jsxs(Hs,{defaultValue:"single",className:"w-full",children:[e.jsxs(qs,{className:"grid w-full grid-cols-2",children:[e.jsxs(Ee,{value:"single",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(ys,{className:"h-4 w-4 mr-2"}),"Single Purchase"]}),e.jsxs(Ee,{value:"bulk",disabled:s==="at_ishare",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Bulk Purchase",s==="at_ishare"&&e.jsx("span",{className:"text-xs text-muted-foreground ml-1",children:"(Disabled)"})]})]}),s==="at_ishare"&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Bulk purchases are not available for AT iShare network."}),e.jsx(Be,{value:"single",className:"space-y-6",children:e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Purchase Data Bundle"}),e.jsx(J,{children:"Select a bundle and enter recipient details"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Select Bundle"}),P?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(Q,{className:"h-5 w-5 animate-spin"})}):e.jsxs(Ae,{value:(c==null?void 0:c.id)||"",onValueChange:w=>{const N=R==null?void 0:R.find(y=>y.id===w);d(N||null)},children:[e.jsx(Pe,{children:e.jsx(Te,{placeholder:"Choose a data bundle"})}),e.jsx(Ce,{children:R&&R.length>0?R.map(w=>e.jsxs(H,{value:w.id,children:[w.name," - ",w.validity," - GHâ‚µ",w.basePrice]},w.id)):e.jsx(H,{value:"no-bundles",disabled:!0,children:"No bundles available"})})]})]}),c&&e.jsxs("div",{className:"p-2 bg-yellow-500 text-white rounded-lg border border-yellow-600",children:[e.jsx("p",{className:"text-sm text-white",children:"Selected Bundle"}),e.jsx("p",{className:"font-medium text-lg text-white",children:c.name}),e.jsx("p",{className:"text-sm text-white",children:c.validity}),c.description&&e.jsx("p",{className:"text-xs text-white mt-1",children:c.description}),e.jsxs("p",{className:"text-2xl font-bold text-white mt-2",children:["GHâ‚µ",c.basePrice]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"phone",children:"Beneficiary Number"}),e.jsx(K,{id:"phone",placeholder:"0241234567",value:x,onChange:w=>p(w.target.value)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["For ",e.jsx("strong",{children:F==null?void 0:F.name})," network only. Valid prefixes: ",e.jsx("strong",{children:c?ns(c.network).join(", "):""})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(z,{className:"text-black font-semibold",children:"Payment Method"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>j(m==="wallet"?void 0:"wallet"),disabled:c?parseFloat(c.basePrice)>(v!=null&&v.walletBalance?parseFloat(v.walletBalance):0):!1,className:`w-full flex items-center justify-between rounded-lg border-2 p-4 transition-all ${m==="wallet"?"border-green-500 bg-green-500 shadow-md":"border-muted bg-white hover:border-green-500 hover:shadow-md cursor-pointer"} ${c&&parseFloat(c.basePrice)>(v!=null&&v.walletBalance?parseFloat(v.walletBalance):0)?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:`h-5 w-5 ${m==="wallet"?"text-white":"text-black"}`}),e.jsxs("div",{children:[e.jsx("div",{className:`font-medium ${m==="wallet"?"text-white":"text-black"}`,children:"Wallet Balance"}),e.jsxs("div",{className:`text-sm ${m==="wallet"?"text-white":"text-black"}`,children:["Available: GHâ‚µ",(v==null?void 0:v.walletBalance)||"0.00"]})]})]}),m==="wallet"&&e.jsx(be,{className:"h-5 w-5 text-white"})]}),c&&parseFloat(c.basePrice)>(v!=null&&v.walletBalance?parseFloat(v.walletBalance):0)&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"text-xs bg-black text-white px-2 py-1 rounded font-semibold",children:"Insufficient"})})]}),e.jsx("div",{children:e.jsxs("button",{type:"button",onClick:()=>j(m==="paystack"?void 0:"paystack"),className:`w-full flex items-center justify-between rounded-lg border-2 p-4 transition-all ${m==="paystack"?"border-green-500 bg-green-500 shadow-md":"border-muted bg-white hover:border-green-500 hover:shadow-md cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:`h-5 w-5 ${m==="paystack"?"text-white":"text-black"}`}),e.jsxs("div",{children:[e.jsx("div",{className:`font-medium ${m==="paystack"?"text-white":"text-black"}`,children:"Pay with MoMo"}),e.jsx("div",{className:`text-sm ${m==="paystack"?"text-white":"text-black"}`,children:"Secure payment via Paystack"})]})]}),m==="paystack"&&e.jsx(be,{className:"h-5 w-5 text-white"})]})})]})]}),c&&m==="wallet"&&parseFloat(c.basePrice)>(v!=null&&v.walletBalance?parseFloat(v.walletBalance):0)&&e.jsxs(ms,{variant:"default",className:"border-destructive bg-white text-destructive",children:[e.jsx(os,{className:"h-4 w-4"}),e.jsxs(xs,{className:"text-sm",children:[e.jsx("strong",{children:"Insufficient Balance:"})," You need GHâ‚µ",(parseFloat(c.basePrice)-(v!=null&&v.walletBalance?parseFloat(v.walletBalance):0)).toFixed(2)," more.",e.jsx("a",{href:"/user/wallet",className:"underline ml-1 font-medium hover:text-destructive-foreground",children:"Top up wallet"})," or select Paystack."]})]}),e.jsx(g,{className:"w-full",size:"lg",onClick:ee,disabled:!c||!x||!m||E.isPending||m==="wallet"&&c&&parseFloat(c.basePrice)>(v!=null&&v.walletBalance?parseFloat(v.walletBalance):0),children:E.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),"Purchase Bundle"]})})]})]})}),e.jsx(Be,{value:"bulk",className:"space-y-6",children:e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Bulk Purchase"}),e.jsxs(J,{children:["Enter phone numbers with GB amounts for ",F==null?void 0:F.name]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(z,{htmlFor:"bulk-phones",children:"Beneficiary Numbers and GB Amounts"}),h.trim()&&e.jsxs(X,{variant:"outline",className:"text-xs",children:[h.split(`
`).filter(w=>w.trim()).length," entries"]})]}),e.jsx(bs,{id:"bulk-phones",placeholder:`0546591622 1
0247064874 3
0245696072 2
233547897522 10
...add as many as you need (no limit)`,rows:20,value:h,onChange:w=>f(w.target.value),className:"font-mono text-sm"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:['Enter one number per line with GB amount (e.g., "0241234567 2" for 2GB). Supports formats: 0241234567 or 233241234567 (no + sign).',e.jsx("strong",{className:"text-green-600",children:"âœ“ No limit - add 100+ numbers!"}),e.jsx("br",{}),"All numbers must be for ",e.jsx("strong",{children:F==null?void 0:F.name})," network. Valid prefixes: ",e.jsx("strong",{children:u?ns(u).join(", "):""})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(z,{className:"text-black font-semibold",children:"Payment Method"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>i(b==="wallet"?void 0:"wallet"),disabled:U?U.total>(v!=null&&v.walletBalance?parseFloat(v.walletBalance):0):!1,className:`w-full flex items-center justify-between rounded-lg border-2 p-4 transition-all ${b==="wallet"?"border-green-500 bg-green-500 shadow-md":"border-muted bg-white hover:border-green-500 hover:shadow-md cursor-pointer"} ${U&&U.total>(v!=null&&v.walletBalance?parseFloat(v.walletBalance):0)?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:`h-5 w-5 ${b==="wallet"?"text-white":"text-black"}`}),e.jsxs("div",{children:[e.jsx("div",{className:`font-medium ${b==="wallet"?"text-white":"text-black"}`,children:"Wallet Balance"}),e.jsxs("div",{className:`text-sm ${b==="wallet"?"text-white":"text-black"}`,children:["Available: GHâ‚µ",(v==null?void 0:v.walletBalance)||"0.00"]})]})]}),b==="wallet"&&e.jsx(be,{className:"h-5 w-5 text-white"})]}),U&&U.total>(v!=null&&v.walletBalance?parseFloat(v.walletBalance):0)&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"text-xs bg-black text-white px-2 py-1 rounded font-semibold",children:"Insufficient"})})]}),e.jsx("div",{children:e.jsxs("button",{type:"button",onClick:()=>i(b==="paystack"?void 0:"paystack"),className:`w-full flex items-center justify-between rounded-lg border-2 p-4 transition-all ${b==="paystack"?"border-green-500 bg-green-500 shadow-md":"border-muted bg-white hover:border-green-500 hover:shadow-md cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:`h-5 w-5 ${b==="paystack"?"text-white":"text-black"}`}),e.jsxs("div",{children:[e.jsx("div",{className:`font-medium ${b==="paystack"?"text-white":"text-black"}`,children:"Pay with MoMo"}),e.jsx("div",{className:`text-sm ${b==="paystack"?"text-white":"text-black"}`,children:"Secure payment via Paystack"})]})]}),b==="paystack"&&e.jsx(be,{className:"h-5 w-5 text-white"})]})})]})]}),e.jsx(g,{className:"w-full",size:"lg",onClick:le,disabled:!h.trim()||!b||se.isPending||b==="wallet"&&U!==null&&U.total>(v!=null&&v.walletBalance?parseFloat(v.walletBalance):0),children:se.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Yr,{className:"mr-2 h-4 w-4"}),U?`Purchase for GHâ‚µ${U.total.toFixed(2)} (${U.count} items)`:"Purchase Data Bundles"]})})]})]})})]})]})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})})}const cd=s=>{switch(s.toLowerCase()){case"completed":case"delivered":return{variant:"default",icon:be,color:"text-white",bgColor:"bg-emerald-600",borderColor:"border-emerald-500",label:"Completed"};case"processing":return{variant:"secondary",icon:Et,color:"text-white",bgColor:"bg-blue-500",borderColor:"border-blue-400",label:"Processing"};case"pending":return{variant:"secondary",icon:ze,color:"text-white",bgColor:"bg-amber-500",borderColor:"border-amber-400",label:"Pending"};case"cancelled":case"failed":return{variant:"destructive",icon:is,color:"text-white",bgColor:"bg-red-600",borderColor:"border-red-500",label:s==="failed"?"Failed":"Cancelled"};default:return{variant:"secondary",icon:ze,color:"text-white",bgColor:"bg-slate-600",borderColor:"border-slate-500",label:s.charAt(0).toUpperCase()+s.slice(1)}}};function dd(){const{user:s}=je();he();const[a,t]=o.useState(!1),[n,l]=o.useState(""),[r,c]=o.useState("all"),{data:d,isLoading:x}=V({queryKey:["/api/transactions"],queryFn:()=>Ie("/api/transactions"),refetchInterval:1e4}),p=d==null?void 0:d.filter(m=>{const j=n===""||m.productName.toLowerCase().includes(n.toLowerCase())||m.customerPhone.includes(n)||m.reference.toLowerCase().includes(n.toLowerCase()),h=r==="all"||m.status===r;return j&&h});return s?e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx(ds,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(He,{open:a,onOpenChange:t,children:[e.jsx(Is,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(pe,{className:"h-5 w-5"})})}),e.jsxs(qe,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(as,{children:[e.jsx(Ve,{children:"Navigation Menu"}),e.jsx(Ye,{children:"Main navigation for order history"})]}),e.jsx(ds,{onClose:()=>t(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Order History"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View all your transactions"})]})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx(C,{children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(K,{placeholder:"Search by product, phone, or reference...",value:n,onChange:m=>l(m.target.value),className:"pl-10"})]}),e.jsxs(Ae,{value:r,onValueChange:c,children:[e.jsxs(Pe,{className:"w-full sm:w-[180px]",children:[e.jsx(On,{className:"h-4 w-4 mr-2"}),e.jsx(Te,{placeholder:"Filter by status"})]}),e.jsxs(Ce,{children:[e.jsx(H,{value:"all",children:"All Status"}),e.jsx(H,{value:"completed",children:"Completed"}),e.jsx(H,{value:"processing",children:"Processing"}),e.jsx(H,{value:"pending",children:"Pending"}),e.jsx(H,{value:"failed",children:"Failed"}),e.jsx(H,{value:"cancelled",children:"Cancelled"})]})]})]})})}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Transaction History"}),e.jsxs(J,{children:[(p==null?void 0:p.length)||0," transaction(s) found"]})]}),e.jsx(D,{children:x?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})}):p&&p.length>0?e.jsx("div",{className:"space-y-4",children:p.map(m=>{const j=cd(m.status),h=j.icon,f=m.isBulkOrder,b=m.phoneNumbers?typeof m.phoneNumbers=="string"?JSON.parse(m.phoneNumbers):m.phoneNumbers:void 0;return e.jsx("div",{className:`p-4 border rounded-lg ${j.bgColor} ${j.borderColor} text-white`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[e.jsx("p",{className:"font-medium text-sm md:text-base text-white",children:m.productName}),e.jsxs(X,{variant:j.variant,className:"flex items-center gap-1 bg-white text-gray-800",children:[e.jsx(h,{className:"h-3 w-3"}),j.label]}),f&&e.jsxs(X,{variant:"secondary",className:"flex items-center gap-1 bg-gray-200 text-gray-800",children:[e.jsx(Et,{className:"h-3 w-3"}),"Bulk (",(b==null?void 0:b.length)||0,")"]})]}),e.jsxs("div",{className:"text-xs md:text-sm text-gray-200 space-y-1",children:[f&&b?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-semibold text-white",children:["Recipients: ",b.length," numbers"]}),e.jsxs("details",{className:"cursor-pointer",children:[e.jsx("summary",{className:"text-blue-300 hover:underline",children:"View all numbers"}),e.jsx("div",{className:"mt-2 ml-2 space-y-1 max-h-32 overflow-y-auto",children:b.map((i,u)=>e.jsxs("p",{className:"font-mono text-xs text-gray-300",children:[u+1,". ",i.phone," - ",i.bundleName," (",i.dataAmount,")"]},u))})]})]}):e.jsxs("p",{className:"text-gray-200",children:["Phone: ",m.customerPhone]}),m.network&&e.jsxs("p",{className:"text-gray-200",children:["Network: ",m.network.toUpperCase()]}),e.jsxs("p",{className:"text-xs text-gray-300",children:["Ref: ",m.reference]}),e.jsxs("p",{className:"text-xs text-gray-300",children:[new Date(m.createdAt).toLocaleDateString()," at ",new Date(m.createdAt).toLocaleTimeString()]}),m.completedAt&&e.jsxs("p",{className:"text-green-300 text-xs",children:["Completed: ",new Date(m.completedAt).toLocaleDateString()," at ",new Date(m.completedAt).toLocaleTimeString()]}),m.failureReason&&e.jsxs("p",{className:"text-red-300 text-xs",children:["Reason: ",m.failureReason]})]})]}),e.jsxs("div",{className:"text-left sm:text-right shrink-0",children:[e.jsxs("p",{className:"font-medium text-lg text-white",children:["GHâ‚µ",m.amount]}),f&&b&&e.jsxs("p",{className:"text-xs text-gray-300",children:["GHâ‚µ",(parseFloat(m.amount)/b.length).toFixed(2)," each"]}),e.jsx(X,{variant:"outline",className:"mt-1 bg-white text-gray-800 border-white",children:m.paymentMethod==="wallet"?"Wallet":"MoMo"})]})]})},m.id)})}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No transactions found"})})})]})]})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})})}function od(){const[s,a]=o.useState(!1);return e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx(ds,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(He,{open:s,onOpenChange:a,children:[e.jsx(Is,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(pe,{className:"h-5 w-5"})})}),e.jsxs(qe,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(as,{children:[e.jsx(Ve,{children:"Navigation Menu"}),e.jsx(Ye,{children:"Main navigation for support"})]}),e.jsx(ds,{onClose:()=>a(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Support Chat"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get help from our support team"})]})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(Rl,{})})})]})]})}function md(){je();const[s,a]=o.useState(!1),{data:t,isLoading:n}=V({queryKey:["result-checker-stock"],queryFn:()=>Ie("/api/result-checkers/stock")}),{data:l,isLoading:r}=V({queryKey:["user-stats"],queryFn:()=>Ie("/api/user/stats")}),c=t||[];return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(He,{open:s,onOpenChange:a,children:[e.jsx(Is,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(pe,{className:"h-5 w-5"})})}),e.jsxs(qe,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(as,{children:[e.jsx(Ve,{children:"Navigation Menu"}),e.jsx(Ye,{children:"Main navigation for your dashboard"})]}),e.jsx(ds,{onClose:()=>a(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Vouchers"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Purchase result checkers and vouchers"})]})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs(C,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Wallet Balance"}),e.jsx(ys,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r?e.jsx(Q,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(l==null?void 0:l.walletBalance)||0}`}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Available for purchases"}),e.jsx(G,{href:"/user/wallet",children:e.jsx(g,{variant:"outline",size:"sm",className:"text-xs mt-3",children:"Top Up Wallet"})})]})]}),e.jsxs(C,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:Pa,alt:"Result Checkers",className:"w-12 h-12 object-contain rounded-lg"}),e.jsxs("div",{children:[e.jsx(B,{children:"WAEC Result Checkers"}),e.jsx(J,{children:"Purchase WAEC result checking vouchers for different years"})]})]})}),e.jsx(D,{children:n?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Q,{className:"h-6 w-6 animate-spin"})}):c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(d=>e.jsxs(C,{className:"relative",children:[e.jsxs($,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"text-lg",children:[d.type.toUpperCase()," ",d.year]}),e.jsx(X,{variant:d.stock>0?"default":"destructive",children:d.stock>0?`${d.stock} in stock`:"Out of stock"})]}),e.jsx(J,{children:"WAEC Result Checker Voucher"})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["GHâ‚µ",d.price]}),e.jsx(G,{href:`/checkout/result_checker/${d.type}-${d.year}`,children:e.jsxs(g,{className:"w-full",disabled:d.stock===0,children:[e.jsx(it,{className:"h-4 w-4 mr-2"}),d.stock>0?"Purchase Now":"Out of Stock"]})})]})})]},`${d.type}-${d.year}`))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No result checkers available at the moment."})})]}),e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Other Vouchers"}),e.jsx(J,{children:"More voucher types coming soon"})]}),e.jsx(D,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(hs,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"More voucher types will be available soon."})]})})]})]})})]})})}function xd(){const{user:s,refreshUser:a}=je(),{toast:t}=he(),[n,l]=o.useState(!1),[r,c]=o.useState({name:(s==null?void 0:s.name)||"",email:(s==null?void 0:s.email)||""}),[d,x]=o.useState(!1),[p,m]=o.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[j,h]=o.useState(!1);o.useEffect(()=>{s&&c({name:s.name||"",email:s.email||""})},[s]);const f=async i=>{if(i.preventDefault(),!r.name.trim()){t({title:"Name is required",variant:"destructive"});return}x(!0);try{const u=await Ie("PUT","/api/user/profile",{name:r.name.trim(),email:r.email.trim()});await a(),t({title:"Profile updated successfully"})}catch(u){t({title:"Failed to update profile",description:u.message,variant:"destructive"})}finally{x(!1)}},b=async i=>{if(i.preventDefault(),p.newPassword!==p.confirmPassword){t({title:"Passwords do not match",variant:"destructive"});return}if(p.newPassword.length<6){t({title:"Password must be at least 6 characters",variant:"destructive"});return}h(!0);try{const{error:u}=await Ds.auth.updateUser({password:p.newPassword});if(u)throw u;m({currentPassword:"",newPassword:"",confirmPassword:""}),t({title:"Password updated successfully"})}catch(u){t({title:"Failed to update password",description:u.message,variant:"destructive"})}finally{h(!1)}};return s?e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx(ds,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(He,{open:n,onOpenChange:l,children:[e.jsx(Is,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(pe,{className:"h-5 w-5"})})}),e.jsxs(qe,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(as,{children:[e.jsx(Ve,{children:"Navigation Menu"}),e.jsx(Ye,{children:"Main navigation for your account"})]}),e.jsx(ds,{onClose:()=>l(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage your account settings"})]})]}),e.jsx(Ne,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:e.jsxs(Hs,{defaultValue:"profile",className:"w-full",children:[e.jsxs(qs,{className:"grid w-full grid-cols-2",children:[e.jsxs(Ee,{value:"profile",className:"flex items-center gap-2",children:[e.jsx(la,{className:"h-4 w-4"}),"Profile"]}),e.jsxs(Ee,{value:"security",className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-4 w-4"}),"Security"]})]}),e.jsx(Be,{value:"profile",className:"space-y-4",children:e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Profile Information"}),e.jsx(J,{children:"Update your personal information"})]}),e.jsx(D,{children:e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"name",children:"Full Name"}),e.jsx(K,{id:"name",value:r.name,onChange:i=>c(u=>({...u,name:i.target.value})),placeholder:"Enter your full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"email",children:"Email Address"}),e.jsx(K,{id:"email",type:"email",value:r.email,onChange:i=>c(u=>({...u,email:i.target.value})),placeholder:"Enter your email"})]}),e.jsxs(g,{type:"submit",disabled:d,children:[d&&e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Profile"]})]})})]})}),e.jsx(Be,{value:"security",className:"space-y-4",children:e.jsxs(C,{children:[e.jsxs($,{children:[e.jsx(B,{children:"Change Password"}),e.jsx(J,{children:"Update your account password"})]}),e.jsx(D,{children:e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"newPassword",children:"New Password"}),e.jsx(K,{id:"newPassword",type:"password",value:p.newPassword,onChange:i=>m(u=>({...u,newPassword:i.target.value})),placeholder:"Enter new password"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsx(K,{id:"confirmPassword",type:"password",value:p.confirmPassword,onChange:i=>m(u=>({...u,confirmPassword:i.target.value})),placeholder:"Confirm new password"})]}),e.jsxs(g,{type:"submit",disabled:j,children:[j&&e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Password"]})]})})]})})]})})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin"})})}function hd(){return e.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gray-50",children:e.jsx(C,{className:"w-full max-w-md mx-4",children:e.jsxs(D,{className:"pt-6",children:[e.jsxs("div",{className:"flex mb-4 gap-2",children:[e.jsx(os,{className:"h-8 w-8 text-red-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"404 Page Not Found"})]}),e.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Did you forget to add the page to the router?"})]})})})}const ua=[Sl,Pl,Cl];function ud(){const{role:s,slug:a}=Dt(),[,t]=Ke(),[n,l]=o.useState(0);o.useEffect(()=>{const m=setInterval(()=>{l(j=>(j+1)%ua.length)},5e3);return()=>clearInterval(m)},[]),o.useEffect(()=>{a&&localStorage.setItem("agentStore",a)},[a]);const r=m=>{console.log(`Navigating to: /store/${s}/${a}/${m}`),t(`/store/${s}/${a}/${m}`)},{data:c,isLoading:d,error:x}=V({queryKey:[`/api/store/${s}/${a}`],enabled:!!s&&!!a,refetchInterval:3e4,refetchOnWindowFocus:!0});if(d)return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx("header",{className:"border-b bg-white",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between h-16 px-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(zs,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold",children:"Loading..."})]}),e.jsx(Ne,{})]})}),e.jsx("main",{className:"flex-1",children:e.jsx(ya,{text:"Loading store..."})})]});if(x||!c)return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx("header",{className:"border-b bg-background",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between h-16 px-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(zs,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold text-foreground",children:"Store Not Found"})]}),e.jsx(Ne,{})]})}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx(C,{className:"max-w-md w-full",children:e.jsxs(D,{className:"pt-6 text-center",children:[e.jsx(zs,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Store Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"This store doesn't exist or is not available."})]})})})]});const{store:p}=c;return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx("header",{className:"border-b sticky top-0 z-50 bg-background",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between h-16 px-4",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h1",{className:"font-semibold text-lg text-foreground",children:p.businessName})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Ne,{})})]})}),e.jsxs("main",{className:"flex-1",children:[e.jsx("section",{className:"relative","data-testid":"banner-carousel",children:e.jsxs("div",{className:"relative h-[300px] md:h-[400px]",children:[ua.map((m,j)=>e.jsx("img",{src:m,alt:`Banner ${j+1}`,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ${j===n?"opacity-100":"opacity-0"}`,"data-testid":`img-banner-${j+1}`},j)),e.jsx("div",{className:"absolute inset-0 bg-black/50"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"container mx-auto max-w-6xl text-center px-4",children:[e.jsx("p",{className:"text-lg md:text-xl text-white/90 max-w-2xl mx-auto leading-relaxed",children:p.businessDescription||"Welcome to our store. Browse our selection of data bundles and result checkers."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6 text-sm",children:[e.jsx(Us,{className:"h-5 w-5 text-green-400"}),e.jsx("span",{className:"font-medium text-white/90",children:"Secure payments powered by Paystack"})]}),(p.whatsappSupportLink||p.whatsappChannelLink)&&e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-6",children:[p.whatsappSupportLink&&e.jsxs("a",{href:p.whatsappSupportLink,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(Rs,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"WhatsApp Support"})]}),p.whatsappChannelLink&&e.jsxs("a",{href:p.whatsappChannelLink,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(Rs,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"WhatsApp Channel"})]})]})]})}),e.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2",children:ua.map((m,j)=>e.jsx("button",{onClick:()=>l(j),className:`w-3 h-3 rounded-full transition-colors ${j===n?"bg-white":"bg-white/50"}`,"aria-label":`Go to banner ${j+1}`,"data-testid":`button-banner-dot-${j+1}`},j))})]})}),e.jsx("section",{className:"py-12 px-4 bg-background",children:e.jsxs("div",{className:"container mx-auto max-w-4xl",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-8",children:"Browse Our Products"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs(C,{className:"p-4 hover-elevate cursor-pointer transition-all aspect-square flex flex-col items-center justify-center gap-3 dark:border-2 dark:border-white",onClick:()=>r("mtn"),children:[e.jsx("img",{src:ft,alt:"MTN Data Bundles",className:"w-16 h-16 md:w-20 md:h-20 object-contain rounded-lg"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold",children:"MTN Data Bundles"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Buy MTN data bundles."})]})]}),e.jsxs(C,{className:"p-4 hover-elevate cursor-pointer transition-all aspect-square flex flex-col items-center justify-center gap-3 dark:border-2 dark:border-white",onClick:()=>r("telecel"),children:[e.jsx("img",{src:Nt,alt:"Telecel Data Bundles",className:"w-16 h-16 md:w-20 md:h-20 object-contain rounded-lg"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Telecel Data Bundles"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Buy Telecel data bundles."})]})]}),e.jsxs(C,{className:"p-4 hover-elevate cursor-pointer transition-all aspect-square flex flex-col items-center justify-center gap-3 dark:border-2 dark:border-white",onClick:()=>r("at_bigtime"),children:[e.jsx("img",{src:cs,alt:"AT BIG TIME Bundles",className:"w-16 h-16 md:w-20 md:h-20 object-contain rounded-lg"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold",children:"AT BIG TIME Bundles"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Buy AT BIG TIME data bundles."})]})]}),e.jsxs(C,{className:"p-4 hover-elevate cursor-pointer transition-all aspect-square flex flex-col items-center justify-center gap-3 dark:border-2 dark:border-white",onClick:()=>r("at_ishare"),children:[e.jsx("img",{src:cs,alt:"AT iShare Bundles",className:"w-16 h-16 md:w-20 md:h-20 object-contain rounded-lg"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold",children:"AT iShare Bundles"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Buy AT iShare data bundles."})]})]})]})]})})]}),e.jsx("footer",{className:"border-t py-8 px-4 bg-muted",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Â© ",new Date().getFullYear()," ",p.businessName,". All rights reserved."]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Developed by ",e.jsx("a",{href:"https://bm-portfolio-up2x.onrender.com",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"BlusMotif"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2 text-xs text-muted-foreground",children:[e.jsx(Us,{className:"h-3 w-3"}),e.jsx("span",{children:"Secure payments â€¢ Fast delivery â€¢ 24/7 support"})]})]})})})]})}function pd({children:s}){const[a,t]=Ke(),n=o.useRef(!1);return o.useEffect(()=>{if(n.current)return;n.current=!0;const l=ps(),c=["/store/","/products/","/checkout","/wallet/topup/success","/login","/register","/agent/register","/agent/activation-complete","/agent/upgrade"].some(d=>a.startsWith(d));if(l){if(a==="/"){console.log("Redirecting from root to agent store:",l),t(`/store/agent/${l}`,{replace:!0});return}!c&&!a.startsWith(`/store/agent/${l}`)&&(console.log("Redirecting non-allowed path to agent store:",a,l),t(`/store/agent/${l}`,{replace:!0}))}},[]),e.jsx(e.Fragment,{children:s})}function jd(){return e.jsxs(qn,{children:[e.jsx(gd,{}),e.jsx(pd,{children:e.jsxs(Un,{children:[e.jsx(Oe,{path:"/",component:Ti}),e.jsx(Oe,{path:"/data-bundles",component:Wa}),e.jsx(Oe,{path:"/products",component:Wa}),e.jsx(Oe,{path:"/products/result-checkers",component:Ga}),e.jsx(Oe,{path:"/products/waec-result-checker",component:Ga}),e.jsx(Oe,{path:"/products/:network",component:Zc}),e.jsx(Oe,{path:"/login",component:Di}),e.jsx(Oe,{path:"/register",component:Ri}),e.jsx(Oe,{path:"/rankings",component:Vc}),e.jsx(Oe,{path:"/checkout/:productType/:productId/:year?",component:_i}),e.jsx(Oe,{path:"/checkout/success",component:Gi}),e.jsx(Oe,{path:"/wallet/topup/success",component:Hi}),e.jsx(Oe,{path:"/agent/register",component:Yi}),e.jsx(Oe,{path:"/agent/upgrade",component:Xi}),e.jsx(Oe,{path:"/agent/activation-complete",component:Qi}),e.jsx(ue,{path:"/user/dashboard",component:rd}),e.jsx(ue,{path:"/user/wallet",component:ld}),e.jsx(ue,{path:"/user/bundles/:network",component:id}),e.jsx(ue,{path:"/user/settings",component:xd}),e.jsx(ue,{path:"/user/vouchers",component:md}),e.jsx(ue,{path:"/user/history",component:dd}),e.jsx(ue,{path:"/user/support",component:od}),e.jsx(ue,{path:"/dealer/dashboard",component:ec,requiredRole:"dealer"}),e.jsx(ue,{path:"/super-dealer/dashboard",component:sc,requiredRole:"super_dealer"}),e.jsx(ue,{path:"/master/dashboard",component:tc,requiredRole:"master"}),e.jsx(ue,{path:"/agent/dashboard",component:Zi,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(ue,{path:"/agent/transactions",component:lc,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(ue,{path:"/agent/withdrawals",component:ic,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(ue,{path:"/agent/storefront",component:dc,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(ue,{path:"/agent/settings",component:xc,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(ue,{path:"/agent/support",component:hc,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(ue,{path:"/agent/bundles/:network",component:pc,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(ue,{path:"/agent/wallet",component:fc,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(ue,{path:"/agent/pricing",component:Nc,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(ue,{path:"/dashboard/api-integrations",component:Cc,requiredRoles:["user","agent","dealer","super_dealer","master","admin"]}),e.jsx(ue,{path:"/dealer/pricing",component:bc,requiredRole:"dealer"}),e.jsx(ue,{path:"/super-dealer/pricing",component:vc,requiredRole:"super_dealer"}),e.jsx(ue,{path:"/master/pricing",component:wc,requiredRole:"master"}),e.jsx(ue,{path:"/admin",component:Tc,requiredRole:"admin"}),e.jsx(ue,{path:"/admin/rankings",component:_c,requiredRole:"admin"}),e.jsx(ue,{path:"/admin/data-bundles",component:Fc,requiredRole:"admin"}),e.jsx(ue,{path:"/admin/role-base-prices",component:Ic,requiredRole:"admin"}),e.jsx(ue,{path:"/admin/result-checkers",component:Dc,requiredRole:"admin"}),e.jsx(ue,{path:"/admin/transactions",component:Lc,requiredRole:"admin"}),e.jsx(ue,{path:"/admin/users",component:Mc,requiredRole:"admin"}),e.jsx(ue,{path:"/admin/agents",component:Oc,requiredRole:"admin"}),e.jsx(ue,{path:"/admin/withdrawals",component:Bc,requiredRole:"admin"}),e.jsx(ue,{path:"/admin/chat-support",component:qc,requiredRole:"admin"}),e.jsx(ue,{path:"/admin/announcements",component:Kc,requiredRole:"admin"}),e.jsx(ue,{path:"/admin/guides",component:Hc,requiredRole:"admin"}),e.jsx(ue,{path:"/admin/break-settings",component:Gc,requiredRole:"admin"}),e.jsx(ue,{path:"/admin/external-api-providers",component:Wc,requiredRole:"admin"}),e.jsx(ue,{path:"/admin/settings",component:zc,requiredRole:"admin"}),e.jsx(Oe,{path:"/store/:role/:slug",component:ud}),e.jsx(Oe,{path:"/store/:role/:slug/:network",component:Jc}),e.jsx(Oe,{component:hd})]})})]})}function gd(){return Ke(),mi(),null}function fd(){return e.jsx(di,{children:e.jsx(Bn,{client:ke,children:e.jsx(li,{children:e.jsxs(ti,{children:[e.jsx(oi,{}),e.jsx(ni,{}),e.jsx(xi,{children:e.jsx(jd,{})}),e.jsx(pi,{}),e.jsx(si,{})]})})})})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(s=>{console.log("Service Worker registered successfully:",s.scope)}).catch(s=>{console.log("Service Worker registration failed:",s)})});const Ka=document.getElementById("root");Ka&&zn(Ka).render(e.jsx(fd,{}));
//# sourceMappingURL=index.BOEvZzcQ.js.map
