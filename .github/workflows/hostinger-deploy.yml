name: Deploy to Hostinger

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [20.x]
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Build server
      run: npm run build:server
    
    - name: Build frontend
      run: npm run build:client
    
    - name: Verify builds exist
      run: |
        echo "Checking server build..."
        test -f dist/server/index.js || (echo "‚ùå Server build failed - dist/server/index.js not found" && exit 1)
        echo "‚úÖ Server build found"
        
        echo "Checking frontend build..."
        test -d dist/public || (echo "‚ùå Frontend build failed - dist/public not found" && exit 1)
        test -f dist/public/index.html || (echo "‚ùå Frontend index.html not found" && exit 1)
        echo "‚úÖ Frontend build found"
    
    - name: Run syntax check
      run: node --check dist/server/index.js
    
    - name: Deployment Ready
      run: |
        echo "‚úÖ Build successful!"
        echo ""
        echo "üìã Hostinger Setup Instructions:"
        echo "================================="
        echo "1. Go to Hostinger hPanel ‚Üí Website ‚Üí Node.js"
        echo "2. Connect this GitHub repository"
        echo "3. Set the following:"
        echo "   - Node Version: 20.x"
        echo "   - Entry Point: dist/server/index.js"
        echo "   - Build Command: npm run build"
        echo "   - Start Command: npm start"
        echo ""
        echo "4. Add Environment Variables in Hostinger:"
        echo "   DATABASE_URL, SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY"
        echo "   NODE_ENV=production, SESSION_SECRET, etc."
        echo ""
        echo "‚úÖ Hostinger will auto-deploy on each push to main"
