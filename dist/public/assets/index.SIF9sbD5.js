var fn=Object.defineProperty;var bn=(s,t,a)=>t in s?fn(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var Pa=(s,t,a)=>bn(s,typeof t!="symbol"?t+"":t,a);import{c as Nn,Q as vn,r as o,t as yn,b as wn,j as e,V as vr,R as yr,A as wr,C as kr,X as rt,T as Sr,D as Pr,e as Yt,P as kn,f as Cr,g as Sn,S as Ar,u as Hs,h as ee,L as re,i as Je,k as Ca,l as ks,m as Ra,W as Pn,n as ze,o as ys,M as Cn,B as ja,E as vt,p as An,q as Tn,s as Tr,v as pa,w as Fr,x as Fn,y as Ir,I as Er,F as Br,G as Or,H as Rs,J as Rr,K as Dr,N as Mr,O as Lr,U as In,Y as En,Z as _r,$ as $r,a0 as zr,a1 as fa,a2 as Gr,a3 as ba,a4 as Ur,a5 as Na,a6 as va,a7 as qr,a8 as Wr,a9 as Kr,aa as Hr,ab as Vr,ac as Bn,ad as Da,ae as Yr,af as Ft,ag as He,ah as X,ai as On,aj as Ee,ak as It,al as Ne,am as ya,an as ot,ao as ta,ap as dt,aq as Rn,ar as Dn,as as Xr,at as fs,au as Lt,av as Qr,aw as Te,ax as ds,ay as Et,az as ea,aA as os,aB as Ke,aC as wa,aD as Jr,aE as Mn,aF as Bt,aG as Zr,aH as Ln,aI as _n,aJ as $n,aK as ae,aL as Ss,aM as Xt,aN as Kt,aO as et,aP as st,aQ as Ps,aR as Ht,aS as Ot,aT as el,aU as sl,aV as tl,aW as zn,aX as al,aY as Gn,aZ as _a,a_ as rl,a$ as ll,b0 as nl,b1 as Un,b2 as il,b3 as qn,b4 as cl,b5 as dl,b6 as Wn,b7 as Kn,b8 as ol,b9 as Hn,ba as Vn,bb as Qt,bc as oe,bd as Yn,be as Ge,bf as ml,bg as xl,bh as ps,bi as ye,bj as hl,bk as Xn,bl as Qn,bm as ul,bn as Jn,bo as Zn,bp as pl,bq as ei,br as Cs,bs as Js,bt as As,bu as Ws,bv as Zs,bw as Rt,bx as tt,by as Gs,bz as at,bA as _s,bB as gl,bC as jl,bD as fl,bE as bl,bF as Nl,bG as vl,bH as yl,bI as js,bJ as qt,bK as si,bL as Qs,bM as wl,bN as kl,bO as Ma,bP as Us,bQ as Vt,bR as ti,bS as Sl,bT as ai,bU as Pl,bV as Cl,bW as Al,bX as Tl,bY as Fl,bZ as ri,b_ as li,b$ as $e,c0 as Aa,c1 as ni,c2 as Za,c3 as $a,c4 as Il,c5 as ii,c6 as El,c7 as ga,c8 as za,c9 as ci,ca as di,cb as oi,cc as mi,cd as xi,ce as Bl,cf as Ta,cg as hi,ch as ui,ci as pi,cj as gi,ck as ji,cl as fi}from"./vendor.C9n2uZh2.js";import{E as bi}from"./vendor_jspdf.DzpfvYeH.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function a(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=a(n);fetch(n.href,r)}})();const er="https://jddstfppigucldetsxws.supabase.co",Ni="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkZHN0ZnBwaWd1Y2xkZXRzeHdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MTQ1MDUsImV4cCI6MjA4MTM5MDUwNX0.MwvCy45DluqdocUkkEhZ3QoGsQfYC30XGzbILT_JGgk";let ma=null;if(!ma){ma=Nn(er,Ni,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:window.localStorage}});const s=`sb-${er.split("//")[1].split(".")[0]}-auth-token`,t=localStorage.getItem(s);if(t)try{const a=JSON.parse(t);(!a.access_token||a.expires_at&&a.expires_at*1e3<Date.now())&&(console.warn("Clearing expired session data"),localStorage.removeItem(s))}catch{console.warn("Clearing invalid session data"),localStorage.removeItem(s)}ma.auth.onAuthStateChange(async(a,i)=>{a==="SIGNED_OUT"&&!i&&(console.log("User signed out, clearing local storage"),localStorage.removeItem(s))})}const Fs=ma;let Tt=null,Ut=null;async function Ol(s){try{const t=await s.text();if(!t)return s.statusText;try{const a=JSON.parse(t);return a.error||a.message||t}catch{return t}}catch{return s.statusText}}async function Rl(){var t;const s=Date.now();if(Tt&&Ut&&s<Ut)return Tt?{Authorization:`Bearer ${Tt}`}:{};try{const{data:a,error:i}=await Fs.auth.getSession();if(i)return console.warn("Session error in getAuthHeaders:",i),Tt=null,Ut=null,{};const n=(t=a.session)==null?void 0:t.access_token;return Tt=n||null,Ut=n?s+5*60*1e3:null,n?{Authorization:`Bearer ${n}`}:{}}catch(a){return console.error("Failed to get session in getAuthHeaders:",a),Tt=null,Ut=null,{}}}function vi(){Tt=null,Ut=null}async function Q(s,t,a){const i=await Rl(),r=t.startsWith("http")?t:`${t}`,d=await fetch(r,{method:s,headers:{"Content-Type":"application/json",...i},body:a?JSON.stringify(a):void 0,credentials:"include"});if(!d.ok){const m=await Ol(d);throw new Error(m)}if((d.headers.get("content-type")||"").includes("application/json"))return d.json();const x=await d.text();throw new Error(x||"Unexpected non-JSON response from server")}const yi=({on401:s})=>async({queryKey:t})=>{const a=await Rl(),i="",n=t[0],r=n.startsWith("http")?n:`${i}${n}`,d=await fetch(r,{headers:{...a},credentials:"include"});if(d.status,!d.ok){const m=await Ol(d);throw new Error(m)}if((d.headers.get("content-type")||"").includes("application/json"))return d.json();const x=await d.text();throw new Error(x||"Unexpected non-JSON response from server")},be=new vn({defaultOptions:{queries:{queryFn:yi({on401:"throw"}),staleTime:2*60*1e3,gcTime:10*60*1e3,retry:1,retryDelay:1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!0,refetchOnMount:!1},mutations:{retry:!1}}}),wi=1,ki=1e6;let Fa=0;function Si(){return Fa=(Fa+1)%Number.MAX_SAFE_INTEGER,Fa.toString()}const Ia=new Map,sr=s=>{if(Ia.has(s))return;const t=setTimeout(()=>{Ia.delete(s),sa({type:"REMOVE_TOAST",toastId:s})},ki);Ia.set(s,t)},Pi=(s,t)=>{switch(t.type){case"ADD_TOAST":return{...s,toasts:[t.toast,...s.toasts].slice(0,wi)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?sr(a):s.toasts.forEach(i=>{sr(i.id)}),{...s,toasts:s.toasts.map(i=>i.id===a||a===void 0?{...i,open:!1}:i)}}case"REMOVE_TOAST":return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==t.toastId)}}},xa=[];let ha={toasts:[]};function sa(s){ha=Pi(ha,s),xa.forEach(t=>{t(ha)})}function Ci({...s}){const t=Si(),a=n=>sa({type:"UPDATE_TOAST",toast:{...n,id:t}}),i=()=>sa({type:"DISMISS_TOAST",toastId:t});return sa({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:n=>{n||i()}}}),{id:t,dismiss:i,update:a}}function fe(){const[s,t]=o.useState(ha);return o.useEffect(()=>(xa.push(t),()=>{const a=xa.indexOf(t);a>-1&&xa.splice(a,1)}),[s]),{...s,toast:Ci,dismiss:a=>sa({type:"DISMISS_TOAST",toastId:a})}}function _(...s){return yn(wn(s))}const Ai=kn,Dl=o.forwardRef(({className:s,...t},a)=>e.jsx(vr,{ref:a,className:_("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...t}));Dl.displayName=vr.displayName;const Ti=Yt("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-white text-black dark:bg-black dark:text-white",destructive:"destructive group border-destructive bg-red-500 text-white dark:bg-red-700 dark:text-white"}},defaultVariants:{variant:"default"}}),Ml=o.forwardRef(({className:s,variant:t,...a},i)=>e.jsx(yr,{ref:i,className:_(Ti({variant:t}),s),...a}));Ml.displayName=yr.displayName;const Fi=o.forwardRef(({className:s,...t},a)=>e.jsx(wr,{ref:a,className:_("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...t}));Fi.displayName=wr.displayName;const Ll=o.forwardRef(({className:s,...t},a)=>e.jsx(kr,{ref:a,className:_("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...t,children:e.jsx(rt,{className:"h-4 w-4"})}));Ll.displayName=kr.displayName;const _l=o.forwardRef(({className:s,...t},a)=>e.jsx(Sr,{ref:a,className:_("text-sm font-semibold",s),...t}));_l.displayName=Sr.displayName;const $l=o.forwardRef(({className:s,...t},a)=>e.jsx(Pr,{ref:a,className:_("text-sm opacity-90",s),...t}));$l.displayName=Pr.displayName;function Ii(){const{toasts:s}=fe();return e.jsxs(Ai,{children:[s.map(function({id:t,title:a,description:i,action:n,...r}){return e.jsxs(Ml,{...r,children:[e.jsxs("div",{className:"grid gap-1",children:[a&&e.jsx(_l,{children:a}),i&&e.jsx($l,{children:i})]}),n,e.jsx(Ll,{})]},t)}),e.jsx(Dl,{})]})}const Ei=Sn,Bi=o.forwardRef(({className:s,sideOffset:t=4,...a},i)=>e.jsx(Cr,{ref:i,sideOffset:t,className:_("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",s),...a}));Bi.displayName=Cr.displayName;const Oi={theme:"light",setTheme:()=>null},zl=o.createContext(Oi);function Ri({children:s,defaultTheme:t="light",storageKey:a="app-theme",...i}){const[n,r]=o.useState(()=>{try{if(typeof window<"u"&&window.localStorage){const c=localStorage.getItem(a);return c==="system"?(localStorage.setItem(a,"light"),"light"):c||t}return t}catch(c){return console.error("Error accessing localStorage:",c),t}});o.useEffect(()=>{const c=window.document.documentElement;c.classList.remove("light","dark"),c.classList.add(n);let x=document.querySelector('meta[name="color-scheme"]');x||(x=document.createElement("meta"),x.setAttribute("name","color-scheme"),document.head.appendChild(x)),x.setAttribute("content",n),console.log("Applied theme:",n,"Classes on root:",c.classList.toString())},[n]);const d={theme:n,setTheme:c=>{try{console.log("Setting theme to:",c),typeof window<"u"&&window.localStorage&&(localStorage.setItem(a,c),console.log("Saved theme to localStorage:",c)),r(c)}catch(x){console.error("Error setting theme:",x),r(c)}}};return e.jsx(zl.Provider,{...i,value:d,children:s})}const nt=()=>{const s=o.useContext(zl);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s},kt="/assets/logo_1765774201026.DUKIXttw.png",Ga=Yt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-yellow-500 dark:text-white text-black shadow-sm hover:shadow-md hover:bg-yellow-600 active:scale-[0.98]",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:shadow-md hover:bg-destructive/90 active:scale-[0.98]",outline:"border border-yellow-500 bg-background text-yellow-700 shadow-sm hover:bg-yellow-50 hover:text-yellow-800 active:scale-[0.98]",secondary:"bg-yellow-400 dark:text-white text-black shadow-sm hover:shadow-md hover:bg-yellow-500 active:scale-[0.98]",ghost:"hover:bg-accent hover:text-accent-foreground active:scale-[0.98]",link:"text-primary underline-offset-4 hover:underline active:scale-[0.98]"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3 text-sm",lg:"h-12 rounded-lg px-8 text-base",xl:"h-14 rounded-lg px-10 text-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),p=o.forwardRef(({className:s,variant:t,size:a,asChild:i=!1,...n},r)=>{const d=i?Ar:"button";return e.jsx(d,{className:_(Ga({variant:t,size:a,className:s})),ref:r,...n})});p.displayName="Button";function Di(){const[s,t]=o.useState(null),[a,i]=o.useState(!1),[n,r]=o.useState(!1),[d,c]=o.useState(!1);o.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches||navigator.standalone===!0?(r(!0),!0):!1)return;const g=localStorage.getItem("pwa-install-dismissed");if(g){const N=parseInt(g,10);if(Date.now()-N<1*60*60*1e3){c(!0);return}}const u=N=>{N.preventDefault(),t(N),i(!0)};window.addEventListener("beforeinstallprompt",u),window.addEventListener("appinstalled",()=>{r(!0),i(!1),t(null)});const f=setTimeout(()=>{!n&&!g&&!a&&(console.log("PWA: Showing install prompt for development/testing"),i(!0))},3e3);return()=>{window.removeEventListener("beforeinstallprompt",u),clearTimeout(f)}},[]);const x=async()=>{if(s){s.prompt();const{outcome:b}=await s.userChoice;b==="accepted"&&r(!0),t(null),i(!1)}else console.log("PWA: No deferred prompt available, attempting manual install"),alert(`To install this app:

1. Click the menu button (â‹®) in your browser
2. Select 'Add to Home screen' or 'Install app'
3. Follow the prompts to install`),i(!1),c(!0),localStorage.setItem("pwa-install-dismissed",Date.now().toString())},m=()=>{c(!0),i(!1),localStorage.setItem("pwa-install-dismissed",Date.now().toString())};return n||d||!a?null:e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-white border-b shadow-md p-3 z-[60]","data-testid":"pwa-install-prompt",children:e.jsxs("div",{className:"container mx-auto max-w-7xl flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg overflow-hidden",children:e.jsx("img",{src:kt,alt:"App Icon",className:"w-full h-full object-contain"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm","data-testid":"text-install-title",children:"Install App"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Install for quick access and offline use."})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(p,{size:"sm",onClick:x,"data-testid":"button-install-app",children:"Install"}),e.jsx(p,{size:"icon",variant:"ghost",onClick:m,"data-testid":"button-close-install",children:e.jsx(rt,{className:"w-4 h-4"})})]})]})})}function ve(){const s=Hs(),[t,a]=o.useState(null),[i,n]=o.useState(!0),[r,d]=o.useState(null),[c,x]=o.useState(null),[m,b]=o.useState(!1),[g,u]=o.useState(!1),[f,N]=o.useState(!1),l=o.useRef(!1);o.useEffect(()=>{let W=!0;Fs.auth.getSession().then(({data:j})=>{W&&(a(j.session),n(!1))});const{data:{subscription:L}}=Fs.auth.onAuthStateChange((j,v)=>{(j==="SIGNED_IN"||j==="TOKEN_REFRESHED")&&a(v),j==="SIGNED_OUT"&&(a(null),s.setQueryData(["/api/auth/me"],{user:null}),s.clear())});return()=>{W=!1,L.unsubscribe()}},[s]),o.useEffect(()=>{!i&&!t&&s.setQueryData(["/api/auth/me"],{user:null})},[t,i,s]);const{data:h,isLoading:y}=ee({queryKey:["/api/auth/me"],enabled:!!(t!=null&&t.access_token),retry:1,retryDelay:1e3,refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:10*60*1e3,gcTime:30*60*1e3,queryFn:async()=>{const W=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${t.access_token}`}});return W.ok?W.json():{user:null}}}),M=(h==null?void 0:h.user)??null,S=h==null?void 0:h.agent,k=!!M,C=i||!!(t!=null&&t.access_token)&&y;return{user:M,agent:S,isAuthenticated:k,isLoading:C,login:async({email:W,password:L})=>{b(!0),d(null);const{error:j}=await Fs.auth.signInWithPassword({email:W.trim(),password:L});return j?(d(j.message),b(!1),{error:j.message}):(s.invalidateQueries({queryKey:["/api/auth/me"]}),b(!1),{success:!0})},register:async({email:W,password:L,name:j,phone:v})=>{u(!0),x(null);try{console.log("[AUTH-REGISTER] Attempting registration:",{email:W,name:j,phone:v});const I=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:W.trim(),password:L,name:j.trim(),phone:(v==null?void 0:v.trim())||null})}),A=await I.json();if(console.log("[AUTH-REGISTER] Response status:",I.status,"Data:",A),!I.ok){const B=A.error||"Registration failed";return console.error("[AUTH-REGISTER] Error:",B),x(B),u(!1),{error:B}}return console.log("[AUTH-REGISTER] Setting Supabase session with tokens"),A.access_token&&A.refresh_token&&await Fs.auth.setSession({access_token:A.access_token,refresh_token:A.refresh_token}),s.invalidateQueries({queryKey:["/api/auth/me"]}),u(!1),console.log("[AUTH-REGISTER] Registration successful"),{success:!0}}catch(I){const A=I.message||"Registration failed";return console.error("[AUTH-REGISTER] Exception:",A),x(A),u(!1),{error:A}}},logout:async()=>{if(l.current){console.log("Logout already in progress, skipping duplicate call");return}try{l.current=!0,N(!0);const W=setTimeout(()=>{console.warn("Logout taking too long, forcing redirect..."),window.location.href="/"},3e3);s.clear(),vi(),await Fs.auth.signOut(),a(null),clearTimeout(W),window.location.href="/"}catch(W){console.error("Logout error:",W),s.clear(),a(null),window.location.href="/"}finally{N(!1),l.current=!1}},loginError:r,registerError:c,isLoginLoading:m,isRegisterLoading:g,isLoggingOut:f}}function Gl({size:s="md",className:t,text:a}){const i={sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8"};return e.jsxs("div",{className:_("flex flex-col items-center justify-center gap-2",t),children:[e.jsx(re,{className:_("animate-spin text-primary",i[s])}),a&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a})]})}function Ua({text:s="Loading..."}){return e.jsx("div",{className:"flex h-[50vh] items-center justify-center",children:e.jsx(Gl,{size:"lg",text:s})})}function Ts({rows:s=5}){return e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-10 bg-muted rounded"}),Array.from({length:s}).map((t,a)=>e.jsx("div",{className:"h-14 bg-muted/50 rounded"},a))]})}function je({path:s,component:t,requiredRole:a,requiredRoles:i,fallbackPath:n="/login"}){const{user:r,isLoading:d}=ve();return e.jsx(Je,{path:s,children:c=>!d&&!r?e.jsx(Ca,{to:n}):d?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Gl,{size:"lg"})}):a&&r.role!==a?e.jsx(Ca,{to:"/"}):i&&!i.includes(r.role)?e.jsx(Ca,{to:"/"}):e.jsx(t,{...c})})}const Mi=Yt("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Is=o.forwardRef(({className:s,variant:t,...a},i)=>e.jsx("div",{ref:i,role:"alert",className:_(Mi({variant:t}),s),...a}));Is.displayName="Alert";const Wt=o.forwardRef(({className:s,...t},a)=>e.jsx("h5",{ref:a,className:_("mb-1 font-medium leading-none tracking-tight",s),...t}));Wt.displayName="AlertTitle";const Es=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:_("text-sm [&_p]:leading-relaxed",s),...t}));Es.displayName="AlertDescription";const F=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:_("rounded-xl border border-border bg-card text-card-foreground shadow-md hover:shadow-lg transition-all duration-200",s),...t}));F.displayName="Card";const $=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:_("flex flex-col space-y-2 p-6 pb-4",s),...t}));$.displayName="CardHeader";const G=o.forwardRef(({className:s,...t},a)=>e.jsx("h3",{ref:a,className:_("text-xl font-semibold leading-tight tracking-tight",s),...t}));G.displayName="CardTitle";const te=o.forwardRef(({className:s,...t},a)=>e.jsx("p",{ref:a,className:_("text-sm text-muted-foreground leading-relaxed",s),...t}));te.displayName="CardDescription";const D=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:_("p-6 pt-0",s),...t}));D.displayName="CardContent";const Li=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:_("flex items-center p-6 pt-0",s),...t}));Li.displayName="CardFooter";class _i extends o.Component{constructor(a){super(a);Pa(this,"handleReload",()=>{window.location.reload()});Pa(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a,errorInfo:null}}componentDidCatch(a,i){console.error("ErrorBoundary caught an error:",a,i),this.setState({error:a,errorInfo:i})}render(){var a;return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs(F,{className:"max-w-2xl w-full",children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"rounded-full bg-red-100 dark:bg-red-900/30 p-3",children:e.jsx(ks,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx(G,{className:"text-2xl",children:"Something went wrong"}),e.jsx(te,{className:"mt-1",children:"The application encountered an unexpected error"})]})]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs(Is,{variant:"destructive",children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsx(Wt,{children:"Error Details"}),e.jsx(Es,{className:"mt-2",children:((a=this.state.error)==null?void 0:a.message)||"An unknown error occurred"})]}),!1,e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please try one of the following options:"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(p,{onClick:this.handleReload,className:"flex items-center gap-2 flex-1",children:[e.jsx(Ra,{className:"h-4 w-4"}),"Reload Page"]}),e.jsx(p,{onClick:this.handleReset,variant:"outline",className:"flex-1",children:"Try Again"})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"ðŸ’¡ Tip:"})," If this error persists, try clearing your browser cache or contact support."]})})]})]})]})}):this.props.children}}function $i(){const[s,t]=o.useState(navigator.onLine),[a,i]=o.useState(!1);return o.useEffect(()=>{const n=()=>{t(!0),i(!1)},r=()=>{t(!1),i(!0)};window.addEventListener("online",n),window.addEventListener("offline",r);const d=setInterval(()=>{!navigator.onLine&&s&&(t(!1),i(!0))},3e4);return()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r),clearInterval(d)}},[s]),o.useEffect(()=>{if(s&&a){const n=setTimeout(()=>{i(!1)},3e3);return()=>clearTimeout(n)}},[s,a]),!a&&s?null:e.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-[9999] max-w-md w-full px-4",children:s?e.jsxs(Is,{className:"shadow-lg bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800",children:[e.jsx(ks,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),e.jsxs(Es,{className:"ml-2 text-green-800 dark:text-green-200",children:[e.jsx("strong",{children:"Back Online"}),e.jsx("p",{className:"text-xs mt-1",children:"Connection restored successfully."})]})]}):e.jsxs(Is,{variant:"destructive",className:"shadow-lg",children:[e.jsx(Pn,{className:"h-4 w-4"}),e.jsxs(Es,{className:"ml-2",children:[e.jsx("strong",{children:"No Internet Connection"}),e.jsx("p",{className:"text-xs mt-1",children:"You're offline. Some features may not work properly."})]})]})})}const tr=5*60*1e3;function zi(){const{logout:s,user:t}=ve(),{toast:a}=fe(),i=o.useRef(),n=o.useRef(),r=o.useRef(Date.now()),d=o.useRef(0),c=o.useCallback(()=>{const b=Date.now();b-d.current<1e3||(d.current=b,r.current=b,i.current&&clearTimeout(i.current),n.current&&clearTimeout(n.current),t&&(i.current=window.setTimeout(async()=>{try{console.log("Session timeout: Logging out user due to inactivity"),await s()}catch(g){console.error("Session timeout logout error:",g),window.location.href="/login"}},tr)))},[t,s,a]),x=o.useCallback(()=>{c()},[c]);return o.useEffect(()=>{if(!t){i.current&&clearTimeout(i.current),n.current&&clearTimeout(n.current);return}c();const b=["mousedown","mousemove","keypress","scroll","touchstart","touchmove","click"];return b.forEach(g=>{document.addEventListener(g,x,!0)}),()=>{b.forEach(g=>{document.removeEventListener(g,x,!0)}),i.current&&clearTimeout(i.current),n.current&&clearTimeout(n.current)}},[t,x,c]),{getTimeUntilLogout:o.useCallback(()=>{if(!t)return null;const b=Date.now()-r.current;return Math.max(0,tr-b)},[t]),resetTimer:x}}function Gi({children:s}){const[t]=ze(),{user:a,isLoading:i}=ve(),{data:n,isLoading:r}=ee({queryKey:["/api/break-settings"],refetchInterval:5*60*1e3,staleTime:4*60*1e3});if((i||r)&&!n&&!a)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(t.startsWith("/admin"))return e.jsx(e.Fragment,{children:s});const c=["/login","/register"].includes(t);return(a==null?void 0:a.role)==="admin"||c?e.jsx(e.Fragment,{children:s}):n!=null&&n.isEnabled?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:e.jsxs("div",{className:"max-w-md w-full text-center space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:e.jsx(ys,{className:"h-10 w-10 text-red-600 dark:text-red-400"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx(rt,{className:"h-3 w-3 text-white"})})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:"Site Closed"}),e.jsx("div",{className:"text-muted-foreground whitespace-pre-wrap text-left bg-muted p-4 rounded-lg",children:n.message||"The site is currently closed. Please check back later."})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"We apologize for any inconvenience."})]})}):e.jsx(e.Fragment,{children:s})}const Ui=Yt("whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 hover-elevate ",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow-xs",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground shadow-xs",outline:" border [border-color:var(--badge-outline)] shadow-xs"}},defaultVariants:{variant:"default"}});function Z({className:s,variant:t,...a}){return e.jsx("div",{className:_(Ui({variant:t}),s),...a})}function qi(s){if(Array.isArray(s.audiences))return s.audiences;if(typeof s.audiences=="string")try{const t=JSON.parse(s.audiences);return Array.isArray(t)?t:[t]}catch{return[s.audiences]}return s.audience?[s.audience]:["all"]}function Wi(s){const t=/(https?:\/\/[^\s]+)/g;return s.split(t).map((i,n)=>t.test(i)?e.jsxs("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-flex items-start gap-1 break-all sm:items-center sm:gap-1",children:[e.jsx("span",{className:"break-all",children:i}),e.jsx(vt,{className:"h-3 w-3 flex-shrink-0 mt-0.5 sm:mt-0"})]},n):i)}function Ki(){const{user:s}=ve(),[t]=ze(),a=(t==null?void 0:t.startsWith("/store/"))??!1,[i,n]=o.useState(!1),[r,d]=o.useState([]);o.useEffect(()=>{const f=localStorage.getItem("dismissedAnnouncements");f&&d(JSON.parse(f))},[]);const{data:c=[]}=ee({queryKey:["announcements"],queryFn:()=>Q("GET","/api/announcements/active"),enabled:!a,staleTime:5*60*1e3,refetchOnWindowFocus:!1}),m=(f=>{var h;const N=(h=s==null?void 0:s.role)==null?void 0:h.toLowerCase(),l=!!s;return f.filter(y=>{const M=qi(y).map(S=>S.toLowerCase());return!!(M.includes("all")||M.includes("guest")&&!l||M.includes("loggedin")&&l||M.includes("agent")&&N==="agent"||M.includes("storefront")&&a)})})(c);o.useEffect(()=>{if(m.length>0){const f=m.some(N=>!r.includes(N.id));n(f)}},[m,r]);const b=f=>{const N=[...r,f];d(N),localStorage.setItem("dismissedAnnouncements",JSON.stringify(N))},g=()=>{const f=[...r,...m.map(N=>N.id)];d(f),localStorage.setItem("dismissedAnnouncements",JSON.stringify(f)),n(!1)};if(a||!i||m.length===0)return null;const u=m.filter(f=>!r.includes(f.id));return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-3 md:p-4 bg-black/50 backdrop-blur-sm",children:e.jsx("div",{className:"w-full max-w-2xl max-h-[85vh] md:max-h-[80vh] overflow-y-auto",children:e.jsxs(F,{className:"relative shadow-2xl border-0 bg-white text-black",children:[e.jsx($,{className:"pb-3 md:pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"p-1.5 md:p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full",children:e.jsx(Cn,{className:"h-4 w-4 md:h-5 md:w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(G,{className:"text-xl md:text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Important Announcements"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Stay updated with the latest news"})]})]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:g,className:"h-7 w-7 md:h-8 md:w-8 p-0 hover:bg-gray-100 hover:text-gray-800 text-gray-600 flex-shrink-0",children:e.jsx(rt,{className:"h-3 w-3 md:h-4 md:w-4"})})]})}),e.jsxs(D,{className:"space-y-3 md:space-y-4",children:[u.map(f=>e.jsx("div",{className:"relative group p-3 md:p-4 rounded-xl border border-gray-200 bg-gradient-to-r from-white to-blue-50/30 hover:shadow-lg transition-all duration-300",children:e.jsxs("div",{className:"flex items-start gap-2 md:gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("div",{className:"p-1 md:p-1.5 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full",children:e.jsx(ja,{className:"h-3 w-3 md:h-3 md:w-3 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1 md:mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm md:text-base break-words",children:f.title}),e.jsx(Z,{variant:"secondary",className:"text-xs md:text-sm bg-blue-100 text-blue-700 border-blue-200 px-1.5 py-0.5 flex-shrink-0",children:"New"})]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>b(f.id),className:"flex-shrink-0 h-6 w-6 md:h-6 md:w-6 p-0 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity hover:bg-gray-200 text-gray-500 hover:text-gray-800",title:"Dismiss this announcement",children:e.jsx(rt,{className:"h-3 w-3"})})]}),e.jsx("div",{className:"text-sm md:text-base text-gray-700 leading-relaxed break-words overflow-wrap-anywhere",children:Wi(f.message)}),e.jsx("div",{className:"mt-2 md:mt-3 text-xs md:text-sm text-gray-500",children:new Date(f.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})})]})]})},f.id)),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center pt-3 md:pt-4 border-t border-gray-200 gap-3 sm:gap-0",children:[e.jsxs("p",{className:"text-xs md:text-sm text-gray-500",children:[u.length," announcement",u.length!==1?"s":""," remaining"]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:g,className:"hover:bg-gray-100 text-gray-700 border-gray-300 text-xs md:text-sm h-8 md:h-9 px-3 md:px-4 flex-1 sm:flex-initial",children:"Dismiss All"}),e.jsx(p,{onClick:g,size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white border-0 text-xs md:text-sm h-8 md:h-9 px-3 md:px-4 flex-1 sm:flex-initial",children:"Got it!"})]})]})]})]})})})}function ke({className:s}){const{theme:t,setTheme:a}=nt(),i=()=>{const n=t==="light"?"dark":"light";console.log("Theme toggle clicked. Current theme:",t,"New theme:",n),a(n)};return e.jsxs(p,{variant:"ghost",size:"sm",onClick:i,"data-testid":"button-theme-toggle",className:_("h-8 w-8",s),children:[t==="light"?e.jsx(An,{className:"h-4 w-4 transition-all"}):e.jsx(Tn,{className:"h-4 w-4 transition-all"}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}const Hi=In,Vi=En,Yi=o.forwardRef(({className:s,inset:t,children:a,...i},n)=>e.jsxs(Tr,{ref:n,className:_("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",s),...i,children:[a,e.jsx(pa,{className:"ml-auto"})]}));Yi.displayName=Tr.displayName;const Xi=o.forwardRef(({className:s,...t},a)=>e.jsx(Fr,{ref:a,className:_("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...t}));Xi.displayName=Fr.displayName;const Ul=o.forwardRef(({className:s,sideOffset:t=4,...a},i)=>e.jsx(Fn,{children:e.jsx(Ir,{ref:i,sideOffset:t,className:_("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...a})}));Ul.displayName=Ir.displayName;const ua=o.forwardRef(({className:s,inset:t,...a},i)=>e.jsx(Er,{ref:i,className:_("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",s),...a}));ua.displayName=Er.displayName;const Qi=o.forwardRef(({className:s,children:t,checked:a,...i},n)=>e.jsxs(Br,{ref:n,className:_("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:a,...i,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Or,{children:e.jsx(Rs,{className:"h-4 w-4"})})}),t]}));Qi.displayName=Br.displayName;const Ji=o.forwardRef(({className:s,children:t,...a},i)=>e.jsxs(Rr,{ref:i,className:_("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Or,{children:e.jsx(Dr,{className:"h-2 w-2 fill-current"})})}),t]}));Ji.displayName=Rr.displayName;const Zi=o.forwardRef(({className:s,inset:t,...a},i)=>e.jsx(Mr,{ref:i,className:_("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",s),...a}));Zi.displayName=Mr.displayName;const ql=o.forwardRef(({className:s,...t},a)=>e.jsx(Lr,{ref:a,className:_("-mx-1 my-1 h-px bg-muted",s),...t}));ql.displayName=Lr.displayName;const aa=o.forwardRef(({className:s,...t},a)=>e.jsx(_r,{ref:a,className:_(`
      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10
      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,s),...t}));aa.displayName=_r.displayName;const ec=o.forwardRef(({className:s,...t},a)=>e.jsx($r,{ref:a,className:_("aspect-square h-full w-full",s),...t}));ec.displayName=$r.displayName;const ra=o.forwardRef(({className:s,...t},a)=>e.jsx(zr,{ref:a,className:_("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...t}));ra.displayName=zr.displayName;const ms=qr,Vs=Wr,sc=Gr,Wl=o.forwardRef(({className:s,...t},a)=>e.jsx(fa,{className:_("fixed inset-0 z-40 bg-black/50 dark:bg-white/20 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));Wl.displayName=fa.displayName;const tc=Yt("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),es=o.forwardRef(({side:s="right",className:t,children:a,...i},n)=>e.jsxs(sc,{children:[e.jsx(Wl,{}),e.jsxs(ba,{ref:n,className:_(tc({side:s}),t),...i,children:[a,e.jsxs(Ur,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));es.displayName=ba.displayName;const xs=o.forwardRef(({className:s,...t},a)=>e.jsx(Na,{ref:a,className:_("text-lg font-semibold text-foreground",s),...t}));xs.displayName=Na.displayName;const hs=o.forwardRef(({className:s,...t},a)=>e.jsx(va,{ref:a,className:_("text-sm text-muted-foreground",s),...t}));hs.displayName=va.displayName;const mt="resellershubprogh",Ds=[{id:"mtn",name:"MTN",color:"#FFCC00",textColor:"#000000"},{id:"telecel",name:"TELECEL",color:"#E60000",textColor:"#FFFFFF"},{id:"at_bigtime",name:"AT Bigtime",color:"#FF0000",textColor:"#FFFFFF"},{id:"at_ishare",name:"AT ishare",color:"#FF0000",textColor:"#FFFFFF"}],qa=[{id:"bece",name:"BECE",description:"Basic Education Certificate Examination"},{id:"wassce",name:"WASSCE",description:"West African Senior School Certificate Examination"}],Kl={pending:{label:"Pending",color:"bg-orange-500 text-white"},approved:{label:"Approved",color:"bg-blue-500 text-white"},rejected:{label:"Rejected",color:"bg-red-500 text-white"},paid:{label:"Paid",color:"bg-green-500 text-white"}},ie=s=>{const t=typeof s=="string"?parseFloat(s):s;return new Intl.NumberFormat("en-GH",{style:"currency",currency:"GHS",minimumFractionDigits:2}).format(t)},Ze=s=>{const t=typeof s=="string"?new Date(s):s;return new Intl.DateTimeFormat("en-GH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)},_t="/assets/darkmode-icon.D6ALZWof.png",Hl="agentStore";function ac(){localStorage.removeItem(Hl)}function Ms(){return localStorage.getItem(Hl)}const us=qr,St=Wr,rc=Gr,Vl=o.forwardRef(({className:s,...t},a)=>e.jsx(fa,{ref:a,className:_("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t}));Vl.displayName=fa.displayName;const ss=o.forwardRef(({className:s,children:t,...a},i)=>e.jsxs(rc,{children:[e.jsx(Vl,{}),e.jsxs(ba,{ref:i,className:_("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a,children:[t,e.jsxs(Ur,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ss.displayName=ba.displayName;const ts=({className:s,...t})=>e.jsx("div",{className:_("flex flex-col space-y-1.5 text-center sm:text-left",s),...t});ts.displayName="DialogHeader";const la=({className:s,...t})=>e.jsx("div",{className:_("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});la.displayName="DialogFooter";const as=o.forwardRef(({className:s,...t},a)=>e.jsx(Na,{ref:a,className:_("text-lg font-semibold leading-none tracking-tight",s),...t}));as.displayName=Na.displayName;const Ks=o.forwardRef(({className:s,...t},a)=>e.jsx(va,{ref:a,className:_("text-sm text-muted-foreground",s),...t}));Ks.displayName=va.displayName;const it=Bn,Ys=o.forwardRef(({className:s,...t},a)=>e.jsx(Kr,{ref:a,className:_("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...t}));Ys.displayName=Kr.displayName;const De=o.forwardRef(({className:s,...t},a)=>e.jsx(Hr,{ref:a,className:_("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...t}));De.displayName=Hr.displayName;const Ue=o.forwardRef(({className:s,...t},a)=>e.jsx(Vr,{ref:a,className:_("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));Ue.displayName=Vr.displayName;const ar=[{id:"guest",category:"guest",title:"How to Use Resellers Data Hub Pro Gh",description:"Choose your options and see how to get started with Resellers Data Hub Pro Gh services.",url:"https://cdn.example.com/videos/how-to-use-dahtahome.mp4"},{id:"customer",category:"customer",title:"How to Purchase as Customer",description:"Learn how to buy data bundles, track orders, and manage your purchases.",url:"https://cdn.example.com/videos/how-to-purchase-as-customer.mp4"},{id:"agent",category:"agent",title:"How to Become an Agent",description:"Discover how to join our agent program, earn commissions, and grow your business.",url:"https://cdn.example.com/videos/how-to-become-agent.mp4"}];function Yl({label:s="Watch How to Purchase",description:t="Learn the quickest way to purchase bundles or become an agent.",triggerVariant:a="outline",triggerSize:i="default",className:n}){const[r,d]=o.useState(!1),[c,x]=o.useState("guest"),[m,b]=o.useState(null),{data:g}=ee({queryKey:["/api/guides",c],queryFn:async()=>await Q("GET",`/api/guides?category=${c}`)}),u=o.useMemo(()=>{const l=Array.isArray(g)?g:[],h=ar.filter(y=>y.category===c);return l.length>0?l:h},[c,g]),f=m&&m.category===c?m:u[0]||null,N=()=>{var h,y,M;if(!(f!=null&&f.url))return e.jsx("div",{className:"rounded-lg border p-6 bg-muted/50 text-sm text-muted-foreground",children:"Video will appear here once an admin uploads it."});if(f.url.includes("youtube.com")||f.url.includes("youtu.be")||f.url.includes("vimeo.com")){let S=f.url;if(S.includes("youtube.com/watch")){const k=new URL(S).searchParams.get("v");k&&(S=`https://www.youtube.com/embed/${k}`)}else if(S.includes("youtube.com/shorts/")){const k=(h=S.split("/shorts/")[1])==null?void 0:h.split("?")[0];k&&(S=`https://www.youtube.com/embed/${k}`)}else if(S.includes("youtu.be/")){const k=(y=S.split("youtu.be/")[1])==null?void 0:y.split("?")[0];k&&(S=`https://www.youtube.com/embed/${k}`)}else if(S.includes("vimeo.com/")&&!S.includes("player.vimeo.com")){const k=(M=S.split("vimeo.com/")[1])==null?void 0:M.split("?")[0];k&&(S=`https://player.vimeo.com/video/${k}`)}return e.jsx("div",{className:"rounded-lg md:rounded-none overflow-hidden border bg-black aspect-video md:aspect-auto md:h-64",children:e.jsx("iframe",{src:S,title:f.title,className:"w-full h-full md:h-64",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})}return e.jsx("div",{className:"rounded-lg md:rounded-none overflow-hidden border bg-black aspect-video md:aspect-auto md:h-64",children:e.jsxs("video",{className:"w-full h-full md:h-64",controls:!0,poster:void 0,children:[e.jsx("source",{src:f.url}),"Your browser does not support the video tag."]})})};return e.jsxs(e.Fragment,{children:[e.jsxs(p,{variant:a,size:i,className:_("border-2 border-yellow-500 bg-yellow-500 text-black hover:bg-yellow-600 dark:hover:bg-yellow-600 transition-colors font-semibold",n),onClick:()=>d(!0),children:[e.jsx(Da,{className:"h-4 w-4 mr-2"}),s]}),e.jsx(us,{open:r,onOpenChange:d,children:e.jsxs(ss,{className:"max-w-4xl bg-card text-card-foreground md:rounded-none",style:{backgroundColor:"hsl(var(--card))",opacity:1},children:[e.jsxs(ts,{children:[e.jsxs(as,{className:"flex items-center gap-2",children:[e.jsx(Yr,{className:"h-5 w-5"}),"How to Use Resellers Data Hub Pro Gh"]}),e.jsx(Ks,{children:t})]}),e.jsxs(it,{value:c,onValueChange:l=>x(l),children:[e.jsxs(Ys,{className:"grid grid-cols-3 w-full gap-2",children:[e.jsx(De,{value:"guest",className:"border-2 border-primary rounded-md md:rounded-none px-3 py-2 transition-colors hover:bg-primary/10 data-[state=active]:text-green-500 data-[state=active]:border-primary data-[state=active]:font-semibold",children:"Guest"}),e.jsx(De,{value:"customer",className:"border-2 border-primary rounded-md md:rounded-none px-3 py-2 transition-colors hover:bg-primary/10 data-[state=active]:text-green-500 data-[state=active]:border-primary data-[state=active]:font-semibold",children:"Customer"}),e.jsx(De,{value:"agent",className:"border-2 border-primary rounded-md md:rounded-none px-3 py-2 transition-colors hover:bg-primary/10 data-[state=active]:text-green-500 data-[state=active]:border-primary data-[state=active]:font-semibold",children:"Agent"})]}),["guest","customer","agent"].map(l=>{const h=l===c?u:ar.filter(y=>y.category===l);return e.jsxs(Ue,{value:l,className:"space-y-4 pt-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:h.map(y=>e.jsxs(F,{className:`h-full md:rounded-none ${(f==null?void 0:f.id)===y.id?"border-primary":""}`,children:[e.jsxs($,{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{variant:"secondary",className:"capitalize",children:y.category}),(f==null?void 0:f.id)===y.id&&e.jsx(Ft,{className:"h-4 w-4 text-primary"})]}),e.jsx(G,{className:"text-base leading-tight",children:y.title}),e.jsx(te,{className:"text-xs leading-snug",children:y.description})]}),e.jsx(D,{className:"space-y-3",children:e.jsxs(p,{variant:(f==null?void 0:f.id)===y.id?"default":"outline",size:"sm",className:"w-full",onClick:()=>b(y),children:[e.jsx(Da,{className:"h-4 w-4 mr-2"}),(f==null?void 0:f.id)===y.id?"Playing":"Play"]})})]},y.id))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(He,{className:"h-4 w-4 text-primary"}),(f==null?void 0:f.title)||"Select a video"]}),N()]})]},l)})]})]})})]})}function gs(){const{user:s,isAuthenticated:t,logout:a,isLoggingOut:i,isLoading:n}=ve(),{theme:r}=nt(),[d]=ze(),[c,x]=o.useState(!1),m=typeof window<"u"?Ms():null,b=f=>f?f.split(" ").map(N=>N[0]).join("").toUpperCase().slice(0,2):"U",g=()=>s?s.role==="admin"?"/admin":s.role==="agent"?"/agent/dashboard":s.role==="dealer"?"/dealer/dashboard":s.role==="super_dealer"?"/super-dealer/dashboard":s.role==="master"?"/master/dashboard":s.role==="user"?"/user/dashboard":"/":"/login",u=[{href:"/",label:"Home",icon:On},{href:"/data-bundles",label:"Data Bundles",icon:Ee},{href:"/products/result-checkers",label:"Result Checkers",icon:It}];return e.jsxs("header",{className:`sticky top-0 z-50 w-full border-b shadow-sm ${r==="dark"?"bg-black":"bg-white"}`,children:[e.jsx(X,{href:m?`/store/${m}`:"/",className:"absolute top-4 left-0 z-10 flex items-center hover:opacity-80 transition-opacity pl-4",children:e.jsx("img",{src:r==="dark"?_t:kt,alt:mt,className:"h-6 md:h-10 w-auto"})}),e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex h-16 items-center justify-between",children:[e.jsx("div",{className:"w-32"}),!m&&e.jsx("nav",{className:"hidden md:flex items-center gap-8",children:u.map(f=>{const N=f.icon,l=d===f.href;return e.jsxs(X,{href:f.href,className:`flex items-center gap-2 text-sm font-medium transition-colors hover:text-primary px-3 py-2 rounded-md ${l?"bg-yellow-500 text-white":"text-muted-foreground hover:text-primary"}`,children:[e.jsx(N,{className:"w-4 h-4"}),f.label]},f.href)})}),e.jsxs("div",{className:"flex items-center gap-3",children:[d==="/"&&e.jsx("div",{className:"hidden md:flex",children:e.jsx(Yl,{triggerVariant:"outline",triggerSize:"sm"})}),e.jsx(ke,{}),!d.startsWith("/products")&&d!=="/"&&d!=="/data-bundles"&&e.jsxs(ms,{open:c,onOpenChange:x,children:[e.jsx(Vs,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm",className:"md:hidden","aria-label":"Open menu",children:e.jsx(Ne,{className:"h-5 w-5"})})}),e.jsx(es,{side:"right",className:`w-80 ${r==="dark"?"bg-black":"bg-white"}`,style:{backgroundColor:r==="dark"?"#000000":"#ffffff"},children:e.jsxs("div",{className:"flex flex-col gap-6 mt-6",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"text-lg font-bold text-primary",children:mt})}),e.jsx("nav",{className:"flex flex-col gap-2",children:u.map(f=>{const N=f.icon,l=d===f.href;return e.jsxs(X,{href:f.href,onClick:()=>x(!1),className:`flex items-center gap-3 text-base font-medium transition-colors hover:text-primary px-4 py-3 rounded-lg ${l?"bg-yellow-500 text-white":"text-muted-foreground hover:text-primary"}`,children:[e.jsx(N,{className:"w-5 h-5"}),f.label]},f.href)})})]})})]}),n?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground hidden sm:inline",children:"Loading..."})]}):t&&s&&s.email?e.jsxs(Hi,{children:[e.jsx(Vi,{asChild:!0,children:e.jsx(p,{variant:"ghost",className:"relative h-9 w-9 rounded-full bg-yellow-500 hover:bg-yellow-600 transition-colors","aria-label":"User menu",children:e.jsx(aa,{className:"h-8 w-8",children:e.jsx(ra,{className:"bg-yellow-500 text-white text-sm font-medium",children:b(s.name)})})})}),e.jsxs(Ul,{align:"end",className:"w-64 bg-yellow-500",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border-b border-yellow-600",children:[e.jsx(aa,{className:"h-10 w-10 flex-shrink-0",children:e.jsx(ra,{className:"bg-yellow-600 text-white",children:b(s.name)})}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-semibold text-sm text-black truncate",children:s.name||"User"}),e.jsx("span",{className:"text-xs text-black/70 truncate",children:s.email})]}),e.jsx("span",{className:"text-xs text-black/80 capitalize font-medium mt-1",children:s.role})]})]}),e.jsx(ua,{asChild:!0,children:e.jsxs(X,{href:g(),className:"flex items-center gap-2 cursor-pointer text-black hover:bg-yellow-600 focus:bg-yellow-600 focus:text-black",children:[e.jsx(ya,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"Dashboard"})]})}),s.role==="agent"&&e.jsx(ua,{asChild:!0,children:e.jsxs(X,{href:"/agent/storefront",className:"flex items-center gap-2 cursor-pointer text-black hover:bg-yellow-600 focus:bg-yellow-600 focus:text-black",children:[e.jsx(ot,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"My Store"})]})}),e.jsx(ql,{className:"bg-yellow-600"}),e.jsxs(ua,{onClick:a,disabled:i,className:"flex items-center gap-2 cursor-pointer text-black hover:bg-yellow-600 focus:bg-yellow-600 focus:text-black",children:[e.jsx(ta,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:i?"Signing out...":"Sign out"})]})]})]}):e.jsxs("div",{className:"flex items-center gap-0.5 md:gap-1",children:[e.jsx(p,{asChild:!0,variant:"ghost",size:"sm",className:"h-6 px-1.5 text-xs md:h-7 md:px-2",children:e.jsx(X,{href:"/login",children:"Sign In"})}),e.jsx(p,{asChild:!0,size:"sm",className:"h-6 px-1.5 text-xs md:h-7 md:px-2",children:e.jsx(X,{href:"/register",children:"Get Started"})})]})]})]})})]})}function zs(){const{theme:s}=nt();return e.jsx("footer",{className:"border-t bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-7xl px-4 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("img",{src:s==="dark"?_t:kt,alt:"ResellersHub Pro",className:"h-8 w-auto"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your trusted platform for data bundles and result checker purchases in Ghana."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Products"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("li",{children:"MTN Data Bundles"}),e.jsx("li",{children:"Telecel Data Bundles"}),e.jsx("li",{children:"AirtelTigo Data Bundles"}),e.jsx("li",{children:"BECE Result Checkers"}),e.jsx("li",{children:"WASSCE Result Checkers"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"For Agents"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("li",{children:"Become an Agent"}),e.jsx("li",{children:"Agent Dashboard"}),e.jsx("li",{children:"Custom Storefronts"}),e.jsx("li",{children:"Profit Withdrawals"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Security & Payments"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(dt,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Secure"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(ys,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Encrypted"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("div",{className:"rounded bg-white dark:bg-black p-2",children:e.jsx(Rn,{className:"h-6 w-10 text-[#1A1F71]"})}),e.jsx("div",{className:"rounded bg-white dark:bg-black p-2",children:e.jsx(Dn,{className:"h-6 w-10 text-[#EB001B]"})}),e.jsx("div",{className:"rounded bg-[#00C3F7] px-2 py-1",children:e.jsx("span",{className:"text-white font-bold text-xs",children:"Paystack"})})]})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t text-center text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Â© ",new Date().getFullYear()," ",mt,". All rights reserved."]}),e.jsxs("p",{className:"mt-2",children:["Developed by"," ",e.jsx("a",{href:"https://bm-portfolio-up2x.onrender.com",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 font-medium",children:"BlusMotif"})]})]})]})})}const Xl=o.forwardRef(({className:s,title:t,subtitle:a,description:i,aboveButtons:n,badge:r,primaryButton:d,secondaryButton:c,images:x=[],showNavigation:m=!1,background:b="gradient",overlay:g=!0,height:u="lg",align:f="center",size:N="lg",children:l,...h},y)=>{const[M,S]=o.useState(0);o.useEffect(()=>{if(x.length>1){const W=setInterval(()=>{S(L=>(L+1)%x.length)},5e3);return()=>clearInterval(W)}},[x.length]);const k={sm:"h-[50vh]",md:"h-[60vh]",lg:"h-[70vh]",xl:"h-[80vh]",full:"h-screen"},C={sm:"text-3xl sm:text-4xl",md:"text-4xl sm:text-5xl lg:text-6xl",lg:"text-4xl sm:text-5xl lg:text-7xl"},E=()=>{S(W=>(W+1)%x.length)},se=()=>{S(W=>(W-1+x.length)%x.length)},H={default:"",gradient:"bg-gradient-to-br from-primary/5 via-background to-secondary/5",image:""};return e.jsxs("section",{ref:y,className:_("relative flex items-center justify-center overflow-hidden",k[u],H[b],s),...h,children:[x.length>0&&e.jsxs(e.Fragment,{children:[x.map((W,L)=>e.jsxs("div",{className:`absolute inset-0 transition-opacity duration-1000 ${L===M?"opacity-100":"opacity-0"}`,children:[e.jsx("img",{src:W,alt:`Hero image ${L+1}`,className:"w-full h-full object-cover"}),g&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/60 via-black/40 to-transparent"})]},L)),m&&x.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:se,className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-white/20 backdrop-blur-sm hover:bg-white/30 transition-colors","aria-label":"Previous image",children:e.jsx(Xr,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:E,className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-white/20 backdrop-blur-sm hover:bg-white/30 transition-colors","aria-label":"Next image",children:e.jsx(pa,{className:"w-6 h-6 text-white"})}),e.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2 z-10",children:x.map((W,L)=>e.jsx("button",{onClick:()=>S(L),className:`w-3 h-3 rounded-full transition-all ${L===M?"bg-white scale-125":"bg-white/50 hover:bg-white/75"}`,"aria-label":`Go to image ${L+1}`},L))})]})]}),e.jsx("div",{className:"relative z-10 flex items-center justify-center h-full",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 text-center",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[r&&e.jsx(Z,{variant:"secondary",className:"mb-6 px-4 py-2 text-sm font-medium",children:r}),a&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:a}),e.jsx("h1",{className:_("font-bold mb-6 tracking-tight",C[N]),children:e.jsx("span",{className:"text-white",children:t})}),i&&e.jsx("p",{className:"text-base sm:text-lg text-white/90 mb-8 max-w-2xl mx-auto leading-relaxed",children:i}),n&&e.jsx("div",{className:"mb-4 flex justify-center",children:n}),(d||c)&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center",children:[d&&e.jsx(p,{size:d.size||"lg",className:_("px-8 py-4 text-lg font-semibold shadow-lg hover:shadow-xl transition-shadow",d.className),asChild:!!d.href,onClick:d.onClick,children:d.href?e.jsxs("a",{href:d.href,className:"flex items-center gap-2",children:[d.text,d.icon&&e.jsx(d.icon,{className:"w-5 h-5"})]}):e.jsxs(e.Fragment,{children:[d.text,d.icon&&e.jsx(d.icon,{className:"w-5 h-5"})]})}),c&&e.jsx(p,{size:c.size||"lg",variant:"outline",className:"px-8 py-4 text-lg font-semibold bg-yellow-500 border-yellow-500 text-black hover:bg-yellow-600",asChild:!!c.href,onClick:c.onClick,children:c.href?e.jsxs("a",{href:c.href,className:"flex items-center gap-2",children:[c.text,c.icon&&e.jsx(c.icon,{className:"w-5 h-5"})]}):e.jsxs(e.Fragment,{children:[c.text,c.icon&&e.jsx(c.icon,{className:"w-5 h-5"})]})})]}),l]})})})]})});Xl.displayName="Hero";function Ea({value:s}){const[t,a]=o.useState(0),[i,n]=o.useState(!1),r=s.match(/(\d+)/),d=r?parseInt(r[1]):0,c=s.replace(/^\d+/,"");return o.useEffect(()=>{o.createRef();const x=new IntersectionObserver(([b])=>{b.isIntersecting&&!i&&n(!0)},{threshold:.5}),m=document.querySelector(`[data-stat-value="${s}"]`);return m&&x.observe(m),()=>{m&&x.unobserve(m)}},[s,i]),o.useEffect(()=>{if(!i)return;const x=2e3,m=Date.now(),b=()=>{const g=Date.now()-m,u=Math.min(g/x,1),N=(h=>1-Math.pow(1-h,2))(u),l=Math.floor(d*N);a(l),u<1?requestAnimationFrame(b):a(d)};requestAnimationFrame(b)},[i,d]),e.jsxs("div",{"data-stat-value":s,children:[t,c]})}const Ql=o.forwardRef(({className:s,title:t,description:a,stats:i,columns:n=4,variant:r="default",...d},c)=>{const x={2:"grid-cols-1 sm:grid-cols-2",3:"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",4:"grid-cols-2 lg:grid-cols-4"};return r==="cards"?e.jsx("section",{ref:c,className:_("py-8 bg-muted/30",s),...d,children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[(t||a)&&e.jsxs("div",{className:"text-center mb-8",children:[t&&e.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-2",children:t}),a&&e.jsx("p",{className:"text-base text-muted-foreground max-w-2xl mx-auto",children:a})]}),e.jsx("div",{className:_("grid gap-4","grid-cols-1 sm:grid-cols-2 lg:grid-cols-4"),children:i.map((m,b)=>{const g=m.icon;return e.jsxs("div",{className:"bg-white dark:bg-black rounded-lg p-4 text-center shadow-sm border hover:shadow-md transition-shadow",children:[g&&e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(g,{className:"w-5 h-5 text-primary"})}),e.jsx("div",{className:"text-2xl font-bold text-primary mb-1",children:e.jsx(Ea,{value:m.value})}),e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:m.label}),m.description&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:m.description})]},b)})})]})}):r==="minimal"?e.jsx("section",{ref:c,className:_("py-12",s),...d,children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:_("grid gap-8",x[n]),children:i.map((m,b)=>{const g=m.icon;return e.jsxs("div",{className:"text-center",children:[g&&e.jsx(g,{className:"w-8 h-8 text-primary mx-auto mb-3"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-primary mb-1",children:e.jsx(Ea,{value:m.value})}),e.jsx("div",{className:"text-sm text-muted-foreground font-medium",children:m.label})]},b)})})})}):e.jsx("section",{ref:c,className:_("py-16 bg-muted/20",s),...d,children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[(t||a)&&e.jsxs("div",{className:"text-center mb-12",children:[t&&e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold mb-4",children:t}),a&&e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:a})]}),e.jsx("div",{className:_("grid gap-8",x[n]),children:i.map((m,b)=>{const g=m.icon;return e.jsxs("div",{className:"text-center",children:[g&&e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(g,{className:"w-8 h-8 text-primary"})}),e.jsx("div",{className:"text-3xl font-bold text-primary mb-2",children:e.jsx(Ea,{value:m.value})}),e.jsx("div",{className:"text-sm text-muted-foreground font-medium",children:m.label}),m.description&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:m.description})]},b)})})]})})});Ql.displayName="Stats";const Jl=o.forwardRef(({className:s,title:t,subtitle:a,description:i,features:n,columns:r=3,variant:d="default",background:c="default",...x},m)=>{const b={default:"",muted:"bg-muted/20",gradient:"bg-gradient-to-br from-primary/5 via-background to-secondary/5"},g={2:"grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 sm:grid-cols-2 lg:grid-cols-4"};return d==="bento"?e.jsx("section",{ref:m,className:_("py-20",b[c],s),...x,children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[(t||a||i)&&e.jsxs("div",{className:"text-center mb-16",children:[a&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:a}),t&&e.jsx("h2",{className:"text-3xl sm:text-4xl font-bold mb-4",children:t}),i&&e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:i})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-6xl mx-auto",children:n.map((u,f)=>{const N=u.icon,l=f===0||f===3;return e.jsx("div",{className:_("group relative overflow-hidden rounded-2xl bg-white dark:bg-black border hover:shadow-xl transition-all duration-300 hover:-translate-y-1",l?"md:col-span-2 md:row-span-1":"md:col-span-1"),children:e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"flex items-start gap-4",children:[N&&e.jsx("div",{className:_("flex-shrink-0 rounded-xl p-3",u.color||"bg-primary/10 text-primary"),children:e.jsx(N,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2 group-hover:text-primary transition-colors",children:u.title}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:u.description})]})]})})},u.id)})})]})}):d==="minimal"?e.jsx("section",{ref:m,className:_("py-16",b[c],s),...x,children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[(t||a||i)&&e.jsxs("div",{className:"text-center mb-12",children:[a&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:a}),t&&e.jsx("h2",{className:"text-3xl sm:text-4xl font-bold mb-4",children:t}),i&&e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:i})]}),e.jsx("div",{className:_("grid gap-8",g[r]),children:n.map(u=>{const f=u.icon;return e.jsxs("div",{className:"text-center",children:[f&&e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(f,{className:"w-6 h-6 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:u.title}),e.jsx("p",{className:"text-muted-foreground",children:u.description})]},u.id)})})]})}):d==="cards"?e.jsx("section",{ref:m,className:_("pt-0 sm:pt-2 pb-12 sm:pb-20",b[c],s),...x,children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-6 lg:px-8",children:[(t||a||i)&&e.jsxs("div",{className:"text-center mb-8 sm:mb-16",children:[a&&e.jsx("div",{className:"text-xs sm:text-sm font-medium text-primary mb-1 sm:mb-2 uppercase tracking-wide",children:a}),t&&e.jsx("h2",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold mb-2 sm:mb-4",children:t}),i&&e.jsx("p",{className:"text-sm sm:text-base lg:text-lg text-muted-foreground max-w-2xl mx-auto",children:i})]}),e.jsx("div",{className:_("grid gap-3 sm:gap-6 lg:gap-8","grid-cols-2 lg:grid-cols-4"),children:n.map(u=>{const f=u.icon;return e.jsx(F,{className:"hover:shadow-lg transition-shadow dark:border-2 dark:border-white bg-card backdrop-blur-sm aspect-square flex flex-col",children:e.jsxs(D,{className:"p-3 sm:p-6 lg:p-8 flex flex-col items-center justify-center h-full text-center",children:[f&&e.jsx("div",{className:_("w-10 sm:w-14 lg:w-16 h-10 sm:h-14 lg:h-16 mx-auto mb-2 sm:mb-4 lg:mb-6 rounded-lg sm:rounded-xl lg:rounded-2xl p-2 sm:p-3 lg:p-4 flex items-center justify-center",u.color||"bg-gradient-to-br from-primary/10 to-primary/5 text-primary"),children:e.jsx(f,{className:"w-5 sm:w-6 lg:w-8 h-5 sm:h-6 lg:h-8"})}),e.jsx("h3",{className:"text-sm sm:text-base lg:text-lg font-semibold mb-1 sm:mb-2 lg:mb-3",children:u.title}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:u.description})]})},u.id)})})]})}):e.jsx("section",{ref:m,className:_("py-20",b[c],s),...x,children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[(t||a||i)&&e.jsxs("div",{className:"text-center mb-16",children:[a&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:a}),t&&e.jsx("h2",{className:"text-3xl sm:text-4xl font-bold mb-4",children:t}),i&&e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:i})]}),e.jsx("div",{className:_("grid gap-8",g[r]),children:n.map(u=>{const f=u.icon;return e.jsxs("div",{className:"flex gap-6",children:[f&&e.jsx("div",{className:_("flex-shrink-0 w-12 h-12 rounded-lg flex items-center justify-center",u.color||"bg-primary/10 text-primary"),children:e.jsx(f,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:u.title}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:u.description})]})]},u.id)})})]})})});Jl.displayName="Features";const Zl=o.forwardRef(({className:s,title:t,subtitle:a,description:i,primaryButton:n,secondaryButton:r,variant:d="default",background:c="default",size:x="md",...m},b)=>{const g={default:"",muted:"bg-muted/20",gradient:"bg-gradient-to-r from-primary/10 via-primary/5 to-secondary/10",primary:"bg-primary text-primary-foreground"},u={sm:"py-12",md:"py-16",lg:"py-24"},f={sm:"text-2xl sm:text-3xl",md:"text-3xl sm:text-4xl",lg:"text-4xl sm:text-5xl"};return d==="minimal"?e.jsx("section",{ref:b,className:_("text-center",u[x],g[c],s),...m,children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[a&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:a}),e.jsx("h2",{className:_("font-bold mb-4",f[x]),children:t}),i&&e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto mb-8",children:i}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[n&&e.jsx(p,{asChild:!!n.href,variant:n.variant||"default",size:"lg",onClick:n.onClick,className:"min-w-[160px]",children:n.href?e.jsxs("a",{href:n.href,className:"flex items-center gap-2",children:[n.icon&&e.jsx(n.icon,{className:"w-5 h-5"}),n.text]}):e.jsxs(e.Fragment,{children:[n.icon&&e.jsx(n.icon,{className:"w-5 h-5"}),n.text]})}),r&&e.jsx(p,{asChild:!!r.href,variant:r.variant||"outline",size:"lg",onClick:r.onClick,className:"min-w-[160px]",children:r.href?e.jsxs("a",{href:r.href,className:"flex items-center gap-2",children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]}):e.jsxs(e.Fragment,{children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]})})]})]})}):d==="centered"?e.jsx("section",{ref:b,className:_("text-center",u[x],g[c],s),...m,children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl",children:e.jsxs("div",{className:"bg-white/50 dark:bg-black/50 backdrop-blur-sm rounded-3xl p-8 md:p-12 border",children:[a&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:a}),e.jsx("h2",{className:_("font-bold mb-4",f[x]),children:t}),i&&e.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:i}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[n&&e.jsx(p,{asChild:!!n.href,variant:n.variant||"default",size:"lg",onClick:n.onClick,className:"min-w-[160px]",children:n.href?e.jsxs("a",{href:n.href,className:"flex items-center gap-2",children:[n.icon&&e.jsx(n.icon,{className:"w-5 h-5"}),n.text]}):e.jsxs(e.Fragment,{children:[n.icon&&e.jsx(n.icon,{className:"w-5 h-5"}),n.text]})}),r&&e.jsx(p,{asChild:!!r.href,variant:r.variant||"outline",size:"lg",onClick:r.onClick,className:"min-w-[160px]",children:r.href?e.jsxs("a",{href:r.href,className:"flex items-center gap-2",children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]}):e.jsxs(e.Fragment,{children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]})})]})]})})}):d==="split"?e.jsx("section",{ref:b,className:_(u[x],g[c],s),...m,children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[e.jsxs("div",{children:[a&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:a}),e.jsx("h2",{className:_("font-bold mb-4",f[x]),children:t}),i&&e.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:i}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[n&&e.jsx(p,{asChild:!!n.href,variant:n.variant||"default",size:"lg",onClick:n.onClick,className:"min-w-[160px]",children:n.href?e.jsxs("a",{href:n.href,className:"flex items-center gap-2",children:[n.icon&&e.jsx(n.icon,{className:"w-5 h-5"}),n.text]}):e.jsxs(e.Fragment,{children:[n.icon&&e.jsx(n.icon,{className:"w-5 h-5"}),n.text]})}),r&&e.jsx(p,{asChild:!!r.href,variant:r.variant||"outline",size:"lg",onClick:r.onClick,className:"min-w-[160px]",children:r.href?e.jsxs("a",{href:r.href,className:"flex items-center gap-2",children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]}):e.jsxs(e.Fragment,{children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]})})]})]}),e.jsx("div",{className:"lg:text-right",children:e.jsx("div",{className:"bg-gradient-to-br from-primary/20 to-secondary/20 rounded-2xl p-8 h-64 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:(n==null?void 0:n.icon)&&e.jsx(n.icon,{className:"w-8 h-8 text-primary"})}),e.jsx("p",{className:"text-muted-foreground",children:"Visual content goes here"})]})})})]})})}):d==="gradient"?e.jsxs("section",{ref:b,className:_("relative overflow-hidden",u[x],s),...m,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary via-primary/80 to-secondary"}),e.jsx("div",{className:"absolute inset-0 bg-black/20"}),e.jsxs("div",{className:"relative container mx-auto px-4 sm:px-6 lg:px-8 text-center text-white",children:[a&&e.jsx("div",{className:"text-sm font-medium text-white/80 mb-2 uppercase tracking-wide",children:a}),e.jsx("h2",{className:_("font-bold mb-4",f[x]),children:t}),i&&e.jsx("p",{className:"text-lg text-white/90 max-w-2xl mx-auto mb-8",children:i}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[n&&e.jsx(p,{asChild:!!n.href,variant:"secondary",size:"lg",onClick:n.onClick,className:"min-w-[160px] bg-white text-primary hover:bg-white/90",children:n.href?e.jsxs("a",{href:n.href,className:"flex items-center gap-2",children:[n.icon&&e.jsx(n.icon,{className:"w-5 h-5"}),n.text]}):e.jsxs(e.Fragment,{children:[n.icon&&e.jsx(n.icon,{className:"w-5 h-5"}),n.text]})}),r&&e.jsx(p,{asChild:!!r.href,variant:"outline",size:"lg",onClick:r.onClick,className:"min-w-[160px] border-white/30 text-white hover:bg-white/10",children:r.href?e.jsxs("a",{href:r.href,className:"flex items-center gap-2",children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]}):e.jsxs(e.Fragment,{children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]})})]})]})]}):e.jsx("section",{ref:b,className:_("text-center",u[x],g[c],s),...m,children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[a&&e.jsx("div",{className:"text-sm font-medium text-primary mb-2 uppercase tracking-wide",children:a}),e.jsx("h2",{className:_("font-bold mb-4",f[x]),children:t}),i&&e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto mb-8",children:i}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[n&&e.jsx(p,{asChild:!!n.href,variant:n.variant||"default",size:"lg",onClick:n.onClick,className:"min-w-[160px]",children:n.href?e.jsxs("a",{href:n.href,className:"flex items-center gap-2",children:[n.icon&&e.jsx(n.icon,{className:"w-5 h-5"}),n.text]}):e.jsxs(e.Fragment,{children:[n.icon&&e.jsx(n.icon,{className:"w-5 h-5"}),n.text]})}),r&&e.jsx(p,{asChild:!!r.href,variant:r.variant||"outline",size:"lg",onClick:r.onClick,className:"min-w-[160px]",children:r.href?e.jsxs("a",{href:r.href,className:"flex items-center gap-2",children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]}):e.jsxs(e.Fragment,{children:[r.icon&&e.jsx(r.icon,{className:"w-5 h-5"}),r.text]})})]})]})})});Zl.displayName="CTA";const rr="https://resellershubprogh.com",We={baseURL:rr,buildUrl:s=>`${rr}${s}`,auth:{me:()=>We.buildUrl("/api/auth/me"),login:()=>We.buildUrl("/api/auth/login"),register:()=>We.buildUrl("/api/auth/register"),logout:()=>We.buildUrl("/api/auth/logout")},products:{dataBundles:()=>We.buildUrl("/api/products/data-bundles"),dataBundle:s=>We.buildUrl(`/api/products/data-bundles/${s}`),resultCheckers:()=>We.buildUrl("/api/products/result-checkers/stock"),resultCheckerInfo:(s,t)=>We.buildUrl(`/api/products/result-checkers/info/${s}/${t}`)},agent:{register:()=>We.buildUrl("/api/agent/register"),profile:()=>We.buildUrl("/api/profile"),transactions:()=>We.buildUrl("/api/agent/transactions"),transactionsStats:()=>We.buildUrl("/api/agent/transactions/stats"),withdrawals:()=>We.buildUrl("/api/agent/withdrawals"),storefront:()=>We.buildUrl("/api/agent/storefront"),pricing:()=>We.buildUrl("/api/agent/pricing")},checkout:{initialize:()=>We.buildUrl("/api/checkout/initialize")},wallet:{topup:{initialize:()=>We.buildUrl("/api/wallet/topup/initialize"),verify:s=>We.buildUrl(`/api/wallet/topup/verify/${s}`)},pay:()=>We.buildUrl("/api/wallet/pay")},transactions:{verify:s=>We.buildUrl(`/api/transactions/verify/${s}`)},store:(s,t)=>We.buildUrl(`/api/store/${s}/${t}`)};let lr=!1;async function Me(s,t={}){var x;const{disableAutoLogout:a,...i}=t,n=We.buildUrl(s),{data:r}=await Fs.auth.getSession(),d=(x=r.session)==null?void 0:x.access_token,c=await fetch(n,{headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0",...d&&{Authorization:`Bearer ${d}`},...i.headers},cache:"no-store",...i});if(!c.ok){const m=await c.json().catch(()=>({error:"Unknown error"})),b=m.error||m.message||`API request failed: ${c.status} ${c.statusText}`;if(console.error("API Error:",{endpoint:s,status:c.status,error:m}),c.status===401&&!a&&!lr){lr=!0;try{await Fs.auth.signOut(),window.location.href="/login"}catch(g){console.error("Auto-logout failed:",g),window.location.href="/login"}throw new Error("Session expired. Please log in again.")}throw new Error(b)}return c.json()}const $t="/assets/mtn_1765780772203.1XQhhhcx.jpg",zt="/assets/telecel_1765780772206.CUaJa_BA.jpg",ws="/assets/at_1765780772206.ldktjSTD.jpg",Wa="/assets/result_1765780772205.DD_xs0-M.jpg",en="/assets/banner1_1765774201032.BpG3zOow.jpeg",sn="/assets/banner2_1765774201033.CHuTf4Ze.jpeg",tn="/assets/banner3_1765774201030.DzQW3uf5.jpeg",Y=o.forwardRef(({className:s,type:t,...a},i)=>e.jsx("input",{type:t,className:_("flex h-9 w-full rounded-md border border-input bg-background text-foreground px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:i,...a}));Y.displayName="Input";function Pt(){const[s,t]=o.useState(""),[a,i]=o.useState(!1),[n,r]=o.useState(!1),[d,c]=o.useState(null),[x,m]=o.useState(null),[b,g]=o.useState(!0),{toast:u}=fe(),f=S=>{if(!S)return!1;const k=(S.skytechStatus||S.deliveryStatus||S.status).toLowerCase();return["pending","processing","queued"].includes(k)};o.useEffect(()=>{if(!d||!b||!f(d))return;const S=setInterval(()=>{l(d.id)},1e4);return()=>clearInterval(S)},[d,b]);const N=async()=>{if(!s.trim()){u({title:"Search Required",description:"Please enter a transaction ID or beneficiary phone number",variant:"destructive"});return}i(!0),m(null);try{const S=await fetch(`/api/track-order?q=${encodeURIComponent(s.trim())}`),k=await S.json();S.ok?(c(k),m(new Date)):(c(null),u({title:"Order Not Found",description:k.error||"No order found with the provided information",variant:"destructive"}))}catch{c(null),u({title:"Search Failed",description:"Failed to search for order. Please try again.",variant:"destructive"})}finally{i(!1)}},l=async S=>{r(!0);try{const k=await fetch(`/api/order-status/${S}`),C=await k.json();if(k.ok){const E=(d==null?void 0:d.skytechStatus)||(d==null?void 0:d.deliveryStatus)||(d==null?void 0:d.status),se=C.skytechStatus||C.deliveryStatus||C.status;if(d&&E!==se){const H=se==null?void 0:se.toLowerCase();H==="completed"||H==="delivered"||H==="success"?u({title:"ðŸŽ‰ Order Delivered!",description:"Your data bundle has been delivered successfully."}):(H==="failed"||H==="error"||H==="cancelled")&&u({title:"âŒ Order Failed",description:"Your order could not be processed. Please contact support.",variant:"destructive"})}c(C),m(new Date)}}catch(k){console.error("Failed to refresh order status:",k)}finally{r(!1)}},h=S=>{var k,C;try{if(!S.apiResponse)return null;const E=JSON.parse(S.apiResponse);return(k=E.skytechStatus)!=null&&k.status?E.skytechStatus.status:E.results&&((C=E.results[0])!=null&&C.status)?E.results[0].status:null}catch{return null}},y=S=>{const k=S.toLowerCase();return k==="completed"||k==="delivered"||k==="success"?e.jsx(Te,{className:"h-5 w-5 text-green-500"}):k==="failed"||k==="error"?e.jsx(ds,{className:"h-5 w-5 text-red-500"}):k==="processing"||k==="pending"||k==="queued"?e.jsx(Et,{className:"h-5 w-5 text-blue-500"}):e.jsx(Ee,{className:"h-5 w-5 text-blue-500"})},M=S=>{const k=S.toLowerCase();return k==="completed"||k==="delivered"||k==="success"?e.jsxs(Z,{variant:"default",className:"bg-green-500 text-white",children:["âœ… ",S]}):k==="failed"||k==="error"?e.jsxs(Z,{variant:"destructive",className:"bg-red-500 text-white",children:["âŒ ",S]}):k==="processing"||k==="pending"?e.jsx(Z,{variant:"secondary",className:"bg-blue-500 text-white animate-pulse",children:"ðŸ”„ Processing"}):k==="queued"?e.jsxs(Z,{variant:"secondary",className:"bg-blue-500 text-white",children:["â³ ",S]}):e.jsxs(Z,{variant:"outline",className:"bg-gray-500 text-white",children:["â³ ",S]})};return e.jsxs(F,{className:"w-full max-w-2xl mx-auto bg-card text-card-foreground border border-border",children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(Ee,{className:"h-5 w-5"}),"Track Your Order"]}),e.jsx(te,{className:"text-muted-foreground",children:"Enter your order number or beneficiary phone number to track your order status"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{placeholder:"Order Number or Phone Number (e.g., #114000 or 0241234567)",value:s,onChange:S=>t(S.target.value),onKeyPress:S=>S.key==="Enter"&&N(),className:"flex-1"}),e.jsxs(p,{onClick:N,disabled:a,children:[a?e.jsx(fs,{className:"h-4 w-4 animate-spin"}):e.jsx(Lt,{className:"h-4 w-4"}),"Search"]})]}),d&&(()=>{const k=d.skytechStatus||h(d)||d.deliveryStatus;return e.jsxs(F,{className:"border-l-4 border-l-blue-500 bg-blue-50 dark:bg-blue-950/30",children:[e.jsxs($,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[y(k),e.jsx(G,{className:"text-lg text-gray-900 dark:text-white font-bold",children:d.productName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[M(k),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>l(d.id),disabled:n,title:"Refresh status",children:e.jsx(Qr,{className:`h-4 w-4 ${n?"animate-spin":""}`})})]})]}),e.jsxs(te,{className:"text-gray-700 dark:text-gray-200 font-medium",children:["Order #",d.reference,x&&e.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300 ml-2",children:["(Updated: ",x.toLocaleTimeString(),")"]})]})]}),e.jsxs(D,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Amount:"}),e.jsxs("p",{className:"font-bold text-gray-900 dark:text-white",children:["GHS ",d.amount]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Network:"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:d.network?d.network.toUpperCase().replace("_"," "):"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Date:"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:new Date(d.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Customer Phone:"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:d.customerPhone})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Type:"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:d.isBulkOrder?"Bulk Order":"Single Order"})]})]}),d.isBulkOrder&&d.phoneNumbers&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Beneficiary Numbers:"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:d.phoneNumbers.map((C,E)=>e.jsx(Z,{variant:"outline",className:"text-xs font-semibold text-gray-900 dark:text-white",children:C.phone},E))})]}),d.completedAt&&e.jsxs("div",{className:"pt-2 border-t dark:border-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Completed:"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:new Date(d.completedAt).toLocaleString()})]}),e.jsx("div",{className:"pt-2 border-t dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ks,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-100",children:"Need help? Contact our support team with your order reference."})]})})]})]})})()]})]})}const lc=[en,sn,tn];function nc(){const{user:s,isAuthenticated:t}=ve(),{data:a}=ee({queryKey:["/api/products/result-checkers/stock"],queryFn:()=>Me("/api/products/result-checkers/stock"),refetchInterval:6e4}),i=[{id:"mtn",title:"MTN Data Bundles",description:"Fast & reliable MTN data packages",icon:()=>e.jsx("img",{src:$t,alt:"MTN",className:"w-8 h-8 object-contain"}),color:"bg-gradient-to-br from-yellow-400 to-orange-500"},{id:"telecel",title:"Telecel Data Bundles",description:"Affordable Telecel data solutions",icon:()=>e.jsx("img",{src:zt,alt:"Telecel",className:"w-8 h-8 object-contain"}),color:"bg-gradient-to-br from-blue-400 to-blue-600"},{id:"at_bigtime",title:"AT BIG TIME Bundles",description:"High-speed AirtelTigo bundles",icon:()=>e.jsx("img",{src:ws,alt:"AirtelTigo",className:"w-8 h-8 object-contain"}),color:"bg-gradient-to-br from-red-400 to-red-600"},{id:"at_ishare",title:"AT iShare Bundles",description:"Flexible AirtelTigo iShare plans",icon:()=>e.jsx("img",{src:ws,alt:"AirtelTigo",className:"w-8 h-8 object-contain"}),color:"bg-gradient-to-br from-purple-400 to-purple-600"},{id:"waec-result-checker",title:"WAEC Result Checker",description:a&&a.length>0?`${a.reduce((x,m)=>x+m.available,0)} PINs available`:"Instant BECE & WASSCE results",icon:()=>e.jsx("img",{src:Wa,alt:"WAEC",className:"w-8 h-8 object-contain"}),color:"bg-gradient-to-br from-green-400 to-green-600",badge:a&&a.length>0?`${a.reduce((x,m)=>x+m.available,0)} In Stock`:null}],n=[{id:"instant-delivery",title:"Instant Delivery",description:"Get your data bundles delivered instantly after payment",icon:Jr,color:"bg-gradient-to-br from-yellow-400/10 to-orange-500/10"},{id:"secured-payment",title:"100% Secure Payment",description:"Bank-grade security with encrypted transactions",icon:dt,color:"bg-gradient-to-br from-green-400/10 to-green-600/10"},{id:"customer-support",title:"24/7 Support",description:"Round-the-clock customer support for all your needs",icon:Mn,color:"bg-gradient-to-br from-blue-400/10 to-blue-600/10"},{id:"best-prices",title:"Best Market Prices",description:"Competitive pricing with exclusive agent discounts",icon:Bt,color:"bg-gradient-to-br from-purple-400/10 to-purple-600/10"}],r=[{label:"Happy Customers",value:"50K+",icon:os},{label:"Data Bundles Sold",value:"1M+",icon:Ke},{label:"Success Rate",value:"99.9%",icon:Te},{label:"Years of Service",value:"5+",icon:wa}],d=()=>!t||!s?"/agent/register":s.role==="agent"||s.role==="dealer"||s.role==="super_dealer"?"/agent/dashboard":"/agent/register",c=()=>!t||!s?"Become an Agent":s.role==="agent"||s.role==="dealer"||s.role==="super_dealer"?"Go to Dashboard":"Become an Agent";return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(gs,{}),e.jsxs("main",{children:[e.jsx(Xl,{title:e.jsxs("span",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-extrabold text-center block hero-title-text",children:[e.jsx("span",{className:"font-extrabold",children:"Your Trusted Platform for Digital"})," ",e.jsx("span",{className:"text-blue-600 font-extrabold",children:"Products"})]}),description:"Purchase data bundles and WAEC result checkers instantly with secure payments and instant delivery.",primaryButton:{text:"Browse Products",href:"/data-bundles",icon:ea,size:"sm",className:"bg-yellow-500 hover:bg-yellow-600 dark:text-white text-black"},secondaryButton:{text:"Track Order",href:"#track-orders",icon:Ee,size:"sm"},images:lc,showNavigation:!1,background:"gradient",size:"lg"}),e.jsx("section",{className:"md:hidden py-4",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-sm mx-auto w-full",children:e.jsx(Yl,{triggerVariant:"default",triggerSize:"sm",className:"w-full"})})})}),e.jsx("section",{id:"products",className:"py-20",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx(Z,{variant:"outline",className:"mb-4",children:"Our Products"}),e.jsx("h2",{className:"text-3xl sm:text-4xl font-bold mb-4",children:"Choose Your Network"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Select from our wide range of data bundles and result checkers from all major networks"})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 md:gap-6",children:i.map(x=>e.jsx(X,{href:`/products/${x.id}`,children:e.jsx(F,{className:"group h-full hover:shadow-xl transition-all duration-300 hover:-translate-y-1 dark:border-2 dark:border-white shadow-md bg-card aspect-square md:aspect-auto flex flex-col",children:e.jsxs(D,{className:"p-2 md:p-2 text-center flex flex-col h-full",children:[x.badge&&e.jsx(Z,{variant:"secondary",className:"mb-2 text-[10px] md:text-xs w-fit mx-auto",children:x.badge}),e.jsx("div",{className:"w-full h-24 md:h-32 mx-auto mb-1 md:mb-1 flex items-center justify-center group-hover:scale-110 transition-transform duration-300",children:e.jsx(x.icon,{})}),e.jsx("h3",{className:"font-semibold text-xs md:text-base lg:text-lg mb-0.5 md:mb-1 lg:mb-2 group-hover:text-primary transition-colors leading-tight",children:x.title}),e.jsx("p",{className:"text-[10px] md:text-xs lg:text-sm text-muted-foreground leading-tight md:leading-snug lg:leading-relaxed flex-grow",children:x.description}),e.jsx("div",{className:"mt-2 md:mt-3 lg:mt-4 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ea,{className:"w-3 md:w-4 lg:w-5 h-3 md:h-4 lg:h-5 text-primary mx-auto"})})]})})},x.id))}),e.jsx(Ql,{stats:r})]})}),e.jsx(Jl,{title:"Experience Excellence",subtitle:"Why Choose Us",description:"We're committed to providing the best digital product experience with top-notch service",columns:4,className:"py-0",features:n,variant:"cards",background:"muted"}),e.jsx("section",{id:"track-orders",className:"py-20",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx(Z,{variant:"outline",className:"mb-4",children:"Track Orders"}),e.jsx("h2",{className:"text-3xl sm:text-4xl font-bold mb-4",children:"Never Lose Track"}),e.jsx("p",{className:"text-lg text-muted-foreground mb-12 max-w-2xl mx-auto",children:"Easily track your data bundle and result checker orders using your transaction ID or beneficiary phone number."}),e.jsx(Pt,{})]})})}),e.jsx(Zl,{title:"Start Your Own Business",subtitle:"Become an Agent",description:"Join thousands of successful agents earning commissions. Get your custom storefront and start selling digital products today.",primaryButton:{text:c(),href:d(),icon:ea},background:"gradient",size:"lg"})]}),e.jsx(zs,{})]})}const ic=Yt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),V=o.forwardRef(({className:s,...t},a)=>e.jsx(Zr,{ref:a,className:_(ic(),s),...t}));V.displayName=Zr.displayName;const Os=_n,an=o.createContext({}),ue=({...s})=>e.jsx(an.Provider,{value:{name:s.name},children:e.jsx($n,{...s})}),na=()=>{const s=o.useContext(an),t=o.useContext(rn),{getFieldState:a,formState:i}=Ln(),n=a(s.name,i);if(!s)throw new Error("useFormField should be used within <FormField>");const{id:r}=t;return{id:r,name:s.name,formItemId:`${r}-form-item`,formDescriptionId:`${r}-form-item-description`,formMessageId:`${r}-form-item-message`,...n}},rn=o.createContext({}),me=o.forwardRef(({className:s,...t},a)=>{const i=o.useId();return e.jsx(rn.Provider,{value:{id:i},children:e.jsx("div",{ref:a,className:_("space-y-2",s),...t})})});me.displayName="FormItem";const pe=o.forwardRef(({className:s,...t},a)=>{const{error:i,formItemId:n}=na();return e.jsx(V,{ref:a,className:_(i&&"text-destructive",s),htmlFor:n,...t})});pe.displayName="FormLabel";const ia=o.forwardRef(({className:s,...t},a)=>{const{error:i}=na();return e.jsx(V,{ref:a,className:_(i&&"text-destructive",s),...t})});ia.displayName="FormLabelWithoutFor";const xe=o.forwardRef(({...s},t)=>{const{error:a,formItemId:i,formDescriptionId:n,formMessageId:r}=na();return e.jsx(Ar,{ref:t,id:i,"aria-describedby":a?`${n} ${r}`:`${n}`,"aria-invalid":!!a,...s})});xe.displayName="FormControl";const Ye=o.forwardRef(({className:s,...t},a)=>{const{formDescriptionId:i}=na();return e.jsx("div",{ref:a,id:i,className:_("text-sm text-muted-foreground",s),...t})});Ye.displayName="FormDescription";const he=o.forwardRef(({className:s,children:t,...a},i)=>{const{error:n,formMessageId:r}=na(),d=n?String((n==null?void 0:n.message)??""):t;return d?e.jsx("p",{ref:i,id:r,className:_("text-sm font-medium text-destructive",s),...a,children:d}):null});he.displayName="FormMessage";const cc=ae.object({email:ae.string().email("Invalid email address"),password:ae.string().min(6,"Password must be at least 6 characters")});function dc(){const[,s]=ze(),[t,a]=o.useState(!1),{login:i,isLoginLoading:n,loginError:r,user:d,isLoading:c}=ve(),{toast:x}=fe(),{theme:m}=nt(),[b,g]=o.useState(!1),u=Ss({resolver:Ps(cc),defaultValues:{email:"",password:""}});o.useEffect(()=>{c||b||(d?(g(!0),d.role==="admin"?(console.log("Redirecting admin to /admin"),s("/admin")):d.role==="agent"?(console.log("Redirecting agent to /agent/dashboard"),s("/agent/dashboard")):d.role==="dealer"?(console.log("Redirecting dealer to /dealer/dashboard"),s("/dealer/dashboard")):d.role==="super_dealer"?(console.log("Redirecting super dealer to /super-dealer/dashboard"),s("/super-dealer/dashboard")):d.role==="master"?(console.log("Redirecting master to /master/dashboard"),s("/master/dashboard")):d.role==="user"||d.role==="guest"?(console.log("Redirecting user to /user/dashboard"),s("/user/dashboard")):(console.log("Redirecting user to /"),s("/"))):console.log("No user found, staying on login page"))},[d,c,s]);const f=async l=>{try{(await i({email:l.email,password:l.password})).error||(ac(),x({title:"Welcome back!",description:"You have successfully logged in."}))}catch{}},N=typeof window<"u"?Ms():null;return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background px-4 py-6",children:[e.jsx("nav",{className:"mb-6 px-2",children:e.jsx(X,{href:N?`/store/${N}`:"/","data-testid":"link-back-home",children:e.jsxs(p,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(Xt,{className:"h-4 w-4"}),"Back to Home"]})})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md shadow-xl border-2 border-yellow-400 bg-card text-card-foreground rounded-xl p-8 dark:border-yellow-500\\",children:[n&&e.jsx("div",{className:"absolute inset-0 bg-background flex items-center justify-center z-10 rounded-lg",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(re,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-foreground",children:"Signing you in..."})]})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:m==="dark"?_t:kt,alt:mt,className:"h-8 w-auto"})}),e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Welcome back"}),e.jsxs("p",{className:"text-foreground",children:["Sign in to your ",mt," account"]})]}),e.jsxs("div",{children:[e.jsx(Os,{...u,children:e.jsxs("form",{onSubmit:u.handleSubmit(f),className:"space-y-4",children:[e.jsx(ue,{control:u.control,name:"email",render:({field:l})=>e.jsxs(me,{children:[e.jsx(pe,{className:"text-foreground",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(Kt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(xe,{children:e.jsx(Y,{placeholder:"you@example.com",type:"email",className:"pl-10","data-testid":"input-email",name:l.name,autoComplete:"email",...l})})]}),e.jsx(he,{})]})}),e.jsx(ue,{control:u.control,name:"password",render:({field:l})=>e.jsxs(me,{children:[e.jsx(pe,{className:"text-foreground",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(xe,{children:e.jsx(Y,{placeholder:"Enter your password",type:t?"text":"password",className:"pl-10 pr-10","data-testid":"input-password",name:l.name,autoComplete:"current-password",...l})}),e.jsx(p,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-0 h-full px-3",onClick:()=>a(!t),children:t?e.jsx(et,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(st,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsx(he,{})]})}),e.jsxs(p,{type:"submit",className:"w-full",disabled:n,"data-testid":"button-submit-login",children:[n&&e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign in"]}),r&&e.jsx("div",{className:"text-red-500 dark:text-red-400 text-sm mt-2",children:r})]})}),e.jsxs("div",{className:"mt-6 text-center text-sm",children:[e.jsx("span",{className:"text-foreground",children:"Don't have an account? "}),e.jsx(X,{href:"/register",className:"text-primary hover:underline font-medium","data-testid":"link-register",children:"Sign up"})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:[e.jsx("span",{className:"text-foreground",children:"Want to become an agent? "}),e.jsx(X,{href:"/agent/register",className:"text-primary hover:underline font-medium","data-testid":"link-agent-register",children:"Register as Agent"})]})]})]})})]})}const oc=ae.object({name:ae.string().min(2,"Name must be at least 2 characters"),email:ae.string().email("Invalid email address"),phone:ae.string().min(10,"Phone number must be at least 10 digits"),password:ae.string().min(6,"Password must be at least 6 characters"),confirmPassword:ae.string()}).refine(s=>s.password===s.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function mc(){const[,s]=ze(),[t,a]=o.useState(!1),{register:i,isRegisterLoading:n,registerError:r,user:d,isLoading:c}=ve(),{toast:x}=fe(),{theme:m}=nt(),b=Ss({resolver:Ps(oc),defaultValues:{name:"",email:"",phone:"",password:"",confirmPassword:""}});o.useEffect(()=>{if(!c&&d){const f=d.role;s(f==="admin"?"/admin":f==="agent"?"/agent":f==="user"||f==="guest"?"/user/dashboard":"/")}},[d,c,s]);const g=async f=>{try{if(console.log("[REGISTER-FORM] Submitting with data:",{email:f.email,name:f.name,phone:f.phone}),!f.phone||f.phone.length<10){x({title:"Phone number required",description:"Please provide a valid phone number with at least 10 digits",variant:"destructive"});return}const N=await i({email:f.email,password:f.password,name:f.name,phone:f.phone});if(N!=null&&N.error){x({title:"Registration failed",description:N.error,variant:"destructive"});return}if((N==null?void 0:N.error)==="Email confirmation required"){x({title:"Check your email",description:"Please click the confirmation link in your email to complete registration."});return}x({title:"Account created!",description:"Welcome to "+mt})}catch(N){x({title:"Registration failed",description:N.message||"Something went wrong",variant:"destructive"})}},u=typeof window<"u"?Ms():null;return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background px-4 py-6",children:[e.jsx("nav",{className:"mb-6 px-2",children:e.jsx(X,{href:u?`/store/${u}`:"/","data-testid":"link-back-home",children:e.jsxs(p,{variant:"outline",size:"sm",className:"gap-2 text-black dark:text-white",children:[e.jsx(Xt,{className:"h-4 w-4"}),"Back to Home"]})})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md shadow-xl border-2 border-yellow-400 bg-white dark:bg-black text-black dark:text-white rounded-xl p-8",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:m==="dark"?_t:kt,alt:mt,className:"h-8 w-auto"})}),e.jsx("h2",{className:"text-2xl font-bold",children:"Create an account"}),e.jsxs("p",{className:"text-muted-foreground dark:text-gray-300",children:["Join ",mt," to purchase data bundles and result checkers"]})]}),e.jsxs("div",{children:[e.jsx(Os,{...b,children:e.jsxs("form",{onSubmit:b.handleSubmit(g),className:"space-y-4",children:[e.jsx(ue,{control:b.control,name:"name",render:({field:f})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Full Name"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Ht,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(Y,{placeholder:"John Doe",className:"pl-10",autoComplete:"name","data-testid":"input-name",...f})]})}),e.jsx(he,{})]})}),e.jsx(ue,{control:b.control,name:"email",render:({field:f})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Email"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Kt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(Y,{placeholder:"you@example.com",type:"email",autoComplete:"email",className:"pl-10","data-testid":"input-email",...f})]})}),e.jsx(he,{})]})}),e.jsx(ue,{control:b.control,name:"phone",render:({field:f})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Phone Number"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Ot,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(Y,{placeholder:"0241234567",autoComplete:"tel",className:"pl-10","data-testid":"input-phone",...f})]})}),e.jsx(he,{})]})}),e.jsx(ue,{control:b.control,name:"password",render:({field:f})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Password"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(Y,{placeholder:"Create a password",type:t?"text":"password",autoComplete:"new-password",className:"pl-10 pr-10","data-testid":"input-password",...f}),e.jsx(p,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-0 h-full px-3",onClick:()=>a(!t),children:t?e.jsx(et,{className:"h-4 w-4 text-muted-foreground dark:text-gray-400"}):e.jsx(st,{className:"h-4 w-4 text-muted-foreground dark:text-gray-400"})})]})}),e.jsx(he,{})]})}),e.jsx(ue,{control:b.control,name:"confirmPassword",render:({field:f})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Confirm Password"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(Y,{placeholder:"Confirm your password",type:t?"text":"password",autoComplete:"new-password",className:"pl-10","data-testid":"input-confirm-password",...f})]})}),e.jsx(he,{})]})}),e.jsxs(p,{type:"submit",className:"w-full",disabled:n,"data-testid":"button-submit-register",children:[n&&e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),r&&e.jsx("div",{className:"text-red-500 text-sm mt-2",children:r}),"Create account"]})]})}),e.jsxs("div",{className:"mt-6 text-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground dark:text-gray-300",children:"Already have an account? "}),e.jsx(X,{href:"/login",className:"text-primary hover:underline font-medium","data-testid":"link-login",children:"Sign in"})]})]})]})})]})}const Le=o.forwardRef(({className:s,orientation:t="horizontal",decorative:a=!0,...i},n)=>e.jsx(el,{ref:n,decorative:a,orientation:t,className:_("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",s),...i}));Le.displayName=el.displayName;const xc={mtn:{bg:"bg-yellow-100 dark:bg-yellow-900/30",text:"text-yellow-800 dark:text-yellow-300",border:"border-yellow-300 dark:border-yellow-700"},telecel:{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-800 dark:text-red-300",border:"border-red-300 dark:border-red-700"},at_bigtime:{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-800 dark:text-red-300",border:"border-red-300 dark:border-red-700"},at_ishare:{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-800 dark:text-red-300",border:"border-red-300 dark:border-red-700"}},hc={mtn:"MTN",telecel:"TELECEL",at_bigtime:"AT Bigtime",at_ishare:"AT ishare"};function uc({network:s,size:t="sm",className:a}){const i=xc[s.toLowerCase()]||{bg:"bg-gray-100 dark:bg-white",text:"text-gray-800 dark:text-gray-300",border:"border-gray-300 dark:border-gray-700"},n={sm:"text-xs px-2 py-0.5",md:"text-sm px-3 py-1",lg:"text-base px-4 py-1.5"};return e.jsx(Z,{variant:"outline",className:_("font-semibold uppercase tracking-wide",i.bg,i.text,i.border,n[t],a),children:hc[s.toLowerCase()]||s.toUpperCase()})}const Dt=o.forwardRef(({className:s,...t},a)=>e.jsx(sl,{className:_("grid gap-2",s),...t,ref:a}));Dt.displayName=sl.displayName;const qs=o.forwardRef(({className:s,...t},a)=>e.jsx(tl,{ref:a,className:_("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(zn,{className:"flex items-center justify-center",children:e.jsx(Dr,{className:"h-2.5 w-2.5 fill-current text-current"})})}));qs.displayName=tl.displayName;const Fe=Hn,Ie=Vn,Pe=o.forwardRef(({className:s,children:t,...a},i)=>e.jsxs(al,{ref:i,className:_("flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...a,children:[t,e.jsx(Gn,{asChild:!0,children:e.jsx(_a,{className:"h-4 w-4 opacity-50"})})]}));Pe.displayName=al.displayName;const ln=o.forwardRef(({className:s,...t},a)=>e.jsx(rl,{ref:a,className:_("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(ll,{className:"h-4 w-4"})}));ln.displayName=rl.displayName;const nn=o.forwardRef(({className:s,...t},a)=>e.jsx(nl,{ref:a,className:_("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(_a,{className:"h-4 w-4"})}));nn.displayName=nl.displayName;const Ce=o.forwardRef(({className:s,children:t,position:a="popper",...i},n)=>e.jsx(Un,{children:e.jsxs(il,{ref:n,className:_("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-background text-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...i,children:[e.jsx(ln,{}),e.jsx(qn,{className:_("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(nn,{})]})}));Ce.displayName=il.displayName;const pc=o.forwardRef(({className:s,...t},a)=>e.jsx(cl,{ref:a,className:_("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...t}));pc.displayName=cl.displayName;const K=o.forwardRef(({className:s,children:t,...a},i)=>e.jsxs(dl,{ref:i,className:_("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Wn,{children:e.jsx(Rs,{className:"h-4 w-4"})})}),e.jsx(Kn,{children:t})]}));K.displayName=dl.displayName;const gc=o.forwardRef(({className:s,...t},a)=>e.jsx(ol,{ref:a,className:_("-mx-1 my-1 h-px bg-muted",s),...t}));gc.displayName=ol.displayName;const jc={mtn:["024","025","053","054","055","059"],telecel:["020","050"],airteltigo:["026","027","056","057"],at_bigtime:["026","027","056","057"],at_ishare:["026","027","056","057"]};function lt(s){let t=s.replace(/\D/g,"");return t.startsWith("233")&&(t="0"+t.substring(3)),t.startsWith("0")||(t="0"+t),t}function fc(s){return lt(s).length===10}function vs(s){return jc[s]||[]}function xt(s,t){const a=lt(s);return fc(a)?{isValid:!0}:{isValid:!1,error:"Phone number must be exactly 10 digits (e.g., 0241234567)"}}const bc=.025,_e=2.5;function Nc(s){return Math.round(s*bc*100)/100}function Bs(s){const t=Nc(s),a=Math.round((s+t)*100)/100;return{subtotal:s,tax:t,total:a}}const vc=ae.object({customerPhone:ae.string().min(10,"Phone number must be exactly 10 digits").max(10,"Phone number must be exactly 10 digits").regex(/^0[0-9]{9}$/,"Phone number must start with 0 and be 10 digits (e.g., 0241234567)"),customerEmail:ae.string().email("Invalid email").optional().or(ae.literal("")),paymentMethod:ae.enum(["paystack"]).default("paystack"),providerId:ae.string().optional()});function yc(){const{productType:s,productId:t,year:a}=Qt(),[,i]=ze(),{toast:n}=fe(),{user:r}=ve(),[d,c]=o.useState(!1),x=new URLSearchParams(window.location.search).get("agent"),m=s==="data-bundle",b=s==="result-checker",{data:g,isLoading:u}=ee({queryKey:[`/api/products/data-bundles/${t}`],enabled:m&&!!t}),{data:f,isLoading:N}=ee({queryKey:[`/api/products/result-checkers/info/${t}/${a}`],enabled:b&&!!t&&!!a}),l=m?g!=null&&g.effective_price?parseFloat(g.effective_price):0:f!=null&&f.price?parseFloat(String(f.price)):0,{subtotal:h,tax:y,total:M}=Bs(l),S=Ss({resolver:Ps(vc),defaultValues:{customerPhone:(r==null?void 0:r.phone)||"",customerEmail:"",paymentMethod:"paystack"}}),k=oe({mutationFn:async H=>{const W={productType:m?"data_bundle":"result_checker",productId:b?`${t}-${a}`:t,customerPhone:H.customerPhone,customerEmail:H.customerEmail||void 0,agentSlug:x||void 0};return(await Q("POST","/api/checkout/initialize",W)).json()},onSuccess:H=>{window.location.href=H.paymentUrl},onError:H=>{const W=H.message||"Unable to process payment";n({title:"âŒ Payment Failed",description:`${W}. Please try again or contact support if the problem persists.`,variant:"destructive",duration:6e3}),c(!1)}}),C=H=>{const W=lt(H.customerPhone);if(m&&g){const L=xt(W,g.network);if(!L.isValid){const j=vs(g.network);n({title:"âŒ Phone Number Mismatch",description:L.error||`This bundle is for ${g.network.toUpperCase()} network. Valid prefixes: ${j.join(", ")}`,variant:"destructive",duration:8e3});return}}c(!0),k.mutate({...H,customerPhone:W})},E=u||N,se=m?g:f;return E?e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(gs,{}),e.jsx("main",{className:"flex-1",children:e.jsx(Ua,{text:"Loading product..."})}),e.jsx(zs,{})]}):se?e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(gs,{}),e.jsx("main",{className:"flex-1 py-12 px-4 pt-16",children:e.jsx("div",{className:"container mx-auto max-w-4xl",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 order-2 lg:order-1",children:e.jsxs(F,{className:"sticky top-24",children:[e.jsx($,{children:e.jsx(G,{className:"text-lg",children:"Order Summary"})}),e.jsxs(D,{className:"space-y-4",children:[m&&g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(uc,{network:g.network,size:"md"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg","data-testid":"text-product-name",children:g.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Yn,{className:"h-4 w-4"}),e.jsx("span",{children:g.dataAmount})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fs,{className:"h-4 w-4"}),e.jsx("span",{children:g.validity})]})]})]})]}),b&&f&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(It,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-medium uppercase",children:f.type})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg","data-testid":"text-product-name",children:[f.type.toUpperCase()," Result Checker"]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Year: ",f.year," â€¢ ",f.stock," in stock"]})]})]}),e.jsx(Le,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsx("span",{className:"font-medium",children:ie(h)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(He,{className:"h-3 w-3"}),"Paystack Fee (",_e,"%)"]}),e.jsx("span",{className:"font-medium text-orange-600",children:ie(y)})]}),e.jsx(Le,{}),e.jsxs("div",{className:"flex items-center justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-primary","data-testid":"text-total-price",children:ie(M)})]}),e.jsx("div",{className:"bg-orange-100 dark:bg-orange-900 rounded-lg p-3 mt-2",children:e.jsxs("p",{className:"text-xs text-orange-700 dark:text-white",children:["A ",_e,"% Paystack fee is added to all Paystack payments."]})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground pt-4",children:[e.jsx(ys,{className:"h-3 w-3"}),e.jsx("span",{children:"Secured by Paystack"})]})]})]})}),e.jsx("div",{className:"lg:col-span-3 order-1 lg:order-2",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Checkout"}),e.jsx(te,{children:"Enter your details to complete the purchase"})]}),e.jsx(D,{children:e.jsx(Os,{...S,children:e.jsxs("form",{onSubmit:S.handleSubmit(C),className:"space-y-6",children:[e.jsx(ue,{control:S.control,name:"paymentMethod",render:({field:H})=>e.jsxs(me,{className:"space-y-3",children:[e.jsx(ia,{children:"Payment Method"}),e.jsx(xe,{children:e.jsx(Dt,{onValueChange:H.onChange,value:H.value,className:"grid gap-3",children:e.jsxs("div",{children:[e.jsx(qs,{value:"paystack",id:"paystack",className:"peer sr-only"}),e.jsxs(V,{className:"flex items-center justify-between rounded-lg border-2 border-muted bg-background dark:bg-card p-4 hover:border-green-500 peer-data-[state=checked]:border-green-500 peer-data-[state=checked]:bg-green-50 dark:peer-data-[state=checked]:bg-green-900/20 cursor-pointer transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Paystack"}),e.jsx("div",{className:"text-sm text-green-600",children:"Pay with card, bank transfer"})]})]}),H.value==="paystack"&&e.jsx(Te,{className:"h-5 w-5 text-green-600"})]})]})})}),e.jsx(he,{})]})}),hasInsufficientBalance&&S.watch("paymentMethod")==="wallet"&&e.jsxs(Is,{variant:"default",className:"border-destructive/50 bg-background text-destructive dark:bg-red-900/20",children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsxs(Es,{className:"text-sm",children:[e.jsx("strong",{children:"Insufficient Balance:"})," You need GHâ‚µ",(l-walletBalance).toFixed(2)," more.",e.jsx("a",{href:"/user/wallet",className:"underline ml-1 font-medium hover:text-destructive-foreground",children:"Top up wallet"})," or select Paystack below."]})]}),e.jsx(ue,{control:S.control,name:"customerPhone",render:({field:H})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Phone Number *"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Ot,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{placeholder:"0241234567",autoComplete:"tel",className:"pl-10","data-testid":"input-phone",...H})]})}),e.jsx(Ye,{children:m&&g?e.jsxs("span",{className:"text-xs",children:["For ",e.jsx("strong",{children:g.network.toUpperCase()})," network only. Valid prefixes: ",e.jsx("strong",{children:vs(g.network).join(", ")})]}):"We'll send the result checker PIN to this number"}),e.jsx(he,{})]})}),(r==null?void 0:r.role)==="admin"&&m&&providers&&providers.length>0&&e.jsx(ue,{control:S.control,name:"providerId",render:({field:H})=>e.jsxs(me,{children:[e.jsx(pe,{children:"API Provider"}),e.jsxs(Fe,{onValueChange:H.onChange,value:H.value,children:[e.jsx(xe,{children:e.jsx(Pe,{children:e.jsx(Ie,{placeholder:"Select API provider"})})}),e.jsx(Ce,{children:providers.map(W=>e.jsxs(K,{value:W.id,children:[W.name," ",W.isDefault?"(Default)":""]},W.id))})]}),e.jsx(Ye,{children:"Choose which external API provider to use for this transaction"}),e.jsx(he,{})]})}),e.jsx(ue,{control:S.control,name:"customerEmail",render:({field:H})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Email (optional)"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Kt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{placeholder:"you@example.com",type:"email",autoComplete:"email",className:"pl-10","data-testid":"input-email",...H})]})}),e.jsx(Ye,{children:"We'll send a receipt to this email"}),e.jsx(he,{})]})}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(ml,{className:"h-5 w-5 text-green-600 dark:text-green-400 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-green-800 dark:text-green-300",children:"Secure Payment"}),e.jsx("p",{className:"text-green-700 dark:text-green-400",children:"Your payment is processed securely through Paystack. We never store your card details."})]})]}),e.jsx(p,{type:"submit",size:"lg",className:"w-full gap-2",disabled:d,"data-testid":"button-pay",children:d?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:["Pay ",ie(M)]})})]})})})]})})]})})}),e.jsx(zs,{})]}):e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(gs,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center",children:e.jsx(F,{className:"max-w-md w-full mx-4",children:e.jsxs(D,{className:"pt-6 text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Product Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The product you're looking for doesn't exist or is no longer available."}),e.jsx(p,{onClick:()=>i("/"),children:"Back to Products"})]})})}),e.jsx(zs,{})]})}function wc(){const s=xl(),[,t]=ze(),{toast:a}=fe(),{user:i,isLoading:n}=ve(),r=Hs(),d=new URLSearchParams(s),c=d.get("reference"),x=d.get("trxref"),m=d.get("status"),b=()=>{try{const B=localStorage.getItem("agentStorefront");if(B){const{role:w,slug:R,network:P}=JSON.parse(B);return localStorage.removeItem("agentStorefront"),`/store/${w}/${R}/${P}`}}catch(B){console.error("Failed to parse agentStorefront:",B)}return"/"},g=()=>i?i.role==="agent"||i.role==="dealer"||i.role==="super_dealer"?`/${i.role}/dashboard`:"/user/dashboard":"/",u=()=>{try{return!!localStorage.getItem("agentStorefront")}catch{return!1}},[f,N]=o.useState(!1),[l,h]=o.useState(m==="failed"||m==="cancelled"),[y,M]=o.useState(!1),[S,k]=o.useState(null),{data:C}=ee({queryKey:[`/api/transactions/verify/${c||x}`],queryFn:async()=>{try{const B=await fetch(`/api/transactions/verify/${c||x}`,{headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},cache:"no-store"});if(!B.ok){const w=await B.json().catch(()=>({error:"Unknown error"})),R=w.error||w.message||`API request failed: ${B.status} ${B.statusText}`;throw k(R),new Error(R)}return k(null),B.json()}catch(B){const w=(B==null?void 0:B.message)||"Failed to connect to server. Please check your internet connection.";throw k(w),B}},enabled:!!(c||x)&&!l,retry:3,retryDelay:B=>Math.min(1e3*2**B,1e4),refetchInterval:5e3});o.useEffect(()=>{C&&(N(!0),C.success===!1?h(!0):C.success&&(C.transaction||C.transactions)&&(r.invalidateQueries({queryKey:["/api/agent/transactions"]}),r.invalidateQueries({queryKey:["/api/agent/transactions/stats"]}),r.invalidateQueries({queryKey:["/api/agent/stats"]})))},[C,r]);const E=C==null?void 0:C.transaction,se=C!=null&&C.bulkOrder?C.transactions:void 0;if(o.useEffect(()=>{if(console.log("=== Auto-download effect triggered ==="),console.log("hasTransaction:",!!E),console.log("verificationComplete:",f),console.log("authLoading:",n),console.log("hasUser:",!!i),console.log("transactionType:",E==null?void 0:E.type),console.log("transactionId:",E==null?void 0:E.id),console.log("autoDownloadTriggered:",y),E&&f&&E.type==="result_checker"&&E.id&&!y){console.log("âœ… All conditions met! Triggering auto-download for result checker"),M(!0);const B=setTimeout(async()=>{try{console.log("ðŸ” Fetching PDF for guest download...");const w=await fetch(`/api/result-checker/download/${E.reference}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/pdf"}});if(!w.ok){console.warn("PDF not ready yet, status:",w.status);const T=await w.json().catch(()=>({error:"Unknown error"}));console.error("PDF error:",T),a({title:"PDF Not Ready",description:T.error||"Please click the download button manually",variant:"destructive"});return}const R=await w.blob(),P=window.URL.createObjectURL(R),q=document.createElement("a");q.href=P,q.download=`${E.productName.replace(/\s+/g,"-")}-${E.reference}.pdf`,document.body.appendChild(q),q.click(),document.body.removeChild(q),window.URL.revokeObjectURL(P),a({title:"Download Started",description:"Your result checker credentials are downloading"}),console.log("ðŸ“¥ Auto-download triggered successfully")}catch(w){console.error("Auto-download failed:",w),a({title:"Auto-download Failed",description:"Please click the download button manually",variant:"destructive"})}},2e3);return()=>clearTimeout(B)}},[E,f,y,a]),n)return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(gs,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx(F,{className:"max-w-md w-full",children:e.jsxs(D,{className:"pt-6 text-center",children:[e.jsx(Ua,{}),e.jsx("h2",{className:"text-xl font-semibold mb-2 mt-4",children:"Restoring Session"}),e.jsx("p",{className:"text-muted-foreground",children:"Please wait while we verify your authentication..."})]})})}),e.jsx(zs,{})]});const H=B=>{navigator.clipboard.writeText(B),a({title:"Copied!",description:"Details copied to clipboard"})};if(!c&&!x)return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(gs,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx(F,{className:"max-w-md w-full",children:e.jsxs(D,{className:"pt-6 text-center",children:[e.jsx(ds,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Invalid Request"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"No transaction reference provided."}),e.jsx(p,{onClick:()=>{const B=localStorage.getItem("agentStore");t(B?`/store/agent/${B}`:"/")},"data-testid":"button-go-home",children:localStorage.getItem("agentStore")?"Back to Store":"Go to Home"})]})})}),e.jsx(zs,{})]});if(l)return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(gs,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx(F,{className:"max-w-md w-full",children:e.jsxs(D,{className:"pt-6 text-center",children:[e.jsx(ds,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsxs("h2",{className:"text-xl font-semibold mb-2",children:["Payment ",m==="cancelled"?"Cancelled":"Failed"]}),e.jsx("p",{className:"text-muted-foreground mb-4",children:m==="cancelled"?"You cancelled the payment. No charges were made to your account.":"Your payment could not be processed. Please try again."}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{onClick:()=>{const B=localStorage.getItem("agentStore");t(B?`/store/agent/${B}`:"/")},children:localStorage.getItem("agentStore")?"Back to Store":"Go to Home"}),e.jsx(p,{variant:"outline",onClick:()=>window.history.back(),children:"Try Again"})]})]})})}),e.jsx(zs,{})]});if(S)return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(gs,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx(F,{className:"max-w-md w-full",children:e.jsxs(D,{className:"pt-6 text-center",children:[e.jsx(ds,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Connection Failed"}),e.jsx("p",{className:"text-muted-foreground mb-2 text-sm",children:S}),e.jsx("p",{className:"text-muted-foreground mb-4 text-xs",children:"Your payment may have been processed. Please try refreshing the page or contact support if you experience any issues."}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{onClick:()=>window.location.reload(),children:"Refresh Page"}),e.jsx(p,{variant:"outline",onClick:()=>{const B=localStorage.getItem("agentStore");t(B?`/store/agent/${B}`:"/")},children:localStorage.getItem("agentStore")?"Back to Store":"Go to Home"})]})]})})}),e.jsx(zs,{})]});const W={completed:{icon:Te,color:"text-white",bgColor:"bg-green-500 dark:bg-green-600",title:"Payment Successful!",description:f?"Your transaction has been completed successfully.":"Verifying transaction..."},pending:{icon:fs,color:"text-white",bgColor:"bg-orange-500 dark:bg-orange-600",title:"Payment Processing",description:"Your payment is being processed. Please wait..."},failed:{icon:ds,color:"text-white",bgColor:"bg-red-500 dark:bg-red-600",title:"Payment Failed",description:"Your payment could not be processed. Please try again."}};let L;(E==null?void 0:E.type)==="data_bundle"&&(E==null?void 0:E.paymentStatus)==="paid"?L="completed":(E==null?void 0:E.type)==="result_checker"&&(E==null?void 0:E.paymentStatus)==="paid"?L=E.status==="completed"?"completed":"pending":L=(E==null?void 0:E.status)||(m==="success"?"completed":"pending");const j=L,v=W[j],I=v.icon,A=u();return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[!A&&e.jsx(gs,{}),e.jsx("main",{className:"flex-1 py-12 px-4 pt-16",children:e.jsx("div",{className:"container mx-auto max-w-lg",children:e.jsxs(F,{children:[e.jsxs($,{className:"text-center",children:[e.jsx("div",{className:`flex h-16 w-16 items-center justify-center rounded-full ${v.bgColor} mx-auto mb-4`,children:e.jsx(I,{className:`h-8 w-8 ${v.color}`})}),e.jsx(G,{className:"text-2xl","data-testid":"text-status-title",children:v.title}),e.jsx(te,{children:v.description})]}),e.jsxs(D,{className:"space-y-6",children:[!f&&e.jsxs("div",{className:"bg-blue-500 dark:bg-blue-600 rounded-lg p-4 flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("p",{className:"text-sm text-white font-medium",children:"Verifying transaction details..."})]}),E&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-slate-700 dark:bg-slate-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Transaction ID"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-mono text-white","data-testid":"text-transaction-id",children:E.id}),e.jsx(p,{variant:"ghost",size:"icon",className:"h-6 w-6 text-white hover:bg-white/20",onClick:()=>H(E.id),children:e.jsx(ps,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Order ID"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-mono text-white","data-testid":"text-reference",children:["#",E.reference]}),e.jsx(p,{variant:"ghost",size:"icon",className:"h-6 w-6 text-white hover:bg-white/20",onClick:()=>H(E.reference),children:e.jsx(ps,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Product"}),e.jsx("span",{className:"text-sm font-medium text-white","data-testid":"text-product",children:E.productName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Amount"}),e.jsx("span",{className:"text-sm font-medium text-white","data-testid":"text-amount",children:ie(E.amount)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Phone"}),e.jsx("span",{className:"text-sm font-medium text-white",children:E.customerPhone})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Date"}),e.jsx("span",{className:"text-sm text-white",children:Ze(E.createdAt)})]})]}),se&&se.length>1&&e.jsxs("div",{className:"bg-blue-500 dark:bg-blue-600 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("h4",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(Ot,{className:"h-4 w-4"}),"Bulk Order Items (",se.length,")"]})}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:se.map((B,w)=>e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-blue-700 rounded px-3 py-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[w+1,"."]}),e.jsxs("span",{className:"text-sm font-mono font-semibold text-blue-900 dark:text-white",children:["#",B.reference]})]}),e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-200 mt-1",children:[e.jsx("span",{children:B.productName}),e.jsx("span",{className:"mx-2",children:"|"}),e.jsx("span",{children:B.customerPhone}),e.jsx("span",{className:"mx-2",children:"|"}),e.jsx("span",{children:ie(B.amount)})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded ${B.deliveryStatus==="delivered"?"bg-green-100 text-green-700":B.deliveryStatus==="processing"?"bg-yellow-100 text-yellow-700":B.deliveryStatus==="failed"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:B.deliveryStatus||"pending"})})]},B.id))})]}),!se&&E.isBulkOrder&&E.phoneNumbers&&(()=>{let B=[];try{const P=E.phoneNumbers;typeof P=="string"?B=JSON.parse(P):Array.isArray(P)&&(B=P)}catch(P){console.error("Failed to parse phoneNumbers:",P),B=[]}if(B.length===0)return null;const w=P=>typeof P=="string"?P:(P==null?void 0:P.phone)||"",R=()=>B.map(w).filter(Boolean).join(`
`);return e.jsxs("div",{className:"bg-green-500 dark:bg-green-600 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(Ot,{className:"h-4 w-4"}),"Bulk Order Recipients (",B.length,")"]}),e.jsxs(p,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:()=>H(R()),children:[e.jsx(ps,{className:"h-3 w-3 mr-1"}),"Copy All"]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-48 overflow-y-auto",children:B.map((P,q)=>{const T=w(P),J=typeof P=="object"&&P!==null;return e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-900 dark:text-white bg-white dark:bg-green-700 rounded px-3 py-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[q+1,"."]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("code",{className:"font-mono font-semibold",children:T}),J&&(P.bundleName||P.dataAmount)&&e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-200 mt-1",children:[P.bundleName&&e.jsx("span",{children:P.bundleName}),P.dataAmount&&e.jsxs("span",{className:"ml-2",children:["(",P.dataAmount,")"]})]})]})]},q)})})]})})(),E.status==="completed"&&E.type==="result_checker"&&e.jsxs("div",{className:"bg-green-600 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-white mb-3",children:"Download Your Result Checker"}),e.jsx("p",{className:"text-sm text-white mb-3",children:"Your result checker has been purchased successfully. Download your PDF credentials below."}),e.jsxs(p,{onClick:async()=>{try{const B=await fetch(`/api/result-checker/download/${E.reference}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/pdf"}});if(!B.ok){const q=await B.json().catch(()=>({error:"Unknown error"}));throw new Error(q.error||`Failed to download PDF: ${B.status}`)}const w=await B.blob(),R=window.URL.createObjectURL(w),P=document.createElement("a");P.href=R,P.download=`${E.productName.replace(/\s+/g,"-")}-${E.reference}.pdf`,document.body.appendChild(P),P.click(),document.body.removeChild(P),window.URL.revokeObjectURL(R),a({title:"âœ… Downloaded",description:"Your PDF credentials have been downloaded successfully"})}catch(B){console.error("PDF Download error:",B),a({title:"âŒ Download Failed",description:B.message||"Failed to download PDF. Please contact support.",variant:"destructive"})}},className:"w-full gap-2 bg-green-400 hover:bg-green-300 text-black border-2 border-green-400 font-semibold","data-testid":"button-download-pdf",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download PDF Credentials"]})]}),j==="completed"&&E.type==="data_bundle"&&e.jsxs("div",{className:"bg-green-500 text-white rounded-lg p-4 shadow-sm",children:[e.jsxs("h4",{className:"font-semibold text-white mb-2 flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4 text-white"}),"Order Placed Successfully"]}),e.jsxs("p",{className:"text-sm text-white/90",children:["Your data bundle order for ",e.jsx("strong",{className:"font-semibold text-white",children:E.customerPhone})," has been placed with our provider.",E.deliveryStatus==="processing"&&e.jsx("span",{className:"block mt-1 text-white/90",children:"â³ Delivery in progress - you will receive an SMS confirmation shortly."}),E.deliveryStatus==="delivered"&&e.jsx("span",{className:"block mt-1 text-white/90",children:"âœ“ Delivered! Check your phone for confirmation."})]})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:u()?e.jsxs(p,{onClick:()=>t(b()),className:"gap-2 flex-1",variant:"outline","data-testid":"button-continue-shopping",children:["Continue Shopping",e.jsx(ea,{className:"h-4 w-4"})]}):e.jsxs(p,{onClick:()=>t(g()),className:"gap-2 flex-1",variant:"outline","data-testid":"button-continue-dashboard",children:["Back to Dashboard",e.jsx(ea,{className:"h-4 w-4"})]})})]})]})})}),e.jsx(zs,{})]})}function kc({reference:s,agent:t,authLoading:a,attempts:i,query:n,setLocation:r}){const{data:d,isLoading:c,isError:x}=n;return a?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(gs,{}),e.jsx("div",{className:"container mx-auto px-4 py-16 flex items-center justify-center",children:e.jsx(F,{className:"max-w-md w-full",children:e.jsxs(D,{className:"pt-6 text-center",children:[e.jsx(re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Restoring Session"}),e.jsx("p",{className:"text-muted-foreground",children:"Please wait while we verify your authentication."})]})})})]}):s?c||!d&&i<10?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(gs,{}),e.jsx("div",{className:"container mx-auto px-4 py-16 flex items-center justify-center",children:e.jsxs(F,{className:"max-w-md w-full",children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-6 w-6 animate-spin"}),"Verifying Payment"]}),e.jsxs(te,{children:["Attempt ",i+1," of 10"]})]}),e.jsx(D,{children:e.jsx("p",{className:"text-muted-foreground",children:"Please wait while we confirm your payment."})})]})})]}):x||!(d!=null&&d.success)?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(gs,{}),e.jsx("div",{className:"container mx-auto px-4 py-16 flex items-center justify-center",children:e.jsxs(F,{className:"max-w-md w-full border-destructive/50",children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(ds,{className:"h-6 w-6"}),"Payment Verification Failed"]}),e.jsxs(te,{children:["Order ID: #",s]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsx("p",{className:"text-muted-foreground",children:(d==null?void 0:d.message)??"We could not verify your payment."}),e.jsx(p,{className:"w-full",onClick:()=>r(t?"/agent/wallet":"/user/wallet"),children:"Check Wallet"})]})]})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(gs,{}),e.jsx("div",{className:"container mx-auto px-4 py-16 flex items-center justify-center",children:e.jsxs(F,{className:"max-w-md w-full",children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2 text-green-600",children:[e.jsx(Te,{className:"h-6 w-6"}),"Top-up Successful"]}),e.jsx(te,{children:"Your wallet has been credited"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-500 text-white border border-green-600 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Amount Added"}),e.jsxs("span",{className:"font-bold",children:["GHâ‚µ",d.amount]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"New Balance"}),e.jsxs("span",{className:"font-bold",children:["GHâ‚µ",d.newBalance]})]})]}),e.jsxs(p,{variant:"outline",className:"w-full",onClick:()=>r(t?"/agent/dashboard":"/user/dashboard"),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Continue"]}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground",children:["Order ID: #",s]})]})]})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(gs,{}),e.jsx("div",{className:"container mx-auto px-4 py-16 flex items-center justify-center",children:e.jsxs(F,{className:"max-w-md w-full",children:[e.jsx($,{children:e.jsxs(G,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(ds,{className:"h-6 w-6"}),"Invalid Request"]})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No transaction reference was found."}),e.jsx(p,{onClick:()=>r("/user/wallet"),className:"w-full",children:"Go to Wallet"})]})]})})]})}function Sc(){const[,s]=ze(),a=new URLSearchParams(xl()).get("reference"),{agent:i,isLoading:n}=ve(),r=Hs(),[d,c]=o.useState(0),x=ee({queryKey:a?["wallet-topup-verify",a]:["wallet-topup-missing-ref"],queryFn:async()=>Me(`/api/wallet/topup/verify/${a}`,{disableAutoLogout:!0}),enabled:!!a&&!n&&d<10,refetchInterval:m=>{var b;return(b=m.state.data)!=null&&b.success?!1:3e3}});return o.useEffect(()=>{!x.data||x.data.success||d>=10||c(m=>m+1)},[x.data]),o.useEffect(()=>{var m;(m=x.data)!=null&&m.success&&(r.invalidateQueries({queryKey:["/api/user/stats"]}),r.invalidateQueries({queryKey:["/api/auth/me"]}),r.invalidateQueries({queryKey:["/api/agent/transactions"]}),r.invalidateQueries({queryKey:["/api/agent/wallet"]}))},[x.data,r]),e.jsx(kc,{reference:a,agent:i,authLoading:n,attempts:d,query:x,setLocation:s})}function Pc(){return e.jsx(Sc,{})}const Ls=o.forwardRef(({className:s,...t},a)=>e.jsx("textarea",{className:_("flex min-h-[80px] w-full rounded-md border border-input bg-background text-foreground px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...t}));Ls.displayName="Textarea";const cn=o.forwardRef(({className:s,...t},a)=>e.jsx(hl,{ref:a,className:_("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...t,children:e.jsx(Xn,{className:_("flex items-center justify-center text-current"),children:e.jsx(Rs,{className:"h-4 w-4"})})}));cn.displayName=hl.displayName;const Cc=60,{subtotal:nr,tax:Ac,total:da}=Bs(Cc),Tc=ae.object({name:ae.string().min(2,"Name must be at least 2 characters"),email:ae.string().email("Invalid email address"),phone:ae.string().min(10,"Phone must be at least 10 digits"),password:ae.string().min(8,"Password must be at least 8 characters"),confirmPassword:ae.string(),businessName:ae.string().min(2,"Business name is required"),storefrontSlug:ae.string().min(3,"URL must be at least 3 characters").regex(/^[a-z0-9-]+$/,"Only lowercase letters, numbers, and hyphens"),businessDescription:ae.string().min(10,"Business description must be at least 10 characters"),agreedToTerms:ae.boolean().refine(s=>s===!0,{message:"You must agree to the terms and conditions"})}).refine(s=>s.password===s.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function Fc(){const[s,t]=o.useState(!1),[a,i]=o.useState(()=>typeof window<"u"?!localStorage.getItem("agent-info-dialog-seen"):!0),{toast:n}=fe(),{theme:r}=nt(),d=u=>{navigator.clipboard.writeText(u),n({title:"Copied!",description:"URL copied to clipboard"})},c=Ss({resolver:Ps(Tc),mode:"onSubmit",defaultValues:{name:"",email:typeof window<"u"&&new URLSearchParams(window.location.search).get("email")||"",phone:"",password:"",confirmPassword:"",businessName:"",storefrontSlug:"",businessDescription:"",agreedToTerms:!1}}),x=oe({mutationFn:async u=>await Q("POST","/api/agent/register",u),onSuccess:u=>{u.paymentUrl?(n({title:"Registration successful!",description:"Redirecting to payment..."}),window.location.href=u.paymentUrl):n({title:"Registration failed",description:"Payment initialization failed",variant:"destructive"})},onError:u=>{console.error("Mutation error:",u),u.message&&u.message.includes("rate limit")?n({title:"Too Many Attempts",description:u.message||"You've exceeded the registration attempt limit. Please wait a few minutes before trying again.",variant:"destructive",duration:8e3}):n({title:"Registration failed",description:u.message||"Something went wrong",variant:"destructive"})}}),m=u=>{x.mutate(u)},b=u=>{i(u),!u&&typeof window<"u"&&localStorage.setItem("agent-info-dialog-seen","true")},g=o.useMemo(()=>typeof window<"u"?window.location.origin:"",[]);return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background px-4 py-6",children:[e.jsx("nav",{className:"mb-6 px-2",children:e.jsx(X,{href:typeof window<"u"&&Ms()?`/store/${Ms()}`:"/","data-testid":"link-back-home",children:e.jsxs(p,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(Xt,{className:"h-4 w-4"}),"Back to Home"]})})}),e.jsx(us,{open:a,onOpenChange:b,children:e.jsxs(ss,{className:"max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-black",children:[e.jsxs(ts,{children:[e.jsxs(as,{className:"flex items-center gap-2 text-xl text-white",children:[e.jsx(He,{className:"h-6 w-6 text-blue-600"}),"Important Information for Agents"]}),e.jsx(Ks,{className:"sr-only",children:"Read important information about agent registration and activation requirements"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx(Ft,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-900",children:"Activation Fee"}),e.jsxs("p",{className:"text-sm text-blue-800",children:["A one-time payment of ",e.jsxs("strong",{children:["GHâ‚µ",nr.toFixed(2)]})," + ",_e,"% Paystack fee = ",e.jsxs("strong",{children:["GHâ‚µ",da.toFixed(2)]})," is required to activate your agent account."]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx(Ft,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-900",children:"Instant Activation"}),e.jsx("p",{className:"text-sm text-green-800",children:"Your account will be automatically activated once payment is confirmed."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx(Ft,{className:"h-5 w-5 text-purple-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-purple-900",children:"Commission Structure"}),e.jsx("p",{className:"text-sm text-purple-800",children:"Earn competitive commissions on every transaction you process."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-indigo-50 rounded-lg border border-indigo-200",children:[e.jsx(Ft,{className:"h-5 w-5 text-indigo-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-indigo-900",children:"Your Storefront"}),e.jsx("p",{className:"text-sm text-indigo-800",children:"Get a personalized storefront URL to share with your customers."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-cyan-50 rounded-lg border border-cyan-200",children:[e.jsx(Ft,{className:"h-5 w-5 text-cyan-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-cyan-900",children:"Payment Methods"}),e.jsx("p",{className:"text-sm text-cyan-800",children:"Accept payments via Mobile Money, Cards, and Bank transfers."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx(ks,{className:"h-5 w-5 text-orange-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-orange-900",children:"Requirements"}),e.jsx("p",{className:"text-sm text-orange-800",children:"Valid phone number, email address, and business information."})]})]})]})}),e.jsx(la,{children:e.jsx(p,{onClick:()=>i(!1),className:"w-full sm:w-auto",children:"I Understand, Proceed to Registration"})})]})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-4xl",children:e.jsxs(F,{className:"w-full shadow-xl border-2 border-yellow-400",children:[e.jsxs($,{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:r==="dark"?_t:kt,alt:"ResellersHub Pro",className:"h-12 w-auto"})}),e.jsx(G,{className:"text-2xl font-bold",children:"Become an Agent"}),e.jsxs(te,{children:["Create your ",mt," agent account and start earning"]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-900",children:"Activation Fee Breakdown"}),e.jsxs("div",{className:"text-xs text-yellow-800 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Activation Fee:"}),e.jsxs("span",{children:["GHâ‚µ",nr.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Paystack Fee (",_e,"%):"]}),e.jsxs("span",{children:["GHâ‚µ",Ac.toFixed(2)]})]}),e.jsx(Le,{className:"my-1 bg-yellow-300"}),e.jsxs("div",{className:"flex justify-between font-semibold text-yellow-900",children:[e.jsx("span",{children:"Total to Pay:"}),e.jsxs("span",{children:["GHâ‚µ",da.toFixed(2)]})]})]})]})})]}),e.jsxs(D,{children:[e.jsx(Os,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(m),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(ue,{control:c.control,name:"name",render:({field:u})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Full Name"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Ht,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(Y,{placeholder:"John Doe",autoComplete:"name",className:"pl-10","data-testid":"input-name",...u})]})}),e.jsx(he,{})]})}),e.jsx(ue,{control:c.control,name:"phone",render:({field:u})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Phone Number"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Ot,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(Y,{placeholder:"0241234567",autoComplete:"tel",className:"pl-10","data-testid":"input-phone",...u})]})}),e.jsx(he,{})]})})]}),e.jsx(ue,{control:c.control,name:"email",render:({field:u})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Email"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Kt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(Y,{placeholder:"you@example.com",type:"email",autoComplete:"email",className:"pl-10","data-testid":"input-email",...u})]})}),e.jsx(he,{})]})}),e.jsx(ue,{control:c.control,name:"businessName",render:({field:u})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Business Name"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(ot,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(Y,{placeholder:"My Data Store",className:"pl-10","data-testid":"input-business",...u})]})}),e.jsx(he,{})]})}),e.jsx(ue,{control:c.control,name:"storefrontSlug",render:({field:u})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Storefront URL"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Qn,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(Y,{placeholder:"my-store",className:"pl-10","data-testid":"input-slug",...u})]})}),e.jsx(Ye,{children:u.value&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("span",{children:["Your store: ",g,"/store/agent/",e.jsx("strong",{children:u.value})]}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>d(`${g}/store/agent/${u.value}`),children:e.jsx(ps,{className:"h-3 w-3"})})]})}),e.jsx(he,{})]})}),e.jsx(ue,{control:c.control,name:"businessDescription",render:({field:u})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Business Description"}),e.jsx(xe,{children:e.jsx(Ls,{placeholder:"Tell customers about your business...",className:"resize-none","data-testid":"input-description",...u})}),e.jsx(he,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(ue,{control:c.control,name:"password",render:({field:u})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Password"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(Y,{type:s?"text":"password",autoComplete:"new-password",className:"pl-10 pr-10","data-testid":"input-password",...u}),e.jsx(p,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3",onClick:()=>t(!s),children:s?e.jsx(et,{className:"h-4 w-4"}):e.jsx(st,{className:"h-4 w-4"})})]})}),e.jsx(he,{})]})}),e.jsx(ue,{control:c.control,name:"confirmPassword",render:({field:u})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Confirm Password"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground dark:text-gray-400"}),e.jsx(Y,{type:s?"text":"password",autoComplete:"new-password",className:"pl-10","data-testid":"input-confirm",...u})]})}),e.jsx(he,{})]})})]}),e.jsx(ue,{control:c.control,name:"agreedToTerms",render:({field:u})=>e.jsxs(me,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(xe,{children:e.jsx(cn,{checked:u.value,onCheckedChange:u.onChange,"data-testid":"checkbox-terms"})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsxs(pe,{className:"text-sm font-medium",children:["I agree to pay the GHâ‚µ",da.toFixed(2)," activation fee (incl. ",_e,"% Paystack fee) and accept the terms and conditions"]}),e.jsx(Ye,{className:"text-xs",children:"By checking this box, you confirm that you understand the activation fee is required and agree to our terms of service."}),e.jsx(he,{})]})]})}),e.jsxs(p,{type:"submit",className:"w-full",disabled:x.isPending,"data-testid":"button-submit",children:[x.isPending&&e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),"Proceed to Payment (GHâ‚µ",da.toFixed(2),")"]})]})}),e.jsxs("div",{className:"mt-6 text-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground dark:text-gray-300",children:"Already have an account? "}),e.jsx(X,{href:"/login",className:"text-primary hover:underline font-medium",children:"Sign in"})]})]})]})})})]})}function Ic(){const[s,t]=o.useState("processing"),[a,i]=o.useState(""),[n,r]=o.useState(""),[,d]=ze(),[c,x]=o.useState(6);ve();const{theme:m}=nt();return o.useEffect(()=>{const b=new URLSearchParams(window.location.search),g=b.get("reference"),u=b.get("mock")==="true";if(!g){t("failed");return}if(u){t("success"),r("test@example.com"),setTimeout(()=>{const N=setInterval(()=>{x(l=>l<=1?(clearInterval(N),d("/login"),0):l-1)},1e3)},1e3);return}const f=async()=>{var N,l;try{const y=await(await fetch(`/api/paystack/verify?reference=${g}`)).json();y.status==="success"?(t("success"),(l=(N=y.data)==null?void 0:N.user)!=null&&l.email&&r(y.data.user.email),setTimeout(()=>{const M=setInterval(()=>{x(S=>S<=1?(clearInterval(M),d("/login"),0):S-1)},1e3)},1500)):y.status==="cancelled"?(t("cancelled"),i(y.message||"Payment was cancelled")):(t("failed"),i(y.message||y.error||"Payment verification failed"))}catch(h){console.error("Payment verification error:",h),t("failed"),i("Network error. Please check your connection and try again.")}};setTimeout(()=>{f()},3e3)},[d]),e.jsx("div",{className:"min-h-screen flex flex-col bg-background px-4 py-6",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs(F,{className:"w-full max-w-lg shadow-xl border-2 bg-card dark:bg-card border-border",children:[e.jsxs($,{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:m==="dark"?_t:kt,alt:"ResellersHub Pro",className:"h-12 w-auto"})}),e.jsx(G,{className:"text-2xl font-bold",children:"Agent Activation"}),e.jsx(te,{children:"Processing your payment"})]}),e.jsxs(D,{className:"space-y-6",children:[s==="processing"&&e.jsxs(Is,{className:"bg-white dark:bg-black border border-blue-200",children:[e.jsx(re,{className:"h-5 w-5 text-blue-600 animate-spin"}),e.jsx(Wt,{className:"text-blue-900",children:"Processing Payment..."}),e.jsx(Es,{className:"text-blue-800",children:"Please wait while we verify your payment. This may take a few moments."})]}),s==="success"&&e.jsxs(e.Fragment,{children:[e.jsxs(Is,{className:"bg-white dark:bg-black border border-green-200",children:[e.jsx(Ft,{className:"h-5 w-5 text-green-600"}),e.jsx(Wt,{className:"text-green-900 text-lg font-semibold",children:"ðŸŽ‰ Account Activated Successfully!"}),e.jsxs(Es,{className:"text-green-800 space-y-3 mt-2",children:[e.jsx("p",{className:"font-semibold",children:"Congratulations! Your agent account has been successfully created and activated."}),e.jsxs("div",{className:"bg-white/80 dark:bg-black/80 p-3 rounded-md border border-green-300",children:[e.jsx("p",{className:"font-semibold text-sm mb-2",children:"âœ‰ï¸ Account Details:"}),n&&e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",n]}),e.jsx("p",{className:"text-sm mt-1 text-green-900",children:"Please use your registration email and password to login."})]}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsx("p",{className:"font-semibold",children:"ðŸš€ What's next?"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[e.jsx("li",{children:"Login to access your agent dashboard"}),e.jsx("li",{children:"Set up your storefront preferences"}),e.jsx("li",{children:"Start selling and earning commissions"}),e.jsx("li",{children:"Share your storefront URL with customers"})]})]})]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(X,{href:"/login",children:e.jsx(p,{className:"w-full",size:"lg",children:"Login to Your Dashboard"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use your email and password to access your account"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Redirecting to login in ",c,"sâ€¦"]})]})]}),s==="cancelled"&&e.jsxs(e.Fragment,{children:[e.jsxs(Is,{className:"bg-white dark:bg-black border border-amber-200",children:[e.jsx(ks,{className:"h-5 w-5 text-amber-600"}),e.jsx(Wt,{className:"text-amber-900 text-lg font-semibold",children:"Payment Cancelled"}),e.jsxs(Es,{className:"text-amber-800",children:[e.jsx("p",{className:"font-semibold",children:a||"You cancelled the payment."}),e.jsx("p",{className:"mt-2",children:"Your registration was not completed because payment was cancelled. No charges have been made to your account."}),e.jsx("p",{className:"mt-2 text-sm",children:"You can try again whenever you're ready to complete your agent registration."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(X,{href:"/agent/register",className:"flex-1",children:e.jsx(p,{className:"w-full",children:"Try Again"})}),e.jsx(X,{href:typeof window<"u"&&Ms()?`/store/${Ms()}`:"/",className:"flex-1",children:e.jsx(p,{variant:"outline",className:"w-full",children:"Back to Home"})})]})]}),s==="failed"&&e.jsxs(e.Fragment,{children:[e.jsxs(Is,{className:"bg-white dark:bg-black border border-red-200",children:[e.jsx(ds,{className:"h-5 w-5 text-red-600"}),e.jsx(Wt,{className:"text-red-900 text-lg font-semibold",children:"Activation Failed"}),e.jsxs(Es,{className:"text-red-800",children:[e.jsx("p",{className:"font-semibold",children:a||"We couldn't verify your payment."}),e.jsx("p",{className:"mt-2",children:"This could be due to:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 ml-2 space-y-1 text-sm",children:[e.jsx("li",{children:"Payment failed to process"}),e.jsx("li",{children:"Network connection issues"}),e.jsx("li",{children:"Invalid payment reference"})]}),e.jsx("p",{className:"mt-3 text-sm font-semibold",children:"Please try registering again or contact support if you were charged."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(X,{href:"/agent/register",className:"flex-1",children:e.jsx(p,{variant:"outline",className:"w-full",children:"Try Again"})}),e.jsx(X,{href:typeof window<"u"&&Ms()?`/store/${Ms()}`:"/",className:"flex-1",children:e.jsx(p,{className:"w-full",children:"Back to Home"})})]})]})]})]})})})}function Ec(){const{theme:s}=nt();return e.jsx("div",{className:"min-h-screen flex flex-col bg-background px-4 py-6",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs(F,{className:"w-full max-w-2xl shadow-xl border-2",children:[e.jsxs($,{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:s==="dark"?_t:kt,alt:"ResellersHub Pro",className:"h-12 w-auto"})}),e.jsx(G,{className:"text-2xl font-bold",children:"Upgrade to Agent"}),e.jsx(te,{children:"Become an agent and start earning commissions"})]}),e.jsx(D,{children:e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(X,{href:"/user/dashboard?upgrade=true",children:e.jsx(p,{variant:"outline",children:"Use Same Account"})}),e.jsx(X,{href:"/agent/register",children:e.jsx(p,{variant:"default",children:"Create New Agent Account"})})]})})]})})})}const yt=o.forwardRef(({className:s,children:t,...a},i)=>e.jsxs(ul,{ref:i,className:_("relative overflow-hidden",s),...a,children:[e.jsx(Jn,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(dn,{}),e.jsx(Zn,{})]}));yt.displayName=ul.displayName;const dn=o.forwardRef(({className:s,orientation:t="vertical",...a},i)=>e.jsx(pl,{ref:i,orientation:t,className:_("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...a,children:e.jsx(ei,{className:"relative flex-1 rounded-full bg-border"})}));dn.displayName=pl.displayName;function Jt({open:s,onOpenChange:t}){const{user:a}=ve(),{toast:i}=fe(),n=Hs(),[r,d]=o.useState(""),[c,x]=o.useState(!1),[m,b]=o.useState(null),[g,u]=o.useState(null),{data:f,isLoading:N}=ee({queryKey:["/api/user/api-keys"],enabled:!!a&&s}),l=oe({mutationFn:async k=>await Q("POST","/api/user/api-keys",{name:k}),onSuccess:k=>{b(k.key),d(""),x(!1),n.invalidateQueries({queryKey:["/api/user/api-keys"]}),i({title:"API Key Created",description:"Your new API key has been generated. Copy it now - it won't be shown again."})},onError:k=>{i({title:"Error",description:k.message||"Failed to create API key",variant:"destructive"})}}),h=oe({mutationFn:async k=>{await Q("DELETE",`/api/user/api-keys/${k}`)},onSuccess:()=>{n.invalidateQueries({queryKey:["/api/user/api-keys"]}),i({title:"API Key Revoked",description:"The API key has been permanently deleted."})},onError:k=>{i({title:"Error",description:k.message||"Failed to revoke API key",variant:"destructive"})}}),y=async(k,C)=>{try{await navigator.clipboard.writeText(k),u(C),setTimeout(()=>u(null),2e3),i({title:"Copied",description:"API key copied to clipboard"})}catch{i({title:"Error",description:"Failed to copy to clipboard",variant:"destructive"})}},M=()=>{r.trim()&&l.mutate(r.trim())},S=k=>{confirm("Are you sure you want to revoke this API key? This action cannot be undone.")&&h.mutate(k)};return e.jsx(us,{open:s,onOpenChange:t,children:e.jsxs(ss,{className:"max-w-[95vw] sm:max-w-md md:max-w-2xl lg:max-w-4xl max-h-[95vh] overflow-y-auto",children:[e.jsxs(ts,{className:"pb-3 sm:pb-4",children:[e.jsxs(as,{className:"flex items-center gap-2 text-base sm:text-lg md:text-xl",children:[e.jsx(Cs,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"API & Integrations"})]}),e.jsx(Ks,{className:"text-xs sm:text-sm leading-relaxed",children:"Generate secure API keys to connect your app or third-party services."})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4 md:space-y-6",children:[m&&e.jsxs(Is,{className:"border-yellow-200 bg-yellow-50 p-3 sm:p-4",children:[e.jsx(ks,{className:"h-3 w-3 sm:h-4 sm:w-4 text-yellow-600 flex-shrink-0"}),e.jsxs(Es,{className:"text-yellow-800 text-xs sm:text-sm leading-relaxed",children:[e.jsx("strong",{children:"New API Key Created:"})," ",m,e.jsxs(p,{variant:"outline",size:"sm",className:"ml-2 mt-2 sm:mt-0 h-6 px-2 text-xs sm:h-7 sm:px-3",onClick:()=>y(m,"created"),children:[g==="created"?e.jsx(Rs,{className:"h-2.5 w-2.5"}):e.jsx(ps,{className:"h-2.5 w-2.5"}),e.jsx("span",{className:"ml-1 hidden sm:inline",children:"Copy"})]})]})]}),e.jsxs(F,{className:"p-3 sm:p-4 md:p-6",children:[e.jsx($,{className:"pb-2 sm:pb-3 px-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(G,{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(Js,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),"API Keys"]}),e.jsx(te,{className:"text-xs sm:text-sm mt-1",children:"Manage your API keys for secure access to our platform"})]}),e.jsxs(us,{open:c,onOpenChange:x,children:[e.jsx(St,{asChild:!0,children:e.jsxs(p,{size:"sm",className:"w-full sm:w-auto h-8 px-3 text-xs sm:h-9 sm:px-4 sm:text-sm",children:[e.jsx(As,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{children:"Create API Key"})]})}),e.jsxs(ss,{className:"w-[95vw] sm:w-full max-w-md mx-4 sm:mx-auto",children:[e.jsxs(ts,{className:"pb-3 sm:pb-4",children:[e.jsx(as,{className:"text-sm sm:text-base",children:"Create New API Key"}),e.jsx(Ks,{className:"text-xs sm:text-sm leading-relaxed",children:"Enter a name for your API key. This will help you identify it later."})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"keyName",className:"text-xs sm:text-sm font-medium",children:"API Key Name"}),e.jsx(Y,{id:"keyName",placeholder:"e.g., My App, Production API",value:r,onChange:k=>d(k.target.value),onKeyDown:k=>k.key==="Enter"&&M(),className:"h-9 sm:h-10 text-sm"})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row sm:justify-end gap-2 sm:gap-3",children:[e.jsx(p,{variant:"outline",onClick:()=>x(!1),size:"sm",className:"w-full sm:w-auto h-8 px-3 text-xs sm:h-9 sm:px-4 sm:text-sm",children:"Cancel"}),e.jsxs(p,{onClick:M,disabled:!r.trim()||l.isPending,size:"sm",className:"w-full sm:w-auto h-8 px-3 text-xs sm:h-9 sm:px-4 sm:text-sm",children:[l.isPending&&e.jsx(re,{className:"h-3 w-3 mr-1 animate-spin"}),"Create Key"]})]})]})]})]})]})}),e.jsx(D,{className:"px-0 pt-0",children:N?e.jsx("div",{className:"flex items-center justify-center py-6 sm:py-8",children:e.jsx(re,{className:"h-6 w-6 sm:h-8 sm:w-8 animate-spin"})}):f&&f.length>0?e.jsx("div",{className:"space-y-2 sm:space-y-3 md:space-y-4",children:f.map(k=>e.jsx("div",{className:"flex flex-col gap-3 p-3 sm:p-4 border rounded-lg bg-card hover:bg-accent/50 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"space-y-2 flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm sm:text-base truncate",children:k.name}),e.jsx(Z,{variant:k.isActive?"default":"secondary",className:"text-xs px-2 py-0.5",children:k.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["Created ",new Date(k.createdAt).toLocaleDateString()]}),k.lastUsed&&e.jsxs("div",{children:["Last used ",new Date(k.lastUsed).toLocaleDateString()]})]}),e.jsx("div",{className:"font-mono text-xs sm:text-sm bg-muted px-2 py-1.5 rounded break-all sm:break-normal",children:"sk_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>y("sk_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",k.id),className:"h-8 w-8 p-0 sm:h-9 sm:w-9 sm:p-2",title:"Copy API Key",children:g===k.id?e.jsx(Rs,{className:"h-3 w-3 sm:h-4 sm:w-4"}):e.jsx(ps,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>S(k.id),disabled:h.isPending,className:"h-8 w-8 p-0 sm:h-9 sm:w-9 sm:p-2 text-destructive hover:text-destructive",title:"Delete API Key",children:e.jsx(Ws,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]})]})},k.id))}):e.jsxs("div",{className:"text-center py-6 sm:py-8 text-muted-foreground",children:[e.jsx(Cs,{className:"h-8 w-8 sm:h-12 sm:w-12 mx-auto mb-3 sm:mb-4 opacity-50"}),e.jsx("p",{className:"text-xs sm:text-sm",children:"No API keys yet. Create your first key to get started."})]})})]}),e.jsxs(F,{className:"p-3 sm:p-4 md:p-6",children:[e.jsxs($,{className:"pb-2 sm:pb-3 px-0",children:[e.jsx(G,{className:"text-sm sm:text-base",children:"API Documentation"}),e.jsx(te,{className:"text-xs sm:text-sm leading-relaxed",children:"Example API calls using your API keys"})]}),e.jsxs(D,{className:"px-0 pt-0 space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-sm sm:text-base",children:"Get Account Balance"}),e.jsxs("div",{className:"bg-muted p-3 sm:p-4 rounded-md font-mono text-xs sm:text-sm overflow-x-auto",children:[e.jsx("div",{className:"whitespace-nowrap sm:whitespace-normal",children:"GET /api/v1/user/balance"}),e.jsx("div",{className:"text-muted-foreground mt-1 whitespace-nowrap sm:whitespace-normal",children:"Authorization: Bearer YOUR_API_KEY"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-sm sm:text-base",children:"Get Transaction History"}),e.jsxs("div",{className:"bg-muted p-3 sm:p-4 rounded-md font-mono text-xs sm:text-sm overflow-x-auto",children:[e.jsx("div",{className:"whitespace-nowrap sm:whitespace-normal",children:"GET /api/v1/user/transactions?limit=10&offset=0"}),e.jsx("div",{className:"text-muted-foreground mt-1 whitespace-nowrap sm:whitespace-normal",children:"Authorization: Bearer YOUR_API_KEY"})]})]})]}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed pt-2 border-t",children:"All API endpoints require Bearer token authentication with your API key."})]})]})]})]})})}const ir=[{title:"Dashboard",href:"/agent/dashboard",icon:ya},{title:"My Storefront",href:"/agent/storefront",icon:ot},{title:"Pricing",href:"/agent/pricing",icon:Bt},{title:"Transactions",href:"/agent/transactions",icon:Zs},{title:"MTN Bundles",href:"/agent/bundles/mtn",icon:Ke},{title:"AT iShare Bundles",href:"/agent/bundles/at_ishare",icon:Ke},{title:"AT BIG TIME Bundles",href:"/agent/bundles/at_bigtime",icon:Ke},{title:"TELECEL Bundles",href:"/agent/bundles/telecel",icon:Ke},{title:"Top Up Wallet",href:"/agent/wallet",icon:Ge},{title:"API Keys & Integrations",href:"/dashboard/api-integrations",icon:Cs},{title:"Withdrawals",href:"/agent/withdrawals",icon:ye},{title:"Settings",href:"/agent/settings",icon:Rt},{title:"Support Chat",href:"/agent/support",icon:tt}];function qe({onClose:s}={}){var f;const[t]=ze(),{logout:a,isLoggingOut:i,user:n}=ve(),{theme:r}=nt(),[d,c]=o.useState(!1),{data:x}=ee({queryKey:["user-rank"],queryFn:()=>Q("GET","/api/user/rank"),enabled:!!n}),{data:m,error:b}=ee({queryKey:["/api/profile"]}),{data:g=0}=ee({queryKey:["/api/support/admin/unread-count"],enabled:(n==null?void 0:n.role)==="admin",queryFn:async()=>{try{return(await(await Q("GET","/api/support/admin/unread-count")).json()).count||0}catch{return 0}},refetchInterval:3e4}),u=m==null?void 0:m.profile;return b?e.jsxs("div",{className:"flex h-full w-64 flex-col border-r border-border bg-sidebar text-sidebar-foreground relative",children:[e.jsx("div",{className:`flex h-16 items-center justify-center border-b border-border px-6 ${s?"pr-4":""}`,children:e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-primary text-primary-foreground font-bold text-xs",children:((f=n==null?void 0:n.name)==null?void 0:f.charAt(0).toUpperCase())||"A"})}),e.jsx(yt,{className:"flex-1 px-3 py-4",children:e.jsx("nav",{className:"flex flex-col gap-1",children:ir.map(N=>{const l=t===N.href||N.href!=="/agent/dashboard"&&t.startsWith(N.href),h=N.href==="/agent/support";return e.jsx(X,{href:N.href,children:e.jsxs(p,{size:"sm",variant:l?"default":"ghost",className:_("w-full justify-start gap-2 px-2 py-1.5 text-xs font-normal relative text-yellow-600 hover:bg-yellow-50 hover:text-yellow-700 dark:text-yellow-400 dark:hover:bg-yellow-900/20 dark:hover:text-yellow-300",l&&"bg-yellow-500 !text-white font-medium shadow-sm hover:bg-yellow-600 hover:!text-white"),onClick:()=>s&&s(),children:[e.jsx(N.icon,{className:_("h-4 w-4",l?"text-white":"text-yellow-600 dark:text-yellow-400")}),e.jsx("span",{className:"flex-1 text-left",children:N.title}),h&&g>0&&e.jsx(Z,{variant:"destructive",className:"ml-auto",children:g})]})},N.href)})})}),e.jsx("div",{className:"border-t p-3",children:e.jsxs(p,{size:"sm",variant:"ghost",className:"w-full justify-start gap-2 px-2 py-1.5 text-xs text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-900/20",onClick:()=>{s&&s(),a()},disabled:i,children:[e.jsx(ta,{className:"h-4 w-4 text-red-600 dark:text-red-400"}),i?"Logging out...":"Log out"]})})]}):e.jsxs("div",{className:"flex h-full w-64 flex-col border-r border-border bg-sidebar text-sidebar-foreground relative",children:[e.jsx("div",{className:`flex h-16 items-center justify-center border-b border-border px-6 ${s?"pr-4":""}`,children:e.jsx("div",{className:"flex flex-col items-center text-center w-full",children:e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-1 w-full",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-sm font-medium text-sidebar-foreground",children:(n==null?void 0:n.name)||"Agent"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n==null?void 0:n.email})]}),x&&e.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-green-500 px-2 py-0.5 text-xs font-medium text-white border border-green-600 dark:bg-green-600 dark:border-green-700",children:[e.jsx(Gs,{className:"h-2.5 w-2.5"}),e.jsx("span",{children:x.rank&&x.rank>0?`#${x.rank}`:"Unranked"})]})]})})}),u&&e.jsx("div",{className:"border-b border-border p-3",children:e.jsxs("div",{className:"rounded-lg bg-green-500 p-3",children:[e.jsx("p",{className:"text-xs text-white mb-1",children:"Profit Balance"}),e.jsx("p",{className:"text-xl font-bold tabular-nums text-white","data-testid":"text-agent-profit-balance",children:ie(u.profitBalance)}),e.jsxs("p",{className:"text-xs text-white mt-1",children:["Wallet Balance: ",ie(u.walletBalance)]}),e.jsxs("p",{className:"text-xs text-white mt-1",children:["Total Withdrawals: ",ie(u.totalWithdrawals)]})]})}),e.jsx(yt,{className:"flex-1 px-3 py-4",children:e.jsxs("nav",{className:"flex flex-col gap-1",children:[ir.map(N=>{const l=t===N.href||N.href!=="/agent/dashboard"&&t.startsWith(N.href),h=N.href==="/agent/support";return e.jsx(X,{href:N.href,children:e.jsxs(p,{variant:l?"default":"ghost",className:_("w-full justify-start gap-3 font-normal relative text-yellow-600 hover:bg-yellow-50 hover:text-yellow-700 dark:text-yellow-400 dark:hover:bg-yellow-900/20 dark:hover:text-yellow-300",l&&"bg-yellow-500 !text-white font-medium shadow-sm hover:bg-yellow-600 hover:!text-white"),"data-testid":`link-agent-${N.title.toLowerCase().replace(/ /g,"-")}`,onClick:()=>s&&s(),children:[e.jsx(N.icon,{className:_("h-4 w-4",l?"text-white":"text-yellow-600 dark:text-yellow-400")}),e.jsx("span",{className:"flex-1 text-left",children:N.title}),h&&g>0&&(n==null?void 0:n.role)==="admin"&&e.jsx(Z,{variant:"destructive",className:"ml-auto",children:g})]})},N.href)}),u&&e.jsx("a",{href:`/store/agent/${u.storefrontSlug}`,target:"_blank",rel:"noopener noreferrer",className:"mt-2",children:e.jsxs(p,{variant:"outline",className:"w-full justify-start gap-3 bg-green-600 hover:bg-green-700 text-white border-green-600","data-testid":"link-view-storefront",onClick:()=>s&&s(),children:[e.jsx(vt,{className:"h-4 w-4"}),"View Public Store"]})})]})}),e.jsxs("div",{className:"border-t p-3",children:[e.jsxs(p,{variant:"ghost",className:"w-full justify-start gap-3 text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-900/20",onClick:()=>{s&&s(),a()},disabled:i,children:[e.jsx(ta,{className:"h-4 w-4 text-red-600 dark:text-red-400"}),i?"Logging out...":"Log out"]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-border/50",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Developed by"," ",e.jsx("a",{href:"https://bm-portfolio-up2x.onrender.com",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 font-medium",children:"BlusMotif"})]})})]}),e.jsx(Jt,{open:d,onOpenChange:c})]})}function Ae({title:s,value:t,description:a,icon:i,trend:n,trendLabel:r,className:d}){return e.jsxs(F,{className:_("bg-green-500 border border-yellow-500 text-white",d),children:[e.jsxs($,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium text-white",children:s}),i&&e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-white/20",children:e.jsx(i,{className:"h-4 w-4 text-white"})})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-lg font-bold tabular-nums",children:t}),(a||n)&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n&&e.jsx("span",{className:"text-xs font-medium text-white",children:n}),r&&e.jsx("span",{className:"text-xs text-white",children:r}),a&&!n&&!r&&e.jsx("p",{className:"text-xs text-white",children:a})]})]})]})}const Bc=({stats:s})=>{const{data:t,isLoading:a}=ee({queryKey:["/api/agent/performance-history"],refetchInterval:3e4,refetchOnWindowFocus:!0});if(a)return e.jsx("div",{className:"w-full h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});const i=Array.isArray(t)?t:[{day:"Mon",profit:25.5,transactions:3},{day:"Tue",profit:45.2,transactions:5},{day:"Wed",profit:32.8,transactions:4},{day:"Thu",profit:67.9,transactions:8},{day:"Fri",profit:89.3,transactions:12},{day:"Sat",profit:54.6,transactions:7},{day:"Sun",profit:(s==null?void 0:s.todayProfit)||42.1,transactions:(s==null?void 0:s.todayTransactions)||5}];return e.jsxs("div",{className:"w-full",children:[e.jsx("h4",{className:"text-sm font-medium mb-4 text-muted-foreground",children:"Weekly Performance"}),e.jsx(gl,{width:"100%",height:200,children:e.jsxs(jl,{data:i,children:[e.jsx(fl,{strokeDasharray:"3 3",className:"opacity-30"}),e.jsx(bl,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:12,fill:"hsl(var(--muted-foreground))"}}),e.jsx(Nl,{axisLine:!1,tickLine:!1,tick:{fontSize:12,fill:"hsl(var(--muted-foreground))"},tickFormatter:n=>`GHâ‚µ${n}`}),e.jsx(vl,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px",fontSize:"12px"},formatter:(n,r)=>[r==="profit"?`GHâ‚µ${n.toFixed(2)}`:n,r==="profit"?"Profit":"Transactions"],labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(yl,{dataKey:"profit",fill:"hsl(var(--primary))",radius:[4,4,0,0],name:"profit"})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4 text-xs text-muted-foreground",children:[e.jsx("span",{children:"Daily profit over the last 7 days"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-primary rounded"}),e.jsx("span",{children:"Profit"})]})})]})]})};function Oc(){var l,h;const[s,t]=o.useState(!1),[a,i]=o.useState(!1),[,n]=ze(),r=o.useRef(!1),{user:d}=ve(),{data:c}=ee({queryKey:["/api/profile"],refetchInterval:3e4,refetchOnWindowFocus:!0,refetchOnReconnect:!0}),x=c==null?void 0:c.profile,[m]=ze();o.useEffect(()=>{x&&!x.isApproved&&m!=="/agent/activation-complete"&&!r.current&&(r.current=!0,console.log("Redirecting to activation page - agent not approved"),n("/agent/activation-complete"))},[x,m,n]);const{data:b,isLoading:g,error:u}=ee({queryKey:["/api/agent/stats"],refetchInterval:5e3,refetchOnWindowFocus:!0,refetchOnReconnect:!0,staleTime:0}),[f,N]=o.useState(0);return o.useEffect(()=>{(b==null?void 0:b.totalProfit)!==void 0&&N(b.totalProfit)},[b==null?void 0:b.totalProfit]),console.log("[Dashboard] Stats data:",b),console.log("[Dashboard] Stats error:",u),console.log("[Dashboard] totalProfit:",b==null?void 0:b.totalProfit),console.log("[Dashboard] displayProfit:",f),ee({queryKey:["/api/agent/transactions/recent"],refetchInterval:5e3,refetchOnWindowFocus:!0,refetchOnReconnect:!0,staleTime:0}),e.jsxs("div",{className:"flex h-screen bg-background",children:[s&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>t(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(qe,{onClose:()=>t(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(qe,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b bg-background px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>t(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Agent Dashboard"}),e.jsxs("p",{className:"text-sm text-muted-foreground hidden sm:block",children:["Welcome back, ",((l=x==null?void 0:x.user)==null?void 0:l.name)||"Agent"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x&&e.jsx("a",{href:`/store/agent/${x.storefrontSlug}`,target:"_blank",rel:"noopener noreferrer",children:e.jsxs(p,{variant:"outline",size:"sm",className:"gap-2 hidden sm:flex",children:[e.jsx(vt,{className:"h-4 w-4"}),"View Store"]})}),e.jsx(ke,{})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs(F,{className:"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 border-yellow-600 shadow-xl overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 sm:w-24 sm:h-24 lg:w-32 lg:h-32 bg-white/10 rounded-full -translate-y-10 sm:-translate-y-12 lg:-translate-y-16 translate-x-10 sm:translate-x-12 lg:translate-x-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 bg-white/5 rounded-full translate-y-8 sm:translate-y-10 lg:translate-y-12 -translate-x-8 sm:-translate-x-10 lg:-translate-x-12"}),e.jsx(D,{className:"p-3 sm:p-4 md:p-6 relative",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 bg-white/20 rounded-full shadow-lg backdrop-blur-sm flex-shrink-0",children:e.jsx("span",{className:"text-lg sm:text-xl md:text-2xl animate-bounce",children:"ðŸ‘‹"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-white mb-1 drop-shadow-sm leading-tight",children:["Welcome back, ",((h=d==null?void 0:d.name)==null?void 0:h.toUpperCase())||"AGENT","!"]}),e.jsx("p",{className:"text-yellow-100 text-xs sm:text-sm md:text-base font-medium leading-relaxed",children:"Here's what's happening with your business today âœ¨"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 sm:gap-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-white/90",children:[e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium",children:"Live Dashboard"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-white/90",children:[e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-blue-400 rounded-full animate-pulse [animation-delay:0.5s]"}),e.jsx("span",{className:"text-xs font-medium",children:"Real-time Updates"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-4",children:[e.jsx("div",{className:"flex items-center gap-2 bg-white/10 rounded-full px-2 sm:px-3 py-1 backdrop-blur-sm w-fit",children:e.jsx("span",{className:"text-xs text-white font-medium",children:new Date().toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})}),e.jsxs("div",{className:"flex items-center gap-1 text-white/80",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-xs",children:"All systems operational"})]})]})]})})]}),g?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:4}).map((y,M)=>e.jsx(F,{className:"animate-pulse",children:e.jsxs(D,{className:"pt-6",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mb-4"}),e.jsx("div",{className:"h-8 bg-muted rounded w-3/4"})]})},M))}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Ae,{title:"Wallet Balance",value:ie((x==null?void 0:x.walletBalance)||0),icon:ye,description:"Available for purchases",trend:"+12%",trendLabel:"vs last month"}),e.jsx(Ae,{title:"Today's Profit",value:ie((b==null?void 0:b.todayProfit)||0),icon:at,description:`${(b==null?void 0:b.todayTransactions)||0} transactions`,trend:"+8%",trendLabel:"vs yesterday"}),e.jsx(Ae,{title:"Total Profit",value:ie(f),icon:Bt,description:`All-time earnings - Raw value: ${f}`,trend:"+24%",trendLabel:"vs last month"},`profit-${f}`),e.jsx(Ae,{title:"Active Orders",value:(b==null?void 0:b.totalTransactions)||0,icon:_s,description:"Completed transactions",trend:"+15%",trendLabel:"vs last month"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Zs,{className:"h-5 w-5"}),"Performance Overview"]}),e.jsx(te,{children:"Your business metrics at a glance"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsx("div",{className:"h-64 w-full",children:e.jsx(Bc,{stats:b})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Jr,{className:"h-4 w-4"}),"Quick Actions"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(X,{href:"/agent/bundles/mtn",children:e.jsxs(p,{variant:"outline",size:"sm",className:"w-full h-auto py-4 flex-col gap-2 text-xs md:text-sm",children:[e.jsx(Ee,{className:"h-5 w-5"}),e.jsx("span",{children:"MTN"})]})}),e.jsx(X,{href:"/agent/bundles/telecel",children:e.jsxs(p,{variant:"outline",size:"sm",className:"w-full h-auto py-4 flex-col gap-2 text-xs md:text-sm",children:[e.jsx(Ee,{className:"h-5 w-5"}),e.jsx("span",{children:"Telecel"})]})}),e.jsx(X,{href:"/agent/bundles/at-bigtime",children:e.jsxs(p,{variant:"outline",size:"sm",className:"w-full h-auto py-4 flex-col gap-2 text-xs md:text-sm",children:[e.jsx(Ee,{className:"h-5 w-5"}),e.jsx("span",{children:"AT BigTime"})]})}),e.jsx(X,{href:"/agent/wallet",children:e.jsxs(p,{variant:"outline",size:"sm",className:"w-full h-auto py-4 flex-col gap-2 text-xs md:text-sm",children:[e.jsx(ye,{className:"h-5 w-5"}),e.jsx("span",{children:"Top Up"})]})})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[x&&e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(os,{className:"h-5 w-5"}),"Your Storefront"]}),e.jsx(te,{children:"Share your store link with customers"})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-500 text-white rounded-lg border border-green-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:x.businessName}),e.jsx(Z,{variant:"outline",className:"bg-white text-green-600 border-green-700",children:"Live"})]}),e.jsx("p",{className:"text-xs text-white/90 mb-3",children:"Share this link with your customers:"}),e.jsxs("code",{className:"text-xs sm:text-sm bg-white text-green-600 px-2 py-1 rounded mt-2 block sm:inline-block border border-green-700 break-all sm:break-normal",children:[window.location.origin,"/store/agent/",x.storefrontSlug]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(`${window.location.origin}/store/agent/${x.storefrontSlug}`),className:"w-full sm:w-auto",children:"Copy Link"}),e.jsx("a",{href:`/store/agent/${x.storefrontSlug}`,target:"_blank",rel:"noopener noreferrer",className:"w-full sm:w-auto",children:e.jsxs(p,{size:"sm",className:"w-full",children:[e.jsx(vt,{className:"h-4 w-4 mr-1"}),"Visit"]})})]})]})})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"Order Tracker"]}),e.jsx(te,{children:"Monitor your customers' purchase status"})]}),e.jsx(D,{children:e.jsx(Pt,{})})]})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"h-5 w-5"}),"API & Tools"]}),e.jsx(te,{children:"Automate your business operations"})]}),e.jsx(D,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(p,{variant:"outline",className:"justify-start h-auto p-4 text-left",onClick:()=>i(!0),children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm md:text-base",children:"API Keys"}),e.jsx("div",{className:"text-xs md:text-sm text-muted-foreground",children:"Integrate with external systems"})]})}),e.jsx(X,{href:"/agent/settings",children:e.jsx(p,{variant:"outline",className:"justify-start h-auto p-4 w-full text-left",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm md:text-base",children:"Settings"}),e.jsx("div",{className:"text-xs md:text-sm text-muted-foreground",children:"Manage your profile & links"})]})})})]})})]})]})})]}),e.jsx(Jt,{open:a,onOpenChange:i})]})}function Rc(){const{user:s}=ve();fe();const[t,a]=o.useState(!1),[i,n]=o.useState(!1),{data:r,isLoading:d}=ee({queryKey:["/api/dealer/stats"],queryFn:()=>Me("/api/dealer/stats",{disableAutoLogout:!0}),refetchInterval:3e4}),{data:c,isLoading:x}=ee({queryKey:["/api/transactions"],queryFn:()=>Me("/api/transactions"),refetchInterval:3e4,select:m=>m.slice(0,5)});return s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(ms,{open:t,onOpenChange:a,children:e.jsx(es,{side:"left",className:"w-64 p-0 bg-sidebar",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx(xs,{children:"Dealer Dashboard"}),e.jsx(hs,{children:e.jsx(js,{children:"Navigation menu for dealer dashboard"})})]}),e.jsxs("nav",{className:"flex-1 p-4 space-y-2",children:[e.jsxs(X,{href:"/dealer/dashboard",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(os,{className:"inline w-4 h-4 mr-2"}),"Dashboard"]}),e.jsxs(X,{href:"/dealer/bundles",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Ee,{className:"inline w-4 h-4 mr-2"}),"Data Bundles"]}),e.jsxs(X,{href:"/dealer/wallet",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(ye,{className:"inline w-4 h-4 mr-2"}),"Wallet"]}),e.jsxs(X,{href:"/dealer/transactions",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Ge,{className:"inline w-4 h-4 mr-2"}),"Transactions"]})]})]})})}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"hidden md:flex md:w-64 md:flex-col md:fixed md:inset-y-0 bg-card dark:bg-card border-r border-border",children:e.jsxs("div",{className:"flex flex-col flex-grow pt-5 pb-4 overflow-y-auto",children:[e.jsx("div",{className:"flex items-center flex-shrink-0 px-4",children:e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Dealer Dashboard"})}),e.jsx("div",{className:"mt-5 flex-grow flex flex-col",children:e.jsxs("nav",{className:"flex-1 px-2 space-y-1",children:[e.jsxs(X,{href:"/dealer/dashboard",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md bg-gray-100 text-gray-900",children:[e.jsx(os,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Dashboard"]}),e.jsxs(X,{href:"/dealer/bundles",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(Ee,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Data Bundles"]}),e.jsxs(X,{href:"/dealer/wallet",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(ye,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Wallet"]}),e.jsxs(X,{href:"/dealer/transactions",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(Ge,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Transactions"]})]})})]})}),e.jsxs("div",{className:"md:pl-64 flex flex-col flex-1",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-card text-card-foreground shadow dark:shadow-lg md:hidden",children:[e.jsx("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 md:hidden",onClick:()=>a(!0),"aria-label":"Open sidebar",children:e.jsx(Ne,{className:"h-6 w-6"})}),e.jsx("div",{className:"flex-1 px-4 flex justify-between",children:e.jsx("div",{className:"flex-1 flex",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Dealer Dashboard"})})})]}),e.jsx("main",{className:"flex-1",children:e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8",children:[e.jsxs("h1",{className:"text-base sm:text-2xl font-semibold text-gray-900",children:["Welcome back, ",s.name,"!"]}),e.jsx("p",{className:"mt-1 text-xs sm:text-sm text-gray-600",children:"Here's what's happening with your dealer account today."}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Wallet Balance"}),e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(r==null?void 0:r.walletBalance)||"0.00"}`}),e.jsx(X,{href:"/dealer/wallet",children:e.jsx(p,{variant:"outline",size:"sm",className:"mt-2",children:"Top Up Wallet"})})]})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Total Sales"}),e.jsx(_s,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):(r==null?void 0:r.totalSales)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+20.1% from last month"})]})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Total Profit"}),e.jsx(at,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(r==null?void 0:r.totalProfit)||"0.00"}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+15.3% from last month"})]})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Active Agents"}),e.jsx(os,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):(r==null?void 0:r.activeAgents)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Agents under your management"})]})]})]}),e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"bg-card text-card-foreground shadow dark:shadow-lg overflow-hidden sm:rounded-md",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Recent Transactions"}),e.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Your latest transaction activity"})]}),e.jsx("ul",{className:"divide-y divide-gray-200",children:x?e.jsx("li",{className:"px-4 py-4",children:e.jsx(re,{className:"h-5 w-5 animate-spin"})}):(c==null?void 0:c.length)>0?c.map(m=>e.jsx("li",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"flex-shrink-0 h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.type==="purchase"?"Data Purchase":"Wallet Top-up"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(m.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{variant:m.status==="completed"?"default":"secondary",children:m.status}),e.jsxs("span",{className:"ml-2 text-sm font-medium text-gray-900",children:["GHâ‚µ",m.amount]})]})]})},m.id)):e.jsx("li",{className:"px-4 py-4 text-center text-gray-500",children:"No recent transactions"})})]})}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(F,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Sell Data Bundles"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage your data bundle offerings"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(X,{href:"/dealer/bundles",children:e.jsx(p,{className:"w-full",children:"View Bundles"})})})]})}),e.jsx(F,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Wallet Management"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Top up and manage your wallet"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(X,{href:"/dealer/wallet",children:e.jsx(p,{variant:"outline",className:"w-full",children:"Manage Wallet"})})})]})}),e.jsx(F,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Cs,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"API Integrations"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Integrate with external systems"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(p,{variant:"outline",className:"w-full",onClick:()=>n(!0),children:"API Settings"})})]})})]})]})]})})})]})]}),e.jsx(Jt,{isOpen:i,onClose:()=>n(!1)}),e.jsx(Pt,{})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})})}function Dc(){const{user:s}=ve();fe();const[t,a]=o.useState(!1),[i,n]=o.useState(!1),{data:r,isLoading:d}=ee({queryKey:["/api/super-dealer/stats"],queryFn:()=>Me("/api/super-dealer/stats",{disableAutoLogout:!0}),refetchInterval:3e4}),{data:c,isLoading:x}=ee({queryKey:["/api/transactions"],queryFn:()=>Me("/api/transactions"),refetchInterval:3e4,select:m=>m.slice(0,5)});return s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(ms,{open:t,onOpenChange:a,children:e.jsx(es,{side:"left",className:"w-64 p-0 bg-sidebar",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx(xs,{children:"Super Dealer Dashboard"}),e.jsx(hs,{children:e.jsx(js,{children:"Navigation menu for super dealer dashboard"})})]}),e.jsxs("nav",{className:"flex-1 p-4 space-y-2",children:[e.jsxs(X,{href:"/super-dealer/dashboard",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(qt,{className:"inline w-4 h-4 mr-2"}),"Dashboard"]}),e.jsxs(X,{href:"/super-dealer/bundles",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Ee,{className:"inline w-4 h-4 mr-2"}),"Data Bundles"]}),e.jsxs(X,{href:"/super-dealer/wallet",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(ye,{className:"inline w-4 h-4 mr-2"}),"Wallet"]}),e.jsxs(X,{href:"/super-dealer/transactions",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Ge,{className:"inline w-4 h-4 mr-2"}),"Transactions"]}),e.jsxs(X,{href:"/super-dealer/dealers",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(os,{className:"inline w-4 h-4 mr-2"}),"Manage Dealers"]})]})]})})}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"hidden md:flex md:w-64 md:flex-col md:fixed md:inset-y-0 bg-card dark:bg-card border-r border-border",children:e.jsxs("div",{className:"flex flex-col flex-grow pt-5 pb-4 overflow-y-auto",children:[e.jsx("div",{className:"flex items-center flex-shrink-0 px-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(qt,{className:"w-8 h-8 text-yellow-500 mr-2"}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Super Dealer"})]})}),e.jsx("div",{className:"mt-5 flex-grow flex flex-col",children:e.jsxs("nav",{className:"flex-1 px-2 space-y-1",children:[e.jsxs(X,{href:"/super-dealer/dashboard",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md bg-gray-100 text-gray-900",children:[e.jsx(qt,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Dashboard"]}),e.jsxs(X,{href:"/super-dealer/bundles",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(Ee,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Data Bundles"]}),e.jsxs(X,{href:"/super-dealer/wallet",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(ye,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Wallet"]}),e.jsxs(X,{href:"/super-dealer/transactions",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(Ge,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Transactions"]}),e.jsxs(X,{href:"/super-dealer/dealers",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(os,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Manage Dealers"]})]})})]})}),e.jsxs("div",{className:"md:pl-64 flex flex-col flex-1",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-card text-card-foreground shadow dark:shadow-lg md:hidden",children:[e.jsx("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 md:hidden",onClick:()=>a(!0),"aria-label":"Open sidebar",children:e.jsx(Ne,{className:"h-6 w-6"})}),e.jsx("div",{className:"flex-1 px-4 flex justify-between",children:e.jsx("div",{className:"flex-1 flex",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Super Dealer Dashboard"})})})]}),e.jsx("main",{className:"flex-1",children:e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(qt,{className:"w-4 sm:w-8 h-4 sm:h-8 text-yellow-500 mr-3"}),e.jsxs("h1",{className:"text-lg sm:text-2xl font-semibold text-gray-900",children:["Welcome back, ",s.name,"!"]})]}),e.jsx("p",{className:"mt-1 text-xs sm:text-sm text-gray-600",children:"Super Dealer Dashboard - Advanced management and analytics."}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Wallet Balance"}),e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(r==null?void 0:r.walletBalance)||"0.00"}`}),e.jsx(X,{href:"/super-dealer/wallet",children:e.jsx(p,{variant:"outline",size:"sm",className:"mt-2",children:"Top Up Wallet"})})]})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Total Sales"}),e.jsx(_s,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):(r==null?void 0:r.totalSales)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+25.5% from last month"})]})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Total Profit"}),e.jsx(at,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(r==null?void 0:r.totalProfit)||"0.00"}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+22.1% from last month"})]})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Managed Dealers"}),e.jsx(os,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):(r==null?void 0:r.managedDealers)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dealers under your supervision"})]})]})]}),e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"bg-card text-card-foreground shadow dark:shadow-lg overflow-hidden sm:rounded-md",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Recent Transactions"}),e.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Your latest transaction activity"})]}),e.jsx("ul",{className:"divide-y divide-gray-200",children:x?e.jsx("li",{className:"px-4 py-4",children:e.jsx(re,{className:"h-5 w-5 animate-spin"})}):(c==null?void 0:c.length)>0?c.map(m=>e.jsx("li",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"flex-shrink-0 h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.type==="purchase"?"Data Purchase":"Wallet Top-up"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(m.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{variant:m.status==="completed"?"default":"secondary",children:m.status}),e.jsxs("span",{className:"ml-2 text-sm font-medium text-gray-900",children:["GHâ‚µ",m.amount]})]})]})},m.id)):e.jsx("li",{className:"px-4 py-4 text-center text-gray-500",children:"No recent transactions"})})]})}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(F,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Sell Data Bundles"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage your data bundle offerings"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(X,{href:"/super-dealer/bundles",children:e.jsx(p,{className:"w-full",children:"View Bundles"})})})]})}),e.jsx(F,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Wallet Management"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Top up and manage your wallet"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(X,{href:"/super-dealer/wallet",children:e.jsx(p,{variant:"outline",className:"w-full",children:"Manage Wallet"})})})]})}),e.jsx(F,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(os,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Manage Dealers"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Oversee your dealer network"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(X,{href:"/super-dealer/dealers",children:e.jsx(p,{variant:"outline",className:"w-full",children:"Manage Dealers"})})})]})}),e.jsx(F,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Cs,{className:"h-8 w-8 text-indigo-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"API Integrations"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Integrate with external systems"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(p,{variant:"outline",className:"w-full",onClick:()=>n(!0),children:"API Settings"})})]})})]})]})]})})})]})]}),e.jsx(Jt,{isOpen:i,onClose:()=>n(!1)}),e.jsx(Pt,{})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})})}function Mc(){const{user:s}=ve();fe();const[t,a]=o.useState(!1),[i,n]=o.useState(!1),{data:r,isLoading:d}=ee({queryKey:["/api/master/stats"],queryFn:()=>Me("/api/master/stats",{disableAutoLogout:!0}),refetchInterval:3e4}),{data:c,isLoading:x}=ee({queryKey:["/api/transactions"],queryFn:()=>Me("/api/transactions"),refetchInterval:3e4,select:m=>m.slice(0,5)});return s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(ms,{open:t,onOpenChange:a,children:e.jsx(es,{side:"left",className:"w-64 p-0 bg-sidebar",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx(xs,{children:"Master Dashboard"}),e.jsx(hs,{children:e.jsx(js,{children:"Navigation menu for master dashboard"})})]}),e.jsxs("nav",{className:"flex-1 p-4 space-y-2",children:[e.jsxs(X,{href:"/master/dashboard",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(dt,{className:"inline w-4 h-4 mr-2"}),"Dashboard"]}),e.jsxs(X,{href:"/master/bundles",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Ee,{className:"inline w-4 h-4 mr-2"}),"Data Bundles"]}),e.jsxs(X,{href:"/master/wallet",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(ye,{className:"inline w-4 h-4 mr-2"}),"Wallet"]}),e.jsxs(X,{href:"/master/transactions",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Ge,{className:"inline w-4 h-4 mr-2"}),"Transactions"]}),e.jsxs(X,{href:"/master/network",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(os,{className:"inline w-4 h-4 mr-2"}),"Network Management"]}),e.jsxs(X,{href:"/master/analytics",className:"block px-3 py-2 rounded-md hover:bg-gray-100",children:[e.jsx(Zs,{className:"inline w-4 h-4 mr-2"}),"Analytics"]})]})]})})}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"hidden md:flex md:w-64 md:flex-col md:fixed md:inset-y-0 bg-card dark:bg-card border-r border-border",children:e.jsxs("div",{className:"flex flex-col flex-grow pt-5 pb-4 overflow-y-auto",children:[e.jsx("div",{className:"flex items-center flex-shrink-0 px-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(dt,{className:"w-8 h-8 text-red-500 mr-2"}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Master"})]})}),e.jsx("div",{className:"mt-5 flex-grow flex flex-col",children:e.jsxs("nav",{className:"flex-1 px-2 space-y-1",children:[e.jsxs(X,{href:"/master/dashboard",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md bg-gray-100 text-gray-900",children:[e.jsx(dt,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Dashboard"]}),e.jsxs(X,{href:"/master/bundles",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(Ee,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Data Bundles"]}),e.jsxs(X,{href:"/master/wallet",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(ye,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Wallet"]}),e.jsxs(X,{href:"/master/transactions",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(Ge,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Transactions"]}),e.jsxs(X,{href:"/master/network",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(os,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Network Management"]}),e.jsxs(X,{href:"/master/analytics",className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[e.jsx(Zs,{className:"mr-3 flex-shrink-0 h-5 w-5"}),"Analytics"]})]})})]})}),e.jsxs("div",{className:"md:pl-64 flex flex-col flex-1",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-card text-card-foreground shadow dark:shadow-lg md:hidden",children:[e.jsx("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 md:hidden",onClick:()=>a(!0),"aria-label":"Open sidebar",title:"Open sidebar",children:e.jsx(Ne,{className:"h-6 w-6"})}),e.jsx("div",{className:"flex-1 px-4 flex justify-between",children:e.jsx("div",{className:"flex-1 flex",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Master Dashboard"})})})]}),e.jsx("main",{className:"flex-1",children:e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(dt,{className:"w-4 sm:w-8 h-4 sm:h-8 text-red-500 mr-3"}),e.jsxs("h1",{className:"text-base sm:text-2xl font-semibold text-gray-900",children:["Welcome back, ",s.name,"!"]})]}),e.jsx("p",{className:"mt-1 text-xs sm:text-sm text-gray-600",children:"Master Dashboard - Complete system oversight and management."}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Wallet Balance"}),e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(r==null?void 0:r.walletBalance)||"0.00"}`}),e.jsx(X,{href:"/master/wallet",children:e.jsx(p,{variant:"outline",size:"sm",className:"mt-2",children:"Top Up Wallet"})})]})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Total Sales"}),e.jsx(_s,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):(r==null?void 0:r.totalSales)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+30.2% from last month"})]})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Total Profit"}),e.jsx(at,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(r==null?void 0:r.totalProfit)||"0.00"}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+28.7% from last month"})]})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Network Size"}),e.jsx(os,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):(r==null?void 0:r.networkSize)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total agents in network"})]})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"System Health"}),e.jsx(Zs,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):"98.5%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Uptime this month"})]})]})]}),e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"bg-card text-card-foreground shadow dark:shadow-lg overflow-hidden sm:rounded-md",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Recent Transactions"}),e.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Your latest transaction activity"})]}),e.jsx("ul",{className:"divide-y divide-gray-200",children:x?e.jsx("li",{className:"px-4 py-4",children:e.jsx(re,{className:"h-5 w-5 animate-spin"})}):(c==null?void 0:c.length)>0?c.map(m=>e.jsx("li",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"flex-shrink-0 h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.type==="purchase"?"Data Purchase":"Wallet Top-up"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(m.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{variant:m.status==="completed"?"default":"secondary",children:m.status}),e.jsxs("span",{className:"ml-2 text-sm font-medium text-gray-900",children:["GHâ‚µ",m.amount]})]})]})},m.id)):e.jsx("li",{className:"px-4 py-4 text-center text-gray-500",children:"No recent transactions"})})]})}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsx(F,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Sell Data Bundles"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage your data bundle offerings"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(X,{href:"/master/bundles",children:e.jsx(p,{className:"w-full",children:"View Bundles"})})})]})}),e.jsx(F,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Wallet Management"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Top up and manage your wallet"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(X,{href:"/master/wallet",children:e.jsx(p,{variant:"outline",className:"w-full",children:"Manage Wallet"})})})]})}),e.jsx(F,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(os,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Network Management"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage your entire agent network"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(X,{href:"/master/network",children:e.jsx(p,{variant:"outline",className:"w-full",children:"Manage Network"})})})]})}),e.jsx(F,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Zs,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Analytics"}),e.jsx("p",{className:"text-sm text-gray-500",children:"View detailed analytics and reports"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(X,{href:"/master/analytics",children:e.jsx(p,{variant:"outline",className:"w-full",children:"View Analytics"})})})]})}),e.jsx(F,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Cs,{className:"h-8 w-8 text-indigo-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"API Integrations"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Integrate with external systems"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(p,{variant:"outline",className:"w-full",onClick:()=>n(!0),children:"API Settings"})})]})})]})]})]})})})]})]}),e.jsx(Jt,{isOpen:i,onClose:()=>n(!1)}),e.jsx(Pt,{})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})})}const rs=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:_("w-full caption-bottom text-sm",s),...t})}));rs.displayName="Table";const ls=o.forwardRef(({className:s,...t},a)=>e.jsx("thead",{ref:a,className:_("[&_tr]:border-b",s),...t}));ls.displayName="TableHeader";const ns=o.forwardRef(({className:s,...t},a)=>e.jsx("tbody",{ref:a,className:_("[&_tr:last-child]:border-0",s),...t}));ns.displayName="TableBody";const Lc=o.forwardRef(({className:s,...t},a)=>e.jsx("tfoot",{ref:a,className:_("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...t}));Lc.displayName="TableFooter";const we=o.forwardRef(({className:s,...t},a)=>e.jsx("tr",{ref:a,className:_("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...t}));we.displayName="TableRow";const U=o.forwardRef(({className:s,...t},a)=>e.jsx("th",{ref:a,className:_("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...t}));U.displayName="TableHead";const z=o.forwardRef(({className:s,...t},a)=>e.jsx("td",{ref:a,className:_("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...t}));z.displayName="TableCell";const _c=o.forwardRef(({className:s,...t},a)=>e.jsx("caption",{ref:a,className:_("mt-4 text-sm text-muted-foreground",s),...t}));_c.displayName="TableCaption";const cr={pending:{label:"Processing",color:"bg-blue-500 text-white",icon:Et},processing:{label:"Processing",color:"bg-blue-500 text-white",icon:Et},confirmed:{label:"Confirmed",color:"bg-blue-600 text-white",icon:Te},completed:{label:"Completed",color:"bg-green-500 text-white",icon:Te},delivered:{label:"Delivered",color:"bg-green-500 text-white",icon:Te},cancelled:{label:"Cancelled",color:"bg-red-500 text-white",icon:ds},failed:{label:"Failed",color:"bg-red-500 text-white",icon:ds},refunded:{label:"Refunded",color:"bg-blue-500 text-white",icon:Ra},approved:{label:"Approved",color:"bg-blue-500 text-white",icon:Te},rejected:{label:"Rejected",color:"bg-red-500 text-white",icon:ds},sent:{label:"Sent",color:"bg-green-500 text-white",icon:Te},retrying:{label:"Retrying",color:"bg-yellow-500 text-white",icon:Ra}};function Ka({status:s,statusConfig:t,className:a}){var r;const i=(t==null?void 0:t[s])||cr[s]||{label:s,color:"bg-gray-100 text-gray-700 dark:bg-white dark:text-gray-300"},n=(r=cr[s])==null?void 0:r.icon;return e.jsxs(Z,{variant:"outline",className:_("gap-1 border-0 font-medium",i.color,a),children:[n&&e.jsx(n,{className:"h-3 w-3"}),i.label]})}const dr=s=>{const t=s.toLowerCase();return t==="success"||t==="delivered"?"completed":t==="failed"||t==="cancelled"?"failed":t==="pending"||t==="processing"?"processing":t},or=s=>{var t,a;try{if(!s.apiResponse)return null;const i=JSON.parse(s.apiResponse);return(t=i.skytechStatus)!=null&&t.status?i.skytechStatus.status:i.results&&((a=i.results[0])!=null&&a.status)?i.results[0].status:null}catch{return null}};function $c(){var f;const[s,t]=o.useState("all"),[a,i]=o.useState("all"),[n,r]=o.useState(""),[d,c]=o.useState(!1),{data:x,isLoading:m}=ee({queryKey:["/api/agent/transactions"],refetchInterval:3e4,refetchOnWindowFocus:!0}),{data:b}=ee({queryKey:["/api/agent/transactions/stats"],refetchInterval:3e4,refetchOnWindowFocus:!0}),g=x==null?void 0:x.filter(N=>{const l=or(N),h=l?dr(l):N.status;if(s!=="all"&&h!==s||a!=="all"&&N.type!==a)return!1;if(n){const y=n.toLowerCase().replace(/^#/,""),M=y.match(/^(\d+)-(\d+)$/);if(M){const[,S,k]=M;if(N.reference===S&&N.isBulkOrder)return!0}if(!N.reference.toLowerCase().includes(y)&&!N.productName.toLowerCase().includes(y)&&!(N.customerPhone&&N.customerPhone.toLowerCase().includes(y)))return!1}return!0}),u=(f=g==null?void 0:g.flatMap(N=>{const l=N.isBulkOrder,h=N.phoneNumbers,y=h?typeof h=="string"?(()=>{try{return JSON.parse(h)}catch{return[]}})():h:void 0;if(l&&y&&y.length>0){const M=parseFloat(N.amount)/y.length,S=parseFloat(N.agentProfit||"0")/y.length;return y.map((k,C)=>({...N,id:`${N.id}-${C}`,originalId:N.id,customerPhone:k.phone,productName:k.bundleName||N.productName,amount:k.price?k.price.toFixed(2):M.toFixed(2),agentProfit:k.agentProfit?k.agentProfit.toFixed(2):S.toFixed(2),isExpandedBulkItem:!0,bulkOrderIndex:C+1,bulkOrderTotal:y.length,dataAmount:k.dataAmount}))}return[{...N,originalId:N.id}]}))==null?void 0:f.filter(N=>{if(n){const h=n.toLowerCase().replace(/^#/,"").match(/^(\d+)-(\d+)$/);if(h){const[,y,M]=h;return N.reference===y&&N.isExpandedBulkItem?N.bulkOrderIndex===parseInt(M):!1}}return!0});return e.jsxs("div",{className:"flex h-screen bg-background",children:[d&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>c(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(qe,{onClose:()=>c(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(qe,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>c(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"My Transactions"})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6",children:[e.jsx(Ae,{title:"Total Transactions",value:(b==null?void 0:b.totalTransactions)||0,icon:_s,description:"All time",className:"text-sm md:text-base"}),e.jsx(Ae,{title:"Total Revenue",value:ie((b==null?void 0:b.totalRevenue)||0),icon:Bt,description:"From sales",className:"text-sm md:text-base"}),e.jsx(Ae,{title:"Total Profit",value:ie((b==null?void 0:b.totalProfit)||0),icon:at,description:"Your earnings",className:"text-sm md:text-base"}),e.jsx(Ae,{title:"Today",value:(b==null?void 0:b.todayTransactions)||0,icon:Zs,description:"Transactions today",className:"text-sm md:text-base"})]}),e.jsxs(F,{className:"bg-card text-card-foreground border-border md:col-span-2 lg:col-span-3",children:[e.jsxs($,{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-3 pb-3 md:pb-6",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(G,{className:"flex items-center gap-2 text-base md:text-lg text-black",children:[e.jsx(Zs,{className:"h-4 w-4 md:h-5 md:w-5"}),e.jsx("span",{className:"truncate",children:"Transaction History"})]}),e.jsx(te,{className:"text-sm md:text-base text-gray-600",children:"View all your customer orders and earnings"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-2 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-1 sm:flex-initial",children:[e.jsx(Lt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(Y,{placeholder:"Search...",value:n,onChange:N=>r(N.target.value),className:"pl-9 w-full sm:w-48 text-sm","data-testid":"input-search"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Fe,{value:s,onValueChange:t,children:[e.jsx(Pe,{className:"w-full sm:w-32 text-xs md:text-sm","data-testid":"filter-status",children:e.jsx(Ie,{placeholder:"Status"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"all",children:"All Status"}),e.jsx(K,{value:"pending",children:"Pending"}),e.jsx(K,{value:"confirmed",children:"Confirmed"}),e.jsx(K,{value:"completed",children:"Completed"}),e.jsx(K,{value:"delivered",children:"Delivered"}),e.jsx(K,{value:"cancelled",children:"Cancelled"}),e.jsx(K,{value:"failed",children:"Failed"}),e.jsx(K,{value:"refunded",children:"Refunded"})]})]}),e.jsxs(Fe,{value:a,onValueChange:i,children:[e.jsx(Pe,{className:"w-full sm:w-36 md:w-40 text-xs md:text-sm","data-testid":"filter-type",children:e.jsx(Ie,{placeholder:"Type"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"all",children:"All Types"}),e.jsx(K,{value:"data_bundle",children:"Data Bundles"}),e.jsx(K,{value:"result_checker",children:"Result Checkers"}),e.jsx(K,{value:"wallet_topup",children:"Wallet Top-up"})]})]})]})]})]}),e.jsxs(D,{className:"px-3 md:px-6",children:[m?e.jsx(Ts,{rows:5}):u&&u.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{className:"text-xs md:text-sm",children:"Order ID"}),e.jsx(U,{className:"text-xs md:text-sm",children:"Product"}),e.jsx(U,{className:"hidden sm:table-cell text-xs md:text-sm",children:"Network"}),e.jsx(U,{className:"text-xs md:text-sm",children:"Amount"}),e.jsx(U,{className:"hidden md:table-cell text-xs md:text-sm",children:"My Profit"}),e.jsx(U,{className:"text-xs md:text-sm",children:"Customer"}),e.jsx(U,{className:"text-xs md:text-sm",children:"Payment"}),e.jsx(U,{className:"text-xs md:text-sm",children:"Status"}),e.jsx(U,{className:"hidden md:table-cell text-xs md:text-sm",children:"Date"})]})}),e.jsx(ns,{children:u.slice(0,50).map(N=>{let l=Ds.find(S=>S.id===N.network);const h=or(N),y=h?dr(h):N.status,M=N.type==="wallet_topup";if(!l&&N.isExpandedBulkItem){const S=N.productName;if(S){const k=S.toLowerCase();k.includes("mtn")?l=Ds.find(C=>C.id==="mtn"):k.includes("telecel")?l=Ds.find(C=>C.id==="telecel"):k.includes("bigtime")?l=Ds.find(C=>C.id==="at_bigtime"):k.includes("ishare")&&(l=Ds.find(C=>C.id==="at_ishare"))}}return e.jsxs(we,{"data-testid":`row-transaction-${N.id}`,children:[e.jsxs(z,{className:"font-mono text-xs md:text-sm",children:["#",N.reference]}),e.jsxs(z,{className:"max-w-[150px] md:max-w-[200px]",children:[e.jsx("div",{className:"font-medium truncate text-xs md:text-sm",children:N.productName}),e.jsxs("div",{className:"flex gap-1 mt-1 flex-wrap",children:[e.jsx(Z,{variant:"outline",className:"text-xs px-1 py-0",children:N.type==="data_bundle"?"Data":N.type==="result_checker"?"Result":N.type==="wallet_topup"?"Wallet":N.type}),N.isExpandedBulkItem&&e.jsxs(Z,{variant:"secondary",className:"text-xs px-1 py-0 flex items-center gap-1 bg-purple-100 text-purple-700",children:[e.jsx(Et,{className:"h-2.5 w-2.5"}),N.bulkOrderIndex," of ",N.bulkOrderTotal]})]})]}),e.jsx(z,{className:"hidden sm:table-cell",children:M?e.jsx("span",{className:"text-muted-foreground",children:"-"}):l?e.jsx(Z,{style:{backgroundColor:l.color,color:l.textColor},className:"text-xs px-1 py-0",children:l.name}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(z,{className:"font-medium tabular-nums text-xs md:text-sm",children:e.jsx("div",{children:ie(N.amount)})}),e.jsx(z,{className:"hidden md:table-cell text-green-600 tabular-nums font-medium text-xs md:text-sm",children:M?e.jsx("span",{className:"text-muted-foreground",children:"-"}):e.jsxs("div",{children:["+",ie(N.agentProfit||0)]})}),e.jsx(z,{className:"text-muted-foreground text-xs md:text-sm",children:M?e.jsx("span",{className:"text-muted-foreground",children:"Self"}):e.jsxs("div",{children:[e.jsx("div",{className:"truncate max-w-[80px] md:max-w-[100px]",children:N.customerPhone}),N.isExpandedBulkItem&&N.dataAmount&&e.jsx("div",{className:"text-xs text-muted-foreground",children:N.dataAmount})]})}),e.jsx(z,{children:e.jsx(Z,{variant:N.paymentStatus==="paid"?"default":N.paymentStatus==="failed"?"destructive":N.paymentStatus==="cancelled"?"outline":"secondary",className:"text-xs",children:N.paymentStatus||"pending"})}),e.jsx(z,{children:e.jsx(Ka,{status:y})}),e.jsx(z,{className:"hidden md:table-cell text-muted-foreground text-xs md:text-sm",children:Ze(N.createdAt)})]},N.id)})})]})}):e.jsx("div",{className:"text-center py-6 md:py-12 text-muted-foreground text-sm md:text-base",children:"No transactions found. Share your store link to start making sales!"}),g&&g.length>20&&e.jsxs("div",{className:"text-center py-2 md:py-4 text-xs md:text-sm text-muted-foreground",children:["Showing 20 of ",g.length," items"]})]})]})]})})]})]})}const zc=ae.object({amount:ae.string().min(1,"Amount is required").refine(s=>parseFloat(s)>=10,"Minimum withdrawal amount is GHâ‚µ10").refine(s=>parseFloat(s)<=1e5,"Maximum withdrawal amount is GHâ‚µ100,000"),paymentMethod:ae.enum(["mtn_momo","telecel_cash","airtel_tigo_cash","vodafone_cash"],{required_error:"Please select a payment method"}),accountNumber:ae.string().min(5,"Phone number is required"),accountName:ae.string().min(2,"Account name is required")});function Gc(){const{toast:s}=fe(),[t,a]=o.useState(!1),[i,n]=o.useState(!1),{data:r}=ee({queryKey:["/api/profile"],refetchInterval:3e4,refetchOnWindowFocus:!0,refetchOnReconnect:!0,staleTime:0}),d=r==null?void 0:r.profile,{data:c,isLoading:x}=ee({queryKey:["/api/agent/withdrawals"],refetchInterval:3e4,refetchOnWindowFocus:!0,refetchOnReconnect:!0,staleTime:0}),m=Ss({resolver:Ps(zc),defaultValues:{amount:"",paymentMethod:"mtn_momo",accountNumber:"",accountName:""}}),b=[{value:"mtn_momo",label:"MTN Mobile Money",icon:Ke,description:"Send to MTN MoMo number"},{value:"telecel_cash",label:"Telecel Cash",icon:Ke,description:"Send to Telecel Cash number"},{value:"airtel_tigo_cash",label:"AirtelTigo Cash",icon:Ke,description:"Send to AirtelTigo Cash number"},{value:"vodafone_cash",label:"Vodafone Cash",icon:Ke,description:"Send to Vodafone Cash number"}],g=oe({mutationFn:l=>Q("POST","/api/agent/withdrawals",{...l,amount:parseFloat(l.amount)}),onSuccess:l=>{be.invalidateQueries({queryKey:["/api/agent/withdrawals"]}),be.invalidateQueries({queryKey:["/api/agent/profile"]}),n(!1),m.reset(),s({title:"Withdrawal Requested!",description:l.message||"Your withdrawal request has been submitted and is pending admin approval."})},onError:l=>{s({title:"Withdrawal failed",description:l.message,variant:"destructive"})}}),u=l=>{const h=parseFloat(l.amount),y=(d==null?void 0:d.profitBalance)||0;if(h<10){s({title:"Amount too low",description:"Minimum withdrawal amount is GHâ‚µ10",variant:"destructive"});return}if(h>y){s({title:"Insufficient balance",description:`Available balance: ${ie(y)}`,variant:"destructive"});return}g.mutate(l)},f={pending:(c==null?void 0:c.filter(l=>l.status==="pending").length)||0,approved:(c==null?void 0:c.filter(l=>l.status==="approved"||l.status==="paid").length)||0,totalWithdrawn:(c==null?void 0:c.filter(l=>l.status==="paid").reduce((l,h)=>l+parseFloat(h.amount),0))||0},N=l=>{const h=Kl[l];return e.jsx(Z,{className:(h==null?void 0:h.color)||"",children:(h==null?void 0:h.label)||l})};return e.jsxs("div",{className:"flex h-screen bg-background",children:[t&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(qe,{onClose:()=>a(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(qe,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>a(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-xs md:text-lg lg:text-xl font-semibold",children:"Withdrawals"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(us,{open:i,onOpenChange:n,children:[e.jsx(St,{asChild:!0,children:e.jsxs(p,{"data-testid":"button-request-withdrawal",className:"flex items-center text-xs px-1 py-0.5 h-6 md:text-sm md:px-3 md:py-2 md:h-10 lg:text-base lg:px-4 lg:py-2 lg:h-10",children:[e.jsx(As,{className:"h-2.5 w-2.5 mr-0.5 md:h-4 md:w-4 md:mr-2"}),"Request Withdrawal"]})}),e.jsxs(ss,{className:"bg-card text-card-foreground",style:{backgroundColor:"hsl(var(--card))",opacity:1},children:[e.jsxs(ts,{children:[e.jsx(as,{children:"Request Profit Withdrawal"}),e.jsx(Ks,{children:"Request profit withdrawal (Minimum: GHâ‚µ10). Funds will be transferred after admin approval."})]}),e.jsx(Os,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(u),className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg mb-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Profit Balance"}),e.jsx("p",{className:"text-lg font-bold",children:ie((d==null?void 0:d.profitBalance)||0)})]}),e.jsx(ue,{control:m.control,name:"amount",render:({field:l})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Amount (GHS) - Minimum GHâ‚µ10"}),e.jsx(xe,{children:e.jsx(Y,{type:"number",step:"0.01",min:"10",placeholder:"10.00","data-testid":"input-amount",...l})}),e.jsx(he,{})]})}),e.jsx(ue,{control:m.control,name:"paymentMethod",render:({field:l})=>e.jsxs(me,{children:[e.jsx(ia,{children:"Payment Method"}),e.jsxs(Fe,{onValueChange:l.onChange,defaultValue:l.value,children:[e.jsx(xe,{children:e.jsx(Pe,{children:e.jsx(Ie,{placeholder:"Select payment method"})})}),e.jsx(Ce,{children:b.map(h=>e.jsx(K,{value:h.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h.icon,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:h.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:h.description})]})]})},h.value))})]}),e.jsx(he,{})]})}),e.jsx(ue,{control:m.control,name:"accountNumber",render:({field:l})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Phone Number"}),e.jsx(xe,{children:e.jsx(Y,{placeholder:"Enter phone number (e.g., 0241234567)","data-testid":"input-account-number",...l})}),e.jsx(he,{})]})}),e.jsx(ue,{control:m.control,name:"accountName",render:({field:l})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Account Name"}),e.jsx(xe,{children:e.jsx(Y,{placeholder:"Name on account","data-testid":"input-account-name",...l})}),e.jsx(he,{})]})}),e.jsx(p,{type:"submit",className:"w-full",disabled:g.isPending,"data-testid":"button-submit-withdrawal",children:g.isPending?"Submitting...":"Submit Request"})]})})]})]}),e.jsx(ke,{})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(Ae,{title:"Profit Balance",value:ie((d==null?void 0:d.profitBalance)||0),icon:ye,description:"Ready to withdraw"}),e.jsx(Ae,{title:"Pending Requests",value:f.pending,icon:fs,description:"Awaiting approval"}),e.jsx(Ae,{title:"Approved",value:f.approved,icon:Te,description:"Processed requests"}),e.jsx(Ae,{title:"Total Withdrawn",value:ie(f.totalWithdrawn),icon:Bt,description:"All time"})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"Withdrawal History"]}),e.jsx(te,{children:"Track your withdrawal requests and their status"})]}),e.jsx(D,{children:x?e.jsx(Ts,{rows:8}):c&&c.length>0?e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{children:"Amount"}),e.jsx(U,{children:"Payment Method"}),e.jsx(U,{children:"Account Details"}),e.jsx(U,{children:"Status"}),e.jsx(U,{children:"Requested"}),e.jsx(U,{children:"Processed"}),e.jsx(U,{children:"Note"})]})}),e.jsx(ns,{children:c.map(l=>{var h;return e.jsxs(we,{"data-testid":`row-withdrawal-${l.id}`,children:[e.jsx(z,{className:"font-bold tabular-nums text-lg",children:ie(l.amount)}),e.jsx(z,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[l.paymentMethod==="bank"?e.jsx(si,{className:"h-4 w-4 text-blue-600"}):e.jsx(Ke,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium capitalize",children:((h=l.paymentMethod)==null?void 0:h.replace("_"," "))||"Bank"})]})}),e.jsx(z,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:l.accountName}),e.jsx("div",{className:"text-muted-foreground",children:l.accountNumber}),l.paymentMethod==="bank"&&l.bankName&&e.jsx("div",{className:"text-muted-foreground text-xs",children:l.bankName})]})}),e.jsx(z,{children:N(l.status)}),e.jsx(z,{className:"text-muted-foreground text-sm",children:Ze(l.createdAt)}),e.jsx(z,{className:"text-muted-foreground text-sm",children:l.paidAt?Ze(l.paidAt):"-"}),e.jsx(z,{className:"text-muted-foreground text-sm max-w-[150px] truncate",children:l.adminNote||"-"})]},l.id)})})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:'No withdrawal requests yet. Click "Request Withdrawal" to submit a withdrawal request (Min: GHâ‚µ10).'})})]})]})})]})]})}const Uc=ae.object({businessName:ae.string().min(2,"Business name must be at least 2 characters"),businessDescription:ae.string().min(10,"Business description must be at least 10 characters"),whatsappSupportLink:ae.string().url("Please enter a valid WhatsApp link").optional().or(ae.literal("")),whatsappChannelLink:ae.string().url("Please enter a valid WhatsApp Channel link").optional().or(ae.literal(""))});function qc(){const{toast:s}=fe(),[t,a]=o.useState(!1),{data:i,isLoading:n}=ee({queryKey:["/api/profile"],refetchInterval:3e4,refetchOnWindowFocus:!0}),r=i==null?void 0:i.profile,d=Ss({resolver:Ps(Uc),defaultValues:{businessName:"",businessDescription:"",whatsappSupportLink:"",whatsappChannelLink:""}});o.useEffect(()=>{r&&d.reset({businessName:r.businessName||"",businessDescription:r.businessDescription||"",whatsappSupportLink:r.whatsappSupportLink||"",whatsappChannelLink:r.whatsappChannelLink||""})},[r,d]);const c=oe({mutationFn:b=>Q("PATCH","/api/agent/storefront",b),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/profile"]}),s({title:"Store details updated successfully"})},onError:b=>{s({title:"Failed to update store",description:b.message,variant:"destructive"})}}),x=b=>{c.mutate(b)},m=()=>{if(r){const b=`${window.location.origin}/store/agent/${r.storefrontSlug}`;navigator.clipboard.writeText(b),s({title:"Store link copied to clipboard!"})}};return e.jsxs("div",{className:"flex h-screen bg-background",children:[t&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(qe,{onClose:()=>a(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(qe,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>a(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"My Storefront"})]}),e.jsx(ke,{})]}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:[e.jsx("div",{className:"max-w-4xl mx-auto mb-8",children:e.jsxs("div",{className:"relative bg-green-500 rounded-lg p-8 border border-green-600",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"p-3 bg-white/20 rounded-full",children:e.jsx(ot,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:(r==null?void 0:r.businessName)||"Your Storefront"}),e.jsx("p",{className:"text-green-100",children:"Manage and customize your online store"})]})]}),e.jsx("div",{className:"bg-white/10 rounded-md p-4 border border-white/20",children:e.jsx("p",{className:"text-white/90 leading-relaxed",children:(r==null?void 0:r.businessDescription)||"No business description provided. Update it below to tell customers about your store."})}),e.jsxs("div",{className:"flex items-center gap-4 mt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/90",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{children:"Active Storefront"})]}),(r==null?void 0:r.storefrontSlug)&&e.jsxs(Z,{variant:"secondary",className:"text-xs bg-white/20 text-white border-white/30",children:["/",r.storefrontSlug]})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"h-5 w-5"}),"Store Link"]}),e.jsx(te,{children:"Share this link with your customers"})]}),e.jsx(D,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsx(Y,{value:r?`${window.location.origin}/store/agent/${r.storefrontSlug}`:"",readOnly:!0,className:"font-mono text-sm flex-1 min-w-0","data-testid":"input-store-url"}),e.jsxs("div",{className:"flex items-center gap-2 sm:shrink-0",children:[e.jsx(p,{variant:"outline",size:"icon",onClick:m,"data-testid":"button-copy-link",children:e.jsx(ps,{className:"h-4 w-4"})}),r&&e.jsx("a",{href:`/store/agent/${r.storefrontSlug}`,target:"_blank",rel:"noopener noreferrer","aria-label":"Open storefront in new tab",children:e.jsx(p,{variant:"outline",size:"icon","data-testid":"button-open-store",children:e.jsx(vt,{className:"h-4 w-4"})})})]})]})})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Store Details"}),e.jsx(te,{children:"Customize how your store appears to customers"})]}),e.jsx(D,{children:e.jsx(Os,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(x),className:"space-y-4",children:[e.jsx(ue,{control:d.control,name:"businessName",render:({field:b})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Business Name"}),e.jsx(xe,{children:e.jsx(Y,{placeholder:"Your business name",disabled:n,"data-testid":"input-business-name",...b})}),e.jsx(he,{})]})}),e.jsx(ue,{control:d.control,name:"businessDescription",render:({field:b})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Description"}),e.jsx(xe,{children:e.jsx(Ls,{placeholder:"Tell customers about your business...",className:"resize-none",rows:3,disabled:n,"data-testid":"input-business-description",...b})}),e.jsx(Ye,{children:"This will be shown on your storefront page"}),e.jsx(he,{})]})}),e.jsx(ue,{control:d.control,name:"whatsappSupportLink",render:({field:b})=>e.jsxs(me,{children:[e.jsx(pe,{children:"WhatsApp Support Link"}),e.jsx(xe,{children:e.jsx(Y,{placeholder:"https://wa.me/1234567890",disabled:n,"data-testid":"input-whatsapp-support",...b})}),e.jsx(Ye,{children:"Link to your WhatsApp for customer support. Leave empty to hide from storefront."}),e.jsx(he,{})]})}),e.jsx(ue,{control:d.control,name:"whatsappChannelLink",render:({field:b})=>e.jsxs(me,{children:[e.jsx(pe,{children:"WhatsApp Channel Link"}),e.jsx(xe,{children:e.jsx(Y,{placeholder:"https://whatsapp.com/channel/...",disabled:n,"data-testid":"input-whatsapp-channel",...b})}),e.jsx(Ye,{children:"Link to your WhatsApp Channel. Leave empty to hide from storefront."}),e.jsx(he,{})]})}),e.jsxs(p,{type:"submit",disabled:c.isPending||n,"data-testid":"button-save-details",children:[e.jsx(Qs,{className:"h-4 w-4 mr-2"}),c.isPending?"Saving...":n?"Loading...":"Save Changes to my storefront page"]})]})})})]})]})]})]})]})}const Wc=ae.object({name:ae.string().min(2,"Name must be at least 2 characters"),email:ae.string().email("Invalid email address"),phone:ae.string().optional(),whatsappSupportLink:ae.string().url("Must be a valid URL").optional().or(ae.literal("")),whatsappChannelLink:ae.string().url("Must be a valid URL").optional().or(ae.literal(""))}),Kc=ae.object({currentPassword:ae.string().min(6,"Password must be at least 6 characters"),newPassword:ae.string().min(6,"Password must be at least 6 characters"),confirmPassword:ae.string()}).refine(s=>s.newPassword===s.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function Hc(){const{toast:s}=fe(),[t,a]=o.useState(!1),{data:i}=ee({queryKey:["/api/profile"]}),n=i==null?void 0:i.profile,r=Ss({resolver:Ps(Wc),defaultValues:{name:"",email:"",phone:"",whatsappSupportLink:"",whatsappChannelLink:""}});o.useEffect(()=>{var g,u,f;n&&r.reset({name:((g=n.user)==null?void 0:g.name)||"",email:((u=n.user)==null?void 0:u.email)||"",phone:((f=n.user)==null?void 0:f.phone)||"",whatsappSupportLink:n.whatsappSupportLink||"",whatsappChannelLink:n.whatsappChannelLink||""})},[n,r]);const d=Ss({resolver:Ps(Kc),defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}}),c=oe({mutationFn:g=>Q("PATCH","/api/agent/profile",g),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/agent/profile"]}),s({title:"Profile updated successfully"})},onError:g=>{s({title:"Failed to update profile",description:g.message,variant:"destructive"})}}),x=oe({mutationFn:g=>Q("POST","/api/agent/password",g),onSuccess:()=>{d.reset(),s({title:"Password updated successfully"})},onError:g=>{s({title:"Failed to update password",description:g.message,variant:"destructive"})}}),m=g=>{c.mutate(g)},b=g=>{x.mutate(g)};return e.jsxs("div",{className:"flex h-screen bg-background",children:[t&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(qe,{onClose:()=>a(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(qe,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>a(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Settings"})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Ht,{className:"h-5 w-5"}),"Profile Information"]}),e.jsx(te,{children:"Update your personal details"})]}),e.jsx(D,{children:e.jsx(Os,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(m),className:"space-y-4",children:[e.jsx(ue,{control:r.control,name:"name",render:({field:g})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Full Name"}),e.jsx(xe,{children:e.jsx(Y,{placeholder:"Your full name","data-testid":"input-name",...g})}),e.jsx(he,{})]})}),e.jsx(ue,{control:r.control,name:"email",render:({field:g})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Email Address"}),e.jsx(xe,{children:e.jsx(Y,{type:"email",placeholder:"your@email.com","data-testid":"input-email",...g})}),e.jsx(he,{})]})}),e.jsx(ue,{control:r.control,name:"phone",render:({field:g})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Phone Number"}),e.jsx(xe,{children:e.jsx(Y,{placeholder:"+233 XX XXX XXXX","data-testid":"input-phone",...g})}),e.jsx(Ye,{children:"Used for account recovery and notifications"}),e.jsx(he,{})]})}),e.jsx(ue,{control:r.control,name:"whatsappSupportLink",render:({field:g})=>e.jsxs(me,{children:[e.jsx(pe,{children:"WhatsApp Support Link"}),e.jsx(xe,{children:e.jsx(Y,{placeholder:"https://wa.me/1234567890",...g})}),e.jsx(Ye,{children:"Link to your WhatsApp for customer support. Leave empty to hide from storefront."}),e.jsx(he,{})]})}),e.jsx(ue,{control:r.control,name:"whatsappChannelLink",render:({field:g})=>e.jsxs(me,{children:[e.jsx(pe,{children:"WhatsApp Channel Link"}),e.jsx(xe,{children:e.jsx(Y,{placeholder:"https://whatsapp.com/channel/...",...g})}),e.jsx(Ye,{children:"Link to your WhatsApp Channel. Leave empty to hide from storefront."}),e.jsx(he,{})]})}),e.jsxs(p,{type:"submit",disabled:c.isPending,"data-testid":"button-save-profile",children:[e.jsx(Qs,{className:"h-4 w-4 mr-2"}),c.isPending?"Saving...":"Save Changes"]})]})})})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-5 w-5"}),"Change Password"]}),e.jsx(te,{children:"Update your account password"})]}),e.jsx(D,{children:e.jsx(Os,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(b),className:"space-y-4",children:[e.jsx(ue,{control:d.control,name:"currentPassword",render:({field:g})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Current Password"}),e.jsx(xe,{children:e.jsx(Y,{type:"password",placeholder:"Enter current password","data-testid":"input-current-password",...g})}),e.jsx(he,{})]})}),e.jsx(Le,{}),e.jsx(ue,{control:d.control,name:"newPassword",render:({field:g})=>e.jsxs(me,{children:[e.jsx(pe,{children:"New Password"}),e.jsx(xe,{children:e.jsx(Y,{type:"password",placeholder:"Enter new password","data-testid":"input-new-password",...g})}),e.jsx(he,{})]})}),e.jsx(ue,{control:d.control,name:"confirmPassword",render:({field:g})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Confirm New Password"}),e.jsx(xe,{children:e.jsx(Y,{type:"password",placeholder:"Confirm new password","data-testid":"input-confirm-password",...g})}),e.jsx(he,{})]})}),e.jsxs(p,{type:"submit",disabled:x.isPending,"data-testid":"button-change-password",children:[e.jsx(ys,{className:"h-4 w-4 mr-2"}),x.isPending?"Updating...":"Change Password"]})]})})})]})]})})]})]})}function on(){const[s,t]=o.useState(""),[a,i]=o.useState(null),[n,r]=o.useState("chat"),[d,c]=o.useState(null),[x,m]=o.useState(""),[b,g]=o.useState(!1),u=o.useRef(null),f=Hs(),{toast:N}=fe(),{isAuthenticated:l,isLoading:h}=ve(),{data:y,isLoading:M,error:S}=ee({queryKey:["/api/public/whatsapp-support"],queryFn:async()=>{try{console.log("Fetching WhatsApp number...");const w=await Q("GET","/api/public/whatsapp-support");return console.log("WhatsApp API Response:",w),w}catch(w){throw console.error("WhatsApp API Error:",w),w}},retry:3,staleTime:1e3*60*5});o.useEffect(()=>{console.log("WhatsApp query state:",{whatsappData:y,whatsappLoading:M,whatsappError:S}),y!=null&&y.whatsappNumber?(m(y.whatsappNumber),console.log("WhatsApp number set to:",y.whatsappNumber)):S&&console.error("WhatsApp error:",S)},[y,S]);const{data:k,error:C,isLoading:E}=ee({queryKey:["/api/support/chats"],queryFn:async()=>{console.log("Fetching chats...");try{const w=await Q("GET","/api/support/chats");return console.log("Chats fetched:",w),w}catch(w){throw console.error("Error fetching chats:",w),w}},enabled:l&&!h,retry:!1}),se=oe({mutationFn:async()=>{if(!l)throw new Error("Please log in to start a support chat.");return await Q("POST","/api/support/chat/create",{})},onSuccess:w=>{i(w.chatId),f.invalidateQueries({queryKey:["/api/support/chats"]})},onError:w=>{console.error("Failed to create chat:",w),N({title:"Failed to create chat",description:w.message,variant:"destructive"})}}),{data:H,isLoading:W,error:L}=ee({queryKey:["/api/support/chat",a],queryFn:async()=>await Q("GET",`/api/support/chat/${a}`),enabled:!!a&&l&&!h,refetchInterval:5e3,retry:!1});o.useEffect(()=>{if(!(!l||h||E)&&!(typeof k>"u")&&(console.log("Chat initialization logic - chats:",k,"chatId:",a,"attempted:",b,"pending:",se.isPending),!a&&Array.isArray(k))){const w=k.find(R=>R.status==="open");w?(console.log("Found existing open chat:",w.id),i(w.id)):k.length===0&&!b&&!se.isPending&&(console.log("No existing chats, auto-creating..."),g(!0),se.mutate())}},[k,a,l,h,E,b]),o.useEffect(()=>{const w=R=>{const P=R instanceof Error?R.message:String(R||"");return P.toLowerCase().includes("unauthorized")||P.toLowerCase().includes("401")};C&&w(C)||L&&w(L)?c("Your session expired. Please log in again to use support chat."):c(null)},[C,L]);const j=oe({mutationFn:async w=>{if(!l)throw new Error("Please log in to send messages.");let R=a;return R||(R=(await Q("POST","/api/support/chat/create",{})).chatId,i(R),f.invalidateQueries({queryKey:["/api/support/chats"]})),await Q("POST",`/api/support/chat/${R}/message`,{message:w})},onSuccess:()=>{f.invalidateQueries({queryKey:["/api/support/chat",a]}),t("")},onError:w=>{N({title:"Failed to send message",description:w.message,variant:"destructive"})}}),v=w=>{w.preventDefault(),!(!s.trim()||!a||!l)&&j.mutate(s)},I=()=>{if(r("whatsapp"),console.log("WhatsApp number state:",x),console.log("WhatsApp data:",y),!x){console.warn("WhatsApp number not found"),N({title:"WhatsApp Support Unavailable",description:"Admin has not configured WhatsApp support yet.",variant:"destructive"});return}const w=x.replace(/\D/g,"");if(console.log("Cleaned WhatsApp number:",w),!w){N({title:"Invalid WhatsApp Number",description:"The WhatsApp number is not properly configured.",variant:"destructive"});return}const R=encodeURIComponent("Hi, I need help with my data bundle purchase."),P=`https://wa.me/${w}?text=${R}`;console.log("WhatsApp URL:",P),window.open(P,"_blank")},A=()=>{var w;r("chat"),(w=document.getElementById("chat-section"))==null||w.scrollIntoView({behavior:"smooth"})};o.useEffect(()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},[H==null?void 0:H.messages]),o.useEffect(()=>{if(H!=null&&H.messages&&a){const w=H.messages.filter(R=>R.senderType==="admin"&&!R.isRead);w.forEach(async R=>{try{await Q("PUT",`/api/support/message/${R.id}/read`,{})}catch(P){console.error("Failed to mark message as read:",P)}}),w.length>0&&f.invalidateQueries({queryKey:["/api/support/unread-count"]})}},[H==null?void 0:H.messages,a,f]);const B=(H==null?void 0:H.messages)||[];return!l&&!h?e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{className:"text-lg",children:"Customer Support"}),e.jsx(te,{children:"You need to log in to start a support chat."})]}),e.jsx(D,{children:e.jsx(p,{onClick:()=>window.location.href="/login",className:"w-full",children:"Go to Login"})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Customer Support"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Choose your preferred support channel"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs(p,{onClick:I,className:`h-auto py-4 text-sm flex-col gap-2 ${n==="whatsapp"?"bg-yellow-500 text-white font-medium shadow-sm":"bg-green-600 hover:bg-green-700 text-white"}`,children:[e.jsx(tt,{className:"h-6 w-6"}),e.jsx("span",{children:"WhatsApp Support"}),e.jsx("span",{className:"text-xs opacity-90",children:"Get instant help via WhatsApp"})]}),e.jsxs(p,{onClick:A,className:`h-auto py-4 text-sm flex-col gap-2 ${n==="chat"?"bg-yellow-500 text-white font-medium shadow-sm":"border hover:bg-accent"}`,children:[e.jsx(tt,{className:"h-6 w-6"}),e.jsx("span",{children:"Live Chat"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Chat with our support team"})]})]})]}),e.jsxs(F,{id:"chat-section",children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(tt,{className:"h-4 w-4 md:h-5 md:w-5"}),"Live Chat",a?e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:"Connected"}):e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full",children:se.isPending?"Connecting...":"Initializing..."})]}),e.jsx(te,{className:"text-xs md:text-sm",children:"Send us a message and we'll respond as soon as possible"})]}),e.jsxs(D,{className:"space-y-4",children:[d&&e.jsx("div",{className:"rounded-md border border-amber-300 bg-amber-50 px-3 py-2 text-sm text-amber-800",children:d}),e.jsxs("div",{className:"border rounded-lg h-[600px] flex flex-col",children:[e.jsx(yt,{className:"flex-1 p-4",ref:u,children:W?e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading messages..."}):B.length===0?e.jsx("div",{className:"text-center text-muted-foreground",children:"No messages yet. Start a conversation!"}):e.jsx("div",{className:"space-y-4",children:B.map(w=>e.jsxs("div",{className:`flex gap-3 ${w.senderType==="user"?"justify-end":"justify-start"}`,children:[w.senderType==="admin"&&e.jsx(aa,{className:"h-8 w-8",children:e.jsx(ra,{className:"text-xs",children:"ST"})}),e.jsxs("div",{className:`max-w-[70%] rounded-lg px-3 py-2 ${w.senderType==="user"?"bg-primary text-primary-foreground":"bg-muted"}`,children:[e.jsx("p",{className:"text-sm",children:w.message}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:new Date(w.createdAt).toLocaleTimeString()})]}),w.senderType==="user"&&e.jsx(aa,{className:"h-8 w-8",children:e.jsx(ra,{children:"ME"})})]},w.id))})}),e.jsx("form",{onSubmit:v,className:"p-4 border-t",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{value:s,onChange:w=>t(w.target.value),placeholder:"Type your message...",disabled:j.isPending}),e.jsxs(p,{type:"submit",size:"sm",disabled:j.isPending||!s.trim(),title:s.trim()?j.isPending?"Sending message...":"Send message":"Message cannot be empty",children:[e.jsx(wl,{className:"h-4 w-4"}),j.isPending&&"Sending..."]})]})})]})]})]})]})}function Vc(){const[s,t]=o.useState(!1);return e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx(qe,{})}),e.jsx(ms,{open:s,onOpenChange:t,children:e.jsxs(es,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(js,{children:[e.jsx(xs,{children:"Navigation Menu"}),e.jsx(hs,{children:"Main navigation for support"})]}),e.jsx(qe,{onClose:()=>t(!1)})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ms,{open:s,onOpenChange:t,children:[e.jsx(Vs,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(Ne,{className:"h-5 w-5"})})}),e.jsxs(es,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(js,{children:[e.jsx(xs,{children:"Navigation Menu"}),e.jsx(hs,{children:"Main navigation for support"})]}),e.jsx(qe,{onClose:()=>t(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Support Chat"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get help from our support team"})]})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(on,{})})})]})]})}const mr=s=>{const t=s.match(/(\d+(?:\.\d+)?)\s*(GB|MB)/);if(!t)return 0;const a=parseFloat(t[1]);return t[2].toUpperCase()==="MB"?a/1024:a},Yc=s=>s?[...s].sort((t,a)=>mr(t.name)-mr(a.name)):[],Xc={mtn:{name:"MTN",color:"bg-yellow-400",logo:$t},at_ishare:{name:"AirtelTigo iShare",color:"bg-red-500",logo:ws},at_bigtime:{name:"AirtelTigo BIG TIME",color:"bg-red-600",logo:ws},telecel:{name:"Telecel",color:"bg-green-500",logo:zt}};function Qc(){var v;const[,s]=ze(),{network:t}=Qt(),{user:a}=ve(),{toast:i}=fe(),n=Hs(),[r,d]=o.useState(!1),[c,x]=o.useState(null),[m,b]=o.useState(""),[g,u]=o.useState("paystack"),[f,N]=o.useState(""),[l,h]=o.useState("paystack"),{data:y,isLoading:M}=ee({queryKey:["/api/products/data-bundles",t],queryFn:async()=>{const I=t==null?void 0:t.replace(/-/g,"_");return await Q("GET",`/api/products/data-bundles?network=${I}`)},enabled:!!t}),{data:S}=ee({queryKey:["/api/profile"],queryFn:async()=>Q("GET","/api/profile")}),{data:k}=ee({queryKey:["/api/auth/me"],enabled:!0}),C=(v=k==null?void 0:k.user)!=null&&v.walletBalance?parseFloat(k.user.walletBalance):0,E=o.useMemo(()=>{if(!f.trim()||!y)return null;const I=f.split(`
`).filter(w=>w.trim());let A=0,B=0;for(const w of I){const R=w.trim().split(/\s+/);if(R.length===2){const P=parseFloat(R[1]);if(!isNaN(P)&&P>0){const q=y.find(T=>{const ce=T.dataAmount.toLowerCase().match(/(\d+(?:\.\d+)?)/);return ce?parseFloat(ce[1])===P:!1});if(q){const T=parseFloat(q.basePrice);A+=T,B++}}}}return B>0?{total:A,count:B}:null},[f,y]),se=oe({mutationFn:async I=>{const A=y==null?void 0:y.find(P=>P.id===I.bundleId);if(!A)throw new Error("Bundle not found");const B=[I.phoneNumber],w=parseFloat(A.basePrice),R=!1;if(I.paymentMethod==="wallet"){const P={productType:"data_bundle",productId:A.id,productName:A.name,network:A.network,amount:w.toFixed(2),customerPhone:B[0],phoneNumbers:void 0,isBulkOrder:R};return await Q("POST","/api/wallet/pay",P)}else{const P={productType:"data_bundle",productId:A.id,customerPhone:B[0],phoneNumbers:void 0,isBulkOrder:R,customerEmail:(a==null?void 0:a.email)||void 0};return await Q("POST","/api/checkout/initialize",P)}},onSuccess:(I,A)=>{if(A.paymentMethod==="wallet"){if(i({title:"âœ… Payment Successful!",description:"Redirecting to live status...",duration:3e3}),I.reference){s(`/checkout/success?reference=${I.reference}`);return}x(null),b(""),n.invalidateQueries({queryKey:["/api/auth/me"]}),n.invalidateQueries({queryKey:["/api/transactions"]})}else window.location.href=I.paymentUrl},onError:I=>{const A=I.message||"Unable to process payment",B=A.toLowerCase().includes("insufficient"),w=A.includes("wait")&&A.includes("minute");i({title:w?"â³ Purchase Limit":B?"âš ï¸ Insufficient Wallet Balance":"âŒ Payment Failed",description:w?A:B?"Your wallet balance is too low for this purchase. Please top up your wallet or use Paystack.":`${A}. Please try again or contact support if the problem persists.`,variant:"destructive",duration:w?8e3:6e3})}}),H=oe({mutationFn:async I=>{var B;if(I.orderItems&&I.totalAmount!==void 0){const w=I.orderItems.map(P=>P.phone),R=I.totalAmount;if(I.paymentMethod==="wallet"){const P={productType:"data_bundle",productName:`Bulk Order - ${I.orderItems.length} items`,network:t,amount:R.toFixed(2),customerPhone:w[0],isBulkOrder:!0,orderItems:I.orderItems};return await Q("POST","/api/wallet/pay",P)}else{const P={productType:"data_bundle",network:t,customerPhone:w[0],isBulkOrder:!0,orderItems:I.orderItems,totalAmount:R,customerEmail:(a==null?void 0:a.email)||void 0};return await Q("POST","/api/checkout/initialize",P)}}else{const w=y==null?void 0:y.find(ce=>ce.id===I.bundleId);if(!w)throw new Error("Bundle not found");const R=I.phoneNumbers,P=parseFloat(w.basePrice),q=((B=S==null?void 0:S.profile)==null?void 0:B.markupPercentage)||0,J=(P+P*q/100)*R.length;if(I.paymentMethod==="wallet"){const ce={productType:"data_bundle",productId:w.id,productName:w.name,network:w.network,amount:J.toFixed(2),customerPhone:R[0],phoneNumbers:R,isBulkOrder:!0};return await Q("POST","/api/wallet/pay",ce)}else{const ce={productType:"data_bundle",productId:w.id,customerPhone:R[0],phoneNumbers:R,isBulkOrder:!0,customerEmail:(a==null?void 0:a.email)||void 0};return await Q("POST","/api/checkout/initialize",ce)}}},onSuccess:(I,A)=>{if(A.paymentMethod==="wallet"){if(i({title:"âœ… Payment Successful!",description:"Redirecting to live status...",duration:3e3}),I.reference){s(`/checkout/success?reference=${I.reference}`);return}N(""),n.invalidateQueries({queryKey:["/api/auth/me"]}),n.invalidateQueries({queryKey:["/api/transactions"]})}else window.location.href=I.paymentUrl},onError:I=>{const A=I.message||"Unable to process payment",B=A.includes("wait")&&A.includes("minute"),w=A.toLowerCase().includes("insufficient");i({title:B?"â³ Purchase Limit":w?"âš ï¸ Insufficient Balance":"âŒ Payment Error",description:A,variant:"destructive",duration:B?8e3:6e3})}}),W=()=>{if(!c||!m)return;const I=parseFloat(c.basePrice);if(g==="wallet"&&I>C){i({title:"âš ï¸ Insufficient Wallet Balance",description:`You need GHâ‚µ${(I-C).toFixed(2)} more. Please top up your wallet or use Paystack.`,variant:"destructive",duration:6e3});return}if(!g){i({title:"âŒ Payment Method Required",description:"Please select a payment method",variant:"destructive"});return}se.mutate({bundleId:c.id,phoneNumber:m,paymentMethod:g})},L=()=>{var R;if(!f.trim()){i({title:"âŒ Missing Information",description:"Please enter phone numbers with GB amounts",variant:"destructive"});return}const I=f.split(`
`).filter(P=>P.trim()),A=[];for(const P of I){const q=P.trim().split(/\s+/);if(q.length!==2){i({title:"âŒ Invalid Format",description:`Line "${P}" must have format: phone_number GB_amount (e.g., "0241234567 2")`,variant:"destructive",duration:8e3});return}let T=q[0];const J=parseFloat(q[1]);if(isNaN(J)||J<=0){i({title:"âŒ Invalid GB Amount",description:`GB amount "${q[1]}" must be a positive number`,variant:"destructive",duration:8e3});return}T=T.replace(/^\+/,""),T.startsWith("233")&&(T="0"+T.substring(3));const ce=lt(T),ge=xt(ce);if(!ge.isValid){const Ve=vs(t);i({title:"âŒ Phone Number Mismatch",description:`${T}: ${ge.error||`Must be for ${j==null?void 0:j.name} network. Valid prefixes: ${Ve.join(", ")}`}`,variant:"destructive",duration:8e3});return}A.push({phone:ce,gb:J})}if(A.length===0){i({title:"No Data",description:"Please enter at least one phone number with GB amount",variant:"destructive"});return}const B=[];let w=0;for(const P of A){const q=y==null?void 0:y.find(ce=>{const Ve=ce.dataAmount.match(/(\d+(?:\.\d+)?)\s*gb/i);return Ve?parseFloat(Ve[1])===P.gb:!1});if(!q){i({title:"âŒ Bundle Not Found",description:`No ${P.gb}GB bundle available for ${j==null?void 0:j.name}. Please check available bundles.`,variant:"destructive",duration:8e3});return}const T=xt(P.phone);T.isValid||i({title:"âš ï¸ Network Mismatch",description:`${P.phone}: ${T.error}. Purchase will proceed but may fail if network doesn't match.`,variant:"default",duration:6e3});const J=q.agentPrice?parseFloat(q.agentPrice):parseFloat(q.basePrice)+parseFloat(q.basePrice)*(((R=S==null?void 0:S.profile)==null?void 0:R.markupPercentage)||0)/100;B.push({phone:P.phone,bundleId:q.id,bundleName:q.name,price:J}),w+=J}if(l==="wallet"&&C<w){i({title:"âš ï¸ Insufficient Wallet Balance",description:`You need GHâ‚µ${(w-C).toFixed(2)} more. Please top up your wallet or use Paystack.`,variant:"destructive",duration:6e3});return}if(!l){i({title:"âŒ Payment Method Required",description:"Please select a payment method",variant:"destructive"});return}H.mutate({bundleId:"",phoneNumbers:[],paymentMethod:l,orderItems:B,totalAmount:w})};if(!a)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})});const j=Xc[t==null?void 0:t.replace(/-/g,"_")];return j?e.jsxs("div",{className:"fixed inset-0 flex",children:[e.jsx("aside",{className:"hidden md:block flex-shrink-0",children:e.jsx(qe,{})}),e.jsx(ms,{open:r,onOpenChange:d,children:e.jsxs(es,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(js,{children:[e.jsx(xs,{children:"Navigation Menu"}),e.jsx(hs,{children:"Main navigation for your dashboard"})]}),e.jsx(qe,{onClose:()=>d(!1)})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ms,{open:r,onOpenChange:d,children:[e.jsx(Vs,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(Ne,{className:"h-5 w-5"})})}),e.jsxs(es,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(js,{children:[e.jsx(xs,{children:"Navigation Menu"}),e.jsx(hs,{children:"Main navigation for your dashboard"})]}),e.jsx(qe,{onClose:()=>d(!1)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:j.logo,alt:j.name,className:"h-8 w-8 rounded"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold",children:[j.name," Bundles"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Purchase data bundles for your customers"})]})]})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx(F,{children:e.jsx(D,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${j.color}`}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold",children:[j.name," Data Bundles"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Purchase data bundles for your customers with your markup pricing"})]})]})})}),e.jsxs("div",{className:"text-sm text-orange-600 flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"âš ï¸"}),e.jsx("span",{children:"Please double-check your beneficiary number before completing purchase"})]}),e.jsxs(it,{defaultValue:"single",className:"w-full",children:[e.jsxs(Ys,{className:"grid w-full grid-cols-2",children:[e.jsxs(De,{value:"single",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Single Purchase"]}),t!=="at_ishare"&&e.jsxs(De,{value:"bulk",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Bulk Purchase"]})]}),e.jsx(Ue,{value:"single",className:"space-y-6",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Purchase Data Bundle"}),e.jsx(te,{children:"Select a bundle and enter recipient details"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Select Bundle"}),M?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(re,{className:"h-5 w-5 animate-spin"})}):e.jsxs(Fe,{value:(c==null?void 0:c.id)||"",onValueChange:I=>{const A=y==null?void 0:y.find(B=>B.id===I);x(A||null)},children:[e.jsx(Pe,{children:e.jsx(Ie,{placeholder:"Choose a data bundle"})}),e.jsx(Ce,{children:y&&y.length>0?Yc(y).map(I=>{const A=parseFloat(I.basePrice);return e.jsxs(K,{value:I.id,children:[I.name," - ",I.validity," - GHâ‚µ",A.toFixed(2)]},I.id)}):e.jsx(K,{value:"no-bundles",disabled:!0,children:"No bundles available"})})]})]}),c&&e.jsxs("div",{className:"p-2 bg-yellow-500 text-white rounded-lg border border-yellow-600",children:[e.jsx("p",{className:"text-sm text-white",children:"Selected Bundle"}),e.jsx("p",{className:"font-medium text-lg text-white",children:c.name}),e.jsx("p",{className:"text-sm text-white",children:c.validity}),c.description&&e.jsx("p",{className:"text-xs text-white mt-1",children:c.description}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsxs("span",{className:"text-2xl font-bold text-white",children:["GHâ‚µ",parseFloat(c.basePrice).toFixed(2)]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"phone",children:"Beneficiary Number"}),e.jsx(Y,{id:"phone",placeholder:"0241234567",value:m,onChange:I=>b(I.target.value)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["For ",e.jsx("strong",{children:j==null?void 0:j.name})," network only. Valid prefixes: ",e.jsx("strong",{children:c?vs(c.network).join(", "):""})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(V,{children:"Payment Method"}),e.jsxs(Dt,{value:g||"",onValueChange:I=>u(I),className:"grid gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(qs,{value:"wallet",id:"wallet-single",disabled:c?parseFloat(c.basePrice)>C:!1,className:"peer sr-only"}),e.jsxs(V,{htmlFor:"wallet-single",className:`flex items-center justify-between rounded-lg border-2 border-muted bg-white p-4 hover:border-green-500 hover:shadow-md peer-checked:border-green-500 peer-checked:bg-green-50 peer-checked:shadow-md cursor-pointer transition-all ${c?parseFloat(c.basePrice)>C:""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Wallet Balance"}),e.jsxs("div",{className:"text-sm text-green-600",children:["Available: GHâ‚µ",C.toFixed(2)]})]})]}),g==="wallet"&&e.jsx(Te,{className:"h-5 w-5 text-green-600"})]}),c?parseFloat(c.basePrice)>C:!1]}),e.jsxs("div",{children:[e.jsx(qs,{value:"paystack",id:"paystack-single",className:"peer sr-only"}),e.jsxs(V,{htmlFor:"paystack-single",className:"flex items-center justify-between rounded-lg border-2 border-muted bg-white p-4 hover:border-green-500 hover:shadow-md peer-checked:border-green-500 peer-checked:bg-green-50 peer-checked:shadow-md cursor-pointer transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Pay with MoMo"}),e.jsx("div",{className:"text-sm text-green-600",children:"Secure payment via Paystack"})]})]}),g==="paystack"&&e.jsx(Te,{className:"h-5 w-5 text-green-600"})]})]})]})]}),c&&g==="paystack"&&(()=>{const I=parseFloat(c.basePrice),{subtotal:A,tax:B,total:w}=Bs(I);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(Le,{}),e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bundle Price"}),e.jsxs("span",{children:["GHâ‚µ",A.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:["Paystack Fee (",_e,"%)",e.jsx(He,{className:"h-3 w-3"})]}),e.jsxs("span",{className:"text-orange-600",children:["+GHâ‚µ",B.toFixed(2)]})]}),e.jsx(Le,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total to Pay"}),e.jsxs("span",{className:"text-primary",children:["GHâ‚µ",w.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-orange-100 dark:bg-orange-900 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx(He,{className:"h-4 w-4 text-orange-600 dark:text-white mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-white",children:["A ",_e,"% Paystack fee is applied to all Paystack payments."]})]})]})})(),c&&g==="wallet"&&parseFloat(c.basePrice)>C&&e.jsxs(Is,{variant:"default",className:"border-destructive bg-background text-destructive dark:bg-red-900/20",children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsxs(Es,{className:"text-sm",children:[e.jsx("strong",{children:"Insufficient Balance:"})," You need GHâ‚µ",(parseFloat(c.basePrice)-C).toFixed(2)," more.",e.jsx("a",{href:"/agent/wallet",className:"underline ml-1 font-medium hover:text-destructive-foreground",children:"Top up wallet"})," or select Paystack."]})]}),e.jsx(p,{className:"w-full",size:"lg",onClick:W,disabled:!c||!m||!g||se.isPending||g==="wallet"&&c&&parseFloat(c.basePrice)>C,children:se.isPending?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),"Purchase Bundle"]})})]})]})}),t!=="at_ishare"&&e.jsx(Ue,{value:"bulk",className:"space-y-6",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Bulk Purchase"}),e.jsxs(te,{children:["Enter phone numbers with GB amounts for ",j==null?void 0:j.name]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(V,{htmlFor:"bulk-phones",children:"Beneficiary Numbers and GB Amounts"}),f.trim()&&e.jsxs(Z,{variant:"outline",className:"text-xs",children:[f.split(`
`).filter(I=>I.trim()).length," entries"]})]}),e.jsx(Ls,{id:"bulk-phones",placeholder:`0546591622 1
0247064874 3
0245696072 2
233547897522 10
...add as many as you need (no limit)`,rows:20,value:f,onChange:I=>N(I.target.value),className:"font-mono text-sm"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:['Enter one number per line with GB amount (e.g., "0241234567 2" for 2GB). Supports formats: 0241234567 or 233241234567 (no + sign).',e.jsx("strong",{className:"text-green-600",children:"âœ“ No limit - add 100+ numbers!"}),e.jsx("br",{}),"All numbers must be for ",e.jsx("strong",{children:j==null?void 0:j.name})," network. Valid prefixes: ",e.jsx("strong",{children:t?vs(t).join(", "):""})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(V,{children:"Payment Method"}),e.jsxs(Dt,{value:l||"",onValueChange:I=>h(I),className:"grid gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(qs,{value:"wallet",id:"wallet-bulk",disabled:E?C<E.total:!1,className:"peer sr-only"}),e.jsxs(V,{htmlFor:"wallet-bulk",className:`flex items-center justify-between rounded-lg border-2 border-muted !bg-white p-4 hover:border-green-500 hover:shadow-md peer-checked:border-green-500 peer-checked:bg-green-50 peer-checked:shadow-md cursor-pointer transition-all ${E?C<E.total:""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Wallet Balance"}),e.jsxs("div",{className:"text-sm text-green-600",children:["Available: GHâ‚µ",C.toFixed(2)]})]})]}),l==="wallet"&&e.jsx(Te,{className:"h-5 w-5 text-green-600"})]}),E?C<E.total:!1]}),e.jsxs("div",{children:[e.jsx(qs,{value:"paystack",id:"paystack-bulk",className:"peer sr-only"}),e.jsxs(V,{htmlFor:"paystack-bulk",className:"flex items-center justify-between rounded-lg border-2 border-muted bg-white p-4 hover:border-green-500 hover:shadow-md peer-checked:border-green-500 peer-checked:bg-green-50 peer-checked:shadow-md cursor-pointer transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Pay with MoMo"}),e.jsx("div",{className:"text-sm text-green-600",children:"Secure payment via Paystack"})]})]}),l==="paystack"&&e.jsx(Te,{className:"h-5 w-5 text-green-600"})]})]})]})]}),E&&l==="paystack"&&(()=>{const{subtotal:I,tax:A,total:B}=Bs(E.total);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(Le,{}),e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Total Bundle Price (",E.count," bundles)"]}),e.jsxs("span",{children:["GHâ‚µ",I.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:["Processing Fee (",_e,"%)",e.jsx(He,{className:"h-3 w-3"})]}),e.jsxs("span",{className:"text-orange-600",children:["+GHâ‚µ",A.toFixed(2)]})]}),e.jsx(Le,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total to Pay"}),e.jsxs("span",{className:"text-primary",children:["GHâ‚µ",B.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-orange-100 dark:bg-orange-900 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx(He,{className:"h-4 w-4 text-orange-600 dark:text-white mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-white",children:["A ",_e,"% processing fee is applied to all Paystack payments."]})]})]})})(),E&&l==="wallet"&&C<E.total&&e.jsxs(Is,{variant:"default",className:"border-destructive bg-background text-destructive dark:bg-red-900/20",children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsxs(Es,{className:"text-sm",children:[e.jsx("strong",{children:"Insufficient Balance:"})," You need GHâ‚µ",(E.total-C).toFixed(2)," more.",e.jsx("a",{href:"/agent/wallet",className:"underline ml-1 font-medium hover:text-destructive-foreground",children:"Top up wallet"})," or select Paystack."]})]}),e.jsx(p,{className:"w-full",size:"lg",onClick:L,disabled:!f.trim()||!l||H.isPending||l==="wallet"&&E!==null&&C<E.total,children:H.isPending?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(kl,{className:"mr-2 h-4 w-4"}),E?`Purchase for GHâ‚µ${E.total.toFixed(2)} (${E.count} items)`:"Purchase Data Bundles"]})})]})]})})]})]})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Network Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"The requested network is not available."})]})})}const Jc=ae.object({amount:ae.string().refine(s=>{const t=parseFloat(s);return!isNaN(t)&&t>=1},"Minimum top-up amount is GHS 1"),paymentMethod:ae.enum(["paystack"],{required_error:"Please select a payment method"})});function mn(){const[s,t]=o.useState(!1),[a,i]=o.useState(!1),{toast:n}=fe(),r=Ss({resolver:Ps(Jc),defaultValues:{amount:"",paymentMethod:"paystack"}});o.useEffect(()=>{s&&r.reset({amount:"",paymentMethod:"paystack"})},[s,r]);const d=oe({mutationFn:async m=>await Me("/api/wallet/topup/initialize",{method:"POST",body:JSON.stringify({amount:m.amount,paymentMethod:m.paymentMethod})}),onSuccess:m=>{m.authorizationUrl&&(window.location.href=m.authorizationUrl)},onError:m=>{const b=m.message||"Unable to initialize payment";n({title:"âŒ Wallet Top-up Failed",description:`${b}. Please check your connection and try again. If the issue persists, contact support.`,variant:"destructive",duration:6e3}),i(!1)}}),c=m=>{i(!0),d.mutate(m)},x=[10,20,50,100,200,500];return e.jsxs(us,{open:s,onOpenChange:t,children:[e.jsx(St,{asChild:!0,children:e.jsxs(p,{variant:"default",size:"sm",children:[e.jsx(As,{className:"w-4 h-4 mr-2"}),"Top Up Wallet"]})}),e.jsxs(ss,{className:"sm:max-w-md bg-card text-card-foreground",style:{backgroundColor:"hsl(var(--card))",opacity:1},children:[e.jsxs(ts,{children:[e.jsxs(as,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Top Up Wallet"]}),e.jsx(Ks,{children:"Add money to your wallet to make instant purchases"})]}),e.jsx(Os,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(c),className:"space-y-4",children:[e.jsx(ue,{control:r.control,name:"amount",render:({field:m})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Amount (GHS)"}),e.jsx(xe,{children:e.jsx(Y,{type:"number",placeholder:"Enter amount",step:"0.01",min:"1",...m,disabled:a})}),e.jsx(he,{})]})}),e.jsx(ue,{control:r.control,name:"paymentMethod",render:({field:m})=>e.jsxs(me,{className:"space-y-3",children:[e.jsx(ia,{children:"Payment Method"}),e.jsx(xe,{children:e.jsx(Dt,{onValueChange:m.onChange,value:m.value,className:"grid gap-3",children:e.jsxs("div",{className:"flex items-center space-x-3 p-4 rounded-lg border-2 border-border bg-background hover:border-primary hover:shadow-md cursor-pointer transition-all",children:[e.jsx(qs,{value:"paystack",id:"paystack"}),e.jsxs("div",{className:"flex items-center justify-between flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-foreground",children:"Pay with MoMo"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Secure payment via Paystack"})]})]}),m.value==="paystack"&&e.jsx(Te,{className:"h-5 w-5 text-primary"})]})]})})}),e.jsx(he,{})]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Quick amounts:"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:x.map(m=>e.jsxs(p,{type:"button",variant:"outline",size:"sm",onClick:()=>r.setValue("amount",m.toString()),disabled:a,children:["GHS ",m]},m))})]}),(()=>{const m=r.watch("amount"),b=parseFloat(m)||0;if(b>0){const{subtotal:g,tax:u,total:f}=Bs(b);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(Le,{}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Topup Amount"}),e.jsxs("span",{children:["GHâ‚µ",g.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:["Paystack Fee (",_e,"%)",e.jsx(He,{className:"h-3 w-3"})]}),e.jsxs("span",{className:"text-orange-600",children:["+GHâ‚µ",u.toFixed(2)]})]}),e.jsx(Le,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total to Pay"}),e.jsxs("span",{className:"text-primary",children:["GHâ‚µ",f.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-orange-50 dark:bg-orange-950/30 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx(He,{className:"h-4 w-4 text-orange-600 mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-orange-400",children:["A ",_e,"% Paystack fee is applied to all Paystack payments. You will receive GHâ‚µ",g.toFixed(2)," in your wallet."]})]})]})}return null})(),e.jsx(p,{type:"submit",className:"w-full",disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"}),(()=>{const m=r.watch("amount"),b=parseFloat(m)||0;if(b>0){const{total:g}=Bs(b);return`Pay GHâ‚µ${g.toFixed(2)}`}return"Continue to Payment"})()]})})]})}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1 mt-4",children:[e.jsx("p",{children:"â€¢ Secure payment via Paystack"}),e.jsx("p",{children:"â€¢ Funds reflect instantly after payment"}),e.jsx("p",{children:"â€¢ Use wallet for faster checkout"})]})]})]})}const Zc=s=>{switch(s.toLowerCase()){case"completed":case"delivered":return{variant:"default",icon:Te,color:"text-white",bgColor:"bg-green-500",label:s==="completed"?"Completed":"Delivered"};case"confirmed":return{variant:"secondary",icon:fs,color:"text-white",bgColor:"bg-blue-500",label:"Confirmed"};case"pending":return{variant:"secondary",icon:fs,color:"text-white",bgColor:"bg-amber-500",label:"Pending"};case"failed":return{variant:"destructive",icon:ds,color:"text-white",bgColor:"bg-red-500",label:"Failed"};default:return{variant:"outline",icon:fs,color:"text-white",bgColor:"bg-gray-500",label:s}}};function ed(){const{user:s}=ve(),[t,a]=o.useState(!1),{data:i,isLoading:n}=ee({queryKey:["/api/agent/wallet"],queryFn:()=>Me("/api/agent/wallet",{disableAutoLogout:!0}),refetchInterval:3e4}),{data:r,isLoading:d}=ee({queryKey:["/api/agent/transactions"],queryFn:()=>Me("/api/agent/transactions",{disableAutoLogout:!0}),refetchInterval:3e4,select:c=>c.slice(0,10)});return s?e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx(qe,{})}),e.jsx(ms,{open:t,onOpenChange:a,children:e.jsxs(es,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(js,{children:[e.jsx(xs,{children:"Navigation Menu"}),e.jsx(hs,{children:"Main navigation for your dashboard"})]}),e.jsx(qe,{onClose:()=>a(!1)})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ms,{open:t,onOpenChange:a,children:[e.jsx(Vs,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(Ne,{className:"h-5 w-5"})})}),e.jsxs(es,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(js,{children:[e.jsx(xs,{children:"Navigation Menu"}),e.jsx(hs,{children:"Main navigation for your dashboard"})]}),e.jsx(qe,{onClose:()=>a(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-base sm:text-lg font-bold",children:"Agent Wallet"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage your wallet balance and transactions"})]})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(F,{className:"bg-blue-500 border-blue-600",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium text-white",children:"User Wallet Balance"}),e.jsx(ye,{className:"h-4 w-4 text-white/80"})]}),e.jsxs(D,{children:[e.jsxs("div",{className:"text-lg font-bold text-white",children:["GHâ‚µ",(s==null?void 0:s.walletBalance)||"0.00"]}),e.jsx("p",{className:"text-xs text-white/70 mt-2",children:"Available for purchases"})]})]}),e.jsxs(F,{className:"bg-green-500 border-green-600",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium text-white",children:"Agent Profit Balance"}),e.jsx(at,{className:"h-4 w-4 text-white/80"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-lg font-bold text-white",children:n?e.jsx(re,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(i==null?void 0:i.balance)||"0.00"}`}),e.jsx("p",{className:"text-xs text-white/70 mt-2",children:"Withdrawable earnings"})]})]}),e.jsxs(F,{className:"bg-purple-500 border-purple-600",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium text-white",children:"Total Top-ups"}),e.jsx(Ge,{className:"h-4 w-4 text-white/80"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-lg font-bold text-white",children:n?e.jsx(re,{className:"h-5 w-5 animate-spin"}):(i==null?void 0:i.totalTopups)||0}),e.jsx("p",{className:"text-xs text-white/70 mt-2",children:"Wallet top-up transactions"})]})]}),e.jsxs(F,{className:"bg-red-500 border-red-600",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium text-white",children:"Total Spent"}),e.jsx(Ma,{className:"h-4 w-4 text-white/80"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-lg font-bold text-white",children:n?e.jsx(re,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(i==null?void 0:i.totalSpent)||"0.00"}`}),e.jsx("p",{className:"text-xs text-white/70 mt-2",children:"Total amount spent"})]})]})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Top Up User Wallet"}),e.jsx(te,{children:"Add funds to your user wallet to purchase data bundles and make instant payments"})]}),e.jsx(D,{children:e.jsx(mn,{})})]}),e.jsxs(F,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(G,{children:"Recent Transactions"}),e.jsx(te,{children:"Your latest wallet transactions"})]}),e.jsx(X,{href:"/agent/transactions",children:e.jsx(p,{variant:"outline",size:"sm",children:"View All"})})]})}),e.jsx(D,{children:d?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(re,{className:"h-6 w-6 animate-spin"})}):r&&r.length>0?e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{children:"Order ID"}),e.jsx(U,{children:"Type"}),e.jsx(U,{children:"Product"}),e.jsx(U,{children:"Amount"}),e.jsx(U,{children:"Status"}),e.jsx(U,{children:"Date"})]})}),e.jsx(ns,{children:r.map(c=>{const x=Zc(c.status),m=x.icon;return e.jsxs(we,{children:[e.jsxs(z,{className:"font-mono text-sm",children:["#",c.reference]}),e.jsx(z,{children:e.jsx(Z,{variant:"outline",className:"capitalize",children:c.type.replace("_"," ")})}),e.jsx(z,{className:"max-w-[200px] truncate",children:c.productName}),e.jsxs(z,{className:"font-medium tabular-nums",children:["GHâ‚µ",c.amount]}),e.jsx(z,{children:e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${x.bgColor}`,children:[e.jsx(m,{className:`h-3 w-3 ${x.color}`}),e.jsx("span",{className:x.color,children:x.label})]})}),e.jsx(z,{className:"text-muted-foreground text-sm",children:new Date(c.createdAt).toLocaleString()})]},c.id)})})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No transactions yet. Start by topping up your wallet."})})]})]})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})})}function sd(){const{toast:s}=fe();ve();const[t,a]=o.useState(!1),[i,n]=o.useState({}),{data:r,isLoading:d}=ee({queryKey:["/api/agent/pricing"]}),{data:c}=ee({queryKey:["/api/products/data-bundles"]}),x=oe({mutationFn:N=>Q("POST","/api/agent/pricing",{prices:N}),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/agent/pricing"]}),n({}),s({title:"Pricing updated successfully"})},onError:N=>{s({title:"Failed to update pricing",description:N.message,variant:"destructive"})}}),m=N=>{const l=c==null?void 0:c.find(h=>h.id===N);return l?`${l.network.toUpperCase()} ${l.dataAmount} - ${l.validity}`:N},b=N=>{const l=r==null?void 0:r.find(y=>y.bundleId===N),h=i[N];return{agentPrice:(h==null?void 0:h.agentPrice)||(l==null?void 0:l.agentPrice)||"0.00",agentProfit:(h==null?void 0:h.agentProfit)||(l==null?void 0:l.agentProfit)||"0.00",adminBasePrice:(l==null?void 0:l.adminBasePrice)||"0.00"}},g=(N,l,h)=>{const y=b(N),M=parseFloat(h)||0;{const S=parseFloat(y.adminBasePrice),k=Math.max(0,M-S);n(C=>({...C,[N]:{agentPrice:h,agentProfit:k.toFixed(2)}}))}},u=()=>{if(Object.keys(i).length===0){s({title:"No changes to save"});return}x.mutate(i)},f=Object.keys(i).length>0;return e.jsxs("div",{className:"flex h-screen bg-background",children:[t&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(qe,{onClose:()=>a(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(qe,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>a(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-sm lg:text-base font-semibold",children:"Pricing Management"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[f&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-destructive",children:[e.jsx(ks,{className:"h-4 w-4"}),"Unsaved changes"]}),e.jsx(p,{onClick:u,disabled:x.isPending||!f,children:x.isPending?"Saving...":"Save Changes"}),e.jsx(ke,{})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(at,{className:"h-5 w-5"}),"Set Your Selling Prices"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Set your selling prices for data bundles. Your profit margin will be calculated automatically."})]}),e.jsx(D,{children:d?e.jsx(Ts,{rows:8}):r&&r.length>0?e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{children:"Data Bundle"}),e.jsx(U,{children:"Base Price"}),e.jsx(U,{children:"Your Price"}),e.jsx(U,{children:"Your Profit"})]})}),e.jsx(ns,{children:r.map(N=>{const l=b(N.bundleId),h=i[N.bundleId];return e.jsxs(we,{className:h?"bg-muted":"",children:[e.jsx(z,{className:"font-medium",children:m(N.bundleId)}),e.jsx(z,{className:"tabular-nums",children:ie(l.adminBasePrice)}),e.jsx(z,{children:e.jsx(Y,{type:"number",step:"0.01",value:l.agentPrice,onChange:y=>g(N.bundleId,"agentPrice",y.target.value),className:"w-24 tabular-nums",min:l.adminBasePrice})}),e.jsx(z,{children:e.jsx(Y,{type:"number",step:"0.01",value:l.agentProfit,readOnly:!0,disabled:!0,className:"w-24 tabular-nums bg-muted cursor-not-allowed"})})]},N.bundleId)})})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No pricing data available. Please contact admin to set up base prices."})})]}),e.jsxs(F,{children:[e.jsx($,{children:e.jsx(G,{children:"How Pricing Works"})}),e.jsx(D,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Base Price"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"The minimum price set by admin for each role. You cannot sell below this price."})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Your Price"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"The price you charge customers. Must be at least the base price."})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Your Profit"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your Price minus Base Price. This is your profit margin per sale."})]})]})})]})]})})]})]})}function td(){var n;const[s,t]=o.useState(null),{data:a,isLoading:i}=ee({queryKey:["/api/dealer/pricing"],queryFn:()=>Me("/api/dealer/pricing")});return i?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(qt,{className:"mx-auto h-12 w-12 text-yellow-500"}),e.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900",children:"Dealer Pricing Plans"}),e.jsx("p",{className:"mt-2 text-lg text-gray-600",children:"Choose the perfect plan for your dealer business"})]}),e.jsx("div",{className:"mt-16 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:(n=a==null?void 0:a.plans)==null?void 0:n.map(r=>{var d;return e.jsxs(F,{className:`relative ${s===r.id?"ring-2 ring-blue-500":""}`,children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center justify-between",children:[r.name,r.recommended&&e.jsx(Z,{variant:"default",children:"Recommended"})]}),e.jsx(te,{children:r.description}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("span",{className:"text-3xl font-bold",children:["GHâ‚µ",r.price]}),e.jsxs("span",{className:"text-gray-500",children:["/",r.interval]})]})]}),e.jsxs(D,{children:[e.jsx("ul",{className:"space-y-2",children:(d=r.features)==null?void 0:d.map((c,x)=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"text-green-500 mr-2",children:"âœ“"}),c]},x))}),e.jsx(p,{className:"w-full mt-6",variant:s===r.id?"default":"outline",onClick:()=>t(r.id),children:s===r.id?"Selected":"Select Plan"})]})]},r.id)})}),s&&e.jsx("div",{className:"mt-12 text-center",children:e.jsx(p,{size:"lg",className:"px-8",children:"Upgrade to Selected Plan"})})]})})}function ad(){var n;const[s,t]=o.useState(null),{data:a,isLoading:i}=ee({queryKey:["/api/super-dealer/pricing"],queryFn:()=>Me("/api/super-dealer/pricing")});return i?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(qt,{className:"mx-auto h-12 w-12 text-yellow-500"}),e.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900",children:"Super Dealer Pricing Plans"}),e.jsx("p",{className:"mt-2 text-lg text-gray-600",children:"Advanced plans for managing dealer networks"})]}),e.jsx("div",{className:"mt-16 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:(n=a==null?void 0:a.plans)==null?void 0:n.map(r=>{var d;return e.jsxs(F,{className:`relative ${s===r.id?"ring-2 ring-blue-500":""}`,children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center justify-between",children:[r.name,r.recommended&&e.jsx(Z,{variant:"default",children:"Recommended"})]}),e.jsx(te,{children:r.description}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("span",{className:"text-3xl font-bold",children:["GHâ‚µ",r.price]}),e.jsxs("span",{className:"text-gray-500",children:["/",r.interval]})]})]}),e.jsxs(D,{children:[e.jsx("ul",{className:"space-y-2",children:(d=r.features)==null?void 0:d.map((c,x)=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"text-green-500 mr-2",children:"âœ“"}),c]},x))}),e.jsx(p,{className:"w-full mt-6",variant:s===r.id?"default":"outline",onClick:()=>t(r.id),children:s===r.id?"Selected":"Select Plan"})]})]},r.id)})}),s&&e.jsx("div",{className:"mt-12 text-center",children:e.jsx(p,{size:"lg",className:"px-8",children:"Upgrade to Selected Plan"})})]})})}function rd(){var n;const[s,t]=o.useState(null),{data:a,isLoading:i}=ee({queryKey:["/api/master/pricing"],queryFn:()=>Me("/api/master/pricing")});return i?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(dt,{className:"mx-auto h-12 w-12 text-red-500"}),e.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900",children:"Master Pricing Plans"}),e.jsx("p",{className:"mt-2 text-lg text-gray-600",children:"Enterprise-level plans for complete system management"})]}),e.jsx("div",{className:"mt-16 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:(n=a==null?void 0:a.plans)==null?void 0:n.map(r=>{var d;return e.jsxs(F,{className:`relative ${s===r.id?"ring-2 ring-blue-500":""}`,children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center justify-between",children:[r.name,r.recommended&&e.jsx(Z,{variant:"default",children:"Recommended"})]}),e.jsx(te,{children:r.description}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("span",{className:"text-3xl font-bold",children:["GHâ‚µ",r.price]}),e.jsxs("span",{className:"text-gray-500",children:["/",r.interval]})]})]}),e.jsxs(D,{children:[e.jsx("ul",{className:"space-y-2",children:(d=r.features)==null?void 0:d.map((c,x)=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"text-green-500 mr-2",children:"âœ“"}),c]},x))}),e.jsx(p,{className:"w-full mt-6",variant:s===r.id?"default":"outline",onClick:()=>t(r.id),children:s===r.id?"Selected":"Select Plan"})]})]},r.id)})}),s&&e.jsx("div",{className:"mt-12 text-center",children:e.jsx(p,{size:"lg",className:"px-8",children:"Upgrade to Selected Plan"})})]})})}const ld=[{title:"Dashboard",href:"/admin",icon:ya},{title:"Data Bundles",href:"/admin/data-bundles",icon:Ke},{title:"Role Base Prices",href:"/admin/role-base-prices",icon:Rt},{title:"Result Checkers",href:"/admin/result-checkers",icon:It},{title:"Transactions",href:"/admin/transactions",icon:Zs},{title:"Users",href:"/admin/users",icon:Us},{title:"Agents",href:"/admin/agents",icon:os},{title:"User Rankings",href:"/admin/rankings",icon:Gs},{title:"Withdrawals",href:"/admin/withdrawals",icon:ye},{title:"Manual Top-up",href:"/admin/manual-topup",icon:Ge},{title:"Chat Support",href:"/admin/chat-support",icon:tt},{title:"Announcements",href:"/admin/announcements",icon:ja},{title:"Video Guides",href:"/admin/guides",icon:Yr},{title:"External API Providers",href:"/admin/external-api-providers",icon:Cs},{title:"API Keys & Integrations",href:"/dashboard/api-integrations",icon:Cs},{title:"Break Settings",href:"/admin/break-settings",icon:Vt},{title:"Settings",href:"/admin/settings",icon:Rt}];function Se({onClose:s}={}){const[t]=ze(),{user:a,logout:i,isLoggingOut:n}=ve(),{data:r=0}=ee({queryKey:["/api/support/admin/unread-count"],queryFn:async()=>{try{return(await Q("GET","/api/support/admin/unread-count")).count||0}catch{return 0}},refetchInterval:5e3});return e.jsxs("div",{className:"flex h-screen w-64 flex-col border-r border-border bg-sidebar text-sidebar-foreground relative overflow-hidden md:h-full",children:[s&&e.jsx("div",{className:"absolute top-4 right-4 md:hidden z-50",children:e.jsx(p,{variant:"ghost",size:"icon",onClick:s,children:e.jsx(rt,{className:"h-4 w-4"})})}),e.jsx("div",{className:`flex h-16 items-center gap-2 border-b border-border px-6 flex-shrink-0 ${s?"pr-16":""}`,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-sm text-sidebar-foreground",children:(a==null?void 0:a.name)||"Admin"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Admin Panel"})]})}),e.jsx(yt,{className:"flex-1 px-3 py-4",children:e.jsx("nav",{className:"flex flex-col gap-1",children:ld.map(d=>{const c=t===d.href||d.href!=="/admin"&&t.startsWith(d.href),x=d.href==="/admin/chat-support";return e.jsx(X,{href:d.href,children:e.jsxs(p,{variant:c?"default":"ghost",className:_("w-full justify-start gap-2 px-2 py-1.5 text-xs font-normal relative text-yellow-600 hover:bg-yellow-50 hover:text-yellow-700 dark:text-yellow-400 dark:hover:bg-yellow-900/20 dark:hover:text-yellow-300",c&&"bg-yellow-500 !text-white font-medium shadow-sm hover:bg-yellow-600 hover:!text-white"),onClick:s,"data-testid":`link-admin-${d.title.toLowerCase().replace(" ","-")}`,children:[e.jsx(d.icon,{className:_("h-4 w-4",c?"text-white":"text-yellow-600 dark:text-yellow-400")}),e.jsx("span",{className:"flex-1 text-left",children:d.title}),x&&r>0&&e.jsx(Z,{variant:"destructive",className:"ml-auto",children:r})]})},d.href)})})}),e.jsxs("div",{className:"border-t border-border p-3 flex-shrink-0",children:[e.jsxs(p,{variant:"ghost",className:"w-full justify-start gap-2 px-2 py-1.5 text-xs text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-900/20",onClick:()=>i(),disabled:n,"data-testid":"button-admin-logout",children:[e.jsx(ta,{className:"h-4 w-4 text-red-600 dark:text-red-400"}),n?"Logging out...":"Log out"]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-border/50",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Developed by"," ",e.jsx("a",{href:"https://bm-portfolio-up2x.onrender.com",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 font-medium",children:"BlusMotif"})]})})]})]})}const nd=[{title:"Dashboard",href:"/user/dashboard",icon:ya},{title:"MTN Bundles",href:"/user/bundles/mtn",icon:Ke},{title:"AT iShare Bundles",href:"/user/bundles/at_ishare",icon:Ke},{title:"AT BIG TIME Bundles",href:"/user/bundles/at_bigtime",icon:Ke},{title:"TELECEL Bundles",href:"/user/bundles/telecel",icon:Ke},{title:"Top Up Wallet",href:"/user/wallet",icon:ye},{title:"API Keys & Integrations",href:"/dashboard/api-integrations",icon:Cs},{title:"Settings",href:"/user/settings",icon:Rt},{title:"Order History",href:"/user/history",icon:ti},{title:"Support",href:"/user/support",icon:tt}];function bs({onClose:s}={}){const[t]=ze(),{logout:a,isLoggingOut:i,user:n,agent:r}=ve(),{theme:d}=nt(),{data:c}=ee({queryKey:["user-rank"],queryFn:()=>Q("GET","/api/user/rank"),enabled:!!n});return e.jsxs("div",{className:"flex h-full w-64 flex-col border-r border-border bg-sidebar text-sidebar-foreground relative",children:[e.jsx("div",{className:`flex h-16 items-center justify-center border-b border-border px-6 ${s?"pr-4":""}`,children:e.jsx("div",{className:"flex flex-col items-center text-center w-full",children:e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-1 w-full",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-sm font-medium text-sidebar-foreground",children:(n==null?void 0:n.name)||"User"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n==null?void 0:n.email})]}),c&&e.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-green-500 px-2 py-0.5 text-xs font-medium text-white border border-green-600 dark:bg-green-600 dark:border-green-700",children:[e.jsx(Gs,{className:"h-2.5 w-2.5"}),e.jsx("span",{children:c.rank&&c.rank>0?`#${c.rank}`:"Unranked"})]})]})})}),e.jsx(yt,{className:"flex-1 px-3 py-4",children:e.jsxs("nav",{className:"flex flex-col gap-1",children:[nd.map(x=>{const m=t===x.href||x.href!=="/user/dashboard"&&t.startsWith(x.href);return e.jsx(X,{href:x.href,children:e.jsxs(p,{variant:m?"default":"ghost",className:_("w-full justify-start gap-3 font-normal relative text-yellow-600 hover:bg-yellow-50 hover:text-yellow-700 dark:text-yellow-400 dark:hover:bg-yellow-900/20 dark:hover:text-yellow-300",m&&"bg-yellow-500 !text-white font-medium shadow-sm hover:bg-yellow-600 hover:!text-white dark:bg-yellow-600"),onClick:()=>s&&s(),children:[e.jsx(x.icon,{className:_("h-4 w-4",m?"text-white":"text-yellow-600 dark:text-yellow-400")}),e.jsx("span",{className:"flex-1 text-left",children:x.title})]})},x.href)}),!r&&e.jsx(X,{href:"/agent/register",children:e.jsxs(p,{variant:"outline",className:"w-full justify-start gap-3 mt-2 bg-green-500 text-white border-green-500 hover:bg-green-600 hover:border-green-600 dark:bg-green-600 dark:border-green-600 dark:hover:bg-green-700",onClick:()=>s&&s(),children:[e.jsx(Ke,{className:"h-4 w-4"}),"Become an Agent"]})})]})}),e.jsxs("div",{className:"border-t p-3 dark:border-gray-700",children:[e.jsxs(p,{variant:"ghost",className:"w-full justify-start gap-3 text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-900/20",onClick:()=>{s&&s(),a()},disabled:i,children:[e.jsx(ta,{className:"h-4 w-4 text-red-600 dark:text-red-400"}),i?"Logging out...":"Log out"]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-border/50 dark:border-gray-600",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center dark:text-gray-400",children:["Developed by"," ",e.jsx("a",{href:"https://bm-portfolio-up2x.onrender.com",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 font-medium dark:text-blue-400 dark:hover:text-blue-300",children:"BlusMotif"})]})})]})]})}const wt=ri,id=li,cd=ai,xn=o.forwardRef(({className:s,...t},a)=>e.jsx(Sl,{className:_("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));xn.displayName=Sl.displayName;const ht=o.forwardRef(({className:s,...t},a)=>e.jsxs(cd,{children:[e.jsx(xn,{}),e.jsx(Pl,{ref:a,className:_("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));ht.displayName=Pl.displayName;const ut=({className:s,...t})=>e.jsx("div",{className:_("flex flex-col space-y-2 text-center sm:text-left",s),...t});ut.displayName="AlertDialogHeader";const pt=({className:s,...t})=>e.jsx("div",{className:_("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});pt.displayName="AlertDialogFooter";const gt=o.forwardRef(({className:s,...t},a)=>e.jsx(Cl,{ref:a,className:_("text-lg font-semibold",s),...t}));gt.displayName=Cl.displayName;const jt=o.forwardRef(({className:s,...t},a)=>e.jsx(Al,{ref:a,className:_("text-sm text-muted-foreground",s),...t}));jt.displayName=Al.displayName;const ft=o.forwardRef(({className:s,...t},a)=>e.jsx(Tl,{ref:a,className:_(Ga(),s),...t}));ft.displayName=Tl.displayName;const bt=o.forwardRef(({className:s,...t},a)=>e.jsx(Fl,{ref:a,className:_(Ga({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));bt.displayName=Fl.displayName;const dd=()=>{const[,s]=ze(),{user:t}=ve(),[a,i]=o.useState([]),[n,r]=o.useState(!0),[d,c]=o.useState(!1),[x,m]=o.useState(""),[b,g]=o.useState(!1),[u,f]=o.useState(""),[N,l]=o.useState(!1),[h,y]=o.useState(!1),[M,S]=o.useState("keys");o.useEffect(()=>{k()},[]);const k=async()=>{try{const{data:{session:W}}=await Fs.auth.getSession();if(!(W!=null&&W.access_token)){$e.error("Please log in to manage API keys"),r(!1);return}const L=await fetch("/api/user/api-keys",{headers:{Authorization:`Bearer ${W.access_token}`,"Content-Type":"application/json"}});if(L.ok){const j=await L.json();i(j)}else L.status===401?$e.error("Please log in to manage API keys"):$e.error("Failed to fetch API keys")}catch{$e.error("Error fetching API keys")}finally{r(!1)}},C=async()=>{if(!x.trim()){$e.error("Please enter a name for your API key");return}if(x.trim().length>100){$e.error("API key name must be 100 characters or less");return}c(!0);try{const{data:{session:W}}=await Fs.auth.getSession();if(!(W!=null&&W.access_token)){$e.error("Please log in to create API keys"),c(!1);return}const L=await fetch("/api/user/api-keys",{method:"POST",headers:{Authorization:`Bearer ${W.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({name:x.trim()})});if(L.ok){const j=await L.json();f(j.key),l(!0),m(""),g(!1),k(),j.remaining!==void 0?$e.success(`API key created! You can create ${j.remaining} more keys this hour.`):$e.success("API key created successfully")}else{const j=await L.json();L.status===401?$e.error("Please log in to create API keys"):L.status===429?$e.error(j.error||"Rate limit exceeded. Please try again later."):$e.error(j.error||"Failed to create API key")}}catch{$e.error("Error creating API key")}finally{c(!1)}},E=async W=>{try{const{data:{session:L}}=await Fs.auth.getSession();if(!(L!=null&&L.access_token)){$e.error("Please log in to revoke API keys");return}const j=await fetch(`/api/user/api-keys/${W}`,{method:"DELETE",headers:{Authorization:`Bearer ${L.access_token}`,"Content-Type":"application/json"}});if(j.ok)k(),$e.success("API key revoked successfully");else{const v=await j.json();j.status===401?$e.error("Please log in to revoke API keys"):$e.error(v.error||"Failed to revoke API key")}}catch{$e.error("Error revoking API key")}},se=W=>{navigator.clipboard.writeText(W),$e.success("Copied to clipboard")},H=()=>{if(!t)return null;switch(t.role){case"admin":return e.jsx(Se,{onClose:()=>y(!1)});case"agent":case"dealer":case"super_dealer":case"master":return e.jsx(qe,{onClose:()=>y(!1)});case"user":return e.jsx(bs,{onClose:()=>y(!1)});default:return e.jsx(Se,{onClose:()=>y(!1)})}};return n?e.jsxs("div",{className:"flex h-screen bg-background",children:[H(),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-lg",children:"Loading..."})})]}):e.jsxs("div",{className:"flex h-screen bg-background",children:[h&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>y(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:H()})]}),e.jsx("div",{className:"hidden lg:block",children:H()}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>y(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"API Keys & Integrations"})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground",children:"Manage your API keys and integrate with third-party services"})}),e.jsxs(us,{open:b,onOpenChange:g,children:[e.jsx(St,{asChild:!0,children:e.jsxs(p,{children:[e.jsx(As,{className:"w-4 h-4 mr-2"}),"Create API Key"]})}),e.jsxs(ss,{className:"bg-card text-card-foreground border-border",style:{backgroundColor:"hsl(var(--card))",opacity:1},children:[e.jsxs(ts,{children:[e.jsx(as,{className:"font-bold text-lg",children:"Create New API Key"}),e.jsx(Ks,{children:"Create a new API key to access our services programmatically."})]}),e.jsxs("div",{className:"mt-3 p-3 bg-muted border border-border rounded-md",children:[e.jsx("p",{className:"text-foreground text-sm font-semibold mb-1",children:"âš ï¸ Security Notice"}),e.jsxs("ul",{className:"text-muted-foreground text-xs space-y-1 ml-4 list-disc",children:[e.jsx("li",{children:"Maximum 10 active keys per account"}),e.jsx("li",{children:"Maximum 5 key creations per hour"}),e.jsx("li",{children:"Keys are shown only once - save immediately!"}),e.jsx("li",{children:"Keys cannot be recovered if lost"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"keyName",className:"font-semibold",children:"API Key Name"}),e.jsx(Y,{id:"keyName",placeholder:"e.g., Production App, Development",value:x,onChange:W=>m(W.target.value),maxLength:100}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[x.length,"/100 characters"]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(p,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(p,{onClick:C,disabled:d,className:"font-semibold",children:d?"Creating...":"Create Key"})]})]})]})]})]}),e.jsx(us,{open:N,onOpenChange:l,children:e.jsxs(ss,{className:"max-w-2xl bg-card border-border",children:[e.jsx(ts,{children:e.jsxs(as,{className:"flex items-center gap-2 text-xl",children:[e.jsx(Js,{className:"w-6 h-6 text-primary"}),"API Key Created Successfully!"]})}),e.jsxs("div",{className:"p-4 bg-destructive/10 border-2 border-destructive rounded-lg mt-4",children:[e.jsx("p",{className:"text-destructive font-bold text-sm mb-2",children:"ðŸ” CRITICAL: Save Your API Key Now!"}),e.jsxs("ul",{className:"text-destructive text-xs space-y-1 ml-4 list-disc",children:[e.jsx("li",{children:"This is the ONLY time you'll see this key in full"}),e.jsx("li",{children:"Copy and store it securely (e.g., password manager)"}),e.jsx("li",{children:"Once you close this dialog, the key will be masked forever"}),e.jsx("li",{children:"If lost, you must revoke and create a new key"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg border-2 border-primary",children:[e.jsx(V,{className:"text-sm font-semibold mb-2 block",children:"Your API Key:"}),e.jsx("code",{className:"text-sm break-all block p-3 bg-background text-primary rounded font-mono",children:u})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs(p,{variant:"outline",onClick:()=>{se(u),$e.success("API key copied! Make sure to save it securely.")},className:"border-yellow-500 text-yellow-400 hover:bg-yellow-500/20",children:[e.jsx(ps,{className:"w-4 h-4 mr-2"}),"Copy to Clipboard"]}),e.jsx(p,{onClick:()=>{l(!1),$e.info("API key dialog closed. The key is now masked in your list.")},className:"font-semibold",children:"I've Saved It Securely"})]})]})]})}),e.jsxs(it,{value:M,onValueChange:S,className:"space-y-6",children:[e.jsxs(Ys,{className:"grid w-full grid-cols-4",children:[e.jsx(De,{value:"keys",className:"data-[state=active]:text-green-600 dark:data-[state=active]:text-green-400",children:"API Keys"}),e.jsx(De,{value:"integrations",className:"data-[state=active]:text-green-600 dark:data-[state=active]:text-green-400",children:"Integrations"}),e.jsx(De,{value:"webhooks",className:"data-[state=active]:text-green-600 dark:data-[state=active]:text-green-400",children:"Webhooks"}),e.jsx(De,{value:"docs",className:"data-[state=active]:text-green-600 dark:data-[state=active]:text-green-400",children:"Documentation"})]}),e.jsx(Ue,{value:"keys",className:"space-y-6",children:a.length===0?e.jsx(F,{children:e.jsxs(D,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Js,{className:"w-12 h-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No API Keys Yet"}),e.jsx("p",{className:"text-muted-foreground text-center mb-4",children:"Create your first API key to start integrating with our services."}),e.jsxs(p,{onClick:()=>g(!0),children:[e.jsx(As,{className:"w-4 h-4 mr-2"}),"Create Your First API Key"]})]})}):e.jsx("div",{className:"grid gap-4",children:a.map(W=>e.jsxs(F,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Js,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx(G,{className:"text-lg",children:W.name}),e.jsxs(te,{children:["Created ",new Date(W.createdAt).toLocaleDateString(),W.lastUsed&&` â€¢ Last used ${new Date(W.lastUsed).toLocaleDateString()}`]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(Z,{variant:W.isActive?"default":"secondary",children:W.isActive?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-3 h-3 mr-1"})," Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(ds,{className:"w-3 h-3 mr-1"})," Revoked"]})})})]})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{className:"text-sm font-medium",children:"API Key"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono overflow-x-auto",children:W.key}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>se(W.key),title:"Copy masked key",children:e.jsx(ps,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Key is masked for security. Full key was shown only once at creation."})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(wt,{children:[e.jsx(id,{asChild:!0,children:e.jsxs(p,{variant:"destructive",size:"sm",disabled:!W.isActive,children:[e.jsx(Ws,{className:"w-4 h-4 mr-2"}),"Revoke Key"]})}),e.jsxs(ht,{className:"bg-card border-border",style:{backgroundColor:"hsl(var(--card))",opacity:1},children:[e.jsxs(ut,{children:[e.jsx(gt,{children:"Revoke API Key"}),e.jsx(jt,{children:"Are you sure you want to revoke this API key? This action cannot be undone and any applications using this key will immediately lose access."})]}),e.jsxs(pt,{children:[e.jsx(bt,{children:"Cancel"}),e.jsx(ft,{onClick:()=>E(W.id),className:"bg-red-600 hover:bg-red-700",children:"Revoke Permanently"})]})]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:W.isActive?e.jsx("span",{className:"text-green-600",children:"âœ“ Key is active and functional"}):e.jsx("span",{className:"text-red-600",children:"â¨¯ Key has been revoked"})})]})})]})})]},W.id))})}),e.jsx(Ue,{value:"integrations",className:"space-y-6",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Third-Party Integrations"}),e.jsx(te,{children:"Connect your applications and services to our platform"})]}),e.jsx(D,{className:"space-y-6",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(F,{children:[e.jsx($,{children:e.jsxs(G,{className:"text-lg flex items-center",children:[e.jsx(Cs,{className:"w-5 h-5 mr-2"}),"REST API"]})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Use our REST API to programmatically access data bundles, result checkers, and transactions."}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>s("/dashboard/api-documentation"),children:"View API Docs"})]})]}),e.jsxs(F,{children:[e.jsx($,{children:e.jsxs(G,{className:"text-lg flex items-center",children:[e.jsx(Aa,{className:"w-5 h-5 mr-2"}),"Webhooks"]})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Receive real-time notifications about transaction status changes and other events."}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>S("webhooks"),children:"Configure Webhooks"})]})]})]})})]})}),e.jsx(Ue,{value:"webhooks",className:"space-y-6",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Webhook Configuration"}),e.jsx(te,{children:"Receive real-time notifications when order status changes"})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-muted border border-border rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"ðŸ’¡ How to Use Webhooks"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:["Include the ",e.jsx("code",{className:"bg-muted px-2 py-0.5 rounded text-xs",children:"webhookUrl"})," parameter when creating orders via API:"]}),e.jsx("pre",{className:"bg-muted p-3 rounded text-xs overflow-x-auto border",children:`{
  "productId": "mtn-1gb",
  "customerPhone": "0241234567",
  "amount": "5.00",
  "webhookUrl": "https://your-app.com/webhooks/order-status"
}`}),e.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"When the order status changes (pending â†’ completed/failed), we'll send a POST request to your webhook URL with the updated order details."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{className:"text-base font-semibold",children:"Webhook Payload Example"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Here's what you'll receive when an order status updates:"}),e.jsx("pre",{className:"bg-muted p-4 rounded text-xs overflow-x-auto border",children:`{
  "event": "order.status_updated",
  "reference": "TXN_1234567890",
  "status": "completed",
  "deliveryStatus": "delivered",
  "timestamp": "2024-01-15T10:30:00.000Z",
  "order": {
    "id": "uuid-here",
    "reference": "TXN_1234567890",
    "amount": 5.00,
    "previousStatus": "pending",
    "currentStatus": "completed"
  },
  "products": [
    {
      "bundleId": "mtn-1gb",
      "bundleName": "MTN 1GB",
      "phone": "0241234567",
      "network": "mtn"
    }
  ]
}`})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{onClick:()=>s("/dashboard/api-documentation"),className:"flex-1",children:"View Full Documentation"}),e.jsxs(p,{variant:"outline",onClick:()=>{window.open("https://webhook.site","_blank"),$e.success("Opening webhook.site for testing!")},className:"flex-1",children:[e.jsx(Aa,{className:"w-4 h-4 mr-2"}),"Test with webhook.site"]})]})]})]})})]})}),e.jsx(Ue,{value:"docs",className:"space-y-6",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"API Documentation"}),e.jsx(te,{children:"Complete documentation for integrating with our platform"})]}),e.jsx(D,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(p,{variant:"outline",className:"justify-start",onClick:()=>s("/dashboard/api-documentation"),children:[e.jsx(Cs,{className:"w-4 h-4 mr-2"}),"REST API Reference"]}),e.jsxs(p,{variant:"outline",className:"justify-start",onClick:()=>s("/dashboard/api-documentation"),children:[e.jsx(Aa,{className:"w-4 h-4 mr-2"}),"Webhook Documentation"]}),e.jsxs(p,{variant:"outline",className:"justify-start",onClick:()=>s("/dashboard/api-documentation"),children:[e.jsx(Js,{className:"w-4 h-4 mr-2"}),"Authentication Guide"]}),e.jsx(p,{variant:"outline",className:"justify-start",onClick:()=>{window.open("https://documenter.getpostman.com/view/your-collection-id","_blank"),$e.info("Opening Postman Collection...")},children:"Download Postman Collection"})]})})]})})]})]})})]})]})},od=()=>{const{user:s}=ve(),[,t]=ze(),[a,i]=o.useState(!1),[n,r]=o.useState(null),d="https://resellershubprogh.com",c=(m,b)=>{navigator.clipboard.writeText(m),r(b),$e.success("Copied to clipboard!"),setTimeout(()=>r(null),2e3)},x=()=>{if(!s)return null;switch(s.role){case"admin":return e.jsx(Se,{onClose:()=>i(!1)});case"agent":case"dealer":case"super_dealer":case"master":return e.jsx(qe,{onClose:()=>i(!1)});default:return e.jsx(bs,{onClose:()=>i(!1)})}};return e.jsxs("div",{className:"flex h-screen bg-background",children:[a&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>i(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:x()})]}),e.jsx("div",{className:"hidden lg:block",children:x()}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>i(!a),children:e.jsx(Ne,{className:"h-6 w-6"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"API Documentation"})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto space-y-6",children:e.jsxs(it,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(Ys,{className:"grid w-full grid-cols-4",children:[e.jsxs(De,{value:"overview",className:"flex items-center gap-2 data-[state=active]:text-green-500",children:[e.jsx(ni,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(De,{value:"authentication",className:"flex items-center gap-2 data-[state=active]:text-green-500",children:[e.jsx(Js,{className:"w-4 h-4"}),"Authentication"]}),e.jsxs(De,{value:"endpoints",className:"flex items-center gap-2 data-[state=active]:text-green-500",children:[e.jsx(Za,{className:"w-4 h-4"}),"Endpoints"]}),e.jsxs(De,{value:"examples",className:"flex items-center gap-2 data-[state=active]:text-green-500",children:[e.jsx(Cs,{className:"w-4 h-4"}),"Code Examples"]})]}),e.jsx(Ue,{value:"overview",className:"space-y-6",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-primary"}),"Offers & Orders API"]}),e.jsx(te,{children:"Browse data bundle offers and create single/bulk orders with agent store slugs"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Base URL"}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg border font-mono text-sm flex items-center justify-between",children:[e.jsxs("code",{children:[d,"/api"]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>c(`${d}/api`,"baseUrl"),children:n==="baseUrl"?e.jsx(Rs,{className:"w-4 h-4 text-green-500"}):e.jsx(ps,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"What This API Does"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/20",children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2 text-blue-900 dark:text-blue-100",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Browse Offers"]}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:"View data bundles from MTN, Vodafone, AirtelTigo with pricing per network"})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-green-50 dark:bg-green-900/20",children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2 text-green-900 dark:text-green-100",children:[e.jsx(_s,{className:"w-4 h-4"}),"Single Orders"]}),e.jsx("p",{className:"text-sm text-green-800 dark:text-green-200",children:"Purchase one bundle at a time with phone number for delivery"})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-purple-50 dark:bg-purple-900/20",children:[e.jsx("h4",{className:"font-semibold mb-2 text-purple-900 dark:text-purple-100",children:"ðŸ“¦ Bulk Orders"}),e.jsx("p",{className:"text-sm text-purple-800 dark:text-purple-200",children:"Buy multiple bundles in one transaction for different phone numbers"})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/20",children:[e.jsx("h4",{className:"font-semibold mb-2 text-yellow-900 dark:text-yellow-100",children:"ðŸª Agent Store Slug"}),e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"Use agent slugs to access custom pricing and track commissions"})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Key Concepts"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg text-foreground",children:[e.jsx("h4",{className:"font-medium mb-2",children:"ðŸ”– What is a Slug?"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["A slug is a unique identifier for an agent's storefront. Example: ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-blue-600 dark:text-blue-400",children:"john-data-store"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Use slugs to access agent-specific offers at: ",e.jsxs("code",{className:"bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-blue-600 dark:text-blue-400",children:["/api/store/agent/","{slug}"]})]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg text-foreground",children:[e.jsx("h4",{className:"font-medium mb-2",children:"ðŸ“± Single vs Bulk Orders"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:[e.jsx("strong",{children:"Single:"})," One bundle to one phone number"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Bulk:"})," Multiple bundles to different phone numbers in one API call"]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-500/50 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3 flex items-center gap-2 text-blue-900 dark:text-white",children:"ðŸ“ž Phone Number Requirements"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-900 dark:text-white",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 dark:text-blue-300 font-bold",children:"â€¢"}),e.jsxs("div",{className:"text-blue-900 dark:text-white",children:[e.jsx("strong",{children:"Format:"})," Must be exactly 10 digits starting with 0",e.jsx("br",{}),e.jsx("code",{className:"bg-blue-100 dark:bg-blue-800 px-2 py-1 rounded text-xs text-blue-900 dark:text-white",children:"0241234567, 0501234567, 0261234567"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 dark:text-blue-300 font-bold",children:"â€¢"}),e.jsxs("div",{className:"text-blue-900 dark:text-white",children:[e.jsx("strong",{children:"No Network Validation:"})," Phone numbers are NOT validated against network prefixes",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-blue-700 dark:text-blue-200",children:"The API accepts any valid 10-digit phone regardless of network"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 dark:text-blue-300 font-bold",children:"â€¢"}),e.jsxs("div",{className:"text-blue-900 dark:text-white",children:[e.jsx("strong",{children:"Cooldown Period:"})," 20-minute wait between orders for same phone number",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-blue-700 dark:text-blue-200",children:"Prevents duplicate orders and abuse"})]})]})]})]}),e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 border border-purple-500/50 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3 flex items-center gap-2 text-purple-900 dark:text-white",children:"ðŸŒ Network-Specific Rules"}),e.jsxs("div",{className:"space-y-3 text-sm text-purple-900 dark:text-white",children:[e.jsxs("div",{className:"p-3 bg-white dark:bg-purple-800/30 rounded border border-purple-200 dark:border-purple-700",children:[e.jsx("div",{className:"font-semibold mb-1 text-purple-900 dark:text-white",children:"MTN, Telecel, AT Bigtime"}),e.jsxs("div",{className:"text-xs space-y-1 text-purple-800 dark:text-purple-100",children:[e.jsx("div",{children:"âœ… Single orders supported"}),e.jsx("div",{children:"âœ… Bulk orders supported"}),e.jsx("div",{children:"âœ… Wallet payment supported"}),e.jsx("div",{children:"âœ… Paystack payment supported"})]})]}),e.jsxs("div",{className:"p-3 bg-white dark:bg-purple-800/30 rounded border border-red-300 dark:border-red-600",children:[e.jsx("div",{className:"font-semibold mb-1 text-red-700 dark:text-red-300",children:"AT iShare"}),e.jsxs("div",{className:"text-xs space-y-1 text-purple-800 dark:text-purple-100",children:[e.jsx("div",{children:"âœ… Single orders supported"}),e.jsx("div",{children:"âŒ Bulk orders NOT supported"}),e.jsx("div",{children:"âœ… Wallet payment supported"}),e.jsx("div",{children:"âœ… Paystack payment supported"})]})]})]})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Status Codes"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 p-2 border rounded",children:[e.jsx(Z,{variant:"outline",className:"bg-green-50 dark:bg-green-900/20",children:"200"}),e.jsx("span",{className:"text-sm",children:"Success - Offers retrieved or order created"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 border rounded",children:[e.jsx(Z,{variant:"outline",className:"bg-yellow-50 dark:bg-yellow-900/20",children:"400"}),e.jsx("span",{className:"text-sm",children:"Bad Request - Invalid phone or insufficient balance"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 border rounded",children:[e.jsx(Z,{variant:"outline",className:"bg-yellow-50 dark:bg-yellow-900/20",children:"404"}),e.jsx("span",{className:"text-sm",children:"Not Found - Invalid slug or bundle doesn't exist"})]})]})]})]})]})}),e.jsx(Ue,{value:"authentication",className:"space-y-6",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Js,{className:"w-5 h-5 text-primary"}),"API Key Authentication"]}),e.jsx(te,{children:"Secure your API requests with API keys"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Header Format"}),e.jsx("div",{className:"bg-black p-4 rounded-lg",children:e.jsx("pre",{className:"text-green-400 text-sm",children:`Authorization: Bearer YOUR_API_KEY
Content-Type: application/json`})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Example Request"}),e.jsx("div",{className:"bg-black p-4 rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"text-green-400 text-sm",children:`curl -X GET "${d}/api/products/data-bundles" \\
  -H "Authorization: Bearer sk_1234567890abcdef..." \\
  -H "Content-Type: application/json"`})})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-50 dark:bg-blue-900/30 border border-blue-500/50 rounded-lg",children:[e.jsx(Js,{className:"w-5 h-5 text-blue-500 dark:text-blue-300 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-blue-700 dark:text-white mb-2",children:"Get Your API Key"}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-white mb-3",children:"Generate your API key from the API Keys & Integrations page. Maximum 10 active keys per account."}),e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>t("/dashboard/api-integrations"),children:[e.jsx(Js,{className:"w-4 h-4 mr-2"}),"Go to API Keys",e.jsx(vt,{className:"w-3 h-3 ml-2"})]})]})]})]})]})}),e.jsx(Ue,{value:"endpoints",className:"space-y-6",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Za,{className:"w-5 h-5 text-primary"}),"API Endpoints"]}),e.jsx(te,{children:"Browse offers and create single/bulk orders"})]}),e.jsxs(D,{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 pb-2 border-b",children:"1. Browse Offers"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Z,{className:"bg-blue-500 text-white",children:"GET"}),e.jsx("code",{className:"text-sm font-mono",children:"/api/products/data-bundles"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Get all available data bundle offers across all networks"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Query Parameters (Optional):"}),e.jsx("div",{className:"bg-muted p-3 rounded text-sm text-foreground",children:e.jsxs("div",{children:[e.jsx("code",{className:"text-blue-600 dark:text-blue-400 font-semibold",children:"network"}),": Filter by network (use: ",e.jsx("code",{className:"bg-blue-100 dark:bg-blue-900 px-2 py-0.5 rounded text-blue-700 dark:text-blue-300 font-bold",children:"mtn"}),", ",e.jsx("code",{className:"bg-blue-100 dark:bg-blue-900 px-2 py-0.5 rounded text-blue-700 dark:text-blue-300 font-bold",children:"telecel"}),", ",e.jsx("code",{className:"bg-blue-100 dark:bg-blue-900 px-2 py-0.5 rounded text-blue-700 dark:text-blue-300 font-bold",children:"at_bigtime"}),", or ",e.jsx("code",{className:"bg-blue-100 dark:bg-blue-900 px-2 py-0.5 rounded text-blue-700 dark:text-blue-300 font-bold",children:"at_ishare"}),")"]})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Example: ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-blue-600 dark:text-blue-400",children:"/api/products/data-bundles?network=mtn"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Response Example:"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`[
  {
    "id": 123,
    "network": "mtn",
    "volume": "1GB",
    "validity": "daily",
    "price": 5.00,
    "description": "MTN 1GB Daily Bundle"
  },
  {
    "id": 124,
    "network": "mtn",
    "volume": "2GB",
    "validity": "weekly",
    "price": 15.00,
    "description": "MTN 2GB Weekly Bundle"
  }
]`})})]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Z,{className:"bg-blue-500 text-white",children:"GET"}),e.jsxs("code",{className:"text-sm font-mono",children:["/api/store/agent/","{slug}"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Get offers from a specific agent's store using their slug"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Path Parameters:"}),e.jsxs("div",{className:"bg-muted p-3 rounded text-sm text-foreground",children:[e.jsx("code",{className:"text-primary",children:"slug"}),`: Agent's storefront slug (e.g., "john-data-store")`]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Response Example:"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`{
  "agent": {
    "id": 1,
    "businessName": "John's Data Store",
    "storefrontSlug": "john-data-store"
  },
  "bundles": [
    {
      "id": 123,
      "network": "mtn",
      "volume": "1GB",
      "price": 4.50
    }
  ]
}`})})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 pb-2 border-b",children:"2. Create Orders - Volume + Network Method"}),e.jsxs("div",{className:"mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-500 rounded-lg shadow-sm",children:[e.jsxs("h4",{className:"font-bold mb-3 text-yellow-900 dark:text-white text-base flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"âš ï¸"})," IMPORTANT: Use These Exact Network Names"]}),e.jsxs("p",{className:"text-sm mb-3 font-medium text-yellow-900 dark:text-white",children:["When specifying the ",e.jsx("code",{className:"bg-yellow-100 dark:bg-yellow-800 px-2 py-1 rounded text-yellow-900 dark:text-white font-bold",children:"network"})," parameter, use these ",e.jsx("strong",{className:"text-yellow-900 dark:text-white",children:"exact lowercase spellings"}),":"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 font-mono text-sm bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400 font-bold text-lg",children:"âœ“"}),e.jsx("code",{className:"text-blue-600 dark:text-blue-400 font-bold text-base",children:"mtn"})]}),e.jsxs("div",{className:"flex items-center gap-2 font-mono text-sm bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400 font-bold text-lg",children:"âœ“"}),e.jsx("code",{className:"text-blue-600 dark:text-blue-400 font-bold text-base",children:"telecel"})]}),e.jsxs("div",{className:"flex items-center gap-2 font-mono text-sm bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400 font-bold text-lg",children:"âœ“"}),e.jsx("code",{className:"text-blue-600 dark:text-blue-400 font-bold text-base",children:"at_bigtime"})]}),e.jsxs("div",{className:"flex items-center gap-2 font-mono text-sm bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400 font-bold text-lg",children:"âœ“"}),e.jsx("code",{className:"text-blue-600 dark:text-blue-400 font-bold text-base",children:"at_ishare"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 rounded border border-yellow-400",children:[e.jsx("p",{className:"text-xs font-medium mb-2 text-gray-900 dark:text-gray-100",children:"âœ… All code examples in this documentation use these exact spellings"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300",children:"Note: While network names are case-insensitive (server converts to lowercase), we recommend using lowercase in your code"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-2 border-green-500 rounded-lg p-4 bg-green-50 dark:bg-green-900/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Z,{className:"bg-green-500 text-white",children:"POST"}),e.jsx("code",{className:"text-sm font-mono",children:"/api/checkout/initialize"}),e.jsx(Z,{variant:"outline",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"SINGLE ORDER"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:[e.jsx("strong",{children:"Single Order"})," - Order one bundle for one phone number using volume and network"]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Required Fields:"}),e.jsxs("div",{className:"bg-muted p-3 rounded text-sm space-y-2 mb-3 text-foreground",children:[e.jsxs("div",{children:[e.jsx("code",{className:"text-primary",children:"volume"}),': Bundle size (e.g., "1GB", "2GB", "5GB")']}),e.jsxs("div",{children:[e.jsx("code",{className:"text-primary",children:"network"}),': Network name ("mtn", "telecel", "at_bigtime", "at_ishare")']}),e.jsxs("div",{children:[e.jsx("code",{className:"text-primary",children:"productType"}),': "data_bundle"']}),e.jsxs("div",{children:[e.jsx("code",{className:"text-primary",children:"customerPhone"}),`: Recipient's 10-digit phone (e.g., "0241234567")`]}),e.jsxs("div",{children:[e.jsx("code",{className:"text-primary",children:"paymentMethod"}),': "wallet" (API orders use wallet balance)']}),e.jsxs("div",{children:[e.jsx("code",{className:"text-primary",children:"agentSlug"}),": Agent's storefront slug (optional)"]})]}),e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Request Body Example:"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`{
  "volume": "1GB",
  "network": "mtn",
  "productType": "data_bundle",
  "customerPhone": "0241234567",
  "paymentMethod": "wallet",
  "agentSlug": "john-data-store"
}`})}),e.jsxs("div",{className:"mt-3 p-3 bg-green-100 dark:bg-green-900/40 border border-green-500/50 rounded",children:[e.jsx("p",{className:"text-sm font-semibold text-green-800 dark:text-white mb-1",children:"âœ… Why Use This Method:"}),e.jsxs("ul",{className:"text-xs text-green-700 dark:text-green-100 space-y-1 ml-4 list-disc",children:[e.jsx("li",{children:"No need to look up bundle IDs - just specify volume and network"}),e.jsx("li",{children:"Automatic price calculation based on user role"}),e.jsx("li",{children:"System finds the matching bundle automatically"}),e.jsx("li",{children:"Perfect for simple integrations"})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Success Response (200):"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`{
  "success": true,
  "message": "Order created successfully. Amount deducted from wallet.",
  "transaction": {
    "id": "67131c28-21e2-4cfa-ab4e-ef9716ce5ee6",
    "reference": "CLEC-MKVUPCNI-4438D1BC",
    "amount": "4.70",
    "status": "confirmed",
    "productName": "MTN 1GB - Non Expiry"
  },
  "wallet": {
    "previousBalance": "50.00",
    "amountDeducted": "4.70",
    "newBalance": "45.30"
  }
}`})})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-purple-50 dark:bg-purple-900/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Z,{className:"bg-purple-500 text-white",children:"POST"}),e.jsx("code",{className:"text-sm font-mono",children:"/api/checkout/initialize"}),e.jsx(Z,{variant:"outline",className:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",children:"BULK ORDER"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:[e.jsx("strong",{children:"Bulk Order:"})," Send the same bundle to multiple phone numbers using volume and network"]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Required Fields:"}),e.jsxs("div",{className:"bg-muted p-3 rounded text-sm space-y-2 mb-3 text-foreground",children:[e.jsxs("div",{children:[e.jsx("code",{className:"text-primary",children:"volume"}),': Bundle size (e.g., "1GB", "2GB", "5GB")']}),e.jsxs("div",{children:[e.jsx("code",{className:"text-primary",children:"network"}),': Network name ("mtn", "telecel", "at_bigtime", "at_ishare")']}),e.jsxs("div",{children:[e.jsx("code",{className:"text-primary",children:"productType"}),': "data_bundle"']}),e.jsxs("div",{children:[e.jsx("code",{className:"text-primary",children:"customerPhones"}),": Array of 10-digit phone numbers"]}),e.jsxs("div",{children:[e.jsx("code",{className:"text-primary",children:"paymentMethod"}),': "wallet" (API orders use wallet balance)']}),e.jsxs("div",{children:[e.jsx("code",{className:"text-primary",children:"agentSlug"}),": Agent's storefront slug (optional)"]}),e.jsxs("div",{children:[e.jsx("code",{className:"text-primary",children:"isBulkOrder"}),": true (automatically detected when using customerPhones array)"]})]}),e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Request Body:"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`{
  "volume": "1GB",
  "network": "mtn",
  "productType": "data_bundle",
  "customerPhones": [
    "0241234567",
    "0207654321",
    "0551122334"
  ],
  "paymentMethod": "wallet",
  "agentSlug": "john-data-store",
  "isBulkOrder": true
}`})}),e.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-500/50 rounded",children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-800 dark:text-white mb-1",children:"âš ï¸ Important Notes:"}),e.jsxs("ul",{className:"text-xs text-yellow-700 dark:text-yellow-100 space-y-1 ml-4 list-disc",children:[e.jsx("li",{children:"All phones must be 10 digits starting with 0"}),e.jsx("li",{children:"Phone numbers are validated server-side"}),e.jsx("li",{children:"No duplicate phones allowed in one bulk order"}),e.jsx("li",{children:"20-minute cooldown per phone number enforced"}),e.jsx("li",{children:"Same volume and network sent to all recipients"}),e.jsx("li",{children:"Bulk orders NOT supported for AT iShare network"})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Success Response (200):"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`{
  "success": true,
  "message": "Bulk order created successfully. Amount deducted from wallet.",
  "transaction": {
    "id": "67131c28-21e2-4cfa-ab4e-ef9716ce5ee6",
    "reference": "CLEC-BULK-XYZ789",
    "amount": "14.10",
    "status": "confirmed",
    "productName": "MTN 1GB - Bulk Order (3 recipients)"
  },
  "wallet": {
    "previousBalance": "50.00",
    "amountDeducted": "14.10",
    "newBalance": "35.90"
  },
  "recipients": [
    {"phone": "0241234567", "bundleName": "MTN 1GB - Non Expiry", "dataAmount": "1GB"},
    {"phone": "0207654321", "bundleName": "MTN 1GB - Non Expiry", "dataAmount": "1GB"},
    {"phone": "0551122334", "bundleName": "MTN 1GB - Non Expiry", "dataAmount": "1GB"}
  ]
}`})})]})]}),e.jsxs("div",{className:"border-l-4 border-red-500 pl-4 py-2 bg-red-50 dark:bg-red-900/20",children:[e.jsx("p",{className:"font-semibold text-sm mb-2 text-red-700 dark:text-red-400",children:"âŒ Error Responses:"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-red-400 text-xs",children:`// 400 - Invalid Phone
{
  "error": "Invalid phone number length. Phone number must be exactly 10 digits including the prefix (e.g., 0241234567)"
}

// 400 - Insufficient Balance (Wallet Payment)
{
  "error": "Insufficient wallet balance",
  "balance": "20.00",
  "required": "50.00"
}

// 429 - Cooldown Active
{
  "error": "Please wait 15 minute(s) before purchasing another bundle for 0241234567.",
  "cooldownMinutes": 15,
  "phone": "0241234567"
}

// 404 - Bundle Not Found (Volume+Network)
{
  "error": "No 1GB bundle found for mtn network",
  "hint": "Available volumes can be fetched from /api/products/data-bundles?network=mtn"
}`})})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 pb-2 border-b",children:"3. Network-Specific Order Examples"}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/30 border-2 border-blue-500 rounded-lg shadow-sm",children:[e.jsxs("h4",{className:"font-bold mb-3 text-blue-900 dark:text-white text-base flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“¡"})," Use These Exact Network Names in Your Code"]}),e.jsx("p",{className:"text-sm mb-3 font-medium text-blue-900 dark:text-white",children:"All examples below use these exact network spellings:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700",children:[e.jsx("code",{className:"text-blue-600 dark:text-blue-400 font-bold text-base",children:'"mtn"'}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"MTN Ghana"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700",children:[e.jsx("code",{className:"text-blue-600 dark:text-blue-400 font-bold text-base",children:'"telecel"'}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Telecel"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700",children:[e.jsx("code",{className:"text-blue-600 dark:text-blue-400 font-bold text-base",children:'"at_bigtime"'}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"AT Bigtime"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700",children:[e.jsx("code",{className:"text-blue-600 dark:text-blue-400 font-bold text-base",children:'"at_ishare"'}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"AT iShare"})]})]}),e.jsx("p",{className:"text-xs font-semibold bg-white dark:bg-gray-800 p-2 rounded text-gray-900 dark:text-gray-100",children:"âœ… Copy these exact spellings from the examples below"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-lg",children:"MTN Network"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Single Order (MTN):"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`{
  "volume": "1GB",
  "network": "mtn",
  "productType": "data_bundle",
  "customerPhone": "0241234567",
  "paymentMethod": "wallet",
  "agentSlug": "john-data-store"
}`})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Bulk Order (MTN) - âœ… Supported:"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`{
  "volume": "1GB",
  "network": "mtn",
  "productType": "data_bundle",
  "customerPhones": [
    "0241234567",
    "0254567890"
  ],
  "paymentMethod": "wallet",
  "agentSlug": "john-data-store",
  "isBulkOrder": true
}`})})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-lg",children:"Telecel Network"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Single Order (Telecel):"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`{
  "volume": "2GB",
  "network": "telecel",
  "productType": "data_bundle",
  "customerPhone": "0201234567",
  "paymentMethod": "wallet"
}`})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Bulk Order (Telecel) - âœ… Supported:"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`{
  "volume": "2GB",
  "network": "telecel",
  "productType": "data_bundle",
  "customerPhones": [
    "0201234567",
    "0501234567"
  ],
  "paymentMethod": "wallet",
  "isBulkOrder": true
}`})})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-lg",children:"AT Bigtime Network"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Single Order (AT Bigtime):"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`{
  "volume": "1.5GB",
  "network": "at_bigtime",
  "productType": "data_bundle",
  "customerPhone": "0261234567",
  "paymentMethod": "wallet"
}`})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Bulk Order (AT Bigtime) - âœ… Supported:"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`{
  "volume": "1.5GB",
  "network": "at_bigtime",
  "productType": "data_bundle",
  "customerPhones": [
    "0261234567",
    "0271234567"
  ],
  "paymentMethod": "wallet",
  "isBulkOrder": true
}`})})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 border-red-300 dark:border-red-700 bg-red-50 dark:bg-red-900/10",children:[e.jsx("h4",{className:"font-semibold mb-3 text-lg text-red-700 dark:text-red-400",children:"AT iShare Network"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Single Order (AT iShare) - âœ… Supported:"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`{
  "volume": "1GB",
  "network": "at_ishare",
  "productType": "data_bundle",
  "customerPhone": "0561234567",
  "paymentMethod": "wallet"
}`})})]}),e.jsxs("div",{className:"p-3 bg-red-100 dark:bg-red-900/20 border border-red-500/50 rounded",children:[e.jsx("p",{className:"text-sm font-semibold mb-2 text-red-800 dark:text-red-300",children:"âŒ Bulk Order (AT iShare) - NOT SUPPORTED"}),e.jsx("p",{className:"text-xs text-red-700 dark:text-red-400",children:'AT iShare network does not support bulk orders. Attempting to create a bulk order with network="at_ishare" will result in an error:'}),e.jsx("div",{className:"bg-black p-2 rounded mt-2",children:e.jsx("pre",{className:"text-red-400 text-xs",children:`{
  "error": "Bulk purchases are not available for AT iShare network"
}`})})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 pb-2 border-b",children:"4. Verify Order Status"}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Z,{className:"bg-blue-500 text-white",children:"GET"}),e.jsxs("code",{className:"text-sm font-mono",children:["/api/transactions/verify/","{reference}"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Check order status after payment using the reference code"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Path Parameters:"}),e.jsxs("div",{className:"bg-muted p-3 rounded text-sm text-foreground",children:[e.jsx("code",{className:"text-primary",children:"reference"}),': Transaction reference (e.g., "CLEC-ABC123")']})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Success Response (200):"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`{
  "status": "success",
  "transaction": {
    "id": 789,
    "reference": "CLEC-ABC123",
    "amount": 5.00,
    "status": "completed"
  },
  "products": [
    {
      "type": "data_bundle",
      "network": "mtn",
      "volume": "1GB",
      "phone": "0241234567"
    }
  ]
}`})})]})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 pb-2 border-b",children:"5. Webhooks - Automatic Status Updates"}),e.jsxs("div",{className:"mb-4 p-4 bg-green-50 dark:bg-green-900/30 border-2 border-green-500 rounded-lg",children:[e.jsx("h4",{className:"font-bold mb-2 text-green-900 dark:text-white",children:"ðŸ”” Automatic Notifications"}),e.jsx("p",{className:"text-sm text-green-900 dark:text-white",children:"Instead of constantly checking order status, provide a webhook URL when creating orders. Our system will automatically notify you when the order status changes (paid, processing, completed, failed)."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-lg",children:"How to Receive Status Updates"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Step 1: Add webhookUrl to Your Order Request"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`{
  "volume": "1GB",
  "network": "mtn",
  "productType": "data_bundle",
  "customerPhone": "0241234567",
  "paymentMethod": "wallet",
  "webhookUrl": "https://yoursite.com/api/webhook"
}`})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Step 2: We'll POST to Your Webhook URL on Every Status Change"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`POST https://yoursite.com/api/webhook
Content-Type: application/json
User-Agent: Resellers-Hub-Webhook/1.0
X-Webhook-Signature: [base64_signature]

{
  "event": "order.status_updated",
  "reference": "CLEC-ABC123",
  "status": "completed",
  "deliveryStatus": "delivered",
  "timestamp": "2026-01-27T00:30:00.000Z",
  "order": {
    "id": "67131c28-21e2-4cfa-ab4e-ef9716ce5ee6",
    "reference": "CLEC-ABC123",
    "amount": 4.70,
    "customerEmail": null,
    "isBulkOrder": false,
    "createdAt": "2026-01-27T00:21:19.578Z",
    "completedAt": "2026-01-27T00:30:00.000Z",
    "previousStatus": "processing",
    "currentStatus": "completed"
  },
  "products": [
    {
      "bundleId": "9706a8cb-c33c-445b-9569-83d07799b7ca",
      "bundleName": "MTN 1GB - Non Expiry",
      "phone": "0241234567",
      "network": "mtn"
    }
  ]
}`})})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/30",children:[e.jsx("h4",{className:"font-semibold mb-3 text-lg text-blue-900 dark:text-white",children:"Order Status Flow"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-900 dark:text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white dark:bg-gray-800 rounded",children:[e.jsx("span",{className:"font-mono font-bold text-yellow-600",children:"pending"}),e.jsx("span",{children:"â†’"}),e.jsx("span",{className:"text-muted-foreground",children:"Order created, awaiting payment"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white dark:bg-gray-800 rounded",children:[e.jsx("span",{className:"font-mono font-bold text-blue-600",children:"confirmed"}),e.jsx("span",{children:"â†’"}),e.jsx("span",{className:"text-muted-foreground",children:"Payment confirmed (paid), order queued for processing"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white dark:bg-gray-800 rounded",children:[e.jsx("span",{className:"font-mono font-bold text-purple-600",children:"pending (deliveryStatus: processing)"}),e.jsx("span",{children:"â†’"}),e.jsx("span",{className:"text-muted-foreground",children:"Bundle being sent to network provider"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white dark:bg-gray-800 rounded",children:[e.jsx("span",{className:"font-mono font-bold text-green-600",children:"completed (deliveryStatus: delivered)"}),e.jsx("span",{children:"â†’"}),e.jsx("span",{className:"text-muted-foreground",children:"Bundle delivered successfully âœ…"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white dark:bg-gray-800 rounded",children:[e.jsx("span",{className:"font-mono font-bold text-red-600",children:"failed"}),e.jsx("span",{children:"â†’"}),e.jsx("span",{className:"text-muted-foreground",children:"Delivery failed, will auto-refund âŒ"})]})]}),e.jsxs("div",{className:"mt-3 p-3 bg-blue-100 dark:bg-blue-800/40 border border-blue-500/50 rounded",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-800 dark:text-white mb-1",children:"ðŸ“ Note:"}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-100",children:["Webhooks are sent when ",e.jsx("strong",{children:"status"})," or ",e.jsx("strong",{children:"deliveryStatus"})," changes. Monitor both fields to track the complete order lifecycle."]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-lg",children:"Implement Your Webhook Endpoint"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Example Webhook Handler (Node.js/Express):"}),e.jsx("div",{className:"bg-black p-3 rounded",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`app.post('/api/webhook', express.json(), (req, res) => {
  const { event, reference, status, deliveryStatus, order, products } = req.body;
  
  // Verify webhook signature (recommended for production)
  const signature = req.headers['x-webhook-signature'];
  // if (!verifySignature(req.body, signature)) {
  //   return res.status(401).json({ error: 'Invalid signature' });
  // }
  
  // Update your database based on status
  if (status === 'completed' && deliveryStatus === 'delivered') {
    // Bundle successfully delivered
    database.updateOrder(reference, { 
      status: 'completed',
      deliveredAt: order.completedAt
    });
    
    // Notify customer(s)
    products.forEach(product => {
      sendSMS(product.phone, 
        \`Your \${product.bundleName} has been delivered!\`
      );
    });
    
  } else if (status === 'failed') {
    // Delivery failed - handle refund if needed
    database.updateOrder(reference, { 
      status: 'failed',
      refundProcessed: true 
    });
    
    // Notify admin
    notifyAdmin(\`Order \${reference} failed - check logs\`);
    
  } else if (status === 'confirmed') {
    // Payment confirmed, order being processed
    database.updateOrder(reference, { status: 'paid' });
  }
  
  // CRITICAL: Always respond with 200 OK within 10 seconds
  res.status(200).json({ received: true });
});`})})]}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-500/50 rounded p-3",children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-800 dark:text-white mb-2",children:"âš ï¸ Important Webhook Requirements:"}),e.jsxs("ul",{className:"text-xs text-yellow-700 dark:text-yellow-100 space-y-1 ml-4 list-disc",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Response Time:"})," Your endpoint MUST return HTTP 200 within 10 seconds (timeout enforced)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Retry Logic:"})," Failed webhooks are retried up to 3 times with exponential backoff (1s, 2s, 4s)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Idempotency:"})," Handle duplicate webhooks gracefully - same status may be sent multiple times"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Async Processing:"})," If processing takes >5s, respond 200 immediately and process async"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Security:"})," Use HTTPS for production webhook URLs"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Signature Verification:"})," Check X-Webhook-Signature header to verify authenticity"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Status Transitions:"})," pending â†’ confirmed â†’ pending(processing) â†’ completed(delivered) or failed"]})]})]}),e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 dark:bg-blue-900/30 border border-blue-500/50 rounded",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-800 dark:text-white mb-2",children:"ðŸ” Webhook Security (Optional):"}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-100 mb-2",children:["Each webhook includes an ",e.jsx("code",{className:"bg-blue-100 dark:bg-blue-800 px-1 rounded text-blue-900 dark:text-white",children:"X-Webhook-Signature"})," header for verification. While optional, it's recommended for production to prevent unauthorized webhook calls."]}),e.jsx("div",{className:"bg-black p-2 rounded mt-2",children:e.jsx("pre",{className:"text-green-400 text-xs",children:`// Verify webhook signature (optional but recommended)
const signature = req.headers['x-webhook-signature'];
const isValid = verifyWebhookSignature(req.body, signature);
if (!isValid) {
  return res.status(401).json({ error: 'Invalid signature' });
}`})})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-purple-50 dark:bg-purple-900/30",children:[e.jsx("h4",{className:"font-semibold mb-3 text-lg text-purple-800 dark:text-white",children:"ðŸ§ª Testing Webhooks"}),e.jsx("p",{className:"text-sm mb-3 text-purple-900 dark:text-white",children:"Use these services to test your webhook before going live:"}),e.jsxs("div",{className:"space-y-2 text-sm text-purple-900 dark:text-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"bg-white dark:bg-gray-800 px-2 py-1 rounded text-blue-600 dark:text-blue-400",children:"webhook.site"}),e.jsx("span",{className:"text-muted-foreground",children:"Get a temporary webhook URL and see incoming requests"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"bg-white dark:bg-gray-800 px-2 py-1 rounded text-blue-600 dark:text-blue-400",children:"ngrok"}),e.jsx("span",{className:"text-muted-foreground",children:"Expose your local development server to the internet"})]})]})]})]})]})]})]})}),e.jsx(Ue,{value:"examples",className:"space-y-6",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"w-5 h-5 text-primary"}),"Code Examples"]}),e.jsxs(te,{children:["Complete examples for browsing offers and creating single/bulk orders",e.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-500/50 rounded inline-block",children:[e.jsx("p",{className:"text-xs font-semibold mb-1 text-yellow-900 dark:text-white",children:"ðŸ“Œ Network names in all examples:"}),e.jsx("code",{className:"text-xs font-mono font-bold text-blue-600 dark:text-blue-400",children:"mtn"})," | ",e.jsx("code",{className:"text-xs font-mono font-bold text-blue-600 dark:text-blue-400",children:"telecel"})," | ",e.jsx("code",{className:"text-xs font-mono font-bold text-blue-600 dark:text-blue-400",children:"at_bigtime"})," | ",e.jsx("code",{className:"text-xs font-mono font-bold text-blue-600 dark:text-blue-400",children:"at_ishare"})]})]})]}),e.jsxs(D,{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"JavaScript"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:"1. Browse Offers"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>c("js1-code","js1"),children:n==="js1"?e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 mr-2 text-green-500"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ps,{className:"w-4 h-4 mr-2"}),"Copy"]})})]}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`const API_KEY = 'sk_your_api_key_here';
const BASE_URL = '${d}/api';

async function getBundleOffers(network = 'MTN') {
  const response = await fetch(
    \`\${BASE_URL}/products/data-bundles?network=\${network}\`,
    {
      headers: {
        'Authorization': \`Bearer \${API_KEY}\`,
        'Content-Type': 'application/json'
      }
    }
  );
  
  const bundles = await response.json();
  return bundles;
}

getBundleOffers('MTN');`})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:"2. Browse Agent Store by Slug"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>c("js2-code","js2"),children:n==="js2"?e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 mr-2 text-green-500"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ps,{className:"w-4 h-4 mr-2"}),"Copy"]})})]}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`async function getAgentStore(slug) {
  const response = await fetch(
    \`\${BASE_URL}/store/agent/\${slug}\`,
    {
      headers: {
        'Authorization': \`Bearer \${API_KEY}\`,
        'Content-Type': 'application/json'
      }
    }
  );
  
  if (!response.ok) {
    return null;
  }
  
  const store = await response.json();
  return store;
}

getAgentStore('john-data-store');`})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:"3. Create Order (Volume + Network - SIMPLEST â­)"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>c(`async function createOrder(volume, network, phone, agentSlug = null) {
  const response = await fetch(\`\${BASE_URL}/checkout/initialize\`, {
    method: 'POST',
    headers: {
      'Authorization': \`Bearer \${API_KEY}\`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      volume: volume,           // "1GB", "2GB", "5GB", etc.
      network: network,         // "mtn", "telecel", "at_bigtime", "at_ishare"
      productType: 'data_bundle',
      customerPhone: phone,     // 10-digit phone: "0241234567"
      paymentMethod: 'paystack',
      agentSlug: agentSlug      // Optional agent slug
    })
  });
  
  const result = await response.json();
  
  if (result.paymentUrl) {
    // Redirect user to complete payment
    window.location.href = result.paymentUrl;
    return result;
  } else {
    throw new Error(result.error);
  }
}

// Examples:
createOrder('1GB', 'mtn', '0241234567', 'john-data-store');
createOrder('5GB', 'telecel', '0501234567');
createOrder('2GB', 'at_bigtime', '0261234567');`,"js3"),children:n==="js3"?e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 mr-2 text-green-500"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ps,{className:"w-4 h-4 mr-2"}),"Copy"]})})]}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`async function createOrder(volume, network, phone, agentSlug = null) {
  const response = await fetch(\`\${BASE_URL}/checkout/initialize\`, {
    method: 'POST',
    headers: {
      'Authorization': \`Bearer \${API_KEY}\`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      volume: volume,           // "1GB", "2GB", "5GB", etc.
      network: network,         // "mtn", "telecel", "at_bigtime", "at_ishare"
      productType: 'data_bundle',
      customerPhone: phone,     // 10-digit phone: "0241234567"
      paymentMethod: 'paystack',
      agentSlug: agentSlug      // Optional agent slug
    })
  });
  
  const result = await response.json();
  
  if (result.paymentUrl) {
    // Redirect user to complete payment
    window.location.href = result.paymentUrl;
    return result;
  } else {
    throw new Error(result.error);
  }
}

// Examples:
createOrder('1GB', 'mtn', '0241234567', 'john-data-store');
createOrder('5GB', 'telecel', '0501234567');
createOrder('2GB', 'at_bigtime', '0261234567');`})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:"4. Create Bulk Order"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>c("js4-code","js4"),children:n==="js4"?e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 mr-2 text-green-500"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ps,{className:"w-4 h-4 mr-2"}),"Copy"]})})]}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`async function createBulkOrder(orders, network, agentSlug = null) {
  const response = await fetch(\`\${BASE_URL}/checkout/initialize\`, {
    method: 'POST',
    headers: {
      'Authorization': \`Bearer \${API_KEY}\`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      orderItems: orders.map(order => ({
        bundleId: order.bundleId,
        phone: order.phone,
        bundleName: order.bundleName
      })),
      productType: 'data_bundle',
      network: network,  // "mtn", "telecel", "at_bigtime" (NOT at_ishare)
      paymentMethod: 'paystack',
      agentSlug: agentSlug,
      isBulkOrder: true
    })
  });
  
  const result = await response.json();
  
  if (result.paymentUrl) {
    window.location.href = result.paymentUrl;
    return result;
  } else {
    throw new Error(result.error);
  }
}

// Example: 3 MTN bundles for different phones
const bulkOrders = [
  { bundleId: '123', phone: '0241234567', bundleName: 'MTN 1GB Daily' },
  { bundleId: '124', phone: '0207654321', bundleName: 'MTN 2GB Weekly' },
  { bundleId: '125', phone: '0551122334', bundleName: 'MTN 5GB Monthly' }
];

createBulkOrder(bulkOrders, 'mtn', 'john-data-store');`})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:"5. Verify Order"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>c("js5-code","js5"),children:n==="js5"?e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 mr-2 text-green-500"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ps,{className:"w-4 h-4 mr-2"}),"Copy"]})})]}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`async function verifyOrder(reference) {
  const response = await fetch(
    \`\${BASE_URL}/transactions/verify/\${reference}\`,
    {
      headers: {
        'Authorization': \`Bearer \${API_KEY}\`,
        'Content-Type': 'application/json'
      }
    }
  );
  
  const result = await response.json();
  return result;
}

verifyOrder('CLEC-ABC123');`})})]}),e.jsxs("div",{className:"border-t pt-6 mt-6",children:[e.jsx("h4",{className:"font-medium mb-4 text-lg",children:"6. All Networks Examples"}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`// ============================================
// ALL SUPPORTED NETWORKS
// ============================================

// MTN Network (Single & Bulk Supported)
const mtnSingle = {
  volume: '1GB',
  network: 'mtn',
  productType: 'data_bundle',
  customerPhone: '0241234567',
  paymentMethod: 'wallet'
};

const mtnBulk = {
  volume: '1GB',
  network: 'mtn',
  productType: 'data_bundle',
  customerPhones: ['0241234567', '0254567890'],
  paymentMethod: 'wallet',
  isBulkOrder: true
};

// Telecel Network (Single & Bulk Supported)
const telecelSingle = {
  volume: '2GB',
  network: 'telecel',
  productType: 'data_bundle',
  customerPhone: '0201234567',
  paymentMethod: 'wallet'
};

const telecelBulk = {
  volume: '2GB',
  network: 'telecel',
  productType: 'data_bundle',
  customerPhones: ['0201234567', '0501234567'],
  paymentMethod: 'wallet',
  isBulkOrder: true
};

// AT Bigtime Network (Single & Bulk Supported)
const atBigtimeSingle = {
  volume: '1.5GB',
  network: 'at_bigtime',
  productType: 'data_bundle',
  customerPhone: '0261234567',
  paymentMethod: 'wallet'
};

const atBigtimeBulk = {
  volume: '1.5GB',
  network: 'at_bigtime',
  productType: 'data_bundle',
  customerPhones: ['0261234567', '0271234567'],
  paymentMethod: 'wallet',
  isBulkOrder: true
};

// AT iShare Network (ONLY Single Supported - NO BULK)
const atIshareSingle = {
  volume: '1GB',
  network: 'at_ishare',
  productType: 'data_bundle',
  customerPhone: '0561234567',
  paymentMethod: 'wallet'
};

// âŒ AT iShare Bulk NOT SUPPORTED - Will return error
const atIshareBulk = {
  // This will FAIL with error:
  // "Bulk purchases are not available for AT iShare network"
  orderItems: [...],
  network: 'at_ishare',  // âŒ Will be rejected
  isBulkOrder: true
};

// Usage examples for all networks - using volume + network
await createOrder('1GB', 'mtn', '0241234567', 'agent-slug');        // MTN
await createOrder('2GB', 'telecel', '0201234567', 'agent-slug');    // Telecel
await createOrder('1.5GB', 'at_bigtime', '0261234567', 'agent-slug'); // AT Bigtime
await createOrder('1GB', 'at_ishare', '0561234567', 'agent-slug');  // AT iShare

// Bulk orders (NOT for at_ishare) - using volume + network
await createBulkOrder('1GB', 'mtn', ['0241234567', '0254567890'], 'agent-slug');      // âœ… Works
await createBulkOrder('2GB', 'telecel', ['0201234567', '0501234567'], 'agent-slug'); // âœ… Works
await createBulkOrder('1.5GB', 'at_bigtime', ['0261234567', '0271234567'], 'agent-slug'); // âœ… Works
// await createBulkOrder('1GB', 'at_ishare', [...phones], 'agent-slug');  // âŒ Will fail`})})]})]})]}),e.jsxs("div",{className:"border-t pt-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Python"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:"Browse Offers & Create Single Order"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>c("py1-code","py1"),children:n==="py1"?e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 mr-2 text-green-500"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ps,{className:"w-4 h-4 mr-2"}),"Copy"]})})]}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`import requests

API_KEY = 'sk_your_api_key_here'
BASE_URL = '${d}/api'
headers = {
    'Authorization': f'Bearer {API_KEY}',
    'Content-Type': 'application/json'
}

def get_bundles(network='mtn'):
    """Browse offers by network"""
    response = requests.get(
        f'{BASE_URL}/products/data-bundles?network={network}',
        headers=headers
    )
    bundles = response.json()
    return bundles

def create_single_order(volume, network, phone, agent_slug):
    """Create single order using volume + network"""
    payload = {
        'volume': volume,
        'network': network,
        'productType': 'data_bundle',
        'customerPhone': phone,
        'agentSlug': agent_slug,
        'paymentMethod': 'wallet'
    }
    
    response = requests.post(
        f'{BASE_URL}/checkout/initialize',
        headers=headers,
        json=payload
    )
    
    result = response.json()
    if response.status_code == 200:
        return result
    else:
        raise Exception(result.get('error'))

# Usage
bundles = get_bundles('mtn')
create_single_order('1GB', 'mtn', '0241234567', 'john-data-store')`})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:"Create Bulk Order"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>c("py2-code","py2"),children:n==="py2"?e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 mr-2 text-green-500"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ps,{className:"w-4 h-4 mr-2"}),"Copy"]})})]}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`def create_bulk_order(volume, network, phones, agent_slug):
    """Create bulk order for multiple recipients using volume + network"""
    payload = {
        'volume': volume,
        'network': network,
        'productType': 'data_bundle',
        'customerPhones': phones,
        'agentSlug': agent_slug,
        'paymentMethod': 'wallet',
        'isBulkOrder': True
    }
    
    response = requests.post(
        f'{BASE_URL}/checkout/initialize',
        headers=headers,
        json=payload
    )
    
    result = response.json()
    if response.status_code == 200:
        return result
    else:
        raise Exception(result.get('error'))

# Buy 1GB MTN bundle for 3 different phones
bulk_phones = ['0241234567', '0207654321', '0551122334']

create_bulk_order('1GB', 'mtn', bulk_phones, 'john-data-store')`})})]}),e.jsxs("div",{className:"border-t pt-6 mt-6",children:[e.jsx("h4",{className:"font-medium mb-4 text-lg",children:"All Networks Examples (Python)"}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`# ============================================
# PYTHON - ALL SUPPORTED NETWORKS
# ============================================

# MTN Network (Single & Bulk)
mtn_single = create_single_order('1GB', 'mtn', '0241234567', 'agent-slug')

mtn_bulk_phones = ['0241234567', '0254567890']
create_bulk_order('1GB', 'mtn', mtn_bulk_phones, 'agent-slug')

# Telecel Network (Single & Bulk)
telecel_single = create_single_order('2GB', 'telecel', '0201234567', 'agent-slug')

telecel_bulk_phones = ['0201234567', '0501234567']
create_bulk_order('2GB', 'telecel', telecel_bulk_phones, 'agent-slug')

# AT Bigtime Network (Single & Bulk)
at_bigtime_single = create_single_order('1.5GB', 'at_bigtime', '0261234567', 'agent-slug')

at_bigtime_bulk_phones = ['0261234567', '0271234567']
create_bulk_order('1.5GB', 'at_bigtime', at_bigtime_bulk_phones, 'agent-slug')

# AT iShare Network (ONLY Single - NO BULK)
at_ishare_single = create_single_order('1GB', 'at_ishare', '0561234567', 'agent-slug')

# âŒ AT iShare Bulk NOT SUPPORTED
# create_bulk_order('1GB', 'at_ishare', [...phones], 'agent-slug')  # This will fail!

# Bulk orders (MTN, Telecel, AT Bigtime only)
create_bulk_order('1GB', 'mtn', mtn_bulk_phones, 'agent-slug')         # âœ… Works
create_bulk_order('2GB', 'telecel', telecel_bulk_phones, 'agent-slug') # âœ… Works
create_bulk_order('1.5GB', 'at_bigtime', at_bigtime_bulk_phones, 'agent-slug')  # âœ… Works`})})]})]})]}),e.jsxs("div",{className:"border-t pt-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"cURL Commands"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Browse Offers"}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`curl -X GET "${d}/api/products/data-bundles?network=mtn" \\
  -H "Authorization: Bearer sk_your_api_key_here" \\
  -H "Content-Type: application/json"`})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Browse Agent Store"}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`curl -X GET "${d}/api/store/agent/john-data-store" \\
  -H "Authorization: Bearer sk_your_api_key_here" \\
  -H "Content-Type: application/json"`})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Single Order (Volume + Network)"}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`curl -X POST "${d}/api/checkout/initialize" \\
  -H "Authorization: Bearer sk_your_api_key_here" \\
  -H "Content-Type: application/json" \\
  -d '{
    "volume": "1GB",
    "network": "mtn",
    "productType": "data_bundle",
    "customerPhone": "0241234567",
    "agentSlug": "john-data-store",
    "paymentMethod": "wallet"
  }'`})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Bulk Order (Volume + Network)"}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`curl -X POST "${d}/api/checkout/initialize" \\
  -H "Authorization: Bearer sk_your_api_key_here" \\
  -H "Content-Type: application/json" \\
  -d '{
    "volume": "1GB",
    "network": "mtn",
    "productType": "data_bundle",
    "customerPhones": [
      "0241234567",
      "0207654321",
      "0551122334"
    ],
    "agentSlug": "john-data-store",
    "paymentMethod": "wallet",
    "isBulkOrder": true
  }'`})})]}),e.jsxs("div",{className:"border-t pt-6 mt-6",children:[e.jsx("h4",{className:"font-medium mb-4 text-lg",children:"All Networks Examples (cURL)"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-medium mb-2 text-blue-400",children:"MTN Network"}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto mb-3",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`# MTN Single Order
curl -X POST "${d}/api/checkout/initialize" \\
  -H "Authorization: Bearer sk_your_api_key_here" \\
  -H "Content-Type: application/json" \\
  -d '{
    "volume": "1GB",
    "network": "mtn",
    "productType": "data_bundle",
    "customerPhone": "0241234567",
    "paymentMethod": "wallet"
  }'

# MTN Bulk Order
curl -X POST "${d}/api/checkout/initialize" \\
  -H "Authorization: Bearer sk_your_api_key_here" \\
  -H "Content-Type: application/json" \\
  -d '{
    "volume": "1GB",
    "network": "mtn",
    "productType": "data_bundle",
    "customerPhones": ["0241234567", "0254567890"],
    "paymentMethod": "wallet",
    "isBulkOrder": true
  }'`})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-medium mb-2 text-blue-400",children:"Telecel Network"}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto mb-3",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`# Telecel Single Order
curl -X POST "${d}/api/checkout/initialize" \\
  -H "Authorization: Bearer sk_your_api_key_here" \\
  -H "Content-Type: application/json" \\
  -d '{
    "volume": "2GB",
    "network": "telecel",
    "productType": "data_bundle",
    "customerPhone": "0201234567",
    "paymentMethod": "wallet"
  }'

# Telecel Bulk Order
curl -X POST "${d}/api/checkout/initialize" \\
  -H "Authorization: Bearer sk_your_api_key_here" \\
  -H "Content-Type: application/json" \\
  -d '{
    "volume": "2GB",
    "network": "telecel",
    "productType": "data_bundle",
    "customerPhones": ["0201234567", "0501234567"],
    "paymentMethod": "wallet",
    "isBulkOrder": true
  }'`})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-medium mb-2 text-blue-400",children:"AT Bigtime Network"}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto mb-3",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`# AT Bigtime Single Order
curl -X POST "${d}/api/checkout/initialize" \\
  -H "Authorization: Bearer sk_your_api_key_here" \\
  -H "Content-Type: application/json" \\
  -d '{
    "volume": "1.5GB",
    "network": "at_bigtime",
    "productType": "data_bundle",
    "customerPhone": "0261234567",
    "paymentMethod": "wallet"
  }'

# AT Bigtime Bulk Order
curl -X POST "${d}/api/checkout/initialize" \\
  -H "Authorization: Bearer sk_your_api_key_here" \\
  -H "Content-Type: application/json" \\
  -d '{
    "volume": "1.5GB",
    "network": "at_bigtime",
    "productType": "data_bundle",
    "customerPhones": ["0261234567", "0271234567"],
    "paymentMethod": "wallet",
    "isBulkOrder": true
  }'`})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-medium mb-2 text-blue-400",children:"AT iShare Network (Single Only)"}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto mb-3",children:e.jsx("pre",{className:"p-4 text-sm text-green-400",children:`# AT iShare Single Order (âœ… Supported)
curl -X POST "${d}/api/checkout/initialize" \\
  -H "Authorization: Bearer sk_your_api_key_here" \\
  -H "Content-Type: application/json" \\
  -d '{
    "volume": "1GB",
    "network": "at_ishare",
    "productType": "data_bundle",
    "customerPhone": "0561234567",
    "paymentMethod": "wallet"
  }'

# AT iShare Bulk Order (âŒ NOT SUPPORTED - Will Fail)
curl -X POST "${d}/api/checkout/initialize" \\
  -H "Authorization: Bearer sk_your_api_key_here" \\
  -H "Content-Type: application/json" \\
  -d '{
    "volume": "1GB",
    "network": "at_ishare",
    "customerPhones": [...],
    "isBulkOrder": true
  }'
# Error response:
# {
#   "error": "Bulk purchases are not available for AT iShare network"
# }`})})]})]})]})]})]})]})})]})})})]})]})};function md(){var l;const[s,t]=o.useState(!1),[a,i]=o.useState(!1),{user:n}=ve(),{data:r,isLoading:d}=ee({queryKey:["/api/admin/stats"],refetchInterval:45e3,refetchOnWindowFocus:!0,staleTime:3e4}),{data:c,isLoading:x}=ee({queryKey:["/api/admin/transactions/recent"],refetchInterval:45e3,staleTime:3e4}),{data:m,isLoading:b}=ee({queryKey:["/api/admin/rankings/customers"],refetchInterval:6e4,staleTime:45e3}),{data:g,isLoading:u}=ee({queryKey:["/api/admin/analytics/revenue"],refetchInterval:12e4,staleTime:6e4}),f=g?g.map(h=>({name:new Date(h.date).toLocaleDateString("en-US",{weekday:"short"}),revenue:h.revenue,transactions:h.transactions})):[],N=h=>h===0?e.jsx(Gs,{className:"h-5 w-5 text-yellow-500"}):h===1?e.jsx($a,{className:"h-5 w-5 text-gray-400"}):h===2?e.jsx(wa,{className:"h-5 w-5 text-amber-600"}):e.jsxs("span",{className:"text-sm font-semibold text-muted-foreground",children:["#",h+1]});return e.jsxs("div",{className:"flex h-screen bg-background",children:[s&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>t(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>t(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>t(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Dashboard"})]}),e.jsx(ke,{})]}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4 lg:space-y-6",children:[e.jsxs(F,{className:"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 border-yellow-600 shadow-xl overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-12 -translate-x-12"}),e.jsx(D,{className:"p-6 relative",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-14 h-14 bg-white/20 rounded-full shadow-lg backdrop-blur-sm",children:e.jsx("span",{className:"text-3xl animate-bounce",children:"ðŸ‘‹"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl lg:text-3xl font-bold text-white mb-1 drop-shadow-sm",children:["Welcome back, ",((l=n==null?void 0:n.name)==null?void 0:l.toUpperCase())||"ADMIN","!"]}),e.jsx("p",{className:"text-yellow-100 text-sm lg:text-base font-medium",children:"Here's what's happening with your business today âœ¨"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-white/90",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium",children:"Live Dashboard"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-white/90",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse animate-delay-500"}),e.jsx("span",{className:"text-xs font-medium",children:"Real-time Updates"})]})]})]})]}),e.jsxs("div",{className:"hidden lg:flex flex-col items-end gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 bg-white/10 rounded-full px-3 py-1 backdrop-blur-sm",children:e.jsx("span",{className:"text-xs text-white font-medium",children:new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})}),e.jsxs("div",{className:"flex items-center gap-1 text-white/80",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-xs",children:"All systems operational"})]})]})]})})]}),d?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 lg:gap-6",children:Array.from({length:5}).map((h,y)=>e.jsx(F,{className:"animate-pulse",children:e.jsxs(D,{className:"pt-4 lg:pt-6",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mb-4"}),e.jsx("div",{className:"h-8 bg-muted rounded w-3/4"})]})},y))}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 lg:gap-6",children:[e.jsx(Ae,{title:"Total Revenue",value:ie((r==null?void 0:r.totalRevenue)||0),icon:Bt,description:"All time"}),e.jsx(Ae,{title:"Total Transactions",value:(r==null?void 0:r.totalTransactions)||0,icon:_s,description:"Completed orders"}),e.jsx(Ae,{title:"Active Agents",value:(r==null?void 0:r.totalAgents)||0,icon:os,description:"Registered agents"}),e.jsx(Ae,{title:"Total Agent Profits",value:ie((r==null?void 0:r.totalAgentProfits)||0),icon:at,description:"Combined agent earnings"}),e.jsx(Ae,{title:"Paystack Balance",value:ie((r==null?void 0:r.paystackBalance)||0),icon:ye,description:(r==null?void 0:r.paystackMode)==="test"?"Paystack Test Mode":"Available in Paystack"})]}),d?null:e.jsxs(F,{children:[e.jsx($,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-amber-500"}),"Account Status"]})}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Pending Withdrawals"}),e.jsx("p",{className:"text-2xl font-bold",children:(r==null?void 0:r.pendingWithdrawals)||0})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Today's Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:ie((r==null?void 0:r.todayRevenue)||0)})]})]})})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"text-lg flex items-center gap-2",children:[e.jsx(at,{className:"h-5 w-5 text-blue-500"}),"Revenue Analytics"]}),e.jsx(te,{children:"Weekly revenue and transaction trends"})]}),e.jsx(D,{children:u?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Loading analytics..."})}):f.length>0?e.jsx("div",{className:"h-64",children:e.jsx(gl,{width:"100%",height:"100%",children:e.jsxs(jl,{data:f,children:[e.jsx(fl,{strokeDasharray:"3 3"}),e.jsx(bl,{dataKey:"name"}),e.jsx(Nl,{}),e.jsx(vl,{formatter:(h,y)=>[y==="revenue"?ie(Number(h)):h,y==="revenue"?"Revenue":"Transactions"]}),e.jsx(yl,{dataKey:"revenue",fill:"#10b981",radius:[4,4,0,0]})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"No analytics data available"})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(F,{className:"lg:col-span-2",children:[e.jsx($,{className:"flex flex-row items-center justify-between gap-2",children:e.jsx(G,{className:"text-lg",children:"Recent Transactions"})}),e.jsx(D,{children:x?e.jsx(Ts,{rows:5}):c&&c.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{children:"Order ID"}),e.jsx(U,{children:"Product"}),e.jsx(U,{children:"Amount"}),e.jsx(U,{children:"Status"}),e.jsx(U,{children:"Date"})]})}),e.jsx(ns,{children:c.slice(0,10).map(h=>e.jsxs(we,{"data-testid":`row-transaction-${h.id}`,children:[e.jsxs(z,{className:"font-mono text-sm",children:["#",h.reference]}),e.jsx(z,{className:"max-w-[200px] truncate",children:h.productName}),e.jsx(z,{className:"font-medium tabular-nums",children:ie(h.amount)}),e.jsx(z,{children:e.jsx(Ka,{status:h.status})}),e.jsx(z,{className:"text-muted-foreground text-sm",children:Ze(h.createdAt)})]},h.id))})]})}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No transactions yet"})})]}),e.jsxs(F,{children:[e.jsx($,{children:e.jsx(G,{className:"text-lg",children:"Quick Stats"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-500 text-white rounded-lg border border-green-600",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(at,{className:"h-5 w-5 text-white"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Today's Revenue"})]}),e.jsx("span",{className:"font-bold text-white",children:ie((r==null?void 0:r.todayRevenue)||0)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-500 text-white rounded-lg border border-blue-600",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"h-5 w-5 text-white"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Today's Orders"})]}),e.jsx("span",{className:"font-bold text-white",children:(r==null?void 0:r.todayTransactions)||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-500 text-white rounded-lg border border-purple-600",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Bt,{className:"h-5 w-5 text-white"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Activation Revenue"})]}),e.jsx("span",{className:"font-bold text-white",children:ie((r==null?void 0:r.activationRevenue)||0)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-100 dark:bg-orange-900 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(os,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"}),e.jsx("span",{className:"text-sm font-medium text-orange-900 dark:text-orange-100",children:"Pending Agents"})]}),e.jsx("span",{className:"font-bold text-orange-700 dark:text-orange-300",children:(r==null?void 0:r.pendingAgents)||0})]})]})]})]}),e.jsxs(F,{children:[e.jsx($,{className:"flex flex-row items-center justify-between gap-2",children:e.jsxs("div",{children:[e.jsxs(G,{className:"text-lg flex items-center gap-2",children:[e.jsx(Gs,{className:"h-5 w-5 text-yellow-500"}),"Top Customers"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Highest spending customers"})]})}),e.jsx(D,{children:b?e.jsx(Ts,{rows:5}):m&&m.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{className:"w-16",children:"Rank"}),e.jsx(U,{children:"Customer"}),e.jsx(U,{className:"text-right",children:"Total Spent"}),e.jsx(U,{className:"text-right",children:"Purchases"}),e.jsx(U,{className:"text-right",children:"Last Purchase"})]})}),e.jsx(ns,{children:m.map((h,y)=>e.jsxs(we,{children:[e.jsx(z,{className:"text-center",children:N(y)}),e.jsx(z,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:h.customerName||h.customerEmail}),h.customerPhone&&e.jsx("span",{className:"text-xs text-muted-foreground",children:h.customerPhone}),e.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:h.customerEmail})]})}),e.jsx(z,{className:"text-right",children:e.jsx("span",{className:"font-bold text-green-600 dark:text-green-400",children:ie(h.totalSpent)})}),e.jsx(z,{className:"text-right",children:e.jsxs(Z,{variant:"secondary",children:[h.totalPurchases," ",h.totalPurchases===1?"order":"orders"]})}),e.jsx(z,{className:"text-right text-sm text-muted-foreground",children:Ze(h.lastPurchase)})]},h.rank))})]})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Gs,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No customer rankings yet"})]})})]})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Track Orders"}),e.jsx(te,{children:"Search and monitor order status across the platform"})]}),e.jsx(D,{children:e.jsx(Pt,{})})]})]})]}),e.jsx(Jt,{open:a,onOpenChange:i})]})}const Mt=o.forwardRef(({className:s,...t},a)=>e.jsx(Il,{className:_("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...t,ref:a,children:e.jsx(ii,{className:_("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Mt.displayName=Il.displayName;function xd(){const{toast:s}=fe(),{user:t}=ve(),[a,i]=o.useState(!1),[n,r]=o.useState(null),[d,c]=o.useState(!1),{data:x,isLoading:m}=ee({queryKey:["/api/admin/data-bundles"],refetchInterval:6e4,refetchOnWindowFocus:!0}),{data:b}=ee({queryKey:["/api/admin/role-base-prices"],enabled:(t==null?void 0:t.role)==="admin"}),g=oe({mutationFn:l=>Q("POST","/api/admin/data-bundles",l),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/data-bundles"]}),i(!1),s({title:"Data bundle created successfully"})},onError:l=>{s({title:"Failed to create bundle",description:l.message,variant:"destructive"})}}),u=oe({mutationFn:({id:l,data:h})=>Q("PATCH",`/api/admin/data-bundles/${l}`,h),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/data-bundles"]}),r(null),s({title:"Data bundle updated successfully"})},onError:l=>{s({title:"Failed to update bundle",description:l.message,variant:"destructive"})}}),f=oe({mutationFn:l=>Q("DELETE",`/api/admin/data-bundles/${l}`),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/data-bundles"]}),s({title:"Data bundle deleted successfully"})},onError:l=>{s({title:"Failed to delete bundle",description:l.message,variant:"destructive"})}}),N=(l,h)=>{const y=b==null?void 0:b.find(M=>M.bundleId===l&&M.role===h);return y?ie(y.basePrice):"-"};return e.jsxs("div",{className:"flex h-screen bg-background",children:[d&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>c(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>c(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>c(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Data Bundles"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(us,{open:a,onOpenChange:i,children:[e.jsx(St,{asChild:!0,children:e.jsxs(p,{"data-testid":"button-create-bundle",children:[e.jsx(As,{className:"h-4 w-4 mr-2"}),"Add Bundle"]})}),e.jsxs(ss,{className:"bg-card text-card-foreground",style:{backgroundColor:"hsl(var(--card))",opacity:1},children:[e.jsx(ts,{children:e.jsx(as,{children:"Create Data Bundle"})}),e.jsx(xr,{onSubmit:l=>g.mutate(l),isLoading:g.isPending})]})]}),e.jsx(ke,{})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5"}),"All Data Bundles"]}),e.jsxs(Z,{variant:"secondary",children:[(x==null?void 0:x.length)||0," bundles"]})]}),e.jsx(D,{children:m?e.jsx(Ts,{rows:8}):x&&x.length>0?e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{children:"Network"}),e.jsx(U,{children:"Name"}),e.jsx(U,{children:"Data"}),e.jsx(U,{children:"Validity"}),e.jsx(U,{children:"Base Price"}),e.jsx(U,{children:"Agent Base"}),e.jsx(U,{children:"Dealer Base"}),e.jsx(U,{children:"Super Dealer Base"}),e.jsx(U,{children:"Master Base"}),e.jsx(U,{children:"Admin Price"}),e.jsx(U,{children:"Status"}),e.jsx(U,{className:"text-right",children:"Actions"})]})}),e.jsx(ns,{children:x.map(l=>{const h=Ds.find(y=>y.id===l.network);return e.jsxs(we,{"data-testid":`row-bundle-${l.id}`,children:[e.jsx(z,{children:e.jsx(Z,{style:{backgroundColor:h==null?void 0:h.color,color:h==null?void 0:h.textColor},children:(h==null?void 0:h.name)||l.network.toUpperCase()})}),e.jsxs(z,{className:"font-medium",children:[l.network.toUpperCase()," ",l.dataAmount," - ",l.validity]}),e.jsx(z,{children:l.dataAmount}),e.jsx(z,{children:l.validity}),e.jsx(z,{className:"font-medium tabular-nums",children:ie(l.basePrice)}),e.jsx(z,{className:"tabular-nums",children:N(l.id,"agent")}),e.jsx(z,{className:"tabular-nums",children:N(l.id,"dealer")}),e.jsx(z,{className:"tabular-nums",children:N(l.id,"super_dealer")}),e.jsx(z,{className:"tabular-nums",children:N(l.id,"master")}),e.jsx(z,{className:"tabular-nums",children:l.adminPrice?ie(l.adminPrice):"-"}),e.jsx(z,{children:e.jsx(Z,{variant:l.isActive?"default":"secondary",children:l.isActive?"Active":"Inactive"})}),e.jsx(z,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(p,{size:"icon",variant:"ghost",onClick:()=>r(l),"data-testid":`button-edit-${l.id}`,children:e.jsx(El,{className:"h-4 w-4"})}),e.jsx(p,{size:"icon",variant:"ghost",onClick:()=>{confirm("Are you sure you want to delete this bundle?")&&f.mutate(l.id)},"data-testid":`button-delete-${l.id}`,children:e.jsx(Ws,{className:"h-4 w-4 text-destructive"})})]})})]},l.id)})})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:'No data bundles found. Click "Add Bundle" to create one.'})})]})})})]}),e.jsx(us,{open:!!n,onOpenChange:l=>!l&&r(null),children:e.jsxs(ss,{className:"bg-white dark:bg-gray-900 text-gray-900 dark:text-white",children:[e.jsx(ts,{children:e.jsx(as,{className:"text-gray-900 dark:text-white",children:"Edit Data Bundle"})}),n&&e.jsx(xr,{bundle:n,onSubmit:l=>u.mutate({id:n.id,data:l}),isLoading:u.isPending})]})})]})}function xr({bundle:s,onSubmit:t,isLoading:a}){const{user:i}=ve(),[n,r]=o.useState({name:(s==null?void 0:s.name)||"",network:(s==null?void 0:s.network)||"mtn",dataAmount:(s==null?void 0:s.dataAmount)||"",validity:(s==null?void 0:s.validity)||"",basePrice:(s==null?void 0:s.basePrice)||"",adminPrice:(s==null?void 0:s.adminPrice)||"",isActive:(s==null?void 0:s.isActive)??!0}),d=c=>{c.preventDefault();const x={...n,basePrice:n.basePrice===""?void 0:n.basePrice,adminPrice:n.adminPrice===""?void 0:n.adminPrice};t(x)};return e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",className:"text-gray-900 dark:text-white",children:"Name"}),e.jsx(Y,{id:"name",value:n.name,onChange:c=>r({...n,name:c.target.value}),placeholder:"e.g., MTN 1GB Daily",required:!0,"data-testid":"input-bundle-name",className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-white border-gray-300 dark:border-gray-600"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-gray-900 dark:text-white",children:"Network"}),e.jsxs(Fe,{value:n.network,onValueChange:c=>r({...n,network:c}),children:[e.jsx(Pe,{"data-testid":"select-bundle-network",children:e.jsx(Ie,{})}),e.jsx(Ce,{children:Ds.map(c=>e.jsx(K,{value:c.id,children:c.name},c.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"dataAmount",className:"text-gray-900 dark:text-white",children:"Data Amount"}),e.jsx(Y,{id:"dataAmount",value:n.dataAmount,onChange:c=>r({...n,dataAmount:c.target.value}),placeholder:"e.g., 1GB, 500MB",required:!0,"data-testid":"input-bundle-data",className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-white border-gray-300 dark:border-gray-600"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"validity",className:"text-gray-900 dark:text-white",children:"Validity"}),e.jsx(Y,{id:"validity",value:n.validity,onChange:c=>r({...n,validity:c.target.value}),placeholder:"e.g., 1 Day, 30 Days",required:!0,"data-testid":"input-bundle-validity",className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-white border-gray-300 dark:border-gray-600"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"basePrice",className:"text-gray-900 dark:text-white",children:"Base Price (GHS)"}),e.jsx(Y,{id:"basePrice",type:"number",step:"0.01",value:n.basePrice,onChange:c=>r({...n,basePrice:c.target.value}),placeholder:"0.00",required:!0,"data-testid":"input-bundle-price",className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-white border-gray-300 dark:border-gray-600"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"adminPrice",className:"text-gray-900 dark:text-white",children:"Admin Price (GHS)"}),e.jsx(Y,{id:"adminPrice",type:"number",step:"0.01",value:n.adminPrice,onChange:c=>r({...n,adminPrice:c.target.value}),placeholder:"0.00","data-testid":"input-bundle-admin-price",className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-white border-gray-300 dark:border-gray-600"})]})]}),(i==null?void 0:i.role)==="admin"&&e.jsx("div",{className:"p-4 bg-muted border border-border rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Vt,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-foreground",children:"Role-Based Pricing System"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:'Role-specific base prices are now managed separately. Use the "Role Base Prices" section in the admin panel to set minimum prices for each role (agent, dealer, super_dealer, master). Roles can then set their own profit margins above these base prices.'})]})]})}),n.network&&n.dataAmount&&n.validity&&n.basePrice&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg border",children:[e.jsx(V,{className:"text-sm font-medium mb-2 block",children:"Preview (How users will see this bundle)"}),e.jsxs("div",{className:"text-sm font-medium",children:[n.network.toUpperCase()," ",n.dataAmount," - ",n.validity," - GHâ‚µ",n.basePrice]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Mt,{id:"isActive",checked:n.isActive,onCheckedChange:c=>r({...n,isActive:c}),"data-testid":"switch-bundle-active",className:"data-[state=checked]:bg-green-500 data-[state=unchecked]:bg-red-500 [&_[data-radix-switch-thumb]]:bg-white"}),e.jsx(V,{className:"text-gray-900 dark:text-white",children:"Active"})]}),e.jsx(p,{type:"submit",disabled:a,"data-testid":"button-submit-bundle",children:a?"Saving...":s?"Update Bundle":"Create Bundle"})]})]})}function hd(){const{toast:s}=fe(),[t,a]=o.useState(!1),[i,n]=o.useState(null),[r,d]=o.useState(!1),{data:c,isLoading:x}=ee({queryKey:["/api/admin/role-base-prices"]}),{data:m}=ee({queryKey:["/api/admin/data-bundles"]}),b=oe({mutationFn:l=>Q("POST","/api/admin/role-base-prices",l),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/role-base-prices"]}),a(!1),s({title:"Role base price set successfully"})},onError:l=>{s({title:"Failed to set role base price",description:l.message,variant:"destructive"})}}),g=oe({mutationFn:({bundleId:l,role:h,basePrice:y})=>Q("POST","/api/admin/role-base-prices",{bundleId:l,role:h,basePrice:y}),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/role-base-prices"]}),n(null),s({title:"Role base price updated successfully"})},onError:l=>{s({title:"Failed to update role base price",description:l.message,variant:"destructive"})}}),u=oe({mutationFn:({bundleId:l,role:h})=>Q("DELETE",`/api/admin/role-base-prices/${l}/${h}`),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/role-base-prices"]}),s({title:"Role base price deleted successfully"})},onError:l=>{s({title:"Failed to delete role base price",description:l.message,variant:"destructive"})}}),f=l=>{const h=m==null?void 0:m.find(y=>y.id===l);return h?`${h.network.toUpperCase()} ${h.dataAmount} - ${h.validity}`:l},N=l=>({agent:"Agent",dealer:"Dealer",super_dealer:"Super Dealer",master:"Master"})[l]||l;return e.jsxs("div",{className:"flex h-screen bg-background",children:[r&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>d(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>d(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>d(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Role Base Prices"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(us,{open:t,onOpenChange:a,children:[e.jsx(St,{asChild:!0,children:e.jsxs(p,{"data-testid":"button-create-price",children:[e.jsx(As,{className:"h-4 w-4 mr-2"}),"Set Base Price"]})}),e.jsxs(ss,{className:"bg-card text-card-foreground",style:{backgroundColor:"hsl(var(--card))",opacity:1},children:[e.jsx(ts,{children:e.jsx(as,{children:"Set Role Base Price"})}),e.jsx(hr,{onSubmit:l=>b.mutate(l),isLoading:b.isPending,bundles:m})]})]}),e.jsx(ke,{})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Rt,{className:"h-5 w-5"}),"Role Base Prices"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[(c==null?void 0:c.length)||0," prices configured"]})]}),e.jsx(D,{children:x?e.jsx(Ts,{rows:8}):c&&c.length>0?e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{children:"Data Bundle"}),e.jsx(U,{children:"Role"}),e.jsx(U,{children:"Base Price"}),e.jsx(U,{className:"text-right",children:"Actions"})]})}),e.jsx(ns,{children:c.map((l,h)=>e.jsxs(we,{children:[e.jsx(z,{className:"font-medium",children:f(l.bundleId)}),e.jsx(z,{children:N(l.role)}),e.jsx(z,{className:"font-medium tabular-nums",children:ie(l.basePrice)}),e.jsx(z,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(p,{size:"icon",variant:"ghost",onClick:()=>n(l),children:e.jsx(El,{className:"h-4 w-4"})}),e.jsx(p,{size:"icon",variant:"ghost",onClick:()=>{confirm("Are you sure you want to delete this base price?")&&u.mutate({bundleId:l.bundleId,role:l.role})},children:e.jsx(Ws,{className:"h-4 w-4 text-destructive"})})]})})]},`${l.bundleId}-${l.role}-${h}`))})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:'No role base prices configured. Click "Set Base Price" to create one.'})})]})})})]}),e.jsx(us,{open:!!i,onOpenChange:l=>!l&&n(null),children:e.jsxs(ss,{className:"bg-white dark:bg-gray-900 text-gray-900 dark:text-white",children:[e.jsx(ts,{children:e.jsx(as,{className:"text-gray-900 dark:text-white",children:"Edit Role Base Price"})}),i&&e.jsx(hr,{price:i,onSubmit:l=>g.mutate(l),isLoading:g.isPending,bundles:m})]})})]})}function hr({price:s,onSubmit:t,isLoading:a,bundles:i}){const[n,r]=o.useState({bundleId:(s==null?void 0:s.bundleId)||"",role:(s==null?void 0:s.role)||"agent",basePrice:(s==null?void 0:s.basePrice)||""}),d=c=>{c.preventDefault();const x=parseFloat(n.basePrice);isNaN(x)||x<0||t({bundleId:n.bundleId,role:n.role,basePrice:x.toFixed(2)})};return e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-gray-900 dark:text-white",children:"Data Bundle"}),e.jsxs(Fe,{value:n.bundleId,onValueChange:c=>r({...n,bundleId:c}),children:[e.jsx(Pe,{className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-white border-gray-300 dark:border-gray-600",children:e.jsx(Ie,{placeholder:"Select a data bundle"})}),e.jsx(Ce,{children:i==null?void 0:i.map(c=>e.jsxs(K,{value:c.id,children:[c.network.toUpperCase()," ",c.dataAmount," - ",c.validity]},c.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-gray-900 dark:text-white",children:"Role"}),e.jsxs(Fe,{value:n.role,onValueChange:c=>r({...n,role:c}),children:[e.jsx(Pe,{className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-white border-gray-300 dark:border-gray-600",children:e.jsx(Ie,{})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"agent",children:"Agent"}),e.jsx(K,{value:"dealer",children:"Dealer"}),e.jsx(K,{value:"super_dealer",children:"Super Dealer"}),e.jsx(K,{value:"master",children:"Master"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"basePrice",className:"text-gray-900 dark:text-white",children:"Base Price (GHS)"}),e.jsx(Y,{id:"basePrice",type:"number",step:"0.01",value:n.basePrice,onChange:c=>r({...n,basePrice:c.target.value}),placeholder:"0.00",required:!0,className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-white border-gray-300 dark:border-gray-600"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(p,{type:"submit",disabled:a,children:a?"Saving...":s?"Update Price":"Set Price"})})]})}function ud(){const{toast:s}=fe(),[t,a]=o.useState(!1),[i,n]=o.useState(!1),[r,d]=o.useState(null),[c,x]=o.useState("all"),[m,b]=o.useState("all"),[g,u]=o.useState(!1),{data:f,isLoading:N}=ee({queryKey:["/api/admin/result-checkers"],refetchInterval:6e4,refetchOnWindowFocus:!0}),{data:l}=ee({queryKey:["/api/admin/result-checkers/summary"],refetchInterval:6e4,refetchOnWindowFocus:!0}),h=oe({mutationFn:async v=>{var I;if(v.file){const A=new FormData;A.append("type",v.type),A.append("year",v.year.toString()),A.append("basePrice",v.basePrice),A.append("costPrice",v.costPrice),A.append("file",v.file);const{data:B}=await Fs.auth.getSession(),w=(I=B.session)==null?void 0:I.access_token,R={};w&&(R.Authorization=`Bearer ${w}`);const P=await fetch("/api/admin/result-checkers/bulk-upload",{method:"POST",body:A,credentials:"include",headers:R});if(!P.ok){const q=await P.json().catch(()=>({message:"Upload failed"}));throw new Error(q.message||"Upload failed")}return P.json()}else return await Q("POST","/api/admin/result-checkers/bulk",{type:v.type,year:v.year,basePrice:v.basePrice,costPrice:v.costPrice,checkers:v.checkers})},onSuccess:v=>{be.invalidateQueries({queryKey:["/api/admin/result-checkers"]}),be.invalidateQueries({queryKey:["/api/admin/result-checkers/summary"]}),a(!1),s({title:`${v.added} result checkers added successfully`})},onError:v=>{s({title:"Failed to add checkers",description:v.message,variant:"destructive"})}}),y=oe({mutationFn:async v=>await Q("PUT",`/api/admin/result-checkers/${v.id}`,v.updates),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/result-checkers"]}),be.invalidateQueries({queryKey:["/api/admin/result-checkers/summary"]}),n(!1),d(null),s({title:"Result checker updated successfully"})},onError:v=>{s({title:"Failed to update checker",description:v.message,variant:"destructive"})}}),M=oe({mutationFn:async v=>{await Q("DELETE",`/api/admin/result-checkers/${v}`)},onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/result-checkers"]}),be.invalidateQueries({queryKey:["/api/admin/result-checkers/summary"]}),s({title:"Result checker deleted successfully"})},onError:v=>{s({title:"Failed to delete checker",description:v.message,variant:"destructive"})}}),S=oe({mutationFn:async()=>{await Q("DELETE","/api/admin/result-checkers/sold")},onSuccess:v=>{be.invalidateQueries({queryKey:["/api/admin/result-checkers"]}),be.invalidateQueries({queryKey:["/api/admin/result-checkers/summary"]}),s({title:`${v.deleted||0} sold checkers deleted successfully`})},onError:v=>{s({title:"Failed to delete sold checkers",description:v.message,variant:"destructive"})}}),k=f==null?void 0:f.filter(v=>!(c!=="all"&&v.type!==c||m!=="all"&&v.year.toString()!==m)),C=new Date().getFullYear(),E=[C,C-1,C-2],se=(l==null?void 0:l.reduce((v,I)=>v+I.total,0))||0,H=(l==null?void 0:l.reduce((v,I)=>v+I.available,0))||0,W=(l==null?void 0:l.reduce((v,I)=>v+I.sold,0))||0,L=v=>{d(v),n(!0)},j=v=>{confirm("Are you sure you want to delete this result checker?")&&M.mutate(v)};return e.jsxs("div",{className:"flex h-screen bg-background",children:[g&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>u(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>u(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-2 h-12 border-b px-3 lg:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>u(!0),children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-sm lg:text-base font-semibold",children:"Result Checkers"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(us,{open:i,onOpenChange:n,children:e.jsxs(ss,{className:"max-w-lg",children:[e.jsx(ts,{children:e.jsx(as,{children:"Edit Result Checker"})}),r&&e.jsx(gd,{checker:r,onSubmit:v=>y.mutate({id:r.id,updates:v}),isLoading:y.isPending})]})}),e.jsx(ke,{})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(Ae,{title:"Total Stock",value:se,icon:Ee,description:"All result checkers"}),e.jsx(Ae,{title:"Available",value:H,icon:It,description:"Ready for sale"}),e.jsx(Ae,{title:"Sold",value:W,icon:ks,description:"Delivered to customers"})]}),e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsxs(us,{open:t,onOpenChange:a,children:[e.jsx(St,{asChild:!0,children:e.jsxs(p,{"data-testid":"button-bulk-add",size:"sm",className:"w-auto text-xs whitespace-nowrap",children:[e.jsx(As,{className:"h-3 w-3 mr-1"}),"Add"]})}),e.jsxs(ss,{className:"max-w-lg bg-card text-card-foreground",style:{backgroundColor:"hsl(var(--card))",opacity:1},children:[e.jsx(ts,{children:e.jsx(as,{children:"Bulk Add Result Checkers"})}),e.jsx(pd,{onSubmit:v=>h.mutate(v),isLoading:h.isPending})]})]}),e.jsxs(p,{variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white w-auto text-xs whitespace-nowrap",onClick:()=>{confirm(`Are you sure you want to delete all ${W} sold checkers? This action cannot be undone.`)&&S.mutate()},disabled:S.isPending||W===0,"data-testid":"button-delete-sold",children:["Delete (",W,")"]})]}),l&&l.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:l.map(v=>e.jsxs(F,{children:[e.jsx($,{className:"pb-2",children:e.jsxs(G,{className:"text-sm font-medium",children:[v.type.toUpperCase()," ",v.year]})}),e.jsxs(D,{children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("span",{className:"text-2xl font-bold",children:v.available}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["/ ",v.total," total"]})]}),e.jsx("div",{className:"mt-2 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all progress-bar-dynamic",style:{width:`${Math.min(v.available/v.total*100,100)}%`}})})]})]},`${v.type}-${v.year}`))}),e.jsxs(F,{className:"md:col-span-2 lg:col-span-3",children:[e.jsxs($,{className:"flex flex-row items-center justify-between gap-2 pb-3 md:pb-6",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(G,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(It,{className:"h-4 w-4 md:h-5 md:w-5"}),e.jsx("span",{className:"truncate",children:"Result Checker Inventory"})]}),e.jsx(te,{className:"text-sm md:text-base",children:"View and manage PIN/Serial inventory"})]}),e.jsxs("div",{className:"flex gap-1 md:gap-2 flex-shrink-0",children:[e.jsxs(Fe,{value:c,onValueChange:x,children:[e.jsx(Pe,{className:"w-24 md:w-32 text-xs md:text-sm","data-testid":"filter-type",children:e.jsx(Ie,{placeholder:"Type"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"all",children:"All Types"}),qa.map(v=>e.jsx(K,{value:v.id,children:v.name},v.id))]})]}),e.jsxs(Fe,{value:m,onValueChange:b,children:[e.jsx(Pe,{className:"w-20 md:w-32 text-xs md:text-sm","data-testid":"filter-year",children:e.jsx(Ie,{placeholder:"Year"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"all",children:"All Years"}),E.map(v=>e.jsx(K,{value:v.toString(),children:v},v))]})]})]})]}),e.jsxs(D,{className:"px-3 md:px-6",children:[N?e.jsx(Ts,{rows:5}):k&&k.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{className:"text-xs md:text-sm",children:"Type"}),e.jsx(U,{className:"text-xs md:text-sm",children:"Year"}),e.jsx(U,{className:"text-xs md:text-sm",children:"Serial"}),e.jsx(U,{className:"text-xs md:text-sm",children:"PIN"}),e.jsx(U,{className:"text-xs md:text-sm",children:"Price"}),e.jsx(U,{className:"text-xs md:text-sm",children:"Status"}),e.jsx(U,{className:"hidden md:table-cell text-xs md:text-sm",children:"Sold To"}),e.jsx(U,{className:"hidden lg:table-cell text-xs md:text-sm",children:"Date"}),e.jsx(U,{className:"text-xs md:text-sm",children:"Actions"})]})}),e.jsx(ns,{children:k.slice(0,20).map(v=>e.jsxs(we,{"data-testid":`row-checker-${v.id}`,children:[e.jsx(z,{className:"text-xs md:text-sm",children:e.jsx(Z,{variant:"outline",className:"text-xs",children:v.type.toUpperCase()})}),e.jsx(z,{className:"font-medium text-xs md:text-sm",children:v.year}),e.jsx(z,{className:"font-mono text-xs md:text-sm",children:v.serialNumber}),e.jsx(z,{className:"font-mono text-xs md:text-sm",children:v.isSold?v.pin:"****"}),e.jsx(z,{className:"tabular-nums text-xs md:text-sm",children:ie(v.basePrice)}),e.jsx(z,{children:e.jsx(Z,{variant:v.isSold?"secondary":"default",className:"text-xs",children:v.isSold?"Sold":"Available"})}),e.jsx(z,{className:"hidden md:table-cell text-muted-foreground text-xs md:text-sm",children:v.soldToPhone||"-"}),e.jsx(z,{className:"hidden lg:table-cell text-muted-foreground text-xs",children:v.soldAt?Ze(v.soldAt):Ze(v.createdAt)}),e.jsx(z,{children:e.jsxs("div",{className:"flex gap-1 md:gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>L(v),disabled:v.isSold,className:"text-xs px-2 py-1 h-7",children:"Edit"}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>j(v.id),className:"text-destructive hover:text-destructive text-xs px-2 py-1 h-7",children:"Delete"})]})})]},v.id))})]})}):e.jsx("div",{className:"text-center py-6 md:py-12 text-muted-foreground text-sm md:text-base",children:'No result checkers found. Use "Bulk Add" to add inventory.'}),k&&k.length>20&&e.jsxs("div",{className:"text-center py-2 md:py-4 text-xs md:text-sm text-muted-foreground",children:["Showing 20 of ",k.length," items"]})]})]})]})})]})]})}function pd({onSubmit:s,isLoading:t}){const a=new Date().getFullYear(),[i,n]=o.useState({type:"bece",year:a.toString(),basePrice:"",costPrice:"",checkers:""}),[r,d]=o.useState(null),c=m=>{m.preventDefault(),s({...i,year:parseInt(i.year),file:r||void 0})},x=m=>{var g;const b=(g=m.target.files)==null?void 0:g[0];b&&(d(b),n({...i,checkers:""}))};return e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Type"}),e.jsxs(Fe,{value:i.type,onValueChange:m=>n({...i,type:m}),children:[e.jsx(Pe,{"data-testid":"select-checker-type",children:e.jsx(Ie,{})}),e.jsx(Ce,{children:qa.map(m=>e.jsx(K,{value:m.id,children:m.name},m.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Year"}),e.jsxs(Fe,{value:i.year,onValueChange:m=>n({...i,year:m}),children:[e.jsx(Pe,{"data-testid":"select-checker-year",children:e.jsx(Ie,{})}),e.jsx(Ce,{children:[a,a+1,a-1].map(m=>e.jsx(K,{value:m.toString(),children:m},m))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"costPrice",children:"Cost Price (GHS)"}),e.jsx(Y,{id:"costPrice",type:"number",step:"0.01",value:i.costPrice,onChange:m=>n({...i,costPrice:m.target.value}),placeholder:"0.00",required:!0,"data-testid":"input-checker-cost"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"basePrice",children:"Selling Price (GHS)"}),e.jsx(Y,{id:"basePrice",type:"number",step:"0.01",value:i.basePrice,onChange:m=>n({...i,basePrice:m.target.value}),placeholder:"0.00",required:!0,"data-testid":"input-checker-price"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"checkers",children:"PIN/Serial Pairs"}),e.jsx(Ls,{id:"checkers",value:i.checkers,onChange:m=>n({...i,checkers:m.target.value}),placeholder:`Enter one per line in format: SERIAL,PIN
e.g.,
ABC123456,1234567890
DEF789012,0987654321`,rows:8,required:!r,disabled:!!r,"data-testid":"input-checker-pairs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Format: SERIAL,PIN (one per line) - OR upload a CSV file below"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"file",children:"Upload CSV File (Optional)"}),e.jsx(Y,{id:"file",type:"file",accept:".csv",onChange:x,"data-testid":"input-checker-file"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"CSV format: SERIAL,PIN (one pair per line, no headers)"}),r&&e.jsxs("p",{className:"text-sm text-primary",children:["File selected: ",r.name]})]}),e.jsx(p,{type:"submit",className:"w-full",disabled:t,"data-testid":"button-submit-checkers",children:t?"Adding...":"Add Result Checkers"})]})}function gd({checker:s,onSubmit:t,isLoading:a}){const[i,n]=o.useState({type:s.type,year:s.year.toString(),serialNumber:s.serialNumber,pin:s.pin,basePrice:s.basePrice}),r=x=>{x.preventDefault(),t({type:i.type,year:parseInt(i.year),serialNumber:i.serialNumber,pin:i.pin,basePrice:i.basePrice})},d=new Date().getFullYear(),c=[d,d-1,d-2];return e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{children:"Type"}),e.jsxs(Fe,{value:i.type,onValueChange:x=>n({...i,type:x}),children:[e.jsx(Pe,{children:e.jsx(Ie,{})}),e.jsx(Ce,{children:qa.map(x=>e.jsx(K,{value:x.id,children:x.name},x.id))})]})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Year"}),e.jsxs(Fe,{value:i.year,onValueChange:x=>n({...i,year:x}),children:[e.jsx(Pe,{children:e.jsx(Ie,{})}),e.jsx(Ce,{children:c.map(x=>e.jsx(K,{value:x.toString(),children:x},x))})]})]})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"edit-serial",children:"Serial Number"}),e.jsx(Y,{id:"edit-serial",value:i.serialNumber,onChange:x=>n({...i,serialNumber:x.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"edit-pin",children:"PIN"}),e.jsx(Y,{id:"edit-pin",value:i.pin,onChange:x=>n({...i,pin:x.target.value}),required:!0})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(V,{htmlFor:"edit-base-price",children:"Base Price"}),e.jsx(Y,{id:"edit-base-price",type:"number",step:"0.01",value:i.basePrice,onChange:x=>n({...i,basePrice:x.target.value}),required:!0})]})}),e.jsx(p,{type:"submit",className:"w-full",disabled:a,children:a?"Updating...":"Update Result Checker"})]})}const Gt=s=>{const t=s.toLowerCase();return t==="success"||t==="delivered"?"completed":t==="failed"||t==="cancelled"?"failed":t==="pending"||t==="processing"?"processing":t},At=s=>{var t,a;try{if(!s.apiResponse)return null;const i=JSON.parse(s.apiResponse);return(t=i.skytechStatus)!=null&&t.status?i.skytechStatus.status:i.results&&((a=i.results[0])!=null&&a.status)?i.results[0].status:null}catch{return null}};function oa({field:s,children:t,sortField:a,sortDirection:i,onSort:n}){return e.jsx(U,{className:"cursor-pointer select-none hover:bg-muted/50 transition-colors",onClick:()=>n(s),children:e.jsxs("div",{className:"flex items-center gap-1",children:[t,a===s&&(i==="asc"?e.jsx(ll,{className:"h-4 w-4"}):e.jsx(_a,{className:"h-4 w-4"}))]})})}function jd(){var Ja;const{toast:s}=fe(),t=Hs(),[a,i]=o.useState("all"),[n,r]=o.useState("all"),[d,c]=o.useState(""),[x,m]=o.useState(!1),[b,g]=o.useState(null),[u,f]=o.useState(""),[N,l]=o.useState("all"),[h,y]=o.useState("processing"),[M,S]=o.useState("createdAt"),[k,C]=o.useState("desc"),[E,se]=o.useState(new Set),[H,W]=o.useState({}),[L,j]=o.useState(1),v=50,{data:I,isLoading:A,refetch:B}=ee({queryKey:["/api/admin/transactions"],refetchInterval:45e3,refetchOnWindowFocus:!0,staleTime:3e4}),w=oe({mutationFn:async({transactionId:O,deliveryStatus:ne})=>Q("PATCH",`/api/admin/transactions/${O}/delivery-status`,{deliveryStatus:ne}),onSuccess:()=>{t.invalidateQueries({queryKey:["/api/admin/transactions"]}),s({title:"Delivery status updated successfully"}),g(null),f("")},onError:O=>{s({title:"Failed to update delivery status",description:(O==null?void 0:O.message)||"Unknown error",variant:"destructive"})}}),R=oe({mutationFn:async O=>Q("POST",`/api/admin/refresh-order-status/${O}`,{}),onSuccess:O=>{B(),s({title:"âœ… Order status updated",description:O.message})},onError:O=>{s({title:"Failed to refresh order status",description:(O==null?void 0:O.message)||"Unknown error",variant:"destructive"})}}),P=oe({mutationFn:async({transactionId:O,paymentStatus:ne,reason:le})=>Q("PATCH",`/api/admin/transactions/${O}/payment-status`,{paymentStatus:ne,reason:le}),onSuccess:()=>{t.invalidateQueries({queryKey:["/api/admin/transactions"]}),s({title:"Payment status updated successfully"})},onError:O=>{s({title:"Failed to update payment status",description:(O==null?void 0:O.message)||"Unknown error",variant:"destructive"})}}),q=O=>{confirm("Are you sure you want to mark this payment as cancelled? This will also update the order status to failed.")&&P.mutate({transactionId:O,paymentStatus:"cancelled",reason:"Payment cancelled - customer abandoned checkout"})},T=async O=>{const ne=new Set(E);if(ne.has(O))ne.delete(O);else if(ne.add(O),!H[O])try{const le=await Q("GET",`/api/admin/result-checker/${O}`);W(de=>({...de,[O]:le}))}catch(le){s({title:"Failed to fetch result checker details",description:(le==null?void 0:le.message)||"Unknown error",variant:"destructive"});return}se(ne)},J=oe({mutationFn:async()=>{const O=new URLSearchParams;return N!=="all"&&O.append("paymentStatus",N),await Q("GET",`/api/admin/transactions/export?${O.toString()}`)},onSuccess:O=>{if(O&&Array.isArray(O)){const ne=Ha(O);Va(ne,`transactions-${N==="all"?"all":N}-${new Date().toISOString().split("T")[0]}.csv`),s({title:"Transactions exported successfully"})}},onError:O=>{s({title:"Failed to export transactions",description:(O==null?void 0:O.message)||"Unknown error",variant:"destructive"})}}),ce=I==null?void 0:I.filter(O=>{const ne=At(O),le=ne?Gt(ne):O.status;if(a!=="all"&&le!==a||n!=="all"&&O.type!==n)return!1;if(d){const de=d.toLowerCase().replace(/^#/,""),Be=de.match(/^(\d+)-(\d+)$/);if(Be){const[,cs,$s]=Be;if(O.reference===cs&&O.isBulkOrder)return!0}const Oe=O.id.toLowerCase().includes(de)||O.reference&&O.reference.toLowerCase().includes(de)||O.paymentReference&&O.paymentReference.toLowerCase().includes(de),Xe=!!O.customerPhone&&O.customerPhone.includes(de),Re=(()=>{const cs=O.phoneNumbers;if(!cs)return!1;const $s=typeof cs=="string"?(()=>{try{return JSON.parse(cs)}catch{return[]}})():cs;return Array.isArray($s)?$s.some(Xs=>{const Zt=typeof Xs=="string"?Xs:Xs==null?void 0:Xs.phone;return typeof Zt=="string"&&Zt.includes(de)}):!1})();if(!Oe&&!O.productName.toLowerCase().includes(de)&&!Xe&&!Re)return!1}return!0}),ge={total:(I==null?void 0:I.length)||0,completed:(I==null?void 0:I.filter(O=>{const ne=At(O);return(ne?Gt(ne):O.status)==="completed"}).length)||0,processing:(I==null?void 0:I.filter(O=>{const ne=At(O);return(ne?Gt(ne):O.status)==="processing"}).length)||0,failed:(I==null?void 0:I.filter(O=>{const ne=At(O);return(ne?Gt(ne):O.status)==="failed"}).length)||0},Ve=O=>{M===O?C(k==="asc"?"desc":"asc"):(S(O),C("asc"))},is=ce==null?void 0:ce.sort((O,ne)=>{let le=O[M],de=ne[M];return M==="amount"||M==="profit"?(le=parseFloat(le),de=parseFloat(de)):M==="createdAt"?(le=new Date(le).getTime(),de=new Date(de).getTime()):(M==="productName"||M==="customerPhone")&&(le=le.toLowerCase(),de=de.toLowerCase()),le<de?k==="asc"?-1:1:le>de?k==="asc"?1:-1:0}),Ct=Math.ceil(((is==null?void 0:is.length)||0)/v),ka=is==null?void 0:is.slice((L-1)*v,L*v),Sa=(Ja=ka==null?void 0:ka.flatMap(O=>{const ne=O.isBulkOrder,le=O.phoneNumbers,de=le?typeof le=="string"?(()=>{try{return JSON.parse(le)}catch{return[]}})():le:void 0;if(ne&&de&&de.length>0){const Be=parseFloat(O.amount)/de.length,Oe=parseFloat(O.profit||"0")/de.length;return de.map((Xe,Re)=>({...O,id:`${O.id}-${Re}`,originalId:O.id,customerPhone:Xe.phone,productName:Xe.bundleName||O.productName,amount:Xe.price?Xe.price.toFixed(2):Be.toFixed(2),profit:Xe.profit?Xe.profit.toFixed(2):Oe.toFixed(2),isExpandedBulkItem:!0,bulkOrderIndex:Re+1,bulkOrderTotal:de.length,dataAmount:Xe.dataAmount}))}return[{...O,originalId:O.id}]}))==null?void 0:Ja.filter(O=>{if(d){const le=d.toLowerCase().replace(/^#/,"").match(/^(\d+)-(\d+)$/);if(le){const[,de,Be]=le;return O.reference===de&&O.isExpandedBulkItem?O.bulkOrderIndex===parseInt(Be):!1}}return!0}),Ha=(O,ne=!0)=>{if(O.length===0)return"";const le=Object.keys(O[0]),de=[];ne&&de.push(le.join(","));for(const Be of O){const Oe=le.map(Xe=>{const Re=Be[Xe];if(Array.isArray(Re))return`"${Re.map($s=>typeof $s=="object"?JSON.stringify($s):$s).join("; ")}"`;if(typeof Re=="object"&&Re!==null)return`"${JSON.stringify(Re)}"`;const cs=String(Re||"");return cs.includes(",")||cs.includes('"')?`"${cs.replace(/"/g,'""')}"`:cs});de.push(Oe.join(","))}return de.join(`
`)},Va=(O,ne)=>{const le=new Blob([O],{type:"text/csv;charset=utf-8;"}),de=document.createElement("a"),Be=URL.createObjectURL(le);de.setAttribute("href",Be),de.setAttribute("download",ne),de.style.visibility="hidden",document.body.appendChild(de),de.click(),document.body.removeChild(de)},hn=O=>{var ne;return O?((ne=Ds.find(le=>le.id===O))==null?void 0:ne.name)||O.toUpperCase():"Unknown"},Ya=O=>{if(!O)return"";let le=O.replace(/\s+/g,"");return le.startsWith("+233")?le=`0${le.slice(4)}`:le.startsWith("233")?le=`0${le.slice(3)}`:/^\d{9}$/.test(le)&&!le.startsWith("0")&&(le=`0${le}`),`="${le}"`},Xa=O=>{var Be;if(!O)return"";const ne=O.match(/(\d+(?:\.\d+)?)\s*(GB|MB)?/i);if(!ne)return O;const le=ne[1];if(((Be=ne[2])==null?void 0:Be.toUpperCase())==="MB"){const Oe=parseFloat(le);if(!Number.isNaN(Oe))return(Oe/1024).toFixed(Oe%1024===0?0:2)}return le},un=()=>{const O=[],ne=de=>{const Be=At(de),Oe=Be?Gt(Be):de.status;return h==="processing"?Oe==="processing":h==="failed"?Oe==="failed":h==="pending_paid"?(Oe==="pending"||Oe==="confirmed")&&String(de.paymentStatus||"").toLowerCase()==="paid":!1};return(I||[]).filter(de=>de.type==="data_bundle").filter(ne).forEach(de=>{const Be=hn(de.network),Oe=de.phoneNumbers,Xe=Oe?typeof Oe=="string"?(()=>{try{return JSON.parse(Oe)}catch{return[]}})():Oe:void 0;if(Array.isArray(Xe)&&Xe.length>0){Xe.forEach(Re=>{const cs=typeof Re=="string"?Re:Re==null?void 0:Re.phone,$s=typeof Re=="string"?"":Re==null?void 0:Re.dataAmount;if(!cs)return;const Xs=Xa($s||de.productName);O.push({beneficiary:Ya(cs),product:`${Be} ${Xs}`.trim()})});return}if(de.customerPhone){const Re=Xa(de.productName);O.push({beneficiary:Ya(de.customerPhone),product:`${Be} ${Re}`.trim()})}}),O},pn=()=>{const O=un();if(O.length===0){s({title:"No matching orders",description:"No beneficiaries found for the selected export filter."});return}const ne=Ha(O,!1),le=h.replace(/_/g,"-");Va(ne,`beneficiaries-${le}-${new Date().toISOString().split("T")[0]}.csv`)},Qa=(O,ne)=>{g(O),f(ne)},gn=O=>{u&&w.mutate({transactionId:O,deliveryStatus:u})},jn=()=>{g(null),f("")};return e.jsxs("div",{className:"flex h-screen bg-background",children:[x&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>m(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>m(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>m(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Transactions"})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4",children:[e.jsx(F,{className:"text-sm md:text-base",children:e.jsxs(D,{className:"pt-4 md:pt-6",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold",children:ge.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Transactions"})]})}),e.jsx(F,{className:"text-sm md:text-base",children:e.jsxs(D,{className:"pt-4 md:pt-6",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold text-green-600",children:ge.completed}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Completed"})]})}),e.jsx(F,{className:"text-sm md:text-base",children:e.jsxs(D,{className:"pt-4 md:pt-6",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold text-orange-600",children:ge.pending}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pending"})]})}),e.jsx(F,{className:"text-sm md:text-base",children:e.jsxs(D,{className:"pt-4 md:pt-6",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold text-red-600",children:ge.failed}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Failed"})]})})]}),e.jsxs(F,{className:"md:col-span-2 lg:col-span-3",children:[e.jsxs($,{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-3 pb-3 md:pb-6",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(G,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(Zs,{className:"h-4 w-4 md:h-5 md:w-5"}),e.jsx("span",{className:"truncate",children:"All Transactions"})]}),e.jsx(te,{className:"text-sm md:text-base",children:"View and track all customer orders"})]}),e.jsxs("div",{className:"flex flex-col gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(Fe,{value:N,onValueChange:l,children:[e.jsx(Pe,{className:"w-full sm:w-36 md:w-40 text-xs md:text-sm","data-testid":"export-payment-status",children:e.jsx(Ie,{placeholder:"Export Filter"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"all",children:"All Payments"}),e.jsx(K,{value:"paid",children:"Paid Only"}),e.jsx(K,{value:"processing",children:"Processing Only"})]})]}),e.jsxs(p,{onClick:()=>J.mutate(),disabled:J.isPending,variant:"outline",size:"sm",className:"gap-2 text-xs px-2 py-1 h-8",children:[e.jsx(ga,{className:"h-3 w-3 md:h-4 md:w-4"}),J.isPending?"Exporting...":"Export CSV"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(Fe,{value:h,onValueChange:y,children:[e.jsx(Pe,{className:"w-full sm:w-44 md:w-52 text-xs md:text-sm","data-testid":"export-beneficiaries-filter",children:e.jsx(Ie,{placeholder:"Export Beneficiaries"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"processing",children:"Processing Orders"}),e.jsx(K,{value:"failed",children:"Failed Orders"}),e.jsx(K,{value:"pending_paid",children:"Pending (Paid)"})]})]}),e.jsxs(p,{onClick:pn,variant:"outline",size:"sm",className:"gap-2 text-xs px-2 py-1 h-8",children:[e.jsx(ga,{className:"h-3 w-3 md:h-4 md:w-4"}),"Export Beneficiaries"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 sm:flex-initial",children:[e.jsx(Lt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(Y,{placeholder:"Search order ID or phone number...",value:d,onChange:O=>c(O.target.value),className:"pl-9 w-full sm:w-56 text-sm","data-testid":"input-search"})]}),e.jsxs(Fe,{value:a,onValueChange:i,children:[e.jsx(Pe,{className:"w-full sm:w-32 text-xs md:text-sm","data-testid":"filter-status",children:e.jsx(Ie,{placeholder:"Status"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"all",children:"All Status"}),e.jsx(K,{value:"completed",children:"Completed"}),e.jsx(K,{value:"processing",children:"Processing"}),e.jsx(K,{value:"failed",children:"Failed"}),e.jsx(K,{value:"refunded",children:"Refunded"})]})]}),e.jsxs(Fe,{value:n,onValueChange:r,children:[e.jsx(Pe,{className:"w-full sm:w-36 md:w-40 text-xs md:text-sm","data-testid":"filter-type",children:e.jsx(Ie,{placeholder:"Type"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"all",children:"All Types"}),e.jsx(K,{value:"data_bundle",children:"Data Bundles"}),e.jsx(K,{value:"result_checker",children:"Result Checkers"})]})]})]})]})]}),e.jsx(D,{className:"px-3 md:px-6",children:A?e.jsx(Ts,{rows:5}):is&&is.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{className:"text-xs md:text-sm",children:"Order ID"}),e.jsx(oa,{field:"productName",sortField:M,sortDirection:k,onSort:Ve,children:e.jsx("span",{className:"text-xs md:text-sm",children:"Product"})}),e.jsx(U,{className:"hidden sm:table-cell text-xs md:text-sm",children:"Network"}),e.jsx(oa,{field:"amount",sortField:M,sortDirection:k,onSort:Ve,children:e.jsx("span",{className:"text-xs md:text-sm",children:"Amount"})}),e.jsx(oa,{field:"profit",sortField:M,sortDirection:k,onSort:Ve,children:e.jsx("span",{className:"text-xs md:text-sm",children:"Profit"})}),e.jsx(U,{className:"text-xs md:text-sm",children:"Customer"}),e.jsx(U,{className:"text-xs md:text-sm",children:"Payment"}),e.jsx(U,{className:"text-xs md:text-sm",children:"Status"}),e.jsx(U,{className:"hidden md:table-cell text-xs md:text-sm",children:"Delivery"}),e.jsx(oa,{field:"createdAt",sortField:M,sortDirection:k,onSort:Ve,children:e.jsx("span",{className:"text-xs md:text-sm",children:"Date"})}),e.jsx(U,{className:"text-xs md:text-sm",children:"Actions"})]})}),e.jsx(ns,{children:Sa==null?void 0:Sa.map(O=>{var $s,Xs,Zt;let ne=Ds.find(Qe=>Qe.id===O.network);const le=At(O),de=le?Gt(le):O.status,Be=O.deliveryStatus||"pending";if(!ne&&O.isExpandedBulkItem){const Qe=O.productName;if(Qe){const ct=Qe.toLowerCase();ct.includes("mtn")?ne=Ds.find(Ns=>Ns.id==="mtn"):ct.includes("telecel")?ne=Ds.find(Ns=>Ns.id==="telecel"):ct.includes("bigtime")?ne=Ds.find(Ns=>Ns.id==="at_bigtime"):ct.includes("ishare")&&(ne=Ds.find(Ns=>Ns.id==="at_ishare"))}}const Oe=O.type==="result_checker",Xe=E.has(O.originalId),Re=H[O.originalId],cs=O.quantity||1;return e.jsxs(o.Fragment,{children:[e.jsxs(we,{"data-testid":`row-transaction-${O.id}`,children:[e.jsxs(z,{className:"font-mono text-xs md:text-sm",children:["#",O.reference]}),e.jsxs(z,{className:"max-w-[150px] md:max-w-[200px]",children:[e.jsx("div",{className:"font-medium truncate text-xs md:text-sm",children:O.productName}),e.jsxs("div",{className:"flex gap-1 mt-1 flex-wrap",children:[e.jsx(Z,{variant:"outline",className:"text-xs px-1 py-0",children:O.type==="data_bundle"?"Data":"Result"}),O.isExpandedBulkItem&&e.jsxs(Z,{variant:"secondary",className:"text-xs px-1 py-0 flex items-center gap-1 bg-purple-100 text-purple-700",children:[e.jsx(Et,{className:"h-2.5 w-2.5"}),O.bulkOrderIndex," of ",O.bulkOrderTotal]}),Oe&&cs>1&&e.jsxs(Z,{variant:"secondary",className:"text-xs px-1 py-0 flex items-center gap-1",children:[e.jsx(Et,{className:"h-2.5 w-2.5"}),cs]})]})]}),e.jsx(z,{className:"hidden sm:table-cell",children:ne?e.jsx(Z,{style:{backgroundColor:ne.color,color:ne.textColor},className:"text-xs px-1 py-0",children:ne.name}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(z,{className:"font-medium tabular-nums text-xs md:text-sm",children:e.jsx("div",{children:ie(O.amount)})}),e.jsx(z,{className:"text-green-600 tabular-nums text-xs md:text-sm",children:ie(O.profit)}),e.jsxs(z,{className:"text-muted-foreground text-xs md:text-sm",children:[e.jsx("div",{className:"truncate max-w-[80px] md:max-w-[120px]",children:O.customerPhone}),O.isExpandedBulkItem&&O.dataAmount&&e.jsx("div",{className:"text-xs text-muted-foreground",children:O.dataAmount})]}),e.jsx(z,{children:e.jsx(Z,{variant:O.paymentStatus==="paid"?"default":O.paymentStatus==="failed"?"destructive":O.paymentStatus==="cancelled"?"outline":"secondary",className:"text-xs",children:O.paymentStatus||"pending"})}),e.jsx(z,{children:e.jsx(Ka,{status:de})}),e.jsx(z,{className:"hidden md:table-cell",children:b===O.originalId?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Fe,{value:u,onValueChange:f,children:[e.jsx(Pe,{className:"w-24 md:w-32 h-7 md:h-8 text-xs",children:e.jsx(Ie,{})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"processing",children:"Processing"}),e.jsx(K,{value:"delivered",children:"Delivered"}),e.jsx(K,{value:"failed",children:"Failed"})]})]}),e.jsx(p,{size:"sm",onClick:()=>gn(O.originalId),disabled:w.isPending,className:"h-7 px-2 text-xs",children:w.isPending?"...":"Save"}),e.jsx(p,{size:"sm",variant:"outline",onClick:jn,className:"h-7 px-2 text-xs",children:"Cancel"})]}):e.jsx("div",{className:"flex flex-col gap-1",children:(()=>{const Qe=At(O),ct=Qe||Be;let Ns="outline",ca=!1;if(Qe){const Nt=Qe.toLowerCase();Nt==="completed"||Nt==="delivered"||Nt==="success"?Ns="default":Nt==="processing"||Nt==="pending"||Nt==="queued"?(Ns="secondary",ca=!0):(Nt==="failed"||Nt==="error")&&(Ns="destructive")}else Be==="delivered"?Ns="default":Be==="processing"?(Ns="secondary",ca=!0):Be==="failed"&&(Ns="destructive");return e.jsxs(e.Fragment,{children:[e.jsx(Z,{variant:Ns,className:`cursor-pointer text-xs ${ca?"bg-blue-500 text-white hover:bg-blue-600 animate-pulse":""}`,onClick:()=>Qa(O.originalId,Be),title:Qe?`SkyTech: ${Qe} | Internal: ${Be}`:`Click to change delivery status (Current: ${Be})`,children:ca?"ðŸ”„ Processing":ct.charAt(0).toUpperCase()+ct.slice(1)}),Qe&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"From SkyTech"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:Ze(O.createdAt)})]})})()})}),e.jsx(z,{className:"text-muted-foreground text-xs md:text-sm",children:Ze(O.createdAt)}),e.jsx(z,{children:e.jsxs("div",{className:"flex gap-1",children:[Oe&&cs>1&&e.jsx(p,{size:"sm",variant:"ghost",onClick:()=>T(O.originalId),className:"h-6 w-6 p-0",title:Xe?"Collapse PINs":"View all PINs",children:e.jsx(pa,{className:`h-4 w-4 transition-transform ${Xe?"rotate-90":""}`})}),O.type==="data_bundle"&&(O.status==="pending"||O.status==="confirmed")&&e.jsx(p,{size:"sm",variant:"ghost",onClick:()=>R.mutate(O.originalId),disabled:R.isPending,className:"h-6 w-6 p-0",title:"Refresh SkyTech status",children:e.jsx(Qr,{className:`h-3 w-3 ${R.isPending?"animate-spin":""}`})}),(O.paymentStatus==="pending"||!O.paymentStatus)&&e.jsx(p,{size:"sm",variant:"ghost",onClick:()=>q(O.originalId),disabled:P.isPending,className:"h-6 w-6 p-0 text-red-500 hover:text-red-700 hover:bg-red-100",title:"Mark payment as cancelled",children:e.jsx(ds,{className:"h-3 w-3"})}),e.jsx(p,{size:"sm",variant:"ghost",onClick:()=>Qa(O.originalId,Be),disabled:b===O.originalId,className:"h-6 w-6 p-0",children:e.jsx(za,{className:"h-3 w-3"})})]})})]}),Oe&&Xe&&Re&&e.jsx(we,{children:e.jsx(z,{colSpan:11,className:"bg-muted/30 p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-semibold",children:["Result Checker PINs (",(($s=Re.checkers)==null?void 0:$s.length)||0,")"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Customer: ",((Xs=Re.transaction)==null?void 0:Xs.customerPhone)||"N/A"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:(Zt=Re.checkers)==null?void 0:Zt.map((Qe,ct)=>e.jsxs("div",{className:"p-3 rounded-lg border bg-card text-card-foreground",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(Z,{variant:"outline",className:"text-xs",children:["PIN #",ct+1]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[Qe.type.toUpperCase()," ",Qe.year]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Serial Number:"}),e.jsx("span",{className:"font-mono text-sm font-medium",children:Qe.serialNumber})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"PIN:"}),e.jsx("span",{className:"font-mono text-sm font-medium",children:Qe.pin})]}),Qe.soldAt&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["Sold: ",Ze(Qe.soldAt)]})]})]},Qe.id))})]})})},`${O.originalId}-expanded-details`)]},O.id)})})]})}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"text-xs text-muted-foreground leading-5 sm:text-sm sm:text-left text-center",children:["Showing ",Math.min((L-1)*v+1,(is==null?void 0:is.length)||0)," to ",Math.min(L*v,(is==null?void 0:is.length)||0)," of ",(is==null?void 0:is.length)||0," transactions"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-start sm:justify-end",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>j(O=>Math.max(1,O-1)),disabled:L===1,className:"gap-1",children:[e.jsx(Xr,{className:"h-4 w-4"}),"Previous"]}),e.jsx("div",{className:"flex flex-wrap items-center gap-1",children:e.jsx(e.Fragment,{children:(()=>{let ne=Math.max(1,L-Math.floor(2.5)),le=Math.min(Ct,ne+5-1);return le-ne+1<5&&(ne=Math.max(1,le-5+1)),e.jsxs(e.Fragment,{children:[ne>1&&e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>j(1),className:"h-8 w-8 p-0",children:"1"},"first"),ne>2&&e.jsx("span",{className:"px-1",children:"..."},"ellipsis-start")]}),Array.from({length:le-ne+1},(de,Be)=>{const Oe=ne+Be;return e.jsx(p,{variant:L===Oe?"default":"outline",size:"sm",onClick:()=>j(Oe),className:"h-8 w-8 p-0",children:Oe},`page-${Oe}`)}),le<Ct&&e.jsxs(e.Fragment,{children:[le<Ct-1&&e.jsx("span",{className:"px-1",children:"..."},"ellipsis-end"),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>j(Ct),className:"h-8 w-8 p-0",children:Ct},"last")]})]})})()})}),e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>j(O=>Math.min(Ct,O+1)),disabled:L===Ct,className:"gap-1",children:["Next",e.jsx(pa,{className:"h-4 w-4"})]})]})]})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No transactions found matching your criteria."})})]})]})})]})]})}function fd(){const{toast:s}=fe(),[t,a]=o.useState("all"),[i,n]=o.useState(""),[r,d]=o.useState(!1),[c,x]=o.useState(null),[m,b]=o.useState(null),[g,u]=o.useState(!1),[f,N]=o.useState({}),[l,h]=o.useState("phone"),{data:y,isLoading:M}=ee({queryKey:["/api/admin/users"],refetchInterval:3e4,refetchOnWindowFocus:!0}),S=oe({mutationFn:j=>Q("DELETE",`/api/admin/users/${j}`,{}),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/users"]}),be.invalidateQueries({queryKey:["/api/admin/stats"]}),s({title:"âœ… User deleted successfully"}),x(null)},onError:j=>{s({title:"Failed to delete user",description:j.message,variant:"destructive"})}}),k=oe({mutationFn:j=>Q("DELETE",`/api/admin/users/delete-inactive?days=${j}`,{}),onSuccess:j=>{be.invalidateQueries({queryKey:["/api/admin/users"]}),be.invalidateQueries({queryKey:["/api/admin/stats"]}),s({title:`âœ… Deleted ${j.deletedCount} inactive users`,description:j.errors?`Errors: ${j.errors.join(", ")}`:void 0}),b(null)},onError:j=>{s({title:"Failed to delete inactive users",description:j.message,variant:"destructive"})}}),C=oe({mutationFn:({id:j,role:v})=>Q("PATCH",`/api/admin/users/${j}/role`,{role:v}),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/users"]}),s({title:"âœ… User role updated successfully"})},onError:j=>{s({title:"Failed to update user role",description:j.message,variant:"destructive"})}}),E=y==null?void 0:y.filter(j=>{const v=t==="all"||t==="guest"&&j.role==="guest"||t==="user"&&j.role==="user"||t==="agent"&&j.role==="agent"||t==="dealer"&&j.role==="dealer"||t==="super_dealer"&&j.role==="super_dealer"||t==="master"&&j.role==="master"||t==="admin"&&j.role==="admin",I=!i||j.name.toLowerCase().includes(i.toLowerCase())||j.email.toLowerCase().includes(i.toLowerCase())||j.phone&&j.phone.includes(i);return v&&I}),se={total:(y==null?void 0:y.length)||0,guests:(y==null?void 0:y.filter(j=>j.role==="guest").length)||0,users:(y==null?void 0:y.filter(j=>j.role==="user").length)||0,agents:(y==null?void 0:y.filter(j=>j.role==="agent").length)||0,dealers:(y==null?void 0:y.filter(j=>j.role==="dealer").length)||0,superDealers:(y==null?void 0:y.filter(j=>j.role==="super_dealer").length)||0,masters:(y==null?void 0:y.filter(j=>j.role==="master").length)||0,admins:(y==null?void 0:y.filter(j=>j.role==="admin").length)||0},H=j=>{if(!j)return"";const v=j.replace(/\D/g,"");return v?v.startsWith("0")?v:v.startsWith("233")&&v.length>3?`0${v.slice(3)}`:v.length===9?`0${v}`:`0${v}`:""},W=j=>{const v=H(j);return v?`="${v}"`:""},L=()=>{if(!y||y.length===0){s({title:"No users to export",variant:"destructive"});return}const j=l==="phone"?["Phone"]:l==="phone_email"?["Phone","Email"]:["Phone","Username"],v=y.map(R=>{const P=W(R.phone);return l==="phone"?[P]:l==="phone_email"?[P,R.email||""]:[P,R.name||""]}),I=[j,...v].map(R=>R.map(P=>`"${String(P).replace(/"/g,'""')}"`).join(",")).join(`\r
`),A=new Blob([I],{type:"text/csv;charset=utf-8;"}),B=URL.createObjectURL(A),w=document.createElement("a");w.href=B,w.setAttribute("download",`users-export-${l}.csv`),document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(B)};return e.jsxs("div",{className:"flex h-screen bg-background",children:[r&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>d(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>d(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>d(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Users"})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(Ae,{title:"Total Users",value:se.total,icon:Us,description:"All registered users"}),e.jsx(Ae,{title:"Users",value:se.users,icon:Us,description:"Regular users"}),e.jsx(Ae,{title:"Agents",value:se.agents,icon:Us,description:"Agent accounts"}),e.jsx(Ae,{title:"Dealers",value:se.dealers,icon:Us,description:"Dealer accounts"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(Ae,{title:"Super Dealers",value:se.superDealers,icon:Us,description:"Super dealer accounts"}),e.jsx(Ae,{title:"Guests",value:se.guests,icon:Us,description:"Guest accounts"}),e.jsx(Ae,{title:"Admins",value:se.admins,icon:Us,description:"Administrator accounts"})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Us,{className:"h-5 w-5"}),"All Users"]}),e.jsx(te,{children:"Manage user accounts and track purchases"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Fe,{value:l,onValueChange:h,children:[e.jsx(Pe,{className:"w-48",children:e.jsx(Ie,{placeholder:"Export format"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"phone",children:"Phone only"}),e.jsx(K,{value:"phone_email",children:"Phone + Email"}),e.jsx(K,{value:"phone_username",children:"Phone + Username"})]})]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:L,children:[e.jsx(ga,{className:"h-4 w-4 mr-2"}),"Export"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{type:"number",placeholder:"Days",className:"w-20",value:m||"",onChange:j=>b(parseInt(j.target.value)||null)}),e.jsx(p,{size:"sm",variant:"destructive",onClick:()=>u(!0),disabled:!m,children:"Delete Inactive"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{placeholder:"Search users...",className:"w-64 pl-10",value:i,onChange:j=>n(j.target.value)})]}),e.jsxs(Fe,{value:t,onValueChange:a,children:[e.jsx(Pe,{className:"w-40",children:e.jsx(Ie,{placeholder:"Role"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"all",children:"All Users"}),e.jsx(K,{value:"guest",children:"Guests"}),e.jsx(K,{value:"user",children:"Users"}),e.jsx(K,{value:"agent",children:"Agents"}),e.jsx(K,{value:"dealer",children:"Dealers"}),e.jsx(K,{value:"super_dealer",children:"Super Dealers"}),e.jsx(K,{value:"master",children:"Master"}),e.jsx(K,{value:"admin",children:"Admins"})]})]})]})]}),e.jsx(D,{children:M?e.jsx(Ts,{rows:10}):E&&E.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{children:"Name"}),e.jsx(U,{children:"Email"}),e.jsx(U,{children:"Phone"}),e.jsx(U,{children:"Role"}),e.jsx(U,{children:"Last Purchase"}),e.jsx(U,{children:"Total Purchases"}),e.jsx(U,{children:"Total Spent"}),e.jsx(U,{children:"Joined"}),e.jsx(U,{className:"text-right",children:"Actions"})]})}),e.jsx(ns,{children:E.map(j=>e.jsxs(we,{children:[e.jsx(z,{children:e.jsx("div",{className:"font-medium",children:j.name})}),e.jsx(z,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:j.email})}),e.jsx(z,{children:e.jsx("div",{className:"text-sm",children:j.phone||"â€”"})}),e.jsxs(z,{children:[e.jsxs(Fe,{value:f[j.id]||j.role,onValueChange:v=>{N(I=>({...I,[j.id]:v}))},disabled:C.isPending,children:[e.jsx(Pe,{className:"w-32",children:e.jsx(Ie,{})}),e.jsxs(Ce,{className:"bg-white dark:bg-black border-2 border-gray-300 dark:border-gray-600 text-black dark:text-white",children:[e.jsx(K,{value:"guest",children:"Guest"}),e.jsx(K,{value:"user",children:"User"}),e.jsx(K,{value:"agent",children:"Agent"}),e.jsx(K,{value:"dealer",children:"Dealer"}),e.jsx(K,{value:"super_dealer",children:"Super Dealer"}),e.jsx(K,{value:"master",children:"Master"}),e.jsx(K,{value:"admin",children:"Admin"})]})]}),f[j.id]&&f[j.id]!==j.role&&e.jsx(p,{size:"sm",variant:"outline",className:"ml-2",onClick:()=>{C.mutate({id:j.id,role:f[j.id]}),N(v=>{const I={...v};return delete I[j.id],I})},disabled:C.isPending,children:"Save"})]}),e.jsx(z,{children:j.lastPurchase?e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:ie(j.lastPurchase.amount)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[j.lastPurchase.productType," â€¢ ",Ze(j.lastPurchase.date)]})]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"No purchases"})}),e.jsx(z,{className:"tabular-nums",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ci,{className:"h-3 w-3 text-muted-foreground"}),j.totalPurchases]})}),e.jsx(z,{className:"font-medium tabular-nums",children:ie(j.totalSpent)}),e.jsx(z,{className:"text-muted-foreground text-sm",children:Ze(j.createdAt)}),e.jsx(z,{className:"text-right",children:e.jsx(p,{size:"sm",variant:"ghost",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>x(j.id),disabled:j.role==="admin",children:e.jsx(Ws,{className:"h-4 w-4"})})})]},j.id))})]})}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No users found."})})]})]})})]}),e.jsx(wt,{open:g,onOpenChange:u,children:e.jsxs(ht,{className:"bg-white dark:bg-slate-950 text-white dark:text-white",children:[e.jsxs(ut,{children:[e.jsx(gt,{className:"text-white",children:"Delete Inactive Users"}),e.jsxs(jt,{className:"text-white",children:["Are you sure you want to delete all users who haven't made a purchase in the last ",m," days? This action cannot be undone. All user data and transactions will be permanently removed."]})]}),e.jsxs(pt,{children:[e.jsx(bt,{children:"Cancel"}),e.jsx(ft,{onClick:()=>{m&&(k.mutate(m),u(!1))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:k.isPending,children:"Delete Inactive Users"})]})]})}),e.jsx(wt,{open:!!c,onOpenChange:j=>!j&&x(null),children:e.jsxs(ht,{className:"bg-white dark:bg-slate-950 text-white dark:text-white",children:[e.jsxs(ut,{children:[e.jsx(gt,{className:"text-white",children:"Delete User"}),e.jsx(jt,{className:"text-white",children:"Are you sure you want to delete this user? This action cannot be undone. All user data and transactions will be permanently removed."})]}),e.jsxs(pt,{children:[e.jsx(bt,{children:"Cancel"}),e.jsx(ft,{onClick:()=>c&&S.mutate(c),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})}const bd=ae.object({whatsappSupportLink:ae.string().url("Must be a valid URL").optional().or(ae.literal("")),whatsappChannelLink:ae.string().url("Must be a valid URL").optional().or(ae.literal(""))});function Nd(){const{toast:s}=fe(),[t,a]=o.useState("all"),[i,n]=o.useState(!1),[r,d]=o.useState(null),[c,x]=o.useState(null),m=Ss({resolver:Ps(bd),defaultValues:{whatsappSupportLink:"",whatsappChannelLink:""}}),{data:b,isLoading:g}=ee({queryKey:["/api/admin/agents"],refetchInterval:3e4,refetchOnWindowFocus:!0}),u=oe({mutationFn:h=>Q("DELETE",`/api/admin/agents/${h}`,{}),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/agents"]}),be.invalidateQueries({queryKey:["/api/admin/stats"]}),s({title:"âœ… Agent deleted successfully"}),d(null)},onError:h=>{s({title:"Failed to delete agent",description:h.message,variant:"destructive"})}}),f=oe({mutationFn:({id:h,data:y})=>Q("PATCH",`/api/admin/agents/${h}/whatsapp`,y),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/agents"]}),s({title:"âœ… WhatsApp links updated successfully"}),x(null),m.reset()},onError:h=>{s({title:"Failed to update WhatsApp links",description:h.message,variant:"destructive"})}}),N=b==null?void 0:b.filter(h=>t==="approved"?h.isApproved:t==="pending"?!h.isApproved:!0),l={total:(b==null?void 0:b.length)||0,approved:(b==null?void 0:b.filter(h=>h.isApproved).length)||0,pending:(b==null?void 0:b.filter(h=>!h.isApproved).length)||0};return e.jsxs("div",{className:"flex h-screen bg-background",children:[i&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>n(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>n(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>n(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Agents"})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(Ae,{title:"Total Agents",value:l.total,icon:os,description:"Registered agents"}),e.jsx(Ae,{title:"Approved",value:l.approved,icon:Te,description:"Active agents"}),e.jsx(Ae,{title:"Pending Approval",value:l.pending,icon:fs,description:"Awaiting review"})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"h-5 w-5"}),"All Agents"]}),e.jsx(te,{children:"Manage agent accounts and approvals"})]}),e.jsxs(Fe,{value:t,onValueChange:a,children:[e.jsx(Pe,{className:"w-40","data-testid":"filter-status",children:e.jsx(Ie,{placeholder:"Status"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"all",children:"All Agents"}),e.jsx(K,{value:"approved",children:"Approved"}),e.jsx(K,{value:"pending",children:"Pending"})]})]})]}),e.jsx(D,{children:g?e.jsx(Ts,{rows:8}):N&&N.length>0?e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{children:"Business Name"}),e.jsx(U,{children:"Contact"}),e.jsx(U,{children:"Storefront"}),e.jsx(U,{children:"Balance"}),e.jsx(U,{children:"Total Sales"}),e.jsx(U,{children:"Status"}),e.jsx(U,{children:"Joined"}),e.jsx(U,{className:"text-right",children:"Actions"})]})}),e.jsx(ns,{children:N.map(h=>{var y,M,S;return e.jsxs(we,{"data-testid":`row-agent-${h.id}`,children:[e.jsxs(z,{children:[e.jsx("div",{className:"font-medium",children:h.businessName}),h.businessDescription&&e.jsx("div",{className:"text-sm text-muted-foreground truncate max-w-[200px]",children:h.businessDescription})]}),e.jsxs(z,{children:[e.jsx("div",{className:"text-sm",children:(y=h.user)==null?void 0:y.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:(M=h.user)==null?void 0:M.email}),e.jsx("div",{className:"text-xs text-muted-foreground",children:(S=h.user)==null?void 0:S.phone})]}),e.jsx(z,{children:e.jsxs("a",{href:`/store/agent/${h.storefrontSlug}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline font-mono text-sm",children:["/store/agent/",h.storefrontSlug]})}),e.jsx(z,{className:"font-medium tabular-nums",children:ie(h.balance)}),e.jsx(z,{className:"tabular-nums",children:ie(h.totalSales)}),e.jsx(z,{children:e.jsx(Z,{variant:h.isApproved?"default":"secondary",children:h.isApproved?"Approved":"Pending"})}),e.jsx(z,{className:"text-muted-foreground text-sm",children:Ze(h.createdAt)}),e.jsx(z,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(p,{size:"sm",variant:"ghost",onClick:()=>{x(h.id),m.reset({whatsappSupportLink:h.whatsappSupportLink||"",whatsappChannelLink:h.whatsappChannelLink||""})},children:e.jsx(za,{className:"h-4 w-4"})}),e.jsx(p,{size:"sm",variant:"ghost",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>d(h.id),children:e.jsx(Ws,{className:"h-4 w-4"})})]})})]},h.id)})})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No agents found."})})]})]})})]}),e.jsx(wt,{open:!!r,onOpenChange:h=>!h&&d(null),children:e.jsxs(ht,{children:[e.jsxs(ut,{children:[e.jsx(gt,{children:"Delete Agent"}),e.jsx(jt,{children:"Are you sure you want to delete this agent? This action cannot be undone. The agent's storefront, transactions, and all related data will be permanently removed."})]}),e.jsxs(pt,{children:[e.jsx(bt,{children:"Cancel"}),e.jsx(ft,{onClick:()=>r&&u.mutate(r),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(us,{open:!!c,onOpenChange:h=>!h&&x(null),children:e.jsxs(ss,{className:"bg-card text-card-foreground",style:{backgroundColor:"hsl(var(--card))",opacity:1},children:[e.jsx(ts,{children:e.jsx(as,{children:"Edit WhatsApp Links"})}),e.jsxs("form",{onSubmit:m.handleSubmit(h=>{c&&f.mutate({id:c,data:h})}),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"whatsappSupportLink",children:"WhatsApp Support Link"}),e.jsx(Y,{id:"whatsappSupportLink",placeholder:"https://wa.me/1234567890",...m.register("whatsappSupportLink")}),m.formState.errors.whatsappSupportLink&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:m.formState.errors.whatsappSupportLink.message})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"whatsappChannelLink",children:"WhatsApp Channel Link"}),e.jsx(Y,{id:"whatsappChannelLink",placeholder:"https://whatsapp.com/channel/...",...m.register("whatsappChannelLink")}),m.formState.errors.whatsappChannelLink&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:m.formState.errors.whatsappChannelLink.message})]}),e.jsxs(la,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>x(null),children:"Cancel"}),e.jsx(p,{type:"submit",disabled:f.isPending,children:f.isPending?"Saving...":"Save Changes"})]})]})]})})]})}function vd(){const{toast:s}=fe(),[t,a]=o.useState("all"),[i,n]=o.useState(!1),{data:r,isLoading:d,error:c}=ee({queryKey:["/api/admin/withdrawals"],refetchInterval:2e4,refetchOnWindowFocus:!0});if(c)return console.error("Error fetching withdrawals:",c),e.jsxs("div",{className:"flex h-screen bg-background",children:[e.jsx(Se,{}),e.jsx("div",{className:"flex-1 p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error Loading Withdrawals"}),e.jsx("p",{className:"text-muted-foreground",children:"Unable to fetch withdrawal requests. Please try again later."}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Error: ",c.message]})]})})]});const x=Array.isArray(r)&&r?r.filter(l=>t==="all"?!0:l.status===t):[],m={total:Array.isArray(r)&&r?r.length:0,pending:Array.isArray(r)&&r?r.filter(l=>l.status==="pending").length:0,approved:Array.isArray(r)&&r?r.filter(l=>l.status==="approved").length:0,rejected:Array.isArray(r)&&r?r.filter(l=>l.status==="rejected").length:0,paid:Array.isArray(r)&&r?r.filter(l=>l.status==="paid").length:0,totalAmount:Array.isArray(r)&&r?r.reduce((l,h)=>l+parseFloat(h.amount),0):0},b=l=>{const h=Kl[l];return e.jsx(Z,{className:(h==null?void 0:h.color)||"",children:(h==null?void 0:h.label)||l})},g=oe({mutationFn:async({id:l,action:h})=>await Q("POST",`/api/admin/withdrawals/${l}/${h}`),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/withdrawals"]}),s({title:"Success",description:"Withdrawal request updated successfully"})},onError:l=>{s({title:"Error",description:l.message||"Failed to update withdrawal request",variant:"destructive"})}}),u=l=>{g.mutate({id:l,action:"approve"})},f=l=>{g.mutate({id:l,action:"reject"})},N=l=>{g.mutate({id:l,action:"mark_paid"})};return e.jsxs("div",{className:"flex h-screen bg-background",children:[i&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>n(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>n(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>n(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Withdrawals"})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(Ae,{title:"Total Requests",value:m.total,icon:ye,description:"All time"}),e.jsx(Ae,{title:"Pending",value:m.pending,icon:fs,description:"Awaiting approval"}),e.jsx(Ae,{title:"Approved",value:m.approved,icon:Te,description:"Ready for manual payout"}),e.jsx(Ae,{title:"Paid",value:m.paid,icon:Te,description:"Manually paid out"})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"Withdrawal Requests"]}),e.jsx(te,{children:"Track all agent withdrawal requests and their transfer status"})]}),e.jsxs(Fe,{value:t,onValueChange:a,children:[e.jsx(Pe,{className:"w-40","data-testid":"filter-status",children:e.jsx(Ie,{placeholder:"Status"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"all",children:"All Status"}),e.jsx(K,{value:"pending",children:"Pending"}),e.jsx(K,{value:"approved",children:"Approved"}),e.jsx(K,{value:"rejected",children:"Rejected"}),e.jsx(K,{value:"paid",children:"Paid"})]})]})]}),e.jsx(D,{children:d?e.jsx(Ts,{rows:8}):x&&x.length>0?e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{children:"Agent"}),e.jsx(U,{children:"Amount"}),e.jsx(U,{children:"Payment Method"}),e.jsx(U,{children:"Account Details"}),e.jsx(U,{children:"Status"}),e.jsx(U,{children:"Requested"}),e.jsx(U,{children:"Actions"})]})}),e.jsx(ns,{children:x.map(l=>{var h,y,M;return e.jsxs(we,{"data-testid":`row-withdrawal-${l.id}`,children:[e.jsxs(z,{children:[e.jsx("div",{className:"font-medium",children:(h=l.agent)==null?void 0:h.businessName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:(y=l.user)==null?void 0:y.name})]}),e.jsx(z,{className:"font-bold tabular-nums text-lg",children:ie(l.amount)}),e.jsx(z,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[l.paymentMethod==="bank"?e.jsx(di,{className:"h-4 w-4 text-blue-600"}):e.jsx(ye,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium capitalize",children:((M=l.paymentMethod)==null?void 0:M.replace("_"," "))||"Bank"})]})}),e.jsx(z,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:l.accountName}),e.jsx("div",{className:"text-muted-foreground",children:l.accountNumber}),l.paymentMethod==="bank"&&l.bankName&&e.jsx("div",{className:"text-muted-foreground text-xs",children:l.bankName})]})}),e.jsx(z,{children:b(l.status)}),e.jsx(z,{className:"text-muted-foreground text-sm",children:Ze(l.createdAt)}),e.jsxs(z,{children:[l.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{size:"sm",variant:"default",onClick:()=>u(l.id),disabled:g.isPending,children:[e.jsx(Te,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(p,{size:"sm",variant:"destructive",onClick:()=>f(l.id),disabled:g.isPending,children:[e.jsx(ds,{className:"h-4 w-4 mr-1"}),"Reject"]})]}),l.status==="approved"&&e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>N(l.id),disabled:g.isPending,children:[e.jsx(Te,{className:"h-4 w-4 mr-1"}),"Mark as Paid"]})]})]},l.id)})})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No withdrawal requests found."})})]})]})})]})]})}function yd(){const[s,t]=o.useState(null),[a,i]=o.useState(""),[n,r]=o.useState("open"),[d,c]=o.useState(!1),x=o.useRef(null),{toast:m}=fe(),b=Hs(),{data:g=0}=ee({queryKey:["/api/support/admin/unread-count"],queryFn:async()=>{try{return(await Q("GET","/api/support/admin/unread-count")).count||0}catch{return 0}},refetchInterval:15e3}),{data:u,isLoading:f}=ee({queryKey:[`/api/admin/support/chats?status=${n}`],refetchInterval:2e4}),{data:N}=ee({queryKey:[`/api/support/chat/${s}`],enabled:!!s,refetchInterval:1e4}),l=oe({mutationFn:k=>Q("POST",`/api/support/chat/${s}/message`,{message:k}),onSuccess:()=>{i(""),b.invalidateQueries({queryKey:[`/api/support/chat/${s}`]}),b.invalidateQueries({queryKey:["/api/admin/support/chats"],exact:!1})},onError:()=>{m({title:"âŒ Error",description:"Failed to send message",variant:"destructive",duration:4e3})}}),h=oe({mutationFn:k=>Q("PUT",`/api/admin/support/chat/${k}/assign`,{}),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/support/chats"],exact:!1}),b.invalidateQueries({queryKey:[`/api/support/chat/${s}`]}),m({title:"âœ… Assigned",description:"Chat assigned to you",duration:3e3})}}),y=oe({mutationFn:k=>Q("PUT",`/api/support/chat/${k}/close`,{}),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/support/chats"],exact:!1}),t(null),m({title:"âœ… Chat Closed",description:"The chat has been closed",duration:3e3})}});o.useEffect(()=>{x.current&&(x.current.scrollTop=x.current.scrollHeight)},[N==null?void 0:N.messages]),o.useEffect(()=>{if(N!=null&&N.messages&&s){const k=N.messages.filter(C=>C.senderType==="user"&&!C.isRead);k.forEach(async C=>{try{await Q("PUT",`/api/support/message/${C.id}/read`,{})}catch(E){console.error("Failed to mark message as read:",E)}}),k.length>0&&b.invalidateQueries({queryKey:["/api/support/admin/unread-count"]})}},[N==null?void 0:N.messages,s,b]);const M=()=>{!a.trim()||!s||l.mutate(a)},S=k=>{k.key==="Enter"&&!k.shiftKey&&(k.preventDefault(),M())};return e.jsxs("div",{className:"flex h-screen bg-background",children:[d&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>c(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>c(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"lg:hidden border-b px-4 py-3 flex items-center justify-between bg-background",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>c(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Support Chat"}),g>0&&e.jsx(Z,{variant:"destructive",className:"h-5 min-w-5 flex items-center justify-center px-1.5",children:g})]}),e.jsx("div",{className:"w-10"})," "]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 md:p-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6 hidden lg:block",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Support Chat"}),g>0&&e.jsxs(Z,{variant:"destructive",className:"text-sm px-2.5 py-1",children:[g," New ",g===1?"Message":"Messages"]})]}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"Manage customer support conversations"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 h-[calc(100vh-140px)] md:h-[calc(100vh-200px)]",children:[e.jsxs(F,{className:"lg:col-span-1 max-h-[40vh] lg:max-h-none",children:[e.jsx($,{className:"border-b p-3 md:p-6",children:e.jsx(it,{value:n,onValueChange:k=>r(k),children:e.jsxs(Ys,{className:"grid w-full grid-cols-2",children:[e.jsx(De,{value:"open",className:"text-xs md:text-sm data-[state=active]:bg-yellow-500 data-[state=active]:text-white data-[state=active]:font-medium data-[state=active]:shadow-sm",children:"Open"}),e.jsx(De,{value:"closed",className:"text-xs md:text-sm data-[state=active]:bg-yellow-500 data-[state=active]:text-white data-[state=active]:font-medium data-[state=active]:shadow-sm",children:"Closed"})]})})}),e.jsx(D,{className:"p-0",children:e.jsx(yt,{className:"h-[calc(40vh-100px)] lg:h-[calc(100vh-340px)]",children:f?e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"Loading..."}):!u||u.length===0?e.jsxs("div",{className:"p-4 md:p-8 text-center text-muted-foreground",children:[e.jsx(tt,{className:"h-8 w-8 md:h-12 md:w-12 mx-auto mb-3 opacity-50"}),e.jsxs("p",{className:"text-xs md:text-sm",children:["No ",n," chats"]})]}):e.jsx("div",{className:"divide-y",children:u.map(k=>e.jsxs("button",{onClick:()=>t(k.id),className:`w-full p-3 md:p-4 text-left hover:bg-muted/50 transition-colors ${s===k.id?"bg-muted":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Us,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm",children:k.userName})]}),k.status==="open"&&e.jsx(Z,{variant:"default",className:"text-xs",children:"Open"})]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:k.userEmail}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-muted-foreground",children:[e.jsx(fs,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(k.lastMessageAt).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]},k.id))})})})]}),e.jsx(F,{className:"lg:col-span-2 flex flex-col min-h-[55vh] lg:min-h-0",children:!s||!N?e.jsx(D,{className:"flex-1 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(tt,{className:"h-12 w-12 md:h-16 md:w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm md:text-base",children:"Select a chat to view conversation"})]})}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"border-b p-3 md:p-6",children:e.jsxs("div",{className:"flex items-start md:items-center justify-between gap-2 flex-col md:flex-row",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs(G,{className:"text-base md:text-lg flex items-center gap-2",children:[e.jsx(Us,{className:"h-4 w-4 md:h-5 md:w-5 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:N.chat.userName})]}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mt-1 truncate",children:N.chat.userEmail})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap w-full md:w-auto",children:[!N.chat.assignedToAdminId&&N.chat.status==="open"&&e.jsx(p,{variant:"outline",size:"sm",onClick:()=>h.mutate(N.chat.id),disabled:h.isPending,className:"text-xs flex-1 md:flex-initial",children:"Assign to Me"}),N.chat.status==="open"&&e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>y.mutate(N.chat.id),disabled:y.isPending,className:"text-xs flex-1 md:flex-initial",children:[e.jsx(Te,{className:"h-3 w-3 md:h-4 md:w-4 mr-1"}),"Close Chat"]}),N.chat.status==="closed"&&e.jsx(Z,{variant:"secondary",className:"text-xs",children:"Closed"})]})]})}),e.jsx(D,{className:"flex-1 p-0 overflow-hidden",children:e.jsx(yt,{className:"h-[calc(55vh-150px)] lg:h-[calc(100vh-380px)] p-3 md:p-4",ref:x,children:N.messages.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-8",children:e.jsx("p",{className:"text-xs md:text-sm",children:"No messages yet"})}):e.jsx("div",{className:"space-y-2 md:space-y-3",children:N.messages.map(k=>e.jsx("div",{className:`flex ${k.senderType==="admin"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] md:max-w-[80%] rounded-lg p-2 md:p-3 ${k.senderType==="admin"?"bg-primary text-primary-foreground":"bg-muted"}`,children:[k.senderType==="user"&&e.jsx("p",{className:"text-[10px] md:text-xs font-semibold mb-1 opacity-80",children:"Customer"}),e.jsx("p",{className:"text-xs md:text-sm whitespace-pre-wrap break-words",children:k.message}),e.jsx("p",{className:"text-[10px] md:text-xs opacity-70 mt-1",children:new Date(k.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},k.id))})})}),e.jsx("div",{className:"border-t p-3 md:p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{placeholder:"Type your message...",value:a,onChange:k=>i(k.target.value),onKeyPress:S,disabled:l.isPending||N.chat.status==="closed",className:"flex-1 text-sm"}),e.jsx(p,{onClick:M,disabled:!a.trim()||l.isPending||N.chat.status==="closed",size:"icon",className:"flex-shrink-0",children:e.jsx(wl,{className:"h-4 w-4"})})]})})]})})]})]})]})]})}function wd(s){const t=/(https?:\/\/[^\s]+)/g;return s.split(t).map((i,n)=>t.test(i)?e.jsxs("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-flex items-center gap-1",children:[i,e.jsx(vt,{className:"h-3 w-3"})]},n):i)}function kd(){var B,w,R,P,q;const{toast:s}=fe(),t=Hs(),[a,i]=o.useState(!1),[n,r]=o.useState({data_bundle_auto_processing:"false"}),[d,c]=o.useState([]),[x,m]=o.useState(null),[b,g]=o.useState({email:"",password:"",name:"",phone:""}),[u,f]=o.useState({title:"",message:""}),[N,l]=o.useState([]),{data:h}=ee({queryKey:["/api/admin/settings"],refetchInterval:3e4}),{data:y}=ee({queryKey:["/api/admin/users"],refetchInterval:3e4}),{data:M}=ee({queryKey:["/api/admin/announcements"],refetchInterval:3e4}),S=oe({mutationFn:async({key:T,value:J,description:ce})=>{const ge=encodeURIComponent(T);return Q("PUT",`/api/admin/settings/${ge}`,{value:J,description:ce})},onMutate:async({key:T,value:J})=>{await t.cancelQueries({queryKey:["/api/admin/settings"]});const ce=t.getQueryData(["/api/admin/settings"]);return t.setQueryData(["/api/admin/settings"],ge=>ge&&ge.map(Ve=>Ve.key===T?{...Ve,value:J}:Ve)),r(ge=>({...ge,[T]:J})),{previousSettings:ce}},onError:(T,J,ce)=>{if(ce!=null&&ce.previousSettings){t.setQueryData(["/api/admin/settings"],ce.previousSettings);const ge={};ce.previousSettings.forEach(Ve=>{ge[Ve.key]=Ve.value}),r(ge)}s({title:"Failed to update setting",description:T.message,variant:"destructive"})},onSuccess:()=>{s({title:"Setting updated successfully"})},onSettled:()=>{t.invalidateQueries({queryKey:["/api/admin/settings"]})}}),k=oe({mutationFn:async({userId:T,data:J})=>Q("PUT",`/api/admin/users/${T}/credentials`,J),onSuccess:()=>{t.invalidateQueries({queryKey:["/api/admin/users"]}),m(null),g({email:"",password:"",name:"",phone:""}),s({title:"User credentials updated successfully"})},onError:T=>{const J=(T==null?void 0:T.message)||"Unknown error occurred";console.error("[Credentials] Update error:",J),s({title:"Failed to update credentials",description:J,variant:"destructive"})}}),C=oe({mutationFn:async T=>Q("POST","/api/admin/announcements",T),onSuccess:()=>{t.invalidateQueries({queryKey:["/api/admin/announcements"]}),f({title:"",message:""}),s({title:"Announcement created successfully"})},onError:T=>{s({title:"Failed to create announcement",description:T.message,variant:"destructive"})}}),E=oe({mutationFn:async({id:T,isActive:J})=>Q("PATCH",`/api/admin/announcements/${T}`,{isActive:J}),onSuccess:()=>{t.invalidateQueries({queryKey:["/api/admin/announcements"]}),s({title:"Announcement updated successfully"})},onError:T=>{s({title:"Failed to update announcement",description:T.message,variant:"destructive"})}}),se=oe({mutationFn:async T=>Q("DELETE",`/api/admin/announcements/${T}`),onSuccess:()=>{t.invalidateQueries({queryKey:["/api/admin/announcements"]}),s({title:"Announcement deleted successfully"})},onError:T=>{s({title:"Failed to delete announcement",description:T.message,variant:"destructive"})}});o.useEffect(()=>{if(h){const T={data_bundle_auto_processing:"false"};h.forEach(J=>{J.isMasked?T[J.key]="":T[J.key]=J.value}),r(T)}},[h]),o.useEffect(()=>{y&&c(y)},[y]),o.useEffect(()=>{M&&l(M)},[M]);const H=(T,J)=>{r(ce=>({...ce,[T]:J}))},W=(T,J)=>{const ce=n[T];ce!==void 0&&S.mutate({key:T,value:ce,description:J})},L=T=>{m(T),g({email:T.email,password:"",name:T.name,phone:T.phone||""})},j=()=>{if(!x)return;const T={};if(b.email!==x.email){if(!b.email.trim()){s({title:"Email cannot be empty",variant:"destructive"});return}T.email=b.email}if(b.password){if(b.password.length<8){s({title:"Password must be at least 8 characters",variant:"destructive"});return}T.password=b.password}if(b.name!==x.name){if(!b.name.trim()){s({title:"Name cannot be empty",variant:"destructive"});return}T.name=b.name}if(b.phone!==(x.phone||"")&&(T.phone=b.phone),Object.keys(T).length===0){s({title:"No changes detected",variant:"default"});return}console.log("[Credentials] Submitting update for user:",x.id,"Data:",Object.keys(T)),k.mutate({userId:x.id,data:T})},v=()=>{if(!u.title.trim()||!u.message.trim()){s({title:"Title and message are required",variant:"destructive"});return}C.mutate({title:u.title.trim(),message:u.message.trim()})},I=(T,J)=>{E.mutate({id:T,isActive:!J})},A=T=>{confirm("Are you sure you want to delete this announcement?")&&se.mutate(T)};return e.jsxs("div",{className:"flex h-screen bg-background",children:[a&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>i(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>i(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>i(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Settings"})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Rt,{className:"h-5 w-5"}),"General Settings"]}),e.jsx(te,{children:"Configure basic application settings"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"appName",children:"Application Name"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{id:"appName",value:n.app_name||"",onChange:T=>H("app_name",T.target.value),placeholder:"My App"}),e.jsx(p,{size:"sm",onClick:()=>W("app_name","Application name displayed in the UI"),disabled:S.isPending,children:e.jsx(Qs,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"supportEmail",children:"Support Email"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{id:"supportEmail",type:"email",autoComplete:"email",value:n.support_email||"",onChange:T=>H("support_email",T.target.value),placeholder:"support@example.com"}),e.jsx(p,{size:"sm",onClick:()=>W("support_email","Support email for customer inquiries"),disabled:S.isPending,children:e.jsx(Qs,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"supportPhone",children:"Support Phone"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{id:"supportPhone",autoComplete:"tel",value:n.support_phone||"",onChange:T=>H("support_phone",T.target.value),placeholder:"+233 XX XXX XXXX"}),e.jsx(p,{size:"sm",onClick:()=>W("support_phone","Support phone number"),disabled:S.isPending,children:e.jsx(Qs,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"whatsappNumber",children:"WhatsApp Support Number"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(Y,{id:"whatsappNumber",autoComplete:"tel",value:n.whatsapp_support_number||"",onChange:T=>H("whatsapp_support_number",T.target.value),placeholder:"+233 XX XXX XXXX"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter the WhatsApp number for customer support. Format: +233XXXXXXXXX. When set, customers can contact you via WhatsApp."}),e.jsx(p,{size:"sm",onClick:()=>W("whatsapp_support_number","WhatsApp support number for customer inquiries"),disabled:S.isPending,children:e.jsx(Qs,{className:"h-4 w-4"})})]})]})]})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5"}),"Payment Settings"]}),e.jsx(te,{children:"Configure payment gateway credentials"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"paystackSecretKey",children:"Paystack Secret Key"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(Y,{id:"paystackSecretKey",type:"password",autoComplete:"off",value:n["paystack.secret_key"]||"",onChange:T=>H("paystack.secret_key",T.target.value),placeholder:(B=h==null?void 0:h.find(T=>T.key==="paystack.secret_key"))!=null&&B.isMasked?"Current: "+((w=h.find(T=>T.key==="paystack.secret_key"))==null?void 0:w.value)+" (Enter new to update)":"sk_test_... or sk_live_..."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(()=>{var J,ce;const T=h==null?void 0:h.find(ge=>ge.key==="paystack.secret_key");if(T!=null&&T.isMasked){const ge=T.value;return ge.includes("sk_test")?"âš ï¸ Currently using TEST mode (key is set)":ge.includes("sk_live")?"âœ… Currently using LIVE mode (key is set)":"ðŸ”’ Key is configured (enter new value to update)"}return(J=n["paystack.secret_key"])!=null&&J.startsWith("sk_test_")?"âš ï¸ Currently using TEST mode":(ce=n["paystack.secret_key"])!=null&&ce.startsWith("sk_live_")?"âœ… Currently using LIVE mode":"Enter your Paystack secret key"})()}),e.jsxs(p,{size:"sm",onClick:()=>W("paystack.secret_key","Paystack Secret Key for payment processing"),disabled:S.isPending||!n["paystack.secret_key"],children:[e.jsx(Qs,{className:"h-4 w-4 mr-2"}),"Save Secret Key"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"paystackPublicKey",children:"Paystack Public Key"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(Y,{id:"paystackPublicKey",autoComplete:"off",value:n["paystack.public_key"]||"",onChange:T=>H("paystack.public_key",T.target.value),placeholder:(R=h==null?void 0:h.find(T=>T.key==="paystack.public_key"))!=null&&R.isMasked?"Current: "+((P=h.find(T=>T.key==="paystack.public_key"))==null?void 0:P.value)+" (Enter new to update)":"pk_test_... or pk_live_..."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(q=h==null?void 0:h.find(T=>T.key==="paystack.public_key"))!=null&&q.isMasked?"ðŸ”’ Public key is configured (enter new value to update)":"Public key for client-side payment initialization"}),e.jsxs(p,{size:"sm",onClick:()=>W("paystack.public_key","Paystack Public Key for client-side payment initialization"),disabled:S.isPending||!n["paystack.public_key"],children:[e.jsx(Qs,{className:"h-4 w-4 mr-2"}),"Save Public Key"]})]})]})]})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Js,{className:"h-5 w-5"}),"User Credential Management"]}),e.jsx(te,{children:"Manage user credentials and account information"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"userSelect",children:"Select User to Manage"}),e.jsxs("select",{id:"userSelect","aria-label":"Select User to Manage",className:"w-full p-2 border rounded-md mt-1",value:(x==null?void 0:x.id)||"",onChange:T=>{const J=d.find(ce=>ce.id===T.target.value);J&&L(J)},children:[e.jsx("option",{value:"",children:"Choose a user..."}),d.map(T=>e.jsxs("option",{value:T.id,children:[T.name," (",T.email,") - ",T.role]},T.id))]})]}),x&&e.jsxs(e.Fragment,{children:[e.jsx(Le,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-medium",children:["Update Credentials for ",x.name]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"userEmail",children:"Email"}),e.jsx(Y,{id:"userEmail",type:"email",autoComplete:"email",value:b.email,onChange:T=>g(J=>({...J,email:T.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"userName",children:"Name"}),e.jsx(Y,{id:"userName",autoComplete:"name",value:b.name,onChange:T=>g(J=>({...J,name:T.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"userPhone",children:"Phone"}),e.jsx(Y,{id:"userPhone",autoComplete:"tel",value:b.phone,onChange:T=>g(J=>({...J,phone:T.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"userPassword",children:"New Password (leave empty to keep current)"}),e.jsx(Y,{id:"userPassword",type:"password",autoComplete:"new-password",value:b.password,onChange:T=>g(J=>({...J,password:T.target.value})),placeholder:"Enter new password"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{onClick:j,disabled:k.isPending,children:k.isPending?"Updating...":"Update Credentials"}),e.jsxs(p,{variant:"outline",onClick:()=>{m(null),g({email:"",password:"",name:"",phone:""})},children:[e.jsx(rt,{className:"h-4 w-4 mr-2"}),"Cancel"]})]})]})]})]})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(ja,{className:"h-5 w-5"}),"Announcement Management"]}),e.jsx(te,{children:"Create and manage system announcements for users"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"announcementTitle",children:"Title"}),e.jsx(Y,{id:"announcementTitle",value:u.title,onChange:T=>f(J=>({...J,title:T.target.value})),placeholder:"Announcement title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"announcementMessage",children:"Message"}),e.jsx("textarea",{id:"announcementMessage",className:"w-full p-2 border rounded-md resize-none",rows:3,value:u.message,onChange:T=>f(J=>({...J,message:T.target.value})),placeholder:"Announcement message"})]}),e.jsxs(p,{onClick:v,disabled:C.isPending,className:"gap-2",children:[e.jsx(As,{className:"h-4 w-4"}),C.isPending?"Creating...":"Create Announcement"]})]}),e.jsx(Le,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Existing Announcements"}),N.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No announcements yet"}):e.jsx("div",{className:"space-y-2",children:N.map(T=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:T.title}),e.jsx("div",{className:"text-sm text-muted-foreground",children:wd(T.message)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["By ",T.createdBy," â€¢ ",new Date(T.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Mt,{checked:T.isActive,onCheckedChange:()=>I(T.id,T.isActive),className:"data-[state=checked]:bg-green-500 data-[state=unchecked]:bg-red-500 [&_[data-radix-switch-thumb]]:bg-white"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>A(T.id),className:"text-red-600 hover:text-red-700",children:e.jsx(Ws,{className:"h-4 w-4"})})]})]},T.id))})]})]})]})]})})]})]})}function Sd(){const[s,t]=o.useState(!1),{data:a,isLoading:i}=ee({queryKey:["/api/admin/rankings/customers"],refetchInterval:6e4}),n=r=>r===0?e.jsx(Gs,{className:"h-5 w-5 text-yellow-500"}):r===1?e.jsx($a,{className:"h-5 w-5 text-gray-400"}):r===2?e.jsx(wa,{className:"h-5 w-5 text-amber-600"}):e.jsxs("span",{className:"text-sm font-semibold text-muted-foreground",children:["#",r+1]});return e.jsxs("div",{className:"flex h-screen bg-background",children:[s&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>t(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>t(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>t(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Users Ranking"})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs(F,{children:[e.jsx($,{children:e.jsxs("div",{children:[e.jsxs(G,{className:"text-lg flex items-center gap-2",children:[e.jsx(Gs,{className:"h-5 w-5 text-yellow-500"}),"Top Customers"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Highest spending customers"})]})}),e.jsx(D,{children:i?e.jsx(Ts,{rows:10}):a&&a.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{className:"w-16",children:"Rank"}),e.jsx(U,{children:"Customer"}),e.jsx(U,{className:"text-right",children:"Total Spent"}),e.jsx(U,{className:"text-right",children:"Purchases"}),e.jsx(U,{className:"text-right",children:"Last Purchase"})]})}),e.jsx(ns,{children:a.map((r,d)=>e.jsxs(we,{children:[e.jsx(z,{className:"text-center",children:n(d)}),e.jsx(z,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:r.customerName||r.customerEmail}),r.customerPhone&&e.jsx("span",{className:"text-xs text-muted-foreground",children:r.customerPhone}),e.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:r.customerEmail})]})}),e.jsx(z,{className:"text-right",children:e.jsx("span",{className:"font-bold text-green-600 dark:text-green-400",children:ie(r.totalSpent)})}),e.jsx(z,{className:"text-right",children:e.jsxs(Z,{variant:"secondary",children:[r.totalPurchases," ",r.totalPurchases===1?"order":"orders"]})}),e.jsx(z,{className:"text-right text-sm text-muted-foreground",children:Ze(r.lastPurchase)})]},r.rank))})]})}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Gs,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No customer rankings yet"}),e.jsx("p",{className:"text-sm",children:"Customer rankings will appear here once transactions are completed"})]})})]})})})]})]})}function Pd(){const{toast:s}=fe(),t=Hs(),{user:a,isLoading:i}=ve(),[n,r]=o.useState(!1),[d,c]=o.useState(!1),[x,m]=o.useState(""),{data:b}=ee({queryKey:["/api/admin/break-settings"],enabled:!!a});o.useEffect(()=>{b&&(c(b.isEnabled),m(b.message))},[b]);const g=oe({mutationFn:async f=>await Q("POST","/api/admin/break-settings",f),onSuccess:f=>{t.invalidateQueries({queryKey:["/api/admin/break-settings"]}),t.invalidateQueries({queryKey:["/api/break-settings"]}),s({title:"Settings Updated",description:`Site break mode ${f.isEnabled?"enabled":"disabled"} successfully.`})},onError:f=>{s({title:"Update Failed",description:f.message||"Failed to update break settings.",variant:"destructive"})}}),u=()=>{if(d&&!x.trim()){s({title:"Validation Error",description:"Please enter a message when enabling break mode.",variant:"destructive"});return}g.mutate({isEnabled:d,message:x.trim()})};return i?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"flex h-screen bg-background",children:[n&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>r(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>r(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>r(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rt,{className:"h-5 w-5"}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Break Settings"})]})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 lg:p-8",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-8",children:[e.jsx("div",{className:"p-6 border-2 border-gray-200 dark:border-gray-700 rounded-lg bg-red-500",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs(V,{className:"text-lg font-bold flex items-center gap-3 text-white",children:[e.jsx(ys,{className:"h-6 w-6 text-white drop-shadow-lg"}),"Enable Break Mode"]}),e.jsx("p",{className:"text-base leading-relaxed text-white",children:"âš ï¸ When enabled, the site will be completely unavailable to all users except administrators"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 lg:gap-6",children:[e.jsx("span",{className:`px-4 py-2 rounded-full text-sm font-bold min-w-[100px] text-center ${d?"bg-red-500 text-white shadow-lg":"bg-green-500 text-white shadow-md"}`,children:d?"ðŸš« ENABLED":"âœ… DISABLED"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{htmlFor:"break-mode-toggle",className:"text-sm font-medium text-white",children:d?"ON":"OFF"}),e.jsx(Mt,{id:"break-mode-toggle",checked:d,onCheckedChange:c,disabled:g.isPending,className:"data-[state=checked]:bg-green-500 data-[state=unchecked]:bg-red-500 [&_[data-radix-switch-thumb]]:bg-white"})]})]})]})}),e.jsxs("div",{className:"space-y-4 p-4 bg-white rounded-lg border-2 border-gray-300 text-black",children:[e.jsx(V,{htmlFor:"break-message",className:"text-lg font-semibold",children:"Maintenance Message"}),e.jsx(Ls,{id:"break-message",placeholder:"Enter a message to display to users when the site is in break mode...",value:x,onChange:f=>m(f.target.value),disabled:!d||g.isPending,rows:5,className:"resize-none text-base p-4 border-2 border-gray-400"}),e.jsx("p",{className:"text-sm text-black leading-relaxed",children:"This message will be displayed to users when they try to access the site. Keep it clear and informative about when the site will be available again."})]}),d&&x&&e.jsxs("div",{className:"space-y-4 p-6 bg-blue-50 dark:bg-blue-950/20 rounded-lg border-2 border-blue-200 dark:border-blue-800",children:[e.jsx(V,{className:"text-lg font-semibold text-blue-900 dark:text-blue-100",children:"Preview"}),e.jsx("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-inner",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(ys,{className:"h-10 w-10 text-red-600 dark:text-red-400"})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(rt,{className:"h-3 w-3 text-white"})})]})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 dark:text-red-400 mb-3",children:"Site Closed"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap text-base leading-relaxed",children:x})]})]})})]}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-center sm:justify-end gap-4 pt-6 mt-6 border-t border-gray-200 dark:border-gray-700",children:e.jsx(p,{onClick:u,disabled:g.isPending,className:"min-w-40 h-12 text-lg font-semibold",size:"lg",children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"Saving Changes..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Qs,{className:"h-5 w-5 mr-3"}),"Save Settings"]})})})]})})]})]})}function Cd(){const{toast:s}=fe(),[t,a]=o.useState(!1),[i,n]=o.useState([]),[r,d]=o.useState(!0),[c,x]=o.useState(!1),[m,b]=o.useState(null),[g,u]=o.useState(!1),[f,N]=o.useState(null),[l,h]=o.useState({name:"",provider:"",apiKey:"",apiSecret:"",endpoint:"",isActive:!0,isDefault:!1,networkMappings:JSON.stringify({mtn:"MTN",telecel:"TELECEL",at_bigtime:"AIRTELTIGO",at_ishare:"AIRTELTIGO",airteltigo:"AIRTELTIGO"},null,2)}),[y,M]=o.useState({});o.useEffect(()=>{S()},[]);const S=async()=>{try{const j=await Q("GET","/api/admin/external-providers");n(j)}catch(j){console.error("Failed to load providers:",j),s({title:"Error",description:"Failed to load external API providers",variant:"destructive"})}finally{d(!1)}},k=()=>{h({name:"",provider:"",apiKey:"",apiSecret:"",endpoint:"",isActive:!0,isDefault:!1,networkMappings:JSON.stringify({mtn:"MTN",telecel:"TELECEL",at_bigtime:"AIRTELTIGO",at_ishare:"AIRTELTIGO",airteltigo:"AIRTELTIGO"},null,2)}),b(null)},C=j=>{h({name:j.name,provider:j.provider,apiKey:j.apiKey,apiSecret:j.apiSecret,endpoint:j.endpoint,isActive:j.isActive,isDefault:j.isDefault,networkMappings:j.networkMappings||JSON.stringify({mtn:"MTN",telecel:"TELECEL",at_bigtime:"AIRTELTIGO",at_ishare:"AIRTELTIGO",airteltigo:"AIRTELTIGO"},null,2)}),b(j),x(!0)},E=async j=>{j.preventDefault(),u(!0);try{JSON.parse(l.networkMappings);const v={...l,networkMappings:l.networkMappings};m?(await Q("PUT",`/api/admin/external-providers/${m.id}`,v),s({title:"Success",description:"External API provider updated successfully"})):(await Q("POST","/api/admin/external-providers",v),s({title:"Success",description:"External API provider created successfully"})),x(!1),k(),S()}catch(v){console.error("Failed to save provider:",v),s({title:"Error",description:v.message||"Failed to save external API provider",variant:"destructive"})}finally{u(!1)}},se=async j=>{if(confirm("Are you sure you want to delete this external API provider?"))try{await Q("DELETE",`/api/admin/external-providers/${j}`),s({title:"Success",description:"External API provider deleted successfully"}),S()}catch(v){console.error("Failed to delete provider:",v),s({title:"Error",description:"Failed to delete external API provider",variant:"destructive"})}},H=async j=>{try{await Q("POST",`/api/admin/external-providers/${j}/set-default`),s({title:"Success",description:"Default external API provider updated successfully"}),S()}catch(v){console.error("Failed to set default provider:",v),s({title:"Error",description:"Failed to set default external API provider",variant:"destructive"})}},W=async j=>{N(j.id);try{const v=await Q("GET",`/api/admin/external-balance?providerId=${j.id}`);v.success?s({title:"Test Successful",description:`Balance check successful for ${j.name}`}):s({title:"Test Failed",description:v.error||"Balance check failed",variant:"destructive"})}catch(v){s({title:"Test Failed",description:v.message||"Balance check failed",variant:"destructive"})}finally{N(null)}},L=j=>{M(v=>({...v,[j]:!v[j]}))};return r?e.jsxs("div",{className:"flex h-screen bg-background",children:[e.jsx(Se,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-lg",children:"Loading..."})})]}):e.jsxs("div",{className:"flex h-screen bg-background",children:[t&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-card dark:bg-card border-r border-border transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>a(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>a(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"External API Providers"})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsx("p",{className:"text-muted-foreground",children:"Manage external API providers for data bundle purchases"}),e.jsxs(us,{open:c,onOpenChange:x,children:[e.jsx(St,{asChild:!0,children:e.jsxs(p,{children:[e.jsx(As,{className:"h-4 w-4 mr-2"}),"Add Provider"]})}),e.jsxs(ss,{className:"max-w-2xl max-h-[90vh] overflow-y-auto bg-card text-card-foreground border-border",style:{backgroundColor:"hsl(var(--card))",opacity:1},children:[e.jsxs(ts,{children:[e.jsxs(as,{children:[m?"Edit":"Add"," External API Provider"]}),e.jsx(Ks,{children:m?"Update the external API provider configuration.":"Configure a new external API provider for data bundle purchases."})]}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"name",children:"Provider Name"}),e.jsx(Y,{id:"name",value:l.name,onChange:j=>h({...l,name:j.target.value}),placeholder:"e.g., SkyTech GH",required:!0})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"provider",children:"Provider Type"}),e.jsxs(Fe,{value:l.provider,onValueChange:j=>h({...l,provider:j}),children:[e.jsx(Pe,{children:e.jsx(Ie,{placeholder:"Select provider type"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"skytech",children:"SkyTech"}),e.jsx(K,{value:"other",children:"Other"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"endpoint",children:"API Endpoint"}),e.jsx(Y,{id:"endpoint",value:l.endpoint,onChange:j=>h({...l,endpoint:j.target.value}),placeholder:"https://api.example.com/v1/orders",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"apiKey",children:"API Key"}),e.jsx(Y,{id:"apiKey",type:"password",value:l.apiKey,onChange:j=>h({...l,apiKey:j.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"apiSecret",children:"API Secret"}),e.jsx(Y,{id:"apiSecret",type:"password",value:l.apiSecret,onChange:j=>h({...l,apiSecret:j.target.value}),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"networkMappings",children:"Network Mappings (JSON)"}),e.jsx(Ls,{id:"networkMappings",value:l.networkMappings,onChange:j=>h({...l,networkMappings:j.target.value}),placeholder:'{"mtn": "MTN", "telecel": "TELECEL"}',rows:6,required:!0}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"JSON mapping of internal network names to external API network codes"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Mt,{id:"isActive",checked:l.isActive,onCheckedChange:j=>h({...l,isActive:j}),className:"data-[state=checked]:bg-green-500 data-[state=unchecked]:bg-red-500 [&_[data-radix-switch-thumb]]:bg-white"}),e.jsx(V,{htmlFor:"isActive",children:"Active"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Mt,{id:"isDefault",checked:l.isDefault,onCheckedChange:j=>h({...l,isDefault:j}),className:"data-[state=checked]:bg-green-500 data-[state=unchecked]:bg-red-500 [&_[data-radix-switch-thumb]]:bg-white"}),e.jsx(V,{htmlFor:"isDefault",children:"Set as Default"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 pt-4",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>x(!1),className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(p,{type:"submit",disabled:g,className:"w-full sm:w-auto",children:g?"Saving...":m?"Update":"Create"})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 lg:gap-6",children:i.map(j=>e.jsxs(F,{className:"relative",children:[e.jsx($,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(G,{className:"text-lg flex items-center space-x-2 flex-wrap",children:[e.jsx("span",{className:"truncate",children:j.name}),j.isDefault&&e.jsxs(Z,{variant:"default",className:"text-xs shrink-0 bg-yellow-500 text-black",children:[e.jsx(oi,{className:"h-3 w-3 mr-1"}),"Default"]}),!j.isActive&&e.jsx(Z,{variant:"secondary",className:"text-xs shrink-0 bg-gray-600 text-white",children:"Inactive"})]}),e.jsxs("div",{className:"flex space-x-1 shrink-0",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>W(j),disabled:f===j.id,title:"Test Provider",className:"h-8 w-8",children:e.jsx(mi,{className:`h-4 w-4 ${f===j.id?"animate-pulse":""}`})}),!j.isDefault&&e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>H(j.id),title:"Set as Default",className:"h-8 w-8",children:e.jsx(xi,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>C(j),title:"Edit Provider",className:"h-8 w-8",children:e.jsx(za,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>se(j.id),title:"Delete Provider",className:"text-destructive hover:text-destructive h-8 w-8",children:e.jsx(Ws,{className:"h-4 w-4"})})]})]})}),e.jsxs(D,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(V,{className:"text-sm font-medium text-muted-foreground",children:"Provider Type"}),e.jsx("p",{className:"text-sm",children:j.provider})]}),e.jsxs("div",{children:[e.jsx(V,{className:"text-sm font-medium text-muted-foreground",children:"Endpoint"}),e.jsx("p",{className:"font-mono break-all text-xs",children:j.endpoint})]}),e.jsxs("div",{children:[e.jsx(V,{className:"text-sm font-medium text-muted-foreground",children:"API Key"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{value:y[j.id]?j.apiKey:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",readOnly:!0,className:"font-mono h-8 text-xs"}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>L(j.id),className:"h-8 w-8 shrink-0",children:y[j.id]?e.jsx(et,{className:"h-4 w-4"}):e.jsx(st,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx(V,{className:"text-sm font-medium text-muted-foreground",children:"Network Mappings"}),e.jsx("div",{className:"text-xs bg-muted p-2 rounded max-h-20 overflow-y-auto border",children:e.jsx("pre",{className:"whitespace-pre-wrap break-words",children:j.networkMappings||"{}"})})]})]})]},j.id))}),i.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"text-muted-foreground",children:[e.jsx("p",{className:"text-lg mb-2",children:"No external API providers configured"}),e.jsx("p",{className:"text-sm",children:"Add your first provider to enable external data bundle purchases"})]})})]})})]})]})}function ur(s){if(Array.isArray(s.audiences))return s.audiences;if(typeof s.audiences=="string")try{const t=JSON.parse(s.audiences);return Array.isArray(t)?t:[t]}catch{return[s.audiences]}return s.audience?[s.audience]:["all"]}function pr(s){const t=/(https?:\/\/[^\s]+)/g;return s.split(t).map((i,n)=>t.test(i)?e.jsxs("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-flex items-start gap-1 flex-wrap break-words break-all overflow-wrap-anywhere whitespace-pre-wrap text-left",children:[e.jsx("span",{className:"min-w-0 break-words break-all overflow-wrap-anywhere whitespace-pre-wrap",children:i}),e.jsx(vt,{className:"h-3 w-3 flex-shrink-0"})]},n):i)}function Ad(){const{toast:s}=fe(),[t,a]=o.useState(!1),[i,n]=o.useState({title:"",message:"",audiences:["all"]}),[r,d]=o.useState(null),{data:c,isLoading:x}=ee({queryKey:["/api/admin/announcements"],refetchInterval:3e4,onSuccess:l=>{console.log("[Admin] Fetched announcements:",l==null?void 0:l.map(h=>({id:h.id,title:h.title,audiences:h.audiences})))}}),m=oe({mutationFn:l=>(console.log("[Admin] Sending to API:",l),Q("POST","/api/admin/announcements",l)),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/announcements"]}),s({title:"âœ… Announcement created successfully"}),n({title:"",message:"",audiences:["all"]})},onError:l=>{s({title:"Failed to create announcement",description:l.message,variant:"destructive"})}}),b=oe({mutationFn:({id:l,isActive:h})=>Q("PATCH",`/api/admin/announcements/${l}`,{isActive:h}),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/announcements"]}),s({title:"âœ… Announcement updated successfully"})},onError:l=>{s({title:"Failed to update announcement",description:l.message,variant:"destructive"})}}),g=oe({mutationFn:l=>Q("DELETE",`/api/admin/announcements/${l}`,{}),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/announcements"]}),s({title:"âœ… Announcement deleted successfully"}),d(null)},onError:l=>{s({title:"Failed to delete announcement",description:l.message,variant:"destructive"})}}),u=()=>{if(!i.title.trim()||!i.message.trim()){s({title:"Validation Error",description:"Please fill in both title and message",variant:"destructive"});return}console.log("Creating announcement with audiences:",i.audiences),m.mutate(i)},f=(c==null?void 0:c.filter(l=>l.isActive))||[],N=(c==null?void 0:c.filter(l=>!l.isActive))||[];return e.jsxs("div",{className:"flex h-screen bg-background",children:[t&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>a(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>a(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Announcements"})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(As,{className:"h-5 w-5"}),"Create New Announcement"]}),e.jsx(te,{children:"Create announcements that will be shown to all registered users when they login"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"title",children:"Title"}),e.jsx(Ls,{id:"title",value:i.title,onChange:l=>n({...i,title:l.target.value}),placeholder:"Enter announcement title",rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"message",children:"Message"}),e.jsx(Ls,{id:"message",value:i.message,onChange:l=>n({...i,message:l.target.value}),placeholder:"Enter announcement message",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Target Audiences (Select One or More)"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 border rounded-lg p-4",children:[{value:"all",label:"Everyone"},{value:"guest",label:"Guests Only"},{value:"loggedIn",label:"Logged In Users"},{value:"agent",label:"Agents"},{value:"storefront",label:"Storefront Visitors"}].map(({value:l,label:h})=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.audiences.includes(l),onChange:y=>{if(y.target.checked)if(l==="all")n({...i,audiences:["all"]});else{const M=i.audiences.filter(S=>S!=="all").concat(l);n({...i,audiences:M})}else{const M=i.audiences.filter(S=>S!==l);n({...i,audiences:M.length>0?M:["all"]})}},className:"rounded"}),e.jsx("span",{className:"text-sm",children:h})]},l))})]}),e.jsx(p,{onClick:u,disabled:m.isPending,className:"w-full",children:m.isPending?"Creating...":"Create Announcement"})]})]}),f.length>0&&e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(st,{className:"h-5 w-5 text-green-600"}),"Active Announcements (",f.length,")"]}),e.jsx(te,{children:"These announcements are currently visible to users"})]}),e.jsx(D,{children:e.jsx("div",{className:"space-y-3 md:space-y-4",children:f.map(l=>e.jsxs("div",{className:"border rounded-lg p-3 md:p-4",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-2 font-mono",children:["Raw audiences: ",JSON.stringify(l.audiences)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm md:text-base leading-tight break-words",children:l.title}),e.jsx("div",{className:"text-muted-foreground mt-1 md:mt-2 text-xs md:text-sm leading-relaxed break-words overflow-wrap-anywhere whitespace-pre-wrap",children:pr(l.message)}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-2 md:mt-3 text-xs md:text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Created: ",Ze(l.createdAt)]}),e.jsx(Z,{variant:"secondary",className:"bg-green-100 text-green-800 text-xs w-fit",children:"Active"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ur(l).map(h=>e.jsx(Z,{variant:"outline",className:"text-xs w-fit capitalize",children:h==="all"?"Everyone":h==="guest"?"Guests":h==="loggedIn"?"Logged In":h==="agent"?"Agents":h==="storefront"?"Storefront":h},h))})]})]}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-shrink-0",children:[e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>b.mutate({id:l.id,isActive:!1}),disabled:b.isPending,className:"h-8 w-8 p-0 sm:h-9 sm:w-auto sm:px-3",children:[e.jsx(et,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"sr-only sm:not-sr-only sm:ml-1",children:"Hide"})]}),e.jsxs(p,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive h-8 w-8 p-0 sm:h-9 sm:w-auto sm:px-3",onClick:()=>d(l.id),children:[e.jsx(Ws,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"sr-only sm:not-sr-only sm:ml-1",children:"Delete"})]})]})]})]},l.id))})})]}),N.length>0&&e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(et,{className:"h-5 w-5 text-muted-foreground"}),"Inactive Announcements (",N.length,")"]}),e.jsx(te,{children:"These announcements are hidden from users"})]}),e.jsx(D,{children:e.jsx("div",{className:"space-y-3 md:space-y-4",children:N.map(l=>e.jsx("div",{className:"border rounded-lg p-3 md:p-4 opacity-75",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm md:text-base leading-tight break-words",children:l.title}),e.jsx("div",{className:"text-muted-foreground mt-1 md:mt-2 text-xs md:text-sm leading-relaxed break-words overflow-wrap-anywhere whitespace-pre-wrap",children:pr(l.message)}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-2 md:mt-3 text-xs md:text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Created: ",Ze(l.createdAt)]}),e.jsx(Z,{variant:"outline",className:"w-fit",children:"Inactive"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ur(l).map(h=>e.jsx(Z,{variant:"outline",className:"text-xs w-fit capitalize",children:h==="all"?"Everyone":h==="guest"?"Guests":h==="loggedIn"?"Logged In":h==="agent"?"Agents":h==="storefront"?"Storefront":h},h))})]})]}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-shrink-0",children:[e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>b.mutate({id:l.id,isActive:!0}),disabled:b.isPending,className:"h-8 w-8 p-0 sm:h-9 sm:w-auto sm:px-3",children:[e.jsx(st,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"sr-only sm:not-sr-only sm:ml-1",children:"Show"})]}),e.jsxs(p,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive h-8 w-8 p-0 sm:h-9 sm:w-auto sm:px-3",onClick:()=>d(l.id),children:[e.jsx(Ws,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"sr-only sm:not-sr-only sm:ml-1",children:"Delete"})]})]})]})},l.id))})})]}),(c==null?void 0:c.length)===0&&!x&&e.jsx(F,{children:e.jsxs(D,{className:"text-center py-12",children:[e.jsx(ja,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Announcements Yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Create your first announcement to communicate with users"})]})})]})})]}),e.jsx(wt,{open:!!r,onOpenChange:l=>!l&&d(null),children:e.jsxs(ht,{className:"bg-white dark:bg-slate-900 text-white shadow-xl border border-border",children:[e.jsxs(ut,{children:[e.jsx(gt,{children:"Delete Announcement"}),e.jsx(jt,{children:"Are you sure you want to delete this announcement? This action cannot be undone."})]}),e.jsxs(pt,{children:[e.jsx(bt,{children:"Cancel"}),e.jsx(ft,{onClick:()=>r&&g.mutate(r),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})}function Td(){const{toast:s}=fe(),[t,a]=o.useState(!1),[i,n]=o.useState({title:"",description:"",category:"guest",url:"",provider:void 0,isPublished:!0}),[r,d]=o.useState(null),{data:c}=ee({queryKey:["/api/admin/guides"]}),x=oe({mutationFn:u=>Q("POST","/api/admin/guides",u),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/guides"]}),s({title:"âœ… Guide created successfully"}),n({title:"",description:"",category:"guest",url:"",provider:void 0,isPublished:!0})},onError:u=>{s({title:"Failed to create guide",description:u.message,variant:"destructive"})}}),m=oe({mutationFn:({id:u,data:f})=>Q("PATCH",`/api/admin/guides/${u}`,f),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/guides"]}),s({title:"âœ… Guide updated successfully"})},onError:u=>{s({title:"Failed to update guide",description:u.message,variant:"destructive"})}}),b=oe({mutationFn:u=>Q("DELETE",`/api/admin/guides/${u}`,{}),onSuccess:()=>{be.invalidateQueries({queryKey:["/api/admin/guides"]}),s({title:"âœ… Guide deleted successfully"}),d(null)},onError:u=>{s({title:"Failed to delete guide",description:u.message,variant:"destructive"})}}),g=()=>{var u,f;if(!((u=i.title)!=null&&u.trim())||!((f=i.url)!=null&&f.trim())||!i.category){s({title:"Validation Error",description:"Please fill in title, URL and category",variant:"destructive"});return}x.mutate(i)};return e.jsxs("div",{className:"flex h-screen bg-background",children:[t&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>a(!1)})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>a(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Video Guides"})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(As,{className:"h-5 w-5"}),"Add New Guide"]}),e.jsxs(te,{children:["You can use any YouTube/Vimeo URL - it will be automatically converted to embed format.",e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-1 block",children:"âœ… Supported: youtube.com/watch, youtube.com/shorts, youtu.be, vimeo.com, or direct MP4 links"})]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"title",children:"Title"}),e.jsx(Y,{id:"title",value:i.title||"",onChange:u=>n({...i,title:u.target.value}),placeholder:"Guide title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"category",children:"Category"}),e.jsxs(Fe,{value:i.category,onValueChange:u=>n({...i,category:u}),children:[e.jsx(Pe,{id:"category",children:e.jsx(Ie,{placeholder:"Select category"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"guest",children:"Guest"}),e.jsx(K,{value:"customer",children:"Customer"}),e.jsx(K,{value:"agent",children:"Agent"})]})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(V,{htmlFor:"url",children:"Video URL"}),e.jsx(Y,{id:"url",value:i.url||"",onChange:u=>n({...i,url:u.target.value}),placeholder:"Paste any YouTube or Vimeo link (e.g., youtube.com/watch?v=xxx or youtube.com/shorts/xxx)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"The URL will be automatically converted to the correct embed format"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(V,{htmlFor:"description",children:"Description"}),e.jsx(Ls,{id:"description",value:i.description||"",onChange:u=>n({...i,description:u.target.value}),placeholder:"Optional description",rows:3})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Mt,{id:"published",checked:i.isPublished??!0,onCheckedChange:u=>n({...i,isPublished:u})}),e.jsx(V,{htmlFor:"published",children:"Published"})]})]}),e.jsx(p,{onClick:g,disabled:x.isPending,className:"w-full",children:x.isPending?"Creating...":"Create Guide"})]})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Da,{className:"h-5 w-5"}),"All Guides (",(c==null?void 0:c.length)||0,")"]}),e.jsx(te,{children:"Manage visibility and update details."})]}),e.jsx(D,{children:e.jsx("div",{className:"space-y-3",children:(c||[]).map(u=>e.jsx("div",{className:"border rounded-lg p-3 md:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{variant:"secondary",className:"capitalize",children:u.category}),u.isPublished?e.jsx(Z,{variant:"secondary",className:"bg-green-100 text-green-800 text-xs",children:"Published"}):e.jsx(Z,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 text-xs",children:"Draft"})]}),e.jsx("h3",{className:"font-semibold text-sm md:text-base leading-tight mt-1",children:u.title}),u.description&&e.jsx("div",{className:"text-muted-foreground mt-1 text-xs md:text-sm leading-relaxed",children:u.description}),u.createdAt&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["Created: ",Ze(u.createdAt)]})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0 items-center",children:[e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>m.mutate({id:u.id,data:{isPublished:!u.isPublished}}),disabled:m.isPending,children:[u.isPublished?e.jsx(et,{className:"h-4 w-4"}):e.jsx(st,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1 hidden sm:inline",children:u.isPublished?"Unpublish":"Publish"})]}),e.jsxs(p,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>d(u.id),children:[e.jsx(Ws,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1 hidden sm:inline",children:"Delete"})]})]})]})},u.id))})})]})]})})]}),e.jsx(wt,{open:!!r,onOpenChange:u=>!u&&d(null),children:e.jsxs(ht,{children:[e.jsxs(ut,{children:[e.jsx(gt,{children:"Delete Guide"}),e.jsx(jt,{children:"This action cannot be undone. This will permanently delete the guide."})]}),e.jsxs(pt,{children:[e.jsx(bt,{children:"Cancel"}),e.jsx(ft,{onClick:()=>r&&b.mutate(r),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})}function Fd(){const{toast:s}=fe(),[t,a]=o.useState(!1),[i,n]=o.useState(""),[r,d]=o.useState(null),[c,x]=o.useState(""),[m,b]=o.useState(""),[g,u]=o.useState(!1),[f,N]=o.useState(!1),[l,h]=o.useState(""),[y,M]=o.useState(""),[S,k]=o.useState(!1),[C,E]=o.useState(!1),{data:se,isLoading:H}=ee({queryKey:["/api/admin/users-agents"],refetchInterval:3e4}),W=oe({mutationFn:P=>Q("POST","/api/admin/manual-topup",P),onSuccess:P=>{be.invalidateQueries({queryKey:["/api/admin/users-agents"]}),be.invalidateQueries({queryKey:["/api/admin/transactions"]}),s({title:"âœ… Manual top-up successful",description:`${ie(P.amount)} added to ${P.userName}'s wallet`}),u(!1),d(null),x(""),b("")},onError:P=>{s({title:"Failed to process top-up",description:P.message,variant:"destructive"})}}),L=oe({mutationFn:P=>Q("POST","/api/admin/manual-deduct",P),onSuccess:P=>{be.invalidateQueries({queryKey:["/api/admin/users-agents"]}),be.invalidateQueries({queryKey:["/api/admin/transactions"]}),s({title:"âœ… Deduction successful",description:`${ie(P.amount)} deducted from ${P.userName}'s wallet`}),k(!1),d(null),h(""),M("")},onError:P=>{s({title:"Failed to process deduction",description:P.message,variant:"destructive"})}}),j=(se==null?void 0:se.filter(P=>P.name.toLowerCase().includes(i.toLowerCase())||P.email.toLowerCase().includes(i.toLowerCase())||P.phone&&P.phone.includes(i)))||[],v=()=>{if(!r||!c||!m){s({title:"Missing information",description:"Please fill in all required fields",variant:"destructive"});return}const P=parseFloat(c);if(isNaN(P)||P<=0){s({title:"Invalid amount",description:"Please enter a valid positive amount",variant:"destructive"});return}N(!0)},I=()=>{r&&(W.mutate({userId:r.id,amount:parseFloat(c),reason:m}),N(!1))},A=()=>{if(!r||!l||!y){s({title:"Missing information",description:"Please fill in all required fields",variant:"destructive"});return}const P=parseFloat(l);if(isNaN(P)||P<=0){s({title:"Invalid amount",description:"Please enter a valid positive amount",variant:"destructive"});return}if(P>r.walletBalance){s({title:"Insufficient balance",description:"Deduction amount exceeds user's wallet balance",variant:"destructive"});return}E(!0)},B=()=>{r&&(L.mutate({userId:r.id,amount:parseFloat(l),reason:y}),E(!1))},w=P=>{switch(P){case"agent":case"dealer":case"super_dealer":case"master":return e.jsx(os,{className:"h-4 w-4"});default:return e.jsx(Ht,{className:"h-4 w-4"})}},R=P=>{switch(P){case"admin":return"bg-red-100 text-red-800";case"master":return"bg-purple-100 text-purple-800";case"super_dealer":return"bg-blue-100 text-blue-800";case"dealer":return"bg-green-100 text-green-800";case"agent":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"flex h-screen bg-background",children:[t&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsx("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-sidebar border-r transform transition-transform duration-200 ease-in-out",children:e.jsx(Se,{onClose:()=>a(!1)})})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4 h-16 border-b px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>a(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-base font-semibold",children:"Manual Top-up"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Manually add funds to user/agent wallets"})]})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"Manual Wallet Top-up"]}),e.jsx(te,{children:"Search for users or agents and manually add funds to their wallets"})]}),e.jsx(D,{className:"space-y-4",children:e.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx(V,{htmlFor:"search",children:"Search Users/Agents"}),e.jsxs("div",{className:"relative",children:[e.jsx(Lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{id:"search",placeholder:"Search by name, email, or phone...",value:i,onChange:P=>n(P.target.value),className:"pl-10"})]})]})})})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{children:["Users & Agents (",j.length,")"]}),e.jsx(te,{children:"Select a user or agent to manually top-up their wallet"})]}),e.jsxs(D,{children:[H?e.jsx(Ts,{}):e.jsx("div",{className:"overflow-x-auto -mx-6 px-6 md:mx-0 md:px-0",children:e.jsxs(rs,{className:"min-w-full",children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{className:"whitespace-nowrap",children:"User"}),e.jsx(U,{className:"whitespace-nowrap",children:"Role"}),e.jsx(U,{className:"whitespace-nowrap",children:"Phone"}),e.jsx(U,{className:"whitespace-nowrap",children:"Wallet Balance"}),e.jsx(U,{className:"whitespace-nowrap",children:"Actions"})]})}),e.jsx(ns,{children:j.map(P=>e.jsxs(we,{children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[w(P.role),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:P.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:P.email})]})]})}),e.jsx(z,{children:e.jsx(Z,{className:R(P.role),children:P.role.replace("_"," ").toUpperCase()})}),e.jsx(z,{className:"whitespace-nowrap",children:P.phone||"N/A"}),e.jsx(z,{className:"font-medium whitespace-nowrap",children:ie(P.walletBalance)}),e.jsx(z,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{size:"sm",onClick:()=>{d(P),u(!0)},className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 whitespace-nowrap",children:[e.jsx(As,{className:"h-4 w-4"}),"Top-up"]}),e.jsxs(p,{size:"sm",variant:"destructive",onClick:()=>{d(P),k(!0)},className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(Bl,{className:"h-4 w-4"}),"Deduct"]})]})})]},P.id))})]})}),!H&&j.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:i?"No users found matching your search.":"No users or agents found."})]})]})]})})]}),e.jsx(us,{open:g,onOpenChange:u,children:e.jsxs(ss,{className:"bg-card text-card-foreground",style:{backgroundColor:"hsl(var(--card))",opacity:1},children:[e.jsxs(ts,{children:[e.jsx(as,{children:"Manual Wallet Top-up"}),e.jsxs(Ks,{children:["Add funds to ",r==null?void 0:r.name,"'s wallet"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"amount",children:"Amount (GHS)"}),e.jsx(Y,{id:"amount",type:"number",step:"0.01",min:"0",placeholder:"Enter amount",value:c,onChange:P=>x(P.target.value)})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"reason",children:"Reason"}),e.jsxs(Fe,{value:m,onValueChange:b,children:[e.jsx(Pe,{children:e.jsx(Ie,{placeholder:"Select a reason"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"compensation",children:"Compensation"}),e.jsx(K,{value:"bonus",children:"Bonus"}),e.jsx(K,{value:"refund",children:"Refund"}),e.jsx(K,{value:"adjustment",children:"Balance Adjustment"}),e.jsx(K,{value:"promotion",children:"Promotional Credit"}),e.jsx(K,{value:"other",children:"Other"})]})]})]}),r&&e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Current Balance:"})," ",ie(r.walletBalance)]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"New Balance:"})," ",ie(r.walletBalance+(parseFloat(c)||0))]})]})]}),e.jsxs(la,{children:[e.jsx(p,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(p,{onClick:v,disabled:W.isPending,children:W.isPending?"Processing...":"Top-up Wallet"})]})]})}),e.jsx(wt,{open:f,onOpenChange:N,children:e.jsxs(ht,{className:"bg-white dark:bg-gray-900 border-0 shadow-lg text-white dark:text-white",children:[e.jsxs(ut,{children:[e.jsx(gt,{children:"Confirm Manual Top-up"}),e.jsxs(jt,{children:["Are you sure you want to add ",ie(parseFloat(c)||0)," to ",r==null?void 0:r.name,"'s wallet?",e.jsx("br",{}),e.jsx("strong",{children:"Reason:"})," ",m]})]}),e.jsxs(pt,{children:[e.jsx(bt,{children:"Cancel"}),e.jsx(ft,{onClick:I,className:"bg-green-600 hover:bg-green-700",children:"Confirm Top-up"})]})]})}),e.jsx(us,{open:S,onOpenChange:k,children:e.jsxs(ss,{className:"bg-card text-card-foreground",style:{backgroundColor:"hsl(var(--card))",opacity:1},children:[e.jsxs(ts,{children:[e.jsx(as,{children:"Manual Wallet Deduction"}),e.jsxs(Ks,{children:["Deduct funds from ",r==null?void 0:r.name,"'s wallet"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"deduct-amount",children:"Amount (GHS)"}),e.jsx(Y,{id:"deduct-amount",type:"number",step:"0.01",min:"0",max:(r==null?void 0:r.walletBalance)||0,placeholder:"Enter amount to deduct",value:l,onChange:P=>h(P.target.value)})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"deduct-reason",children:"Reason"}),e.jsxs(Fe,{value:y,onValueChange:M,children:[e.jsx(Pe,{children:e.jsx(Ie,{placeholder:"Select a reason"})}),e.jsxs(Ce,{children:[e.jsx(K,{value:"correction",children:"Balance Correction"}),e.jsx(K,{value:"penalty",children:"Penalty"}),e.jsx(K,{value:"chargeback",children:"Chargeback"}),e.jsx(K,{value:"fraud",children:"Fraud Investigation"}),e.jsx(K,{value:"adjustment",children:"Administrative Adjustment"}),e.jsx(K,{value:"other",children:"Other"})]})]})]}),r&&e.jsxs("div",{className:"p-3 bg-destructive/10 border border-destructive rounded-lg",children:[e.jsxs("div",{className:"text-sm text-destructive",children:[e.jsx("strong",{children:"Current Balance:"})," ",ie(r.walletBalance)]}),e.jsxs("div",{className:"text-sm text-destructive",children:[e.jsx("strong",{children:"New Balance:"})," ",ie(Math.max(0,r.walletBalance-(parseFloat(l)||0)))]}),parseFloat(l)>r.walletBalance&&e.jsx("div",{className:"text-xs text-destructive mt-2",children:"âš ï¸ Deduction exceeds available balance"})]})]}),e.jsxs(la,{children:[e.jsx(p,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(p,{variant:"destructive",onClick:A,disabled:L.isPending,children:L.isPending?"Processing...":"Deduct from Wallet"})]})]})}),e.jsx(wt,{open:C,onOpenChange:E,children:e.jsxs(ht,{className:"bg-white dark:bg-gray-900 border-0 shadow-lg text-white dark:text-white",children:[e.jsxs(ut,{children:[e.jsx(gt,{children:"âš ï¸ Confirm Wallet Deduction"}),e.jsx(jt,{asChild:!0,children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:["Are you sure you want to deduct ",ie(parseFloat(l)||0)," from ",r==null?void 0:r.name,"'s wallet?"]}),e.jsx("div",{className:"text-red-600 dark:text-red-400 font-semibold",children:"This action cannot be undone!"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Reason:"})," ",y]})]})})]}),e.jsxs(pt,{children:[e.jsx(bt,{children:"Cancel"}),e.jsx(ft,{onClick:B,className:"bg-red-600 hover:bg-red-700",children:"Confirm Deduction"})]})]})})]})}function Id(){const[s,t]=o.useState(!1);ve();const{data:a,isLoading:i}=ee({queryKey:["/api/rankings/customers"],refetchInterval:6e4}),n=r=>r===0?e.jsx(Gs,{className:"h-5 w-5 text-yellow-500"}):r===1?e.jsx($a,{className:"h-5 w-5 text-gray-400"}):r===2?e.jsx(wa,{className:"h-5 w-5 text-amber-600"}):e.jsxs("span",{className:"text-sm font-semibold text-muted-foreground",children:["#",r+1]});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background",children:[e.jsx("header",{className:"border-b",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between h-16 px-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:()=>t(!0),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg lg:text-xl font-semibold",children:"Users Ranking"})]}),e.jsx(ke,{})]})}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(F,{children:[e.jsx($,{children:e.jsxs("div",{children:[e.jsxs(G,{className:"text-lg flex items-center gap-2",children:[e.jsx(Gs,{className:"h-5 w-5 text-yellow-500"}),"Top Customers"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Highest spending customers"})]})}),e.jsx(D,{children:i?e.jsx(Ts,{rows:10}):a&&a.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{className:"w-16",children:"Rank"}),e.jsx(U,{children:"Customer"}),e.jsx(U,{className:"text-right",children:"Purchases"}),e.jsx(U,{className:"text-right",children:"Total Spent"})]})}),e.jsx(ns,{children:a.map((r,d)=>e.jsxs(we,{children:[e.jsx(z,{className:"text-center",children:n(d)}),e.jsx(z,{children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium",children:r.displayName}),r.displayPhone&&e.jsx("span",{className:"text-xs text-muted-foreground",children:r.displayPhone})]})}),e.jsx(z,{className:"text-right font-medium",children:r.totalPurchases}),e.jsxs(z,{className:"text-right font-medium",children:["â‚µ",r.totalSpent.toFixed(2)]})]},r.rank))})]})}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Gs,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No customer rankings yet"}),e.jsx("p",{className:"text-sm",children:"Customer rankings will appear here once transactions are completed"})]})})]})})})]})}const Ed={mtn:{name:"MTN",logo:$t},telecel:{name:"Telecel",logo:zt},airteltigo:{name:"AirtelTigo",logo:ws},at_bigtime:{name:"AT BIG TIME",logo:ws},at_ishare:{name:"AT iShare",logo:ws}},Bd=ae.object({customerPhone:ae.string().min(10,"Phone number must be exactly 10 digits").max(10,"Phone number must be exactly 10 digits").regex(/^0[0-9]{9}$/,"Phone number must start with 0 and be 10 digits (e.g., 0241234567)"),customerEmail:ae.string().email("Invalid email")}),Od=ae.object({phoneNumbers:ae.string().min(10,"Enter at least one phone number with GB amount").refine(s=>s.split(/\n/).map(a=>a.trim()).filter(a=>a).every(a=>{const i=a.split(/\s+/);if(i.length!==2)return!1;let n=i[0].replace(/^\+/,"");n.startsWith("233")&&(n="0"+n.substring(3));const r=/^0[0-9]{9}$/.test(n),d=parseFloat(i[1]),c=!isNaN(d)&&d>0;return r&&c}),"Each line must have format: phone_number GB_amount (e.g., '0241234567 2' or '233241234567 2')"),customerEmail:ae.string().email("Invalid email")});function Rd(){var W;const{role:s,slug:t,network:a}=Qt(),[,i]=ze(),{toast:n}=fe(),[r,d]=o.useState(""),[c,x]=o.useState(!1),[m,b]=o.useState("single"),g=o.useRef(!1);o.useEffect(()=>{a==="at_ishare"&&m==="bulk"&&b("single")},[a,m]),o.useEffect(()=>{const L=()=>{i(`/store/${s}/${t}`)};return window.addEventListener("popstate",L),()=>window.removeEventListener("popstate",L)},[s,t,i]);const u=Ed[a||""]||{name:"Unknown",logo:""},{data:f,isLoading:N}=ee({queryKey:[`/api/store/${s}/${t}`],enabled:!!s&&!!t}),l=(f==null?void 0:f.dataBundles)||[],h=l==null?void 0:l.filter(L=>L.network===a&&L.isActive),y=h==null?void 0:h.sort((L,j)=>parseFloat(L.price)-parseFloat(j.price)),M=y==null?void 0:y.find(L=>L.id===r),S=M?parseFloat(M.price):0,k=Ss({resolver:Ps(Bd),defaultValues:{customerPhone:"",customerEmail:""}}),C=Ss({resolver:Ps(Od),defaultValues:{phoneNumbers:"",customerEmail:""}}),E=o.useMemo(()=>{const L=C.watch("phoneNumbers");if(!(L!=null&&L.trim())||!y||!(f!=null&&f.store))return{total:0,count:0};const j=L.split(`
`).filter(A=>A.trim());let v=0,I=0;for(const A of j){const B=A.trim().split(/\s+/);if(B.length===2){const w=parseFloat(B[1]);if(!isNaN(w)&&w>0){const R=y.find(P=>{const q=P.dataAmount.match(/(\d+(?:\.\d+)?)\s*gb/i);return q?parseFloat(q[1])===w:!1});if(R){const P=parseFloat(R.price);v+=P,I++}}}}return{total:v,count:I}},[C.watch("phoneNumbers"),y,f==null?void 0:f.store]),se=oe({mutationFn:async L=>{console.log("[Agent Frontend] Payment mutation called with:",L);const j="phoneNumbers"in L;if("orderItems"in L&&L.orderItems){const A=L.orderItems.map(P=>P.phone),B=L.totalAmount;console.log("[Agent Frontend] ========== NEW BULK FORMAT PAYMENT =========="),console.log("[Agent Frontend] Order items:",L.orderItems),console.log("[Agent Frontend] Total amount:",B),console.log("[Agent Frontend] ================================================");const w={productType:"data_bundle",network:a,customerPhone:A[0],isBulkOrder:!0,orderItems:L.orderItems,totalAmount:B,customerEmail:L.customerEmail||void 0,agentSlug:t||void 0};console.log("[Agent Frontend] Paystack payload:",JSON.stringify(w,null,2));const R=await Q("POST","/api/checkout/initialize",w);return console.log("[Agent Frontend] ===== SERVER RESPONSE ====="),console.log("[Agent Frontend] Result:",R),console.log("[Agent Frontend] ================================"),R}if(!M)throw new Error("No bundle selected");console.log("[Agent Frontend] Is bulk:",j),console.log("[Agent Frontend] Data:",L);const v=j?L.phoneNumbers.split(/[\n,]/).map(A=>A.trim()).filter(A=>A):[L.customerPhone];console.log("[Agent Frontend] Phone numbers array:",v),console.log("[Agent Frontend] First phone:",v[0]);const I={productType:"data_bundle",productId:M.id,customerPhone:v[0],phoneNumbers:j?v:void 0,isBulkOrder:j,customerEmail:L.customerEmail||void 0,agentSlug:t||void 0};return console.log("[Agent Frontend] Single/Legacy payload:",JSON.stringify(I,null,2)),await Q("POST","/api/checkout/initialize",I)},onSuccess:L=>{g.current=!1,localStorage.setItem("agentStorefront",JSON.stringify({role:s,slug:t,network:a})),window.location.href=L.paymentUrl},onError:L=>{g.current=!1,n({title:"âŒ Payment Failed",description:L.message||"Unable to process payment",variant:"destructive"}),x(!1)}}),H=L=>{if(g.current)return;if(g.current=!0,x(!0),!("phoneNumbers"in L)){if(!M){n({title:"No Bundle Selected",description:"Please select a data bundle to continue",variant:"destructive"});return}let P=L.customerPhone.trim();P=P.replace(/^\+/,""),P.startsWith("233")&&(P="0"+P.substring(3));const q=lt(P),T=xt(q,M.network);if(!T.isValid){const J=vs(M.network);n({title:"âŒ Phone Number Mismatch",description:T.error||`Valid prefixes: ${J.join(", ")}`,variant:"destructive",duration:8e3});return}x(!0),se.mutate({customerPhone:q,customerEmail:L.customerEmail});return}const v=L;if(!v.phoneNumbers.trim()){n({title:"Missing Information",description:"Please enter phone numbers with GB amounts",variant:"destructive"});return}const I=v.phoneNumbers.split(`
`).filter(P=>P.trim()),A=[];for(const P of I){const q=P.trim().split(/\s+/);if(q.length!==2){n({title:"âŒ Invalid Format",description:`Line "${P}" must have format: phone_number GB_amount (e.g., "0241234567 2")`,variant:"destructive",duration:8e3});return}let T=q[0];const J=parseFloat(q[1]);if(isNaN(J)||J<=0){n({title:"âŒ Invalid GB Amount",description:`GB amount "${q[1]}" must be a positive number`,variant:"destructive",duration:8e3});return}T=T.replace(/^\+/,""),T.startsWith("233")&&(T="0"+T.substring(3));const ce=lt(T),ge=xt(ce);if(!ge.isValid){const Ve=vs(a||"");n({title:"âŒ Phone Number Mismatch",description:`${T}: ${ge.error||`Valid prefixes: ${Ve.join(", ")}`}`,variant:"destructive",duration:8e3});return}A.push({phone:ce,gb:J})}if(A.length===0){n({title:"No Data",description:"Please enter at least one phone number with GB amount",variant:"destructive"});return}if(new Set(A.map(P=>P.phone)).size!==A.length){n({title:"Duplicate Numbers",description:"Phone numbers must be unique",variant:"destructive"});return}const w=[];let R=0;for(const P of A){const q=y==null?void 0:y.find(J=>{const ce=J.dataAmount.match(/(\d+(?:\.\d+)?)\s*gb/i);return ce?parseFloat(ce[1])===P.gb:!1});if(!q){n({title:"âŒ Bundle Not Found",description:`No ${P.gb}GB bundle available for ${u.name}. Please check available bundles.`,variant:"destructive",duration:8e3});return}const T=parseFloat(q.price);w.push({phone:P.phone,bundleId:q.id,bundleName:q.name,price:T}),R+=T}console.log("[Agent Frontend] Prepared order items:",w),console.log("[Agent Frontend] Total amount:",R),x(!0),se.mutate({orderItems:w,totalAmount:R,customerEmail:v.customerEmail})};return N?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):f!=null&&f.store?e.jsxs("div",{className:"fixed inset-0 flex flex-col bg-background",children:[e.jsx("header",{className:"flex-none sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsxs("div",{className:"container flex h-16 items-center justify-between px-4",children:[e.jsx(X,{href:`/store/${s}/${t}`,children:e.jsxs(p,{variant:"ghost",className:"gap-2",children:[e.jsx(Xt,{className:"h-4 w-4"}),"Back"]})}),e.jsx("h1",{className:"text-xl font-bold truncate mx-4",children:f==null?void 0:f.store.businessName}),e.jsx("div",{className:"w-20"})," "]})}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"py-8 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-4xl pb-12",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[u.logo&&e.jsx("img",{src:u.logo,alt:u.name,className:"w-16 h-16 object-contain rounded-lg"}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[u.name," Data Bundles"]}),e.jsx("p",{className:"text-muted-foreground",children:"Complete your purchase below"})]})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5"}),"Complete Your Purchase"]}),e.jsx(te,{children:"Enter order details and checkout"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"text-sm text-orange-600 flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"âš ï¸"}),e.jsx("span",{children:"Please double-check your beneficiary number before completing purchase"})]}),e.jsxs(it,{value:m,onValueChange:L=>{b(L)},className:"w-full",children:[e.jsxs(Ys,{className:"grid w-full grid-cols-2",children:[e.jsxs(De,{value:"single",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),"Single Purchase"]}),e.jsxs(De,{value:"bulk",disabled:a==="at_ishare",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Bulk Purchase",a==="at_ishare"&&e.jsx("span",{className:"text-xs text-muted-foreground ml-1",children:"(Disabled)"})]})]}),a==="at_ishare"&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Bulk purchases are not available for AT iShare network."}),e.jsx(Ue,{value:"single",className:"space-y-4 mt-4",children:e.jsx(Os,{...k,children:e.jsxs("form",{onSubmit:k.handleSubmit(H),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Select Data Bundle"}),e.jsxs(Fe,{value:r,onValueChange:L=>{d(L)},children:[e.jsx(Pe,{className:"w-full",children:e.jsx(Ie,{placeholder:"Choose a data bundle..."})}),e.jsx(Ce,{children:y==null?void 0:y.map(L=>e.jsxs(K,{value:L.id,children:[L.name," - ",L.validity," - ",ie(parseFloat(L.price))]},L.id))})]})]}),e.jsx(ue,{control:k.control,name:"customerPhone",render:({field:L})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Beneficiary Number *"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Ot,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{placeholder:"0241234567",className:"pl-10",...L})]})}),e.jsxs(Ye,{children:["Network prefixes: ",vs(a||"").join(", ")]}),e.jsx(he,{})]})}),e.jsx(ue,{control:k.control,name:"customerEmail",render:({field:L})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Email *"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Kt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{type:"email",placeholder:"your@email.com",className:"pl-10",...L})]})}),e.jsx(Ye,{children:"Required for receipt and order updates"}),e.jsx(he,{})]})}),e.jsxs("div",{className:"pt-4",children:[(()=>{const{subtotal:L,tax:j,total:v}=Bs(S);return e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bundle Price"}),e.jsxs("span",{children:["GHâ‚µ",L.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:["Paystack Fee (",_e,"%)",e.jsx(He,{className:"h-3 w-3"})]}),e.jsxs("span",{className:"text-orange-600",children:["+GHâ‚µ",j.toFixed(2)]})]}),e.jsx(Le,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total to Pay"}),e.jsxs("span",{className:"text-primary",children:["GHâ‚µ",v.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-orange-100 dark:bg-orange-900 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx(He,{className:"h-4 w-4 text-orange-600 dark:text-white mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-white",children:["A ",_e,"% Paystack fee is applied to all Paystack payments."]})]})]})})(),e.jsx(p,{type:"submit",className:"w-full gap-2",size:"lg",disabled:c||!r,children:c?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-5 w-5 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"h-5 w-5"}),"Proceed to Payment"]})})]})]})})}),e.jsx(Ue,{value:"bulk",className:"space-y-4 mt-4",children:e.jsx(Os,{...C,children:e.jsxs("form",{onSubmit:C.handleSubmit(H),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(V,{htmlFor:"bulk-phones",children:"Beneficiary Numbers and GB Amounts"}),C.watch("phoneNumbers")&&C.watch("phoneNumbers").trim()&&e.jsxs(Z,{variant:"outline",className:"text-xs",children:[C.watch("phoneNumbers").split(`
`).filter(L=>L.trim()).length," entries"]})]}),e.jsx(ue,{control:C.control,name:"phoneNumbers",render:({field:L})=>e.jsxs(me,{children:[e.jsx(xe,{children:e.jsx(Ls,{id:"bulk-phones",placeholder:`0546591622 1
0247064874 3
0245696072 2
233547897522 10
...add as many as you need (no limit)`,rows:20,className:"font-mono text-sm",...L})}),e.jsxs(Ye,{className:"text-xs",children:['Enter one number per line with GB amount (e.g., "0241234567 2" for 2GB). Supports formats: 0241234567 or 233241234567 (no + sign).',e.jsx("strong",{className:"text-green-600",children:"âœ“ No limit - add 100+ numbers!"}),e.jsx("br",{}),"All numbers must be for ",e.jsx("strong",{children:u.name})," network. Valid prefixes: ",e.jsx("strong",{children:vs(a||"").join(", ")})]}),e.jsx(he,{})]})})]}),e.jsx(ue,{control:C.control,name:"customerEmail",render:({field:L})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Email *"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Kt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{type:"email",placeholder:"your@email.com",className:"pl-10",...L})]})}),e.jsx(Ye,{children:"Required for receipt and order updates"}),e.jsx(he,{})]})}),E&&E.count>0&&e.jsx("div",{className:"pt-4",children:(()=>{const{subtotal:L,tax:j,total:v}=Bs(E.total);return e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Bundles Total (",E.count," ",E.count===1?"bundle":"bundles",")"]}),e.jsxs("span",{children:["GHâ‚µ",L.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Paystack Fee (",_e,"%)"]}),e.jsxs("span",{className:"text-orange-600",children:["+GHâ‚µ",j.toFixed(2)]})]}),e.jsx(Le,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total to Pay"}),e.jsxs("span",{className:"text-primary text-lg",children:["GHâ‚µ",v.toFixed(2)]})]})]}),e.jsx("div",{className:"bg-orange-100 dark:bg-orange-900 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2 text-xs text-orange-800 dark:text-orange-100",children:[e.jsx(He,{className:"h-4 w-4 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:["A ",_e,"% Paystack fee is applied to all Paystack payments to cover transaction costs."]})]})})]})})()}),e.jsx(p,{type:"submit",className:"w-full gap-2",size:"lg",disabled:c||!((W=C.watch("phoneNumbers"))!=null&&W.trim()),children:c?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-5 w-5 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"h-5 w-5"}),E?e.jsxs(e.Fragment,{children:["Pay GHâ‚µ",Bs(E.total).total.toFixed(2)," with Paystack"]}):"Purchase Data Bundles"]})})]})})})]})]})]}),e.jsxs("div",{className:"mt-8 space-y-4",children:[e.jsx(F,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fs,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Data Delivery Time"}),e.jsx("p",{className:"text-muted-foreground",children:"All data orders are delivered within 5â€“45 minutes. Please note that delivery times may vary during network downtime"})]})]})}),e.jsx(F,{className:"p-6 border-destructive/30 bg-destructive/10 text-card-foreground",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Vt,{className:"h-5 w-5 text-destructive mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 text-foreground",children:"Our DATA REQUEST DOES NOT support:"}),e.jsxs("ul",{className:"text-foreground/90 space-y-1 ml-4",children:[e.jsx("li",{children:"â€¢ Turbonet SIM"}),e.jsx("li",{children:"â€¢ Merchant SIM"}),e.jsx("li",{children:"â€¢ EVD SIM"}),e.jsx("li",{children:"â€¢ Broadband SIM"}),e.jsx("li",{children:"â€¢ Blacklisted SIM"}),e.jsx("li",{children:"â€¢ Roaming SIM"}),e.jsx("li",{children:"â€¢ Different Network"}),e.jsx("li",{children:"â€¢ Wrong Number"}),e.jsx("li",{children:"â€¢ Inactive Number"})]}),e.jsx("p",{className:"text-foreground font-medium mt-3",children:"Important Notice: Any data transferred to the above SIM types is burnt and irreversible."})]})]})}),e.jsx(F,{className:"p-6 border-amber-500/30 bg-amber-500/10 text-card-foreground",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Vt,{className:"h-5 w-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 text-foreground",children:"Complaint Resolution Policy"}),e.jsxs("div",{className:"text-foreground/90 space-y-2",children:[e.jsx("p",{children:"Complaints can only be resolved within 24 hours."}),e.jsx("p",{children:"If you purchase data and do not receive it, kindly report the issue within 24 hours."}),e.jsx("p",{className:"font-medium",children:"Reports made after 24 hours will not be attended to."})]})]})]})})]})]})})})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(F,{className:"p-6 max-w-md",children:e.jsx("p",{className:"text-center text-muted-foreground",children:"Agent store not found"})})})}const La={mtn:{name:"MTN",logo:$t},telecel:{name:"Telecel",logo:zt},at_bigtime:{name:"AT BIG TIME",logo:ws},at_ishare:{name:"AT iShare",logo:ws}};function Dd(){const{network:s}=Qt(),t=s==="bigtime"?"at_bigtime":s==="ishare"?"at_ishare":s,a=t==null?void 0:t.replace(/-/g,"_"),i=La[a||""]||{name:"Unknown",logo:""},r=new URLSearchParams(window.location.search).get("agent")||Ms(),d=typeof window<"u"?Ms():null;return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(gs,{}),e.jsx("main",{className:"flex-1 py-8 px-4 pt-16",children:e.jsxs("div",{className:"container mx-auto max-w-4xl",children:[e.jsx(X,{href:d?`/store/${d}`:"/",children:e.jsxs(p,{variant:"ghost",className:"gap-2 mb-6","data-testid":"button-back",children:[e.jsx(Xt,{className:"h-4 w-4"}),"Back to Products"]})}),e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[i.logo&&e.jsx("img",{src:i.logo,alt:i.name,className:"w-16 h-16 object-contain rounded-lg","data-testid":"img-network-logo"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold","data-testid":"text-network-name",children:[i.name," Data Bundles"]}),e.jsx("p",{className:"text-muted-foreground",children:"Complete your purchase in one easy flow"})]})]}),e.jsx(Md,{network:a||"",agentSlug:r}),e.jsxs("div",{className:"mt-12 space-y-6",children:[e.jsx(F,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fs,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Data Delivery Time"}),e.jsx("p",{className:"text-muted-foreground",children:"All data orders are delivered within 5â€“45 minutes. Please note that delivery times may vary during network downtime"})]})]})}),e.jsx(F,{className:"p-6 border-destructive/30 bg-destructive/10 text-card-foreground",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Vt,{className:"h-5 w-5 text-destructive mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 text-foreground",children:"Our DATA REQUEST DOES NOT support:"}),e.jsxs("ul",{className:"text-foreground/90 space-y-1 ml-4",children:[e.jsx("li",{children:"â€¢ Turbonet SIM"}),e.jsx("li",{children:"â€¢ Merchant SIM"}),e.jsx("li",{children:"â€¢ EVD SIM"}),e.jsx("li",{children:"â€¢ Broadband SIM"}),e.jsx("li",{children:"â€¢ Blacklisted SIM"}),e.jsx("li",{children:"â€¢ Roaming SIM"}),e.jsx("li",{children:"â€¢ Different Network"}),e.jsx("li",{children:"â€¢ Wrong Number"}),e.jsx("li",{children:"â€¢ Inactive Number"})]}),e.jsx("p",{className:"text-foreground font-medium mt-3",children:"Important Notice: Any data transferred to the above SIM types is burnt and irreversible."})]})]})}),e.jsx(F,{className:"p-6 border-amber-500/30 bg-amber-500/10 text-card-foreground",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Vt,{className:"h-5 w-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 text-foreground",children:"Complaint Resolution Policy"}),e.jsxs("div",{className:"text-foreground/90 space-y-2",children:[e.jsx("p",{children:"Complaints can only be resolved within 24 hours."}),e.jsx("p",{children:"If you purchase data and do not receive it, kindly report the issue within 24 hours."}),e.jsx("p",{className:"font-medium",children:"Reports made after 24 hours will not be attended to."})]})]})]})})]})]})}),e.jsx(zs,{})]})}function Md({network:s,agentSlug:t}){const{toast:a}=fe(),{user:i}=ve(),[n,r]=o.useState(""),[d,c]=o.useState("single"),[x,m]=o.useState(""),[b,g]=o.useState(""),[u,f]=o.useState("paystack"),[N,l]=o.useState(!1),h=o.useRef(!1),y=()=>{const v={top:0,behavior:"smooth"};window.requestAnimationFrame(()=>{var I,A,B,w;window.scrollTo(v),(A=(I=document.documentElement)==null?void 0:I.scrollTo)==null||A.call(I,v),(w=(B=document.body)==null?void 0:B.scrollTo)==null||w.call(B,v)})};o.useEffect(()=>{s==="at_ishare"&&d==="bulk"&&c("single")},[s,d]),o.useEffect(()=>{y()},[]);const{data:M}=ee({queryKey:["/api/user/stats"],enabled:!!i}),S=M!=null&&M.walletBalance?parseFloat(M.walletBalance):0,{data:k,isLoading:C}=ee({queryKey:["/api/products/data-bundles",s,t],queryFn:async()=>{const I=`/api/products/data-bundles?network=${s}`;return await Q("GET",I)},refetchOnMount:!0,staleTime:0});ee({queryKey:["/api/store/agent",t],queryFn:async()=>t?(await Q("GET",`/api/store/agent/${t}`)).json():null,enabled:!!t});const E=k==null?void 0:k.filter(v=>v.network===s&&v.isActive).sort((v,I)=>{const A=parseFloat(v.effective_price),B=parseFloat(I.effective_price);return A-B}),se=(E==null?void 0:E.find(v=>v.id===n))||null,H=o.useMemo(()=>{if(!(b!=null&&b.trim())||!E)return{total:0,count:0,invalidCount:0};const v=b.split(`
`).filter(w=>w.trim());let I=0,A=0,B=0;for(const w of v){const R=w.trim().split(/\s+/);if(R.length===2){const P=parseFloat(R[1]);if(!isNaN(P)&&P>0){const q=E.find(T=>{const J=T.dataAmount.match(/(\d+(?:\.\d+)?)\s*gb/i);return J?parseFloat(J[1])===P:!1});if(q){const T=parseFloat(q.effective_price);I+=T,A++}else B++}}}return{total:I,count:A,invalidCount:B}},[b,E]),W=oe({mutationFn:async v=>v.paymentMethod==="wallet"?await Q("POST","/api/wallet/pay",v):await Q("POST","/api/checkout/initialize",v)}),L=async()=>{if(h.current)return;if(h.current=!0,l(!0),!se){a({title:"No bundle selected",variant:"destructive"});return}const v=lt(x.trim());if(!v){a({title:"Invalid phone",variant:"destructive"});return}const I=xt(v,se.network);if(!I.isValid){a({title:"Phone mismatch",description:I.error||"Network mismatch",variant:"destructive"});return}if(u==="wallet"){if(!i){a({title:"Login required",description:"Please log in to pay with wallet",variant:"destructive"});return}const A=parseFloat(se.effective_price);if(S<A){a({title:"Insufficient balance",description:"Your wallet balance is not enough",variant:"destructive"});return}}l(!0);try{const A=parseFloat(se.effective_price),B={productType:"data_bundle",productId:se.id,customerPhone:v,amount:A.toFixed(2),isBulkOrder:!1,agentSlug:t,paymentMethod:u,productName:se.name,network:se.network};W.mutate(B,{onSuccess:w=>{if(h.current=!1,l(!1),u==="wallet"){if(a({title:"âœ… Payment Successful!",description:"Redirecting to live status...",duration:3e3}),w.reference){window.location.href=`/checkout/success?reference=${w.reference}`;return}}else w.paymentUrl?window.location.href=w.paymentUrl:a({title:"Payment init failed",variant:"destructive"})},onError:w=>{h.current=!1,l(!1);const R=w.message||"Checkout failed";R.includes("wait")&&R.includes("minute")?(console.log("[Checkout Error] Cooldown triggered:",R),a({title:"â³ Purchase Limit",description:R,variant:"destructive",duration:8e3})):a({title:"Error",description:R,variant:"destructive"})}})}catch{l(!1),a({title:"Error",description:"Failed to process payment",variant:"destructive"})}},j=()=>{var P;if(h.current)return;if(h.current=!0,l(!0),!b.trim()){a({title:"Missing Information",description:"Enter phone numbers with GB amounts",variant:"destructive"});return}if(!E){a({title:"No bundles",variant:"destructive"});return}const v=b.split(`
`).filter(q=>q.trim()),I=[];for(const q of v){const T=q.trim().split(/\s+/);if(T.length!==2){a({title:"Invalid Format",description:`Line "${q}" must be "phone GB"`,variant:"destructive"});return}let J=T[0].replace(/^\+/,"");J.startsWith("233")&&(J="0"+J.substring(3));const ce=parseFloat(T[1]);if(isNaN(ce)||ce<=0){a({title:"Invalid GB",variant:"destructive"});return}const ge=lt(J);if(!ge){a({title:"Invalid phone",description:J,variant:"destructive"});return}const Ve=xt(ge);if(!Ve.isValid){a({title:"Phone mismatch",description:`${J}: ${Ve.error}`,variant:"destructive"});return}I.push({phone:ge,gb:ce})}if(new Set(I.map(q=>q.phone)).size!==I.length){a({title:"Duplicate Numbers",description:"Phone numbers must be unique",variant:"destructive"});return}const B=[];let w=0;for(const q of I){const T=E.find(ce=>{const ge=ce.dataAmount.match(/(\d+(?:\.\d+)?)\s*gb/i);return ge?parseFloat(ge[1])===q.gb:!1});if(!T){a({title:"Bundle Not Found",description:`No ${q.gb}GB bundle for ${s}`,variant:"destructive"});return}const J=parseFloat(T.effective_price);B.push({phone:q.phone,bundleId:T.id,bundleName:T.name,price:J}),w+=J}const R={productType:"data_bundle",network:s,customerPhone:(P=B[0])==null?void 0:P.phone,isBulkOrder:!0,orderItems:B,totalAmount:w,agentSlug:t,paymentMethod:"paystack"};W.mutate(R,{onSuccess:q=>{h.current=!1,l(!1),q.paymentUrl?window.location.href=q.paymentUrl:a({title:"Payment init failed",variant:"destructive"})},onError:q=>{h.current=!1,l(!1),a({title:"Error",description:q.message||"Checkout failed",variant:"destructive"})}})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(F,{children:e.jsxs(D,{className:"flex items-center gap-4 p-4",children:[e.jsx("img",{src:(La[s]||{logo:""}).logo,alt:s,className:"h-12 w-12 rounded-lg object-contain"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-lg",children:(La[s]||{name:s}).name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose from our available data bundles"})]})]})}),e.jsx("p",{className:"text-sm text-amber-600 font-medium",children:"âš ï¸ Please double-check your beneficiary number before completing purchase"}),e.jsxs(it,{defaultValue:"single",className:"w-full",onValueChange:v=>c(v),children:[e.jsxs(Ys,{className:"grid w-full grid-cols-2",children:[e.jsxs(De,{value:"single",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),"Single Purchase"]}),e.jsxs(De,{value:"bulk",disabled:s==="at_ishare",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Bulk Purchase",s==="at_ishare"&&e.jsx("span",{className:"text-xs text-muted-foreground ml-1",children:"(Disabled)"})]})]}),s==="at_ishare"&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Bulk purchases are not available for AT iShare network."}),e.jsx(Ue,{value:"single",className:"space-y-4",children:e.jsx(F,{children:e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{children:"Select Bundle"}),C?e.jsx("div",{children:"Loading..."}):e.jsxs(Fe,{value:n,onValueChange:v=>r(v),children:[e.jsx(Pe,{className:"w-full",children:e.jsx(Ie,{placeholder:"Choose a data bundle"})}),e.jsx(Ce,{children:E==null?void 0:E.map(v=>{const I=parseFloat(v.effective_price);return e.jsxs(K,{value:v.id,children:[v.network.toUpperCase()," ",v.dataAmount," - ",v.validity," - GHâ‚µ",I.toFixed(2)]},v.id)})})]})]}),se&&e.jsxs("div",{className:"p-2 bg-yellow-500 text-white rounded-lg border border-yellow-600",children:[e.jsx("p",{className:"text-sm text-white",children:"Selected Bundle"}),e.jsxs("p",{className:"font-medium text-lg text-white",children:[se.network.toUpperCase()," ",se.dataAmount," - ",se.validity," - GHâ‚µ",parseFloat(se.effective_price).toFixed(2)]}),e.jsxs("p",{className:"text-2xl font-bold text-white mt-2",children:["GHâ‚µ",parseFloat(se.effective_price).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"beneficiary-phone",children:"Beneficiary Number"}),e.jsx(Y,{id:"beneficiary-phone",autoComplete:"tel",placeholder:"0241234567",value:x,onChange:v=>m(v.target.value)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Enter one number. Supports 0241234567 or 233241234567 (no +). Valid prefixes: ",vs(s).join(", ")]})]}),se&&u==="paystack"&&(()=>{const v=parseFloat(se.effective_price),{subtotal:I,tax:A,total:B}=Bs(v);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(Le,{}),e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bundle Price"}),e.jsxs("span",{children:["GHâ‚µ",I.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:["Paystack Fee (",_e,"%)",e.jsx(He,{className:"h-3 w-3"})]}),e.jsxs("span",{className:"text-orange-600",children:["+GHâ‚µ",A.toFixed(2)]})]}),e.jsx(Le,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total to Pay"}),e.jsxs("span",{className:"text-primary",children:["GHâ‚µ",B.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-orange-100 dark:bg-orange-900 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx(He,{className:"h-4 w-4 text-orange-600 dark:text-white mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-white",children:["A ",_e,"% Paystack fee is applied to all Paystack payments."]})]})]})})(),e.jsxs("div",{children:[e.jsx(V,{children:"Payment Method"}),e.jsxs(Dt,{value:u,onValueChange:v=>f(v),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(qs,{value:"paystack",id:"paystack"}),e.jsxs(V,{htmlFor:"paystack",className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),"Paystack"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(qs,{value:"wallet",id:"wallet",disabled:!i}),e.jsxs(V,{htmlFor:"wallet",className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"Wallet ",i?`(Balance: GHâ‚µ${S.toFixed(2)})`:"(Login required)"]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(p,{onClick:L,disabled:N||!se||N||u==="wallet"&&(!i||S<parseFloat((se==null?void 0:se.effective_price)||"0")),children:N?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):u==="wallet"?"Pay with Wallet":"Pay with Paystack"})})]})})}),e.jsx(Ue,{value:"bulk",className:"space-y-4",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Bulk Purchase"}),e.jsxs(te,{children:["Enter phone numbers with GB amounts for ",s.toUpperCase()]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsx(Ls,{placeholder:`0546591622 1
0247064874 3
233547897522 10`,value:b,onChange:v=>g(v.target.value),rows:8}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:['Enter one number per line with GB amount (e.g., "0241234567 2"). Supports 0241234567 or 233241234567 (no +). No limit - add 100+ numbers! All numbers must be for ',s.toUpperCase(),". Valid prefixes: ",vs(s).join(", ")]}),H&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"font-medium",children:[H.count," items â€¢ GHâ‚µ",H.total.toFixed(2)]}),H.invalidCount>0&&e.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400",children:["âš ï¸ ",H.invalidCount," bundle(s) not found for this network. Please check the GB amounts."]})]}),H&&H.count>0&&H.invalidCount===0&&(()=>{const{subtotal:v,tax:I,total:A}=Bs(H.total);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(Le,{}),e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Bundles Total (",H.count," items)"]}),e.jsxs("span",{children:["GHâ‚µ",v.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:["Paystack Fee (",_e,"%)",e.jsx(He,{className:"h-3 w-3"})]}),e.jsxs("span",{className:"text-orange-600",children:["+GHâ‚µ",I.toFixed(2)]})]}),e.jsx(Le,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total to Pay"}),e.jsxs("span",{className:"text-primary",children:["GHâ‚µ",A.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-orange-100 dark:bg-orange-900 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx(He,{className:"h-4 w-4 text-orange-600 dark:text-white mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-white",children:["A ",_e,"% Paystack fee is applied to all Paystack payments."]})]})]})})(),e.jsx("div",{className:"flex justify-end",children:e.jsx(p,{onClick:j,disabled:N||H.count===0||H.invalidCount>0,children:N?"Processing...":`Pay with Paystack ${H.count>0?` ${H.count} Bundles - GHâ‚µ${H.total.toFixed(2)}`:""}`})})]})]})})]})]})}const Ld=ae.object({customerPhone:ae.string().min(10,"Invalid phone number").regex(/^[0-9+\-\s()]*$/,"Phone number must contain only numbers and valid characters"),paymentMethod:ae.enum(["paystack","wallet"],{required_error:"Please select a payment method"})});function _d({agentSlug:s}){const[,t]=ze(),{toast:a}=fe(),{user:i}=ve(),[n,r]=o.useState(""),[d,c]=o.useState(1),[x,m]=o.useState(!1),[b,g]=o.useState(!1),[u,f]=o.useState(null),N=()=>{const A={top:0,behavior:"smooth"};window.requestAnimationFrame(()=>{var B,w,R,P;window.scrollTo(A),(w=(B=document.documentElement)==null?void 0:B.scrollTo)==null||w.call(B,A),(P=(R=document.body)==null?void 0:R.scrollTo)==null||P.call(R,A)})},{data:l,isLoading:h}=ee({queryKey:["/api/products/result-checkers/stock"],queryFn:()=>Me("/api/products/result-checkers/stock"),refetchInterval:3e4,refetchOnWindowFocus:!0});o.useEffect(()=>{N()},[]);const{data:y,isLoading:M}=ee({queryKey:["/api/user/stats"],queryFn:()=>Me("/api/user/stats"),enabled:!!i,refetchInterval:1e4}),S=l==null?void 0:l.find(A=>`${A.type}-${A.year}`===n),k=y!=null&&y.walletBalance?parseFloat(y.walletBalance):0,C=S?S.price:0,E=C*d,se=!!(!M&&y&&E>0&&k<E),H=A=>{r(A),c(1),g(!1),f(null),N()},W=A=>{if(S){const B=S.stock;A>=1&&A<=B?c(A):A>B&&a({title:"Quantity Exceeded",description:`Only ${B} PINs available for ${S.type.toUpperCase()} ${S.year}`,variant:"destructive"})}},L=()=>{if(!S||!u)return;const[A,B]=n.split("-"),w=new bi;let R=20;const P=w.internal.pageSize.getHeight(),q=15,T=7;w.setFontSize(18),w.setFont("helvetica","bold"),w.text("RESULT CHECKER PURCHASE RECEIPT",q,R),R+=12,w.setFontSize(10),w.setFont("helvetica","normal"),w.text(`Receipt Date: ${new Date().toLocaleString()}`,q,R),R+=T,w.text(`Transaction ID: ${u.transactionId||"RCP"+Date.now()}`,q,R),R+=12,w.setFont("helvetica","bold"),w.setFontSize(12),w.text("PURCHASE DETAILS",q,R),R+=8,w.setFont("helvetica","normal"),w.setFontSize(10),w.text(`Product: ${A.toUpperCase()} Result Checker ${B}`,q,R),R+=T,w.text(`Quantity: ${d}`,q,R),R+=T,w.text(`Unit Price: GHâ‚µ${S.price.toFixed(2)}`,q,R),R+=T,w.setFont("helvetica","bold"),w.text(`Total Amount: GHâ‚µ${E.toFixed(2)}`,q,R),R+=12,w.setFont("helvetica","bold"),w.setFontSize(12),w.text("RESULT CHECKER DETAILS",q,R),R+=8,w.setFont("helvetica","normal"),w.setFontSize(10);const J=u.pinsData||[];J.length>0?J.forEach((ce,ge)=>{R>P-30&&(w.addPage(),R=q),w.text(`PIN ${ge+1}:`,q,R),R+=T,w.text(`Serial number: ${ce.serialNumber||ce.serial||"XXXXX-XXXXX-XXXXX"}`,q+5,R),R+=T,w.text(`Pin: ${ce.pin||"XXXX-XXXX-XXXX-XXXX"}`,q+5,R),R+=10}):u.deliveredPin&&(w.text(`Serial number: ${u.serialNumber||u.deliveredPin.split("-")[0]||"XXXXX-XXXXX-XXXXX"}`,q+5,R),R+=T,w.text(`Pin: ${u.deliveredPin}`,q+5,R),R+=12),R>P-40&&(w.addPage(),R=q),w.setFont("helvetica","bold"),w.setFontSize(12),w.text("CUSTOMER INFORMATION",q,R),R+=8,w.setFont("helvetica","normal"),w.setFontSize(10),w.text(`Phone: ${(i==null?void 0:i.phone)||"N/A"}`,q,R),R+=T,w.text(`Email: ${(i==null?void 0:i.email)||"N/A"}`,q,R),R+=12,w.setFont("helvetica","bold"),w.setFontSize(12),w.text("DELIVERY STATUS",q,R),R+=8,w.setFont("helvetica","normal"),w.setFontSize(10),w.text("Status: Completed",q,R),R+=T,w.text(`PINs Delivered: ${d}`,q,R),R+=12,w.setFontSize(9),w.setFont("helvetica","italic"),w.text("Keep this receipt safe for your records. Use the provided PINs to check WAEC results.",q,P-20),w.text(`Generated: ${new Date().toISOString()}`,q,P-10),w.save(`result-checker-receipt-${Date.now()}.pdf`),a({title:"âœ… Downloaded",description:"Your receipt has been downloaded successfully"})},j=Ss({resolver:Ps(Ld),defaultValues:{customerPhone:""}}),v=oe({mutationFn:async A=>{if(!S)throw new Error("No checker selected");const[B,w]=n.split("-");if(A.paymentMethod==="wallet"){const R={productType:"result_checker",productId:`${B}-${w}`,productName:`${d} x ${B.toUpperCase()} Result Checker ${w}`,amount:E.toFixed(2),agentSlug:s||void 0,quantity:d};return await Me("/api/wallet/pay",{method:"POST",body:JSON.stringify(R)})}else{const R={productType:"result_checker",productId:`${B}-${w}`,productName:`${d} x ${B.toUpperCase()} Result Checker ${w}`,amount:E.toFixed(2),customerPhone:A.customerPhone,customerEmail:(i==null?void 0:i.email)||void 0,agentSlug:s||void 0,quantity:d};return console.log("[Result Checker] Paystack payment payload:",{amount:R.amount,quantity:R.quantity,unitPrice:C,totalPrice:E}),await Me("/api/checkout/initialize",{method:"POST",body:JSON.stringify(R)})}},onSuccess:(A,B)=>{var w;if(m(!1),B.paymentMethod==="wallet"){if(a({title:"âœ… Payment Successful!",description:"Redirecting to live status...",duration:3e3}),A!=null&&A.reference){t(`/checkout/success?reference=${A.reference}`);return}f(A),g(!0)}else{const R=A.paymentUrl||A.authorizationUrl||A.authorization_url||((w=A.data)==null?void 0:w.authorization_url);R?window.location.href=R:(console.error("Payment response:",A),a({title:"âŒ Payment Initialization Failed",description:A.message||"Unable to redirect to payment page. Please try again.",variant:"destructive"}))}},onError:A=>{const B=A.message||"Unable to process payment",w=B.toLowerCase().includes("insufficient");a({title:w?"âš ï¸ Insufficient Wallet Balance":"âŒ Payment Failed",description:w?"Your wallet balance is too low for this purchase. Please top up your wallet or use Paystack.":`${B}. Please try again or contact support if the problem persists.`,variant:"destructive",duration:6e3}),m(!1)}}),I=A=>{if(!S){a({title:"No Checker Selected",description:"Please select a result checker to continue",variant:"destructive"});return}if(S.stock<d){a({title:"Insufficient Stock",description:`Only ${S.stock} PINs available. Please reduce quantity or select another checker.`,variant:"destructive"});return}if(A.paymentMethod==="wallet"&&se){const B=E-k;a({title:"âš ï¸ Insufficient Wallet Balance",description:`You need GHâ‚µ${B.toFixed(2)} more to complete this purchase. Current balance: GHâ‚µ${k.toFixed(2)}, Required: GHâ‚µ${E.toFixed(2)}. Please top up or use Paystack.`,variant:"destructive",duration:7e3});return}m(!0),v.mutate(A)};if(h)return e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(!l||l.length===0)return e.jsx(F,{className:"p-6",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No result checkers available at the moment."})})});if(b&&S){const[A,B]=n.split("-");return e.jsxs(F,{className:"border-green-500 bg-white dark:bg-black",children:[e.jsx($,{className:"bg-green-50 dark:bg-green-900/20 border-b border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-green-600",children:e.jsx(Te,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx(G,{className:"text-green-700 dark:text-green-300 text-2xl",children:"Payment Successful! ðŸŽ‰"}),e.jsx(te,{className:"text-green-600 dark:text-green-400 mt-1",children:"Your result checkers have been delivered"})]})]})}),e.jsxs(D,{className:"pt-6 space-y-6",children:[e.jsxs("div",{className:"bg-muted dark:bg-black/20 rounded-lg p-4 space-y-3",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Purchase Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Product:"}),e.jsxs("span",{className:"font-medium",children:[A.toUpperCase()," Result Checker ",B]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Quantity:"}),e.jsxs("span",{className:"font-medium",children:[d," PIN(s)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Unit Price:"}),e.jsx("span",{className:"font-medium",children:ie(S.price)})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Total Amount Paid:"}),e.jsx("span",{className:"font-bold text-primary text-lg",children:ie(E)})]})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:[e.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-300 mb-2",children:"ðŸ“§ Delivery Details"}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-400",children:"Your result checker PINs have been sent to your email. Check your inbox (and spam folder) for the delivery details."}),(u==null?void 0:u.deliveredPin)&&e.jsxs("p",{className:"text-sm font-mono bg-white dark:bg-black rounded p-2 mt-2 text-muted-foreground",children:["Reference: ",u.deliveredPin]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsxs(p,{onClick:L,className:"flex-1 gap-2 bg-green-600 hover:bg-green-700",size:"lg",children:[e.jsx(ga,{className:"h-4 w-4"}),"Download Receipt"]}),e.jsx(p,{onClick:()=>t("/user/dashboard"),variant:"outline",className:"flex-1 gap-2",size:"lg",children:"Go to Dashboard"})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border border-amber-200 dark:border-amber-800",children:[e.jsx("h3",{className:"font-semibold text-amber-900 dark:text-amber-300 mb-2",children:"ðŸ“ Next Steps"}),e.jsxs("ol",{className:"text-sm text-amber-800 dark:text-amber-400 list-decimal list-inside space-y-1",children:[e.jsx("li",{children:"Use the PINs to check WAEC result on the official website"}),e.jsx("li",{children:"Keep your receipt safe for your records"}),e.jsx("li",{children:"Contact support if you encounter any issues"})]})]})]})]})}return e.jsxs(F,{children:[e.jsxs($,{className:"space-y-2",children:[e.jsx(G,{children:"Result Checker Purchase"}),e.jsx(te,{children:"Select, review, and pay in one card."})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-sm font-medium",children:"Result Checker"}),e.jsxs(Fe,{value:n,onValueChange:H,children:[e.jsx(Pe,{className:"w-full",children:e.jsx(Ie,{placeholder:"Choose a result checker..."})}),e.jsx(Ce,{children:l.map(A=>e.jsx(K,{value:`${A.type}-${A.year}`,disabled:A.stock<=0,children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-4",children:[e.jsxs("span",{className:"font-medium uppercase",children:[A.type," ",A.year]}),e.jsx("span",{className:"text-muted-foreground text-sm",children:A.stock>0?`${A.stock} in stock`:"Out of stock"}),e.jsx("span",{className:"font-bold text-primary",children:ie(A.price)})]})},`${A.type}-${A.year}`))})]})]}),S&&e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg uppercase",children:[S.type," Result Checker ",S.year]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(It,{className:"h-4 w-4 text-primary"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[S.stock," PINs available"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Unit Price"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:ie(C)})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-3 bg-background rounded-lg p-2",children:[e.jsx("button",{type:"button",onClick:()=>W(d-1),className:"p-1 hover:bg-muted rounded transition-colors disabled:opacity-50",disabled:d<=1,"aria-label":"Decrease quantity",title:"Decrease quantity",children:e.jsx(Bl,{className:"h-4 w-4"})}),e.jsx("input",{type:"number",min:"1",max:S.stock,value:d,onChange:A=>W(parseInt(A.target.value)||1),className:"w-12 text-center font-semibold border rounded px-2 py-1 text-black",placeholder:"1","aria-label":"Quantity of result checkers",title:"Enter quantity"}),e.jsx("button",{type:"button",onClick:()=>W(d+1),className:"p-1 hover:bg-muted rounded transition-colors disabled:opacity-50",disabled:d>=S.stock,"aria-label":"Increase quantity",title:"Increase quantity",children:e.jsx(As,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"pt-3 bg-white dark:bg-black/20 p-3 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Subtotal (",d,"x @ ",ie(C),")"]}),e.jsx("span",{className:"font-medium",children:ie(C*d)})]}),e.jsxs("div",{className:"flex items-center justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total Amount"}),e.jsx("span",{className:"text-primary text-2xl",children:ie(E)})]})]}),j.watch("paymentMethod")==="paystack"&&E>0&&(()=>{const{subtotal:A,tax:B,total:w}=Bs(E);return e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsx(Le,{}),e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Checker Price"}),e.jsxs("span",{children:["GHâ‚µ",A.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:["Paystack Fee (",_e,"%)",e.jsx(He,{className:"h-3 w-3"})]}),e.jsxs("span",{className:"text-orange-600",children:["+GHâ‚µ",B.toFixed(2)]})]}),e.jsx(Le,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total to Pay"}),e.jsxs("span",{className:"text-primary",children:["GHâ‚µ",w.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-orange-100 dark:bg-orange-900 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx(He,{className:"h-4 w-4 text-orange-600 dark:text-white mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-white",children:["A ",_e,"% Paystack fee is applied to all Paystack payments."]})]})]})})()]})]}),e.jsx(Os,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(I),className:"space-y-6",children:[e.jsx(ue,{control:j.control,name:"paymentMethod",render:({field:A})=>e.jsxs(me,{className:"space-y-3",children:[e.jsx(ia,{className:"text-green-700",children:"Payment Method"}),e.jsx(xe,{children:e.jsxs(Dt,{onValueChange:A.onChange,value:A.value,className:"grid gap-3",children:[i&&e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:`flex items-center space-x-2 p-4 rounded-lg border-2 border-muted !bg-white hover:border-green-500 cursor-pointer transition-all ${se?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(qs,{value:"wallet",id:"wallet",disabled:se}),e.jsxs(V,{htmlFor:"wallet",className:"flex items-center justify-between flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Wallet Balance"}),e.jsxs("div",{className:"text-sm text-green-600",children:["Available: GHâ‚µ",k.toFixed(2)]})]})]}),A.value==="wallet"&&e.jsx(Te,{className:"h-5 w-5 text-green-600"})]})]}),se&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"text-xs bg-destructive text-destructive-foreground px-2 py-1 rounded",children:"Insufficient"})})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 rounded-lg border-2 border-muted !bg-white hover:border-green-500 cursor-pointer transition-all",children:[e.jsx(qs,{value:"paystack",id:"paystack"}),e.jsxs(V,{htmlFor:"paystack",className:"flex items-center justify-between flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-700",children:"Paystack"}),e.jsx("div",{className:"text-sm text-green-600",children:"Pay with card, bank transfer"})]})]}),A.value==="paystack"&&e.jsx(Te,{className:"h-5 w-5 text-green-600"})]})]})]})}),e.jsx(he,{})]})}),se&&j.watch("paymentMethod")==="wallet"&&e.jsxs(Is,{variant:"default",className:"border-destructive/50 bg-white text-destructive",children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsxs(Es,{className:"text-sm",children:[e.jsx("strong",{children:"Insufficient Balance:"})," You need GHâ‚µ",(E-k).toFixed(2)," more.",e.jsx("a",{href:"/user/wallet",className:"underline ml-1 font-medium hover:text-destructive-foreground",children:"Top up wallet"})," or select Paystack."]})]}),e.jsx(ue,{control:j.control,name:"customerPhone",render:({field:A})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Phone Number *"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Ot,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{placeholder:"+233 XX XXX XXXX",type:"tel",className:"pl-10",...A})]})}),e.jsx(Ye,{children:"We'll use this number to deliver your result checker PINs"}),e.jsx(he,{})]})}),e.jsxs("div",{className:"bg-green-600 dark:bg-green-700 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(ml,{className:"h-5 w-5 text-white dark:text-white mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-white dark:text-white",children:j.watch("paymentMethod")==="wallet"?"Instant Purchase":"Secure Payment"}),e.jsx("p",{className:"text-white dark:text-white",children:j.watch("paymentMethod")==="wallet"?"Your result checker PIN and serial number will be generated instantly and available for download.":"Your payment is processed securely through Paystack. Your result checker will be available for download after payment."})]})]}),e.jsx(p,{type:"submit",size:"lg",className:"w-full gap-2",disabled:x||!j.watch("paymentMethod")||j.watch("paymentMethod")==="wallet"&&se||!S,children:x?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 animate-spin"}),"Processing..."]}):e.jsx(e.Fragment,{children:j.watch("paymentMethod")==="wallet"?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"h-4 w-4"}),"Pay from Wallet - ",ie(E)]}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"h-4 w-4"}),"Complete Purchase - ",ie(E)]})})})]})})]})]})}function gr(){const s=new URLSearchParams(window.location.search).get("agent"),t=typeof window<"u"?Ms():null;return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(gs,{}),e.jsx("main",{className:"flex-1 py-8 px-4 pt-16",children:e.jsxs("div",{className:"container mx-auto max-w-4xl",children:[e.jsx(X,{href:t?`/store/${t}`:"/",children:e.jsxs(p,{variant:"ghost",className:"gap-2 mb-6","data-testid":"button-back",children:[e.jsx(Xt,{className:"h-4 w-4"}),"Back to Products"]})}),e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("img",{src:Wa,alt:"Result Checkers",className:"w-16 h-16 object-contain rounded-lg","data-testid":"img-result-logo"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold","data-testid":"text-page-title",children:"WAEC Result Checkers"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete your purchase in one easy flow"}),e.jsx("p",{className:"text-sm text-amber-600 font-medium",children:"âš ï¸ Please double-check your beneficiary number before completing purchase"})]})]}),e.jsx(_d,{agentSlug:s})]})}),e.jsx(zs,{})]})}const $d=[{id:"mtn",name:"MTN Data",logo:$t,href:"/products/mtn",description:"MTN Data Bundles"},{id:"telecel",name:"Telecel Data",logo:zt,href:"/products/telecel",description:"Telecel Data Bundles"},{id:"at_bigtime",name:"AT BIG TIME Data",logo:ws,href:"/products/at_bigtime",description:"AT BIG TIME Data Bundles"},{id:"at_ishare",name:"AT iShare Data",logo:ws,href:"/products/at_ishare",description:"AT iShare Data Bundles"}];function jr(){return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(gs,{}),e.jsx("main",{className:"flex-1 pt-16",children:e.jsx("section",{id:"products",className:"py-12 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-4xl space-y-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-center",children:"Select a Data Bundle"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto",children:$d.map(s=>e.jsx(X,{href:s.href,children:e.jsxs(F,{className:"p-0.5 md:p-1 hover-elevate cursor-pointer transition-all aspect-square flex flex-col items-center justify-center gap-3 dark:border-2 dark:border-white","data-testid":`card-product-${s.id}`,children:[e.jsx("img",{src:s.logo,alt:s.name,className:"w-20 h-20 md:w-24 md:h-24 object-contain rounded-lg","data-testid":`img-product-${s.id}`}),e.jsx("p",{className:"text-sm font-medium text-center text-muted-foreground",children:s.description})]})},s.id))})]})})}),e.jsx(zs,{})]})}function zd(){var x;const{user:s}=ve();fe();const[t,a]=o.useState(!1),[,i]=o.useState(!1),{data:n,isLoading:r}=ee({queryKey:["/api/user/stats"],queryFn:()=>Me("/api/user/stats",{disableAutoLogout:!0}),refetchInterval:3e4}),{data:d,isLoading:c}=ee({queryKey:["/api/transactions"],queryFn:()=>Me("/api/transactions"),refetchInterval:3e4,select:m=>m.slice(0,5)});return s?e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx(bs,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ms,{open:t,onOpenChange:a,children:[e.jsx(Vs,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(Ne,{className:"h-5 w-5"})})}),e.jsxs(es,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(js,{children:[e.jsx(xs,{children:"Navigation Menu"}),e.jsx(hs,{children:"Main navigation for your dashboard"})]}),e.jsx(bs,{onClose:()=>a(!1)})]})]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-sm sm:text-xl font-bold",children:["Welcome back, ",s.name,"!"]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Here's your account overview"})]})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 mt-4",children:[e.jsxs(F,{className:"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 border-yellow-600 shadow-xl overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-12 -translate-x-12"}),e.jsx(D,{className:"p-6 relative",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-14 h-14 bg-white/20 rounded-full shadow-lg backdrop-blur-sm",children:e.jsx("span",{className:"text-3xl animate-bounce",children:"ðŸ‘‹"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl lg:text-3xl font-bold text-white mb-1 drop-shadow-sm",children:["Welcome back, ",((x=s==null?void 0:s.name)==null?void 0:x.toUpperCase())||"USER","!"]}),e.jsx("p",{className:"text-yellow-100 text-sm lg:text-base font-medium",children:"Here's what's happening with your account today âœ¨"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-white/90",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium",children:"Live Dashboard"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-white/90",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse [animation-delay:0.5s]"}),e.jsx("span",{className:"text-xs font-medium",children:"Real-time Updates"})]})]})]})]}),e.jsxs("div",{className:"hidden lg:flex flex-col items-end gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 bg-white/10 rounded-full px-3 py-1 backdrop-blur-sm",children:e.jsx("span",{className:"text-xs text-white font-medium",children:new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})}),e.jsxs("div",{className:"flex items-center gap-1 text-white/80",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-xs",children:"All systems operational"})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Wallet Balance"}),e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:r?e.jsx(re,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(n==null?void 0:n.walletBalance)||"0.00"}`}),e.jsx(X,{href:"/user/wallet",children:e.jsx(p,{variant:"outline",size:"sm",className:"text-xs mt-3",children:"Top Up Wallet"})})]})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Total Orders"}),e.jsx(_s,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r?e.jsx(re,{className:"h-5 w-5 animate-spin"}):(n==null?void 0:n.totalOrders)||0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"All time purchases"})]})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Total Spent"}),e.jsx(Ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r?e.jsx(re,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(n==null?void 0:n.totalSpent)||0}`}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"All time spending"})]})]})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Quick Actions"}),e.jsx(te,{children:"Start purchasing data bundles"})]}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsx(X,{href:"/user/bundles/mtn",children:e.jsxs(p,{variant:"outline",className:"w-full h-auto py-4 flex-col gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"MTN Bundles"})]})}),e.jsx(X,{href:"/user/bundles/at-ishare",children:e.jsxs(p,{variant:"outline",className:"w-full h-auto py-4 flex-col gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"AT iShare"})]})}),e.jsx(X,{href:"/user/bundles/at-bigtime",children:e.jsxs(p,{variant:"outline",className:"w-full h-auto py-4 flex-col gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"AT BIG TIME"})]})}),e.jsx(X,{href:"/user/bundles/telecel",children:e.jsxs(p,{variant:"outline",className:"w-full h-auto py-4 flex-col gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"Telecel"})]})}),e.jsx(X,{href:"/user/vouchers",children:e.jsxs(p,{variant:"outline",className:"w-full h-auto py-4 flex-col gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"Vouchers"})]})}),e.jsxs(p,{variant:"outline",className:"w-full h-auto py-4 flex-col gap-2",onClick:()=>i(!0),children:[e.jsx(Cs,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"API & Integrations"})]})]})})]}),e.jsxs(F,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(G,{children:"Recent Transactions"}),e.jsx(te,{children:"Your latest 5 orders"})]}),e.jsx(X,{href:"/user/history",children:e.jsx(p,{variant:"outline",size:"sm",children:"View All"})})]})}),e.jsx(D,{children:c?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(re,{className:"h-6 w-6 animate-spin"})}):d&&d.length>0?e.jsx("div",{className:"space-y-3",children:d.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:m.productName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:m.customerPhone}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(m.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:["GHâ‚µ",m.amount]}),e.jsxs("div",{className:"flex flex-col gap-1 items-end",children:[e.jsx(Z,{variant:m.paymentStatus==="paid"?"default":m.paymentStatus==="failed"?"destructive":m.paymentStatus==="cancelled"?"outline":"secondary",className:"text-xs",children:m.paymentStatus==="paid"?"âœ“ Paid":m.paymentStatus==="failed"?"âœ— Failed":m.paymentStatus==="cancelled"?"âœ— Cancelled":m.paymentStatus||"Pending"}),e.jsx(Z,{variant:m.status==="completed"?"default":"secondary",className:"text-xs",children:m.status})]})]})]},m.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground",children:"No transactions yet"}),e.jsx(X,{href:"/user/bundles/mtn",children:e.jsx(p,{variant:"ghost",className:"mt-2",children:"Start Shopping"})})]})})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Track Your Orders"}),e.jsx(te,{children:"Check the status of your data bundle purchases"})]}),e.jsx(D,{children:e.jsx(Pt,{})})]})]})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})})}const Ba=s=>{switch(s.toLowerCase()){case"completed":case"delivered":return{variant:"default",icon:Te,color:"text-white",bgColor:"bg-emerald-600",borderColor:"border-emerald-500",label:"Completed"};case"processing":case"pending":return{variant:"secondary",icon:fs,color:"text-white",bgColor:"bg-blue-500",borderColor:"border-blue-400",label:"Processing"};case"cancelled":case"failed":return{variant:"destructive",icon:ds,color:"text-white",bgColor:"bg-red-600",borderColor:"border-red-500",label:s==="cancelled"?"Cancelled":"Failed"};default:return{variant:"secondary",icon:fs,color:"text-white",bgColor:"bg-slate-600",borderColor:"border-slate-500",label:s.charAt(0).toUpperCase()+s.slice(1)}}};function Gd(){const{user:s}=ve(),[t,a]=o.useState("overview"),[i,n]=o.useState(!1),{data:r,isLoading:d}=ee({queryKey:["/api/wallet/stats"],queryFn:()=>Me("/api/wallet/stats",{disableAutoLogout:!0}),refetchInterval:3e4}),{data:c,isLoading:x}=ee({queryKey:["/api/transactions"],queryFn:()=>Me("/api/transactions",{disableAutoLogout:!0}),refetchInterval:3e4}),m=(c==null?void 0:c.filter(g=>g.type==="wallet_topup"))||[],b=(c==null?void 0:c.filter(g=>g.paymentMethod==="wallet"))||[];return s?e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx(bs,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ms,{open:i,onOpenChange:n,children:[e.jsx(Vs,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(Ne,{className:"h-5 w-5"})})}),e.jsxs(es,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(js,{children:[e.jsx(xs,{children:"Navigation Menu"}),e.jsx(hs,{children:"Main navigation for your wallet"})]}),e.jsx(bs,{onClose:()=>n(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"My Wallet"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage your wallet balance"})]})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 mt-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ye,{className:"h-6 w-6"}),"Wallet Overview"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage your wallet balance and view transaction history"})]}),e.jsx(mn,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white border-0",children:[e.jsx($,{className:"pb-2",children:e.jsx(G,{className:"text-sm font-medium text-green-100",children:"Current Balance"})}),e.jsx(D,{children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-3xl font-bold",children:["GHâ‚µ",(r==null?void 0:r.walletBalance)||"0.00"]}),e.jsx("p",{className:"text-xs text-green-100 mt-1",children:"Available to spend"})]})})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Total Topups"}),e.jsx(Ta,{className:"h-4 w-4 text-green-600"})]}),e.jsx(D,{children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalTopups)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["GHâ‚µ",(r==null?void 0:r.totalTopupAmount)||"0.00"," total"]})]})})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Total Spent"}),e.jsx(Ma,{className:"h-4 w-4 text-red-600"})]}),e.jsx(D,{children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["GHâ‚µ",(r==null?void 0:r.totalSpent)||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Via wallet payments"})]})})]}),e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Last Topup"}),e.jsx(hi,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(D,{children:d?e.jsx(re,{className:"h-5 w-5 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["GHâ‚µ",(r==null?void 0:r.lastTopupAmount)||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r!=null&&r.lastTopupDate?new Date(r.lastTopupDate).toLocaleDateString():"No topups yet"})]})})]})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Transaction History"}),e.jsx(te,{children:"View your wallet topups and payment history"})]}),e.jsx(D,{children:e.jsxs(it,{value:t,onValueChange:a,children:[e.jsxs(Ys,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsx(De,{value:"overview",children:"Overview"}),e.jsxs(De,{value:"topups",children:["Topups (",m.length,")"]}),e.jsxs(De,{value:"payments",children:["Payments (",b.length,")"]})]}),e.jsx(Ue,{value:"overview",className:"space-y-4",children:x?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})}):c&&c.length>0?e.jsx("div",{className:"space-y-3",children:c.slice(0,10).map(g=>{const u=Ba(g.status),f=u.icon,N=g.type==="wallet_topup",l=g.paymentMethod==="wallet";return e.jsx("div",{className:`p-4 border rounded-lg ${u.bgColor} ${u.borderColor} text-white`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[N?e.jsx(Ta,{className:"h-4 w-4 text-white shrink-0"}):e.jsx(Ma,{className:"h-4 w-4 text-white shrink-0"}),e.jsx("p",{className:"font-medium text-sm break-words text-white",children:g.productName}),e.jsxs(Z,{variant:u.variant,className:"ml-auto shrink-0 bg-white text-gray-800",children:[e.jsx(f,{className:"h-3 w-3 mr-1"}),u.label]})]}),e.jsxs("div",{className:"text-xs text-gray-200 space-y-1",children:[e.jsxs("p",{children:["                                  ",N?"Topup":l?"Paid with wallet":"Paystack"," â€¢ ",new Date(g.createdAt).toLocaleDateString()]}),e.jsxs("p",{className:"text-xs font-mono break-all text-gray-300",children:["Order ID: #",g.reference]})]})]}),e.jsx("div",{className:"text-right shrink-0",children:e.jsxs("p",{className:"text-lg font-bold text-white",children:[N?"+":"-","GHâ‚µ",g.amount]})})]})},g.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ye,{className:"h-12 w-12 mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No transactions yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Top up your wallet to get started"})]})}),e.jsx(Ue,{value:"topups",children:x?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})}):m.length>0?e.jsx("div",{className:"rounded-md border",children:e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{children:"Date"}),e.jsx(U,{children:"Order ID"}),e.jsx(U,{children:"Amount"}),e.jsx(U,{children:"Status"})]})}),e.jsx(ns,{children:m.map(g=>{const u=Ba(g.status),f=u.icon;return e.jsxs(we,{children:[e.jsxs(z,{className:"font-medium",children:[new Date(g.createdAt).toLocaleDateString(),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(g.createdAt).toLocaleTimeString()})]}),e.jsxs(z,{className:"font-mono text-xs",children:["#",g.reference]}),e.jsx(z,{children:e.jsxs("span",{className:"text-green-600 font-bold",children:["+GHâ‚µ",g.amount]})}),e.jsx(z,{children:e.jsxs(Z,{variant:u.variant,children:[e.jsx(f,{className:"h-3 w-3 mr-1"}),u.label]})})]},g.id)})})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ta,{className:"h-12 w-12 mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No topups yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:'Click the "Top Up Wallet" button to add funds'})]})}),e.jsx(Ue,{value:"payments",children:x?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})}):b.length>0?e.jsx("div",{className:"rounded-md border",children:e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(we,{children:[e.jsx(U,{children:"Date"}),e.jsx(U,{children:"Product"}),e.jsx(U,{children:"Amount"}),e.jsx(U,{children:"Status"})]})}),e.jsx(ns,{children:b.map(g=>{const u=Ba(g.status),f=u.icon;return e.jsxs(we,{children:[e.jsxs(z,{className:"font-medium",children:[new Date(g.createdAt).toLocaleDateString(),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(g.createdAt).toLocaleTimeString()})]}),e.jsx(z,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:g.productName}),e.jsxs("p",{className:"text-xs text-gray-500 font-mono",children:["#",g.reference]})]})}),e.jsx(z,{children:e.jsxs("span",{className:"text-blue-600 font-bold",children:["-GHâ‚µ",g.amount]})}),e.jsx(z,{children:e.jsxs(Z,{variant:u.variant,children:[e.jsx(f,{className:"h-3 w-3 mr-1"}),u.label]})})]},g.id)})})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ge,{className:"h-12 w-12 mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No wallet payments yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Use your wallet to pay for products and see your history here"})]})})]})})]})]})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})})}const fr=s=>{const t=s.match(/(\d+(?:\.\d+)?)\s*(GB|MB)/);if(!t)return 0;const a=parseFloat(t[1]);return t[2].toUpperCase()==="MB"?a/1024:a},Ud=s=>s?[...s].sort((t,a)=>fr(t.name)-fr(a.name)):[],qd={mtn:{name:"MTN",color:"bg-yellow-400",logo:$t},at_ishare:{name:"AirtelTigo iShare",color:"bg-red-500",logo:ws},at_bigtime:{name:"AirtelTigo BIG TIME",color:"bg-red-600",logo:ws},telecel:{name:"Telecel",color:"bg-blue-500",logo:zt}};function Wd(){const[,s]=ze(),{network:t}=Qt(),{user:a}=ve(),{toast:i}=fe(),n=Hs(),[r,d]=o.useState(!1),[c,x]=o.useState(null),[m,b]=o.useState(""),[g,u]=o.useState(void 0),[f,N]=o.useState(""),[l,h]=o.useState(void 0),y=t==null?void 0:t.replace(/-/g,"_"),M=qd[y],{data:S,isLoading:k}=ee({queryKey:["/api/products/data-bundles",t],queryFn:async()=>{const j=t==null?void 0:t.replace(/-/g,"_");return await Q("GET",`/api/products/data-bundles?network=${j}`)}}),{data:C}=ee({queryKey:["/api/user/stats"],queryFn:async()=>Q("GET","/api/user/stats")}),E=o.useMemo(()=>{if(!f.trim()||!S)return null;const j=f.split(`
`).filter(A=>A.trim());let v=0,I=0;for(const A of j){const B=A.trim().split(/\s+/);if(B.length===2){const w=parseFloat(B[1]);if(!isNaN(w)&&w>0){const R=S.find(P=>{const T=P.name.toLowerCase().match(/(\d+(?:\.\d+)?)\s*gb/i);return T?parseFloat(T[1])===w:!1});R&&(v+=parseFloat(R.effective_price),I++)}}}return I>0?{total:v,count:I}:null},[f,S]),se=oe({mutationFn:async j=>j.paymentMethod==="wallet"?await Q("POST","/api/wallet/pay",j):await Q("POST","/api/checkout/initialize",j),onSuccess:(j,v)=>{if(v.paymentMethod==="wallet"){if(i({title:"âœ… Payment Successful!",description:"Redirecting to live status...",duration:3e3}),j.reference){s(`/checkout/success?reference=${j.reference}`);return}x(null),b(""),u(void 0),n.invalidateQueries({queryKey:["/api/user/stats"]}),n.invalidateQueries({queryKey:["/api/transactions"]})}else window.location.href=j.paymentUrl},onError:j=>{const v=j.message||"Unable to process payment",I=v.toLowerCase().includes("insufficient"),A=v.includes("wait")&&v.includes("minute");i({title:A?"â³ Purchase Limit":I?"âš ï¸ Insufficient Wallet Balance":"âŒ Payment Failed",description:A?v:I?"Your wallet balance is too low for this purchase. Please top up your wallet or use Paystack.":`${v}. Please try again or contact support if the problem persists.`,variant:"destructive",duration:A?8e3:6e3})}}),H=oe({mutationFn:async j=>j.paymentMethod==="wallet"?await Q("POST","/api/wallet/pay",j):await Q("POST","/api/checkout/initialize",j),onSuccess:(j,v)=>{if(v.paymentMethod==="wallet"){if(i({title:"âœ… Payment Successful!",description:"Redirecting to live status...",duration:3e3}),j.reference){s(`/checkout/success?reference=${j.reference}`);return}N(""),h(void 0),n.invalidateQueries({queryKey:["/api/user/stats"]}),n.invalidateQueries({queryKey:["/api/transactions"]})}else window.location.href=j.paymentUrl},onError:j=>{const v=j.message||"Unable to process payment",I=v.includes("wait")&&v.includes("minute"),A=v.toLowerCase().includes("insufficient");i({title:I?"â³ Purchase Limit":A?"âš ï¸ Insufficient Balance":"âŒ Payment Error",description:v,variant:"destructive",duration:I?8e3:6e3})}}),W=async()=>{if(!c||!m){i({title:"Missing Information",description:"Please select a bundle and enter a phone number",variant:"destructive"});return}const j=lt(m.trim()),v=xt(j,c.network);if(!v.isValid){const B=vs(c.network);i({title:"âŒ Phone Number Mismatch",description:v.error||`This bundle is for ${c.network.toUpperCase()} network. Valid prefixes: ${B.join(", ")}`,variant:"destructive",duration:8e3});return}const I=parseFloat(c.effective_price),A=C!=null&&C.walletBalance?parseFloat(C.walletBalance):0;if(g==="wallet"&&A<I){const B=I-A;i({title:"âš ï¸ Insufficient Wallet Balance",description:`You need GHâ‚µ${B.toFixed(2)} more. Current balance: GHâ‚µ${A.toFixed(2)}, Required: GHâ‚µ${I.toFixed(2)}. Please top up or use Paystack.`,variant:"destructive",duration:7e3});return}if(!g){i({title:"âŒ Payment Method Required",description:"Please select a payment method",variant:"destructive"});return}try{const B=await Q("GET",`/api/products/data-bundles/${c.id}`),w=parseFloat(B.effective_price),R={productType:"data_bundle",productId:c.id,customerPhone:j,amount:w.toFixed(2),isBulkOrder:!1,agentSlug:void 0,paymentMethod:g,productName:c.name,network:c.network};se.mutate(R)}catch{i({title:"Error",description:"Failed to fetch bundle details",variant:"destructive"})}},L=()=>{var w;if(!f.trim()){i({title:"Missing Information",description:"Please enter phone numbers with GB amounts",variant:"destructive"});return}if(!l){i({title:"âŒ Payment Method Required",description:"Please select a payment method",variant:"destructive"});return}if(l==="wallet"&&E&&E.total>(C!=null&&C.walletBalance?parseFloat(C.walletBalance):0)){const R=E.total-(C!=null&&C.walletBalance?parseFloat(C.walletBalance):0);i({title:"âš ï¸ Insufficient Wallet Balance",description:`You need GHâ‚µ${R.toFixed(2)} more. Current balance: GHâ‚µ${(C==null?void 0:C.walletBalance)||"0.00"}, Required: GHâ‚µ${E.total.toFixed(2)}. Please top up or use Paystack.`,variant:"destructive",duration:7e3});return}const j=f.split(`
`).filter(R=>R.trim()),v=[];for(const R of j){const P=R.trim().split(/\s+/);if(P.length!==2){i({title:"âŒ Invalid Format",description:`Line "${R}" must have format: phone_number GB_amount (e.g., "0241234567 2")`,variant:"destructive",duration:8e3});return}let q=P[0];const T=parseFloat(P[1]);if(isNaN(T)||T<=0){i({title:"âŒ Invalid GB Amount",description:`GB amount "${P[1]}" must be a positive number`,variant:"destructive",duration:8e3});return}q=q.replace(/^\+/,""),q.startsWith("233")&&(q="0"+q.substring(3));const J=lt(q),ce=xt(J);if(!ce.isValid){const ge=vs(t);i({title:"âŒ Phone Number Mismatch",description:`${q}: ${ce.error||`Must be for ${M==null?void 0:M.name} network. Valid prefixes: ${ge.join(", ")}`}`,variant:"destructive",duration:8e3});return}v.push({phone:J,gb:T})}if(v.length===0){i({title:"No Data",description:"Please enter at least one phone number with GB amount",variant:"destructive"});return}const I=[];let A=0;for(const R of v){const P=S==null?void 0:S.find(q=>{const J=(q.dataAmount||q.name).match(/(\d+(?:\.\d+)?)\s*gb/i);if(J){const ce=parseFloat(J[1]);return console.log("[DEBUG] Bundle",q.name,"has GB:",ce),ce===R.gb}return!1});if(!P){i({title:"âŒ Bundle Not Found",description:`No ${R.gb}GB bundle available for ${M==null?void 0:M.name}. Please check available bundles.`,variant:"destructive",duration:8e3});return}I.push({phone:R.phone,bundleId:P.id,bundleName:P.name,price:parseFloat(P.effective_price)}),A+=parseFloat(P.effective_price)}const B={productType:"data_bundle",productName:`Bulk Order - ${I.length} bundles`,network:t,amount:A.toFixed(2),customerPhone:(w=I[0])==null?void 0:w.phone,isBulkOrder:!0,orderItems:I,agentSlug:void 0,paymentMethod:l};H.mutate(B)};return a?e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx(bs,{})}),e.jsx(ms,{open:r,onOpenChange:d,children:e.jsxs(es,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(js,{children:[e.jsx(xs,{children:"Navigation Menu"}),e.jsx(hs,{children:"Main navigation for bundles"})]}),e.jsx(bs,{onClose:()=>d(!1)})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ms,{open:r,onOpenChange:d,children:[e.jsx(Vs,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(Ne,{className:"h-5 w-5"})})}),e.jsxs(es,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(js,{children:[e.jsx(xs,{children:"Navigation Menu"}),e.jsx(hs,{children:"Main navigation for bundles"})]}),e.jsx(bs,{onClose:()=>d(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:(M==null?void 0:M.name)||"Data Bundles"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Purchase data bundles"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Wallet Balance"}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["GHâ‚µ",(C==null?void 0:C.walletBalance)||"0.00"]})]}),e.jsx(ke,{})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx(F,{children:e.jsxs(D,{className:"flex items-center gap-4 p-4",children:[e.jsx("img",{src:M==null?void 0:M.logo,alt:M==null?void 0:M.name,className:"h-12 w-12 rounded-lg object-contain"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-lg",children:M==null?void 0:M.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose from our available data bundles"})]})]})}),e.jsxs("div",{className:"text-sm text-orange-600 flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"âš ï¸"}),e.jsx("span",{children:"Please double-check your beneficiary number before completing purchase"})]}),e.jsxs(it,{defaultValue:"single",className:"w-full",children:[e.jsxs(Ys,{className:"grid w-full grid-cols-2",children:[e.jsxs(De,{value:"single",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),"Single Purchase"]}),e.jsxs(De,{value:"bulk",disabled:t==="at_ishare",className:"data-[state=active]:bg-yellow-500 data-[state=active]:text-white",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Bulk Purchase",t==="at_ishare"&&e.jsx("span",{className:"text-xs text-muted-foreground ml-1",children:"(Disabled)"})]})]}),t==="at_ishare"&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Bulk purchases are not available for AT iShare network."}),e.jsx(Ue,{value:"single",className:"space-y-6",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Purchase Data Bundle"}),e.jsx(te,{children:"Select a bundle and enter recipient details"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Select Bundle"}),k?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(re,{className:"h-5 w-5 animate-spin"})}):e.jsxs(Fe,{value:(c==null?void 0:c.id)||"",onValueChange:j=>{const v=S==null?void 0:S.find(I=>I.id===j);x(v||null)},children:[e.jsx(Pe,{children:e.jsx(Ie,{placeholder:"Choose a data bundle"})}),e.jsx(Ce,{children:S&&S.length>0?Ud(S).map(j=>e.jsxs(K,{value:j.id,children:[j.name," - ",j.validity," - GHâ‚µ",j.basePrice]},j.id)):e.jsx(K,{value:"no-bundles",disabled:!0,children:"No bundles available"})})]})]}),c&&e.jsxs("div",{className:"p-2 bg-yellow-500 text-white rounded-lg border border-yellow-600",children:[e.jsx("p",{className:"text-sm text-white",children:"Selected Bundle"}),e.jsx("p",{className:"font-medium text-lg text-white",children:c.name}),e.jsx("p",{className:"text-sm text-white",children:c.validity}),c.description&&e.jsx("p",{className:"text-xs text-white mt-1",children:c.description}),e.jsxs("p",{className:"text-2xl font-bold text-white mt-2",children:["GHâ‚µ",c.basePrice]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"phone",children:"Beneficiary Number"}),e.jsx(Y,{id:"phone",placeholder:"0241234567",value:m,onChange:j=>b(j.target.value)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["For ",e.jsx("strong",{children:M==null?void 0:M.name})," network only. Valid prefixes: ",e.jsx("strong",{children:c?vs(c.network).join(", "):""})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(V,{className:"text-black font-semibold",children:"Payment Method"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>u(g==="wallet"?void 0:"wallet"),disabled:c?parseFloat(c.basePrice)>(C!=null&&C.walletBalance?parseFloat(C.walletBalance):0):!1,className:`w-full flex items-center justify-between rounded-lg border-2 p-4 transition-all ${g==="wallet"?"border-green-500 bg-green-500 shadow-md":"border-muted bg-white hover:border-green-500 hover:shadow-md cursor-pointer"} ${c&&parseFloat(c.basePrice)>(C!=null&&C.walletBalance?parseFloat(C.walletBalance):0)?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:`h-5 w-5 ${g==="wallet"?"text-white":"text-black"}`}),e.jsxs("div",{children:[e.jsx("div",{className:`font-medium ${g==="wallet"?"text-white":"text-black"}`,children:"Wallet Balance"}),e.jsxs("div",{className:`text-sm ${g==="wallet"?"text-white":"text-black"}`,children:["Available: GHâ‚µ",(C==null?void 0:C.walletBalance)||"0.00"]})]})]}),g==="wallet"&&e.jsx(Te,{className:"h-5 w-5 text-white"})]}),c&&parseFloat(c.basePrice)>(C!=null&&C.walletBalance?parseFloat(C.walletBalance):0)&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"text-xs bg-black text-white px-2 py-1 rounded font-semibold",children:"Insufficient"})})]}),e.jsx("div",{children:e.jsxs("button",{type:"button",onClick:()=>u(g==="paystack"?void 0:"paystack"),className:`w-full flex items-center justify-between rounded-lg border-2 p-4 transition-all ${g==="paystack"?"border-green-500 bg-green-500 shadow-md":"border-muted bg-white hover:border-green-500 hover:shadow-md cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:`h-5 w-5 ${g==="paystack"?"text-white":"text-black"}`}),e.jsxs("div",{children:[e.jsx("div",{className:`font-medium ${g==="paystack"?"text-white":"text-black"}`,children:"Pay with MoMo"}),e.jsx("div",{className:`text-sm ${g==="paystack"?"text-white":"text-black"}`,children:"Secure payment via Paystack"})]})]}),g==="paystack"&&e.jsx(Te,{className:"h-5 w-5 text-white"})]})})]})]}),c&&g==="paystack"&&(()=>{const j=parseFloat(c.basePrice),{subtotal:v,tax:I,total:A}=Bs(j);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(Le,{}),e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bundle Price"}),e.jsxs("span",{children:["GHâ‚µ",v.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:["Paystack Fee (",_e,"%)",e.jsx(He,{className:"h-3 w-3"})]}),e.jsxs("span",{className:"text-orange-600",children:["+GHâ‚µ",I.toFixed(2)]})]}),e.jsx(Le,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total to Pay"}),e.jsxs("span",{className:"text-primary",children:["GHâ‚µ",A.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-orange-100 dark:bg-orange-900 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx(He,{className:"h-4 w-4 text-orange-600 dark:text-white mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-white",children:["A ",_e,"% Paystack fee is applied to all Paystack payments."]})]})]})})(),c&&g==="wallet"&&parseFloat(c.basePrice)>(C!=null&&C.walletBalance?parseFloat(C.walletBalance):0)&&e.jsxs(Is,{variant:"default",className:"border-destructive bg-background text-destructive dark:bg-red-900/20",children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsxs(Es,{className:"text-sm",children:[e.jsx("strong",{children:"Insufficient Balance:"})," You need GHâ‚µ",(parseFloat(c.basePrice)-(C!=null&&C.walletBalance?parseFloat(C.walletBalance):0)).toFixed(2)," more.",e.jsx("a",{href:"/user/wallet",className:"underline ml-1 font-medium hover:text-destructive-foreground",children:"Top up wallet"})," or select Paystack."]})]}),e.jsx(p,{className:"w-full",size:"lg",onClick:W,disabled:!c||!m||!g||se.isPending||g==="wallet"&&c&&parseFloat(c.basePrice)>(C!=null&&C.walletBalance?parseFloat(C.walletBalance):0),children:se.isPending?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),"Purchase Bundle"]})})]})]})}),e.jsx(Ue,{value:"bulk",className:"space-y-6",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Bulk Purchase"}),e.jsxs(te,{children:["Enter phone numbers with GB amounts for ",M==null?void 0:M.name]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(V,{htmlFor:"bulk-phones",children:"Beneficiary Numbers and GB Amounts"}),f.trim()&&e.jsxs(Z,{variant:"outline",className:"text-xs",children:[f.split(`
`).filter(j=>j.trim()).length," entries"]})]}),e.jsx(Ls,{id:"bulk-phones",placeholder:`0546591622 1
0247064874 3
0245696072 2
233547897522 10
...add as many as you need (no limit)`,rows:20,value:f,onChange:j=>N(j.target.value),className:"font-mono text-sm"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:['Enter one number per line with GB amount (e.g., "0241234567 2" for 2GB). Supports formats: 0241234567 or 233241234567 (no + sign).',e.jsx("strong",{className:"text-green-600",children:"âœ“ No limit - add 100+ numbers!"}),e.jsx("br",{}),"All numbers must be for ",e.jsx("strong",{children:M==null?void 0:M.name})," network. Valid prefixes: ",e.jsx("strong",{children:y?vs(y).join(", "):""})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(V,{className:"text-black font-semibold",children:"Payment Method"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>h(l==="wallet"?void 0:"wallet"),disabled:E?E.total>(C!=null&&C.walletBalance?parseFloat(C.walletBalance):0):!1,className:`w-full flex items-center justify-between rounded-lg border-2 p-4 transition-all ${l==="wallet"?"border-green-500 bg-green-500 shadow-md":"border-muted bg-white hover:border-green-500 hover:shadow-md cursor-pointer"} ${E&&E.total>(C!=null&&C.walletBalance?parseFloat(C.walletBalance):0)?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:`h-5 w-5 ${l==="wallet"?"text-white":"text-black"}`}),e.jsxs("div",{children:[e.jsx("div",{className:`font-medium ${l==="wallet"?"text-white":"text-black"}`,children:"Wallet Balance"}),e.jsxs("div",{className:`text-sm ${l==="wallet"?"text-white":"text-black"}`,children:["Available: GHâ‚µ",(C==null?void 0:C.walletBalance)||"0.00"]})]})]}),l==="wallet"&&e.jsx(Te,{className:"h-5 w-5 text-white"})]}),E&&E.total>(C!=null&&C.walletBalance?parseFloat(C.walletBalance):0)&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"text-xs bg-black text-white px-2 py-1 rounded font-semibold",children:"Insufficient"})})]}),e.jsx("div",{children:e.jsxs("button",{type:"button",onClick:()=>h(l==="paystack"?void 0:"paystack"),className:`w-full flex items-center justify-between rounded-lg border-2 p-4 transition-all ${l==="paystack"?"border-green-500 bg-green-500 shadow-md":"border-muted bg-white hover:border-green-500 hover:shadow-md cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:`h-5 w-5 ${l==="paystack"?"text-white":"text-black"}`}),e.jsxs("div",{children:[e.jsx("div",{className:`font-medium ${l==="paystack"?"text-white":"text-black"}`,children:"Pay with MoMo"}),e.jsx("div",{className:`text-sm ${l==="paystack"?"text-white":"text-black"}`,children:"Secure payment via Paystack"})]})]}),l==="paystack"&&e.jsx(Te,{className:"h-5 w-5 text-white"})]})})]})]}),E&&l==="paystack"&&(()=>{const{subtotal:j,tax:v,total:I}=Bs(E.total);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(Le,{}),e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Total Bundle Price (",E.count," bundles)"]}),e.jsxs("span",{children:["GHâ‚µ",j.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:["Paystack Fee (",_e,"%)",e.jsx(He,{className:"h-3 w-3"})]}),e.jsxs("span",{className:"text-orange-600",children:["+GHâ‚µ",v.toFixed(2)]})]}),e.jsx(Le,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total to Pay"}),e.jsxs("span",{className:"text-primary",children:["GHâ‚µ",I.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-orange-100 dark:bg-orange-900 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx(He,{className:"h-4 w-4 text-orange-600 dark:text-white mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-white",children:["A ",_e,"% Paystack fee is applied to all Paystack payments."]})]})]})})(),e.jsx(p,{className:"w-full",size:"lg",onClick:L,disabled:!f.trim()||!l||H.isPending||l==="wallet"&&E!==null&&E.total>(C!=null&&C.walletBalance?parseFloat(C.walletBalance):0),children:H.isPending?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(kl,{className:"mr-2 h-4 w-4"}),E?`Purchase for GHâ‚µ${E.total.toFixed(2)} (${E.count} items)`:"Purchase Data Bundles"]})})]})]})})]})]})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})})}const Kd=s=>{switch(s.toLowerCase()){case"completed":case"delivered":return{variant:"default",icon:Te,color:"text-white",bgColor:"bg-emerald-600",borderColor:"border-emerald-500",label:"Completed"};case"processing":case"pending":return{variant:"secondary",icon:fs,color:"text-white",bgColor:"bg-blue-500",borderColor:"border-blue-400",label:"Processing"};case"cancelled":case"failed":return{variant:"destructive",icon:ds,color:"text-white",bgColor:"bg-red-600",borderColor:"border-red-500",label:s==="failed"?"Failed":"Cancelled"};default:return{variant:"secondary",icon:fs,color:"text-white",bgColor:"bg-slate-600",borderColor:"border-slate-500",label:s.charAt(0).toUpperCase()+s.slice(1)}}},br=s=>{const t=s.toLowerCase();return t==="success"||t==="delivered"?"completed":t==="failed"||t==="cancelled"?"failed":t==="pending"||t==="processing"?"processing":t};function Hd(){var N;const{user:s}=ve();fe();const[t,a]=o.useState(!1),[i,n]=o.useState(""),[r,d]=o.useState("all"),[c,x]=o.useState("all"),m=l=>{var h,y;try{if(!l.apiResponse)return null;const M=JSON.parse(l.apiResponse);return(h=M.skytechStatus)!=null&&h.status?M.skytechStatus.status:M.results&&((y=M.results[0])!=null&&y.status)?M.results[0].status:null}catch{return null}},{data:b,isLoading:g}=ee({queryKey:["/api/transactions"],queryFn:async()=>{const l=await Me("/api/transactions");return console.log("[User History] Fetched transactions:",l),l},refetchInterval:3e4}),u=b==null?void 0:b.filter(l=>{var se,H,W,L;const h=i.toLowerCase().replace(/^#/,""),y=h.match(/^(\d+)-(\d+)$/),M=i===""||((se=l.productName)==null?void 0:se.toLowerCase().includes(h))||((H=l.customerPhone)==null?void 0:H.includes(h))||((W=l.reference)==null?void 0:W.toLowerCase().includes(h))||((L=l.id)==null?void 0:L.toLowerCase().includes(h))||y&&l.reference===y[1]&&l.isBulkOrder,S=m(l),k=S?br(S):l.status,C=r==="all"||k===r,E=c==="all"||(l.paymentStatus||"pending")===c;return M&&C&&E}),f=((N=u==null?void 0:u.flatMap(l=>{const h=l.isBulkOrder,y=l.phoneNumbers?typeof l.phoneNumbers=="string"?(()=>{try{return JSON.parse(l.phoneNumbers)}catch{return[]}})():l.phoneNumbers:void 0;if(h&&y&&y.length>0){const M=parseFloat(l.amount)/y.length;return y.map((S,k)=>({...l,id:`${l.id}-${k}`,originalId:l.id,customerPhone:S.phone,productName:S.bundleName||l.productName,dataAmount:S.dataAmount,amount:S.price?S.price.toFixed(2):M.toFixed(2),itemStatus:S.status||l.status,isBulkOrder:!1,isExpandedBulkItem:!0,bulkOrderIndex:k+1,bulkOrderTotal:y.length,originalReference:l.reference}))}return[l]}))==null?void 0:N.filter(l=>{if(i){const y=i.toLowerCase().replace(/^#/,"").match(/^(\d+)-(\d+)$/);if(y){const[,M,S]=y;return(l.reference===M||l.originalReference===M)&&l.isExpandedBulkItem?l.bulkOrderIndex===parseInt(S):!1}}return!0}))||[];return console.log("[User History] Filtered transactions:",u==null?void 0:u.length,"out of",b==null?void 0:b.length),s?e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx(bs,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ms,{open:t,onOpenChange:a,children:[e.jsx(Vs,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(Ne,{className:"h-5 w-5"})})}),e.jsxs(es,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(js,{children:[e.jsx(xs,{children:"Navigation Menu"}),e.jsx(hs,{children:"Main navigation for order history"})]}),e.jsx(bs,{onClose:()=>a(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Order History"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View all your transactions"})]})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx(F,{children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Lt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{placeholder:"Search by product, phone, or reference...",value:i,onChange:l=>n(l.target.value),className:"pl-10"})]}),e.jsxs(Fe,{value:r,onValueChange:d,children:[e.jsxs(Pe,{className:"w-full sm:w-[180px]",children:[e.jsx(ui,{className:"h-4 w-4 mr-2"}),e.jsx(Ie,{placeholder:"Filter by status"})]}),e.jsxs(Ce,{children:[e.jsx(K,{value:"all",children:"All Status"}),e.jsx(K,{value:"completed",children:"Completed"}),e.jsx(K,{value:"processing",children:"Processing"}),e.jsx(K,{value:"failed",children:"Failed"}),e.jsx(K,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs(Fe,{value:c,onValueChange:x,children:[e.jsxs(Pe,{className:"w-full sm:w-[180px]",children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),e.jsx(Ie,{placeholder:"Payment status"})]}),e.jsxs(Ce,{children:[e.jsx(K,{value:"all",children:"All Payments"}),e.jsx(K,{value:"paid",children:"Paid"}),e.jsx(K,{value:"pending",children:"Pending"}),e.jsx(K,{value:"failed",children:"Failed"}),e.jsx(K,{value:"cancelled",children:"Cancelled"})]})]})]})})}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Transaction History"}),e.jsxs(te,{children:[(f==null?void 0:f.length)||0," order(s) found"]})]}),e.jsx(D,{children:g?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})}):f&&f.length>0?e.jsx("div",{className:"space-y-4",children:f.map(l=>{const h=l.type==="wallet_deduction",y=m(l),M=l.itemStatus||(y?br(y):l.status),S=h?{variant:"destructive",icon:ds,bgColor:"bg-red-600",borderColor:"border-red-500",label:"Complete"}:Kd(M),k=S.icon;return e.jsx("div",{className:`p-4 border rounded-lg ${S.bgColor} ${S.borderColor} text-white`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[e.jsx("p",{className:"font-medium text-sm md:text-base text-white",children:l.productName}),e.jsx(Z,{variant:l.paymentStatus==="paid"?"default":l.paymentStatus==="failed"?"destructive":l.paymentStatus==="cancelled"?"outline":"secondary",className:`flex items-center gap-1 ${l.paymentStatus==="paid"?"bg-green-600 text-white border-green-500":l.paymentStatus==="failed"?"bg-red-700 text-white border-red-600":l.paymentStatus==="cancelled"?"bg-orange-600 text-white border-orange-500":"bg-yellow-600 text-white border-yellow-500"}`,children:l.paymentStatus==="paid"?"âœ“ Paid":l.paymentStatus==="failed"?"âœ— Payment Failed":l.paymentStatus==="cancelled"?"âœ— Cancelled":"â³ Pending Payment"}),e.jsxs(Z,{variant:S.variant,className:"flex items-center gap-1 bg-white text-gray-800",children:[e.jsx(k,{className:"h-3 w-3"}),S.label]}),l.isExpandedBulkItem&&e.jsxs(Z,{variant:"secondary",className:"flex items-center gap-1 bg-purple-600 text-white border-purple-500",children:[e.jsx(Et,{className:"h-3 w-3"}),l.bulkOrderIndex," of ",l.bulkOrderTotal]})]}),e.jsxs("div",{className:"text-xs md:text-sm text-gray-200 space-y-1",children:[e.jsxs("p",{className:"text-gray-200",children:["Phone: ",l.customerPhone]}),l.network&&e.jsxs("p",{className:"text-gray-200",children:["Network: ",l.network.toUpperCase()]}),e.jsxs("p",{className:"text-xs text-gray-300",children:["Order ID: #",l.reference]}),e.jsxs("p",{className:"text-xs text-gray-300",children:[new Date(l.createdAt).toLocaleDateString()," at ",new Date(l.createdAt).toLocaleTimeString()]}),l.completedAt&&e.jsxs("p",{className:"text-green-300 text-xs",children:["Completed: ",new Date(l.completedAt).toLocaleDateString()," at ",new Date(l.completedAt).toLocaleTimeString()]}),(()=>{const C=m(l);return C?e.jsxs("p",{className:"text-blue-200 text-xs font-semibold",title:"Real-time provider status",children:["Provider Status: ",C]}):null})(),l.failureReason&&e.jsxs("p",{className:"text-red-300 text-xs",children:["Reason: ",l.failureReason]})]})]}),e.jsxs("div",{className:"text-left sm:text-right shrink-0",children:[e.jsxs("p",{className:"font-medium text-lg text-white",children:["GHâ‚µ",l.amount]}),e.jsx(Z,{variant:"outline",className:"mt-1 bg-white text-gray-800 border-white",children:l.paymentMethod==="wallet"?"Wallet":"MoMo"})]})]})},l.id)})}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No transactions found"})})})]})]})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})})}function Vd(){const[s,t]=o.useState(!1);return e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx(bs,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ms,{open:s,onOpenChange:t,children:[e.jsx(Vs,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(Ne,{className:"h-5 w-5"})})}),e.jsxs(es,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(js,{children:[e.jsx(xs,{children:"Navigation Menu"}),e.jsx(hs,{children:"Main navigation for support"})]}),e.jsx(bs,{onClose:()=>t(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Support Chat"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get help from our support team"})]})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(on,{})})})]})]})}function Yd(){ve();const[s,t]=o.useState(!1),{data:a,isLoading:i}=ee({queryKey:["result-checker-stock"],queryFn:()=>Me("/api/result-checkers/stock")}),{data:n,isLoading:r}=ee({queryKey:["user-stats"],queryFn:()=>Me("/api/user/stats")}),d=a||[];return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ms,{open:s,onOpenChange:t,children:[e.jsx(Vs,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(Ne,{className:"h-5 w-5"})})}),e.jsxs(es,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(js,{children:[e.jsx(xs,{children:"Navigation Menu"}),e.jsx(hs,{children:"Main navigation for your dashboard"})]}),e.jsx(bs,{onClose:()=>t(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Vouchers"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Purchase result checkers and vouchers"})]})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs(F,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Wallet Balance"}),e.jsx(_s,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r?e.jsx(re,{className:"h-5 w-5 animate-spin"}):`GHâ‚µ${(n==null?void 0:n.walletBalance)||0}`}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Available for purchases"}),e.jsx(X,{href:"/user/wallet",children:e.jsx(p,{variant:"outline",size:"sm",className:"text-xs mt-3",children:"Top Up Wallet"})})]})]}),e.jsxs(F,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:Wa,alt:"Result Checkers",className:"w-12 h-12 object-contain rounded-lg"}),e.jsxs("div",{children:[e.jsx(G,{children:"WAEC Result Checkers"}),e.jsx(te,{children:"Purchase WAEC result checking vouchers for different years"})]})]})}),e.jsx(D,{children:i?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(re,{className:"h-6 w-6 animate-spin"})}):d.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(c=>e.jsxs(F,{className:"relative",children:[e.jsxs($,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(G,{className:"text-lg",children:[c.type.toUpperCase()," ",c.year]}),e.jsx(Z,{variant:c.stock>0?"default":"destructive",children:c.stock>0?`${c.stock} in stock`:"Out of stock"})]}),e.jsx(te,{children:"WAEC Result Checker Voucher"})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["GHâ‚µ",c.price]}),e.jsx(X,{href:`/checkout/result_checker/${c.type}-${c.year}`,children:e.jsxs(p,{className:"w-full",disabled:c.stock===0,children:[e.jsx(It,{className:"h-4 w-4 mr-2"}),c.stock>0?"Purchase Now":"Out of Stock"]})})]})})]},`${c.type}-${c.year}`))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No result checkers available at the moment."})})]}),e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Other Vouchers"}),e.jsx(te,{children:"More voucher types coming soon"})]}),e.jsx(D,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(As,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"More voucher types will be available soon."})]})})]})]})})]})})}const Xd=ae.object({name:ae.string().min(2,"Name must be at least 2 characters"),phone:ae.string().optional()}),Qd=ae.object({currentPassword:ae.string().min(6,"Current password must be at least 6 characters"),newPassword:ae.string().min(6,"New password must be at least 6 characters"),confirmPassword:ae.string().min(6,"Please confirm your password")}).refine(s=>s.newPassword===s.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}).refine(s=>s.currentPassword!==s.newPassword,{message:"New password must be different from current password",path:["newPassword"]});function Jd(){const{user:s,refreshUser:t}=ve(),{toast:a}=fe(),[i,n]=o.useState(!1),[r,d]=o.useState(!1),[c,x]=o.useState(!1),[m,b]=o.useState(!1),g=Ss({resolver:Ps(Xd),defaultValues:{name:"",phone:""}}),u=Ss({resolver:Ps(Qd),defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}}),f=g.formState.isSubmitting,N=u.formState.isSubmitting;o.useEffect(()=>{s&&g.reset({name:s.name||"",phone:s.phone||""})},[s,g]);const l=async y=>{var M;try{await Me("PUT","/api/user/profile",{name:y.name.trim(),phone:((M=y.phone)==null?void 0:M.trim())||""}),await t(),a({title:"Profile updated successfully",description:"Your personal information has been saved."})}catch(S){a({title:"Failed to update profile",description:S.message,variant:"destructive"})}},h=async y=>{try{const{data:M,error:S}=await Fs.auth.signInWithPassword({email:(s==null?void 0:s.email)||"",password:y.currentPassword});if(S){a({title:"Current password is incorrect",description:"Please enter your current password correctly",variant:"destructive"});return}const{error:k}=await Fs.auth.updateUser({password:y.newPassword});if(k)throw k;u.reset(),a({title:"Password updated successfully",description:"Your password has been changed. Use your new password next time you log in."})}catch(M){a({title:"Failed to update password",description:M.message,variant:"destructive"})}};return s?e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"hidden md:block",children:e.jsx(bs,{})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between border-b px-6 h-16 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ms,{open:i,onOpenChange:n,children:[e.jsx(Vs,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"md:hidden",children:e.jsx(Ne,{className:"h-5 w-5"})})}),e.jsxs(es,{side:"left",className:"p-0 w-64 bg-sidebar",children:[e.jsxs(js,{children:[e.jsx(xs,{children:"Navigation Menu"}),e.jsx(hs,{children:"Main navigation for your account"})]}),e.jsx(bs,{onClose:()=>n(!1)})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage your account settings"})]})]}),e.jsx(ke,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:e.jsxs(it,{defaultValue:"profile",className:"w-full",children:[e.jsxs(Ys,{className:"grid w-full grid-cols-2",children:[e.jsxs(De,{value:"profile",className:"flex items-center gap-2",children:[e.jsx(Ht,{className:"h-4 w-4"}),"Profile"]}),e.jsxs(De,{value:"security",className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-4 w-4"}),"Security"]})]}),e.jsx(Ue,{value:"profile",className:"space-y-4",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Ht,{className:"h-5 w-5"}),"Profile Information"]}),e.jsx(te,{children:"Update your personal information"})]}),e.jsx(D,{children:e.jsx(Os,{...g,children:e.jsxs("form",{onSubmit:g.handleSubmit(l),className:"space-y-4",children:[e.jsx(ue,{control:g.control,name:"name",render:({field:y})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Full Name"}),e.jsx(xe,{children:e.jsx(Y,{placeholder:"Enter your full name",...y})}),e.jsx(Ye,{children:"This is your display name across the platform"}),e.jsx(he,{})]})}),e.jsx(ue,{control:g.control,name:"phone",render:({field:y})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Phone Number"}),e.jsx(xe,{children:e.jsx(Y,{placeholder:"Enter your phone number",...y})}),e.jsx(Ye,{children:"Your contact phone number (optional)"}),e.jsx(he,{})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"email",children:"Email Address"}),e.jsx(Y,{id:"email",type:"email",value:(s==null?void 0:s.email)||"",disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email cannot be changed"})]}),e.jsxs(p,{type:"submit",disabled:f,children:[f?e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Qs,{className:"mr-2 h-4 w-4"}),f?"Saving...":"Save Changes"]})]})})})]})}),e.jsx(Ue,{value:"security",className:"space-y-4",children:e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-5 w-5"}),"Change Password"]}),e.jsx(te,{children:"Update your account password"})]}),e.jsx(D,{children:e.jsx(Os,{...u,children:e.jsxs("form",{onSubmit:u.handleSubmit(h),className:"space-y-4",children:[e.jsx(ue,{control:u.control,name:"currentPassword",render:({field:y})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Current Password"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Y,{type:r?"text":"password",placeholder:"Enter your current password",...y}),e.jsx(p,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>d(!r),children:r?e.jsx(et,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(st,{className:"h-4 w-4 text-muted-foreground"})})]})}),e.jsx(Ye,{children:"Enter your current password to verify your identity"}),e.jsx(he,{})]})}),e.jsx(Le,{}),e.jsx(ue,{control:u.control,name:"newPassword",render:({field:y})=>e.jsxs(me,{children:[e.jsx(pe,{children:"New Password"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Y,{type:c?"text":"password",placeholder:"Enter your new password",...y}),e.jsx(p,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>x(!c),children:c?e.jsx(et,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(st,{className:"h-4 w-4 text-muted-foreground"})})]})}),e.jsx(Ye,{children:"Password must be at least 6 characters"}),e.jsx(he,{})]})}),e.jsx(ue,{control:u.control,name:"confirmPassword",render:({field:y})=>e.jsxs(me,{children:[e.jsx(pe,{children:"Confirm New Password"}),e.jsx(xe,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Y,{type:m?"text":"password",placeholder:"Confirm your new password",...y}),e.jsx(p,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>b(!m),children:m?e.jsx(et,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(st,{className:"h-4 w-4 text-muted-foreground"})})]})}),e.jsx(he,{})]})}),e.jsxs(p,{type:"submit",disabled:N,children:[N?e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ys,{className:"mr-2 h-4 w-4"}),N?"Updating...":"Change Password"]})]})})})]})})]})})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})})}function Zd(){return e.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gray-50",children:e.jsx(F,{className:"w-full max-w-md mx-4",children:e.jsxs(D,{className:"pt-6",children:[e.jsxs("div",{className:"flex mb-4 gap-2",children:[e.jsx(ks,{className:"h-8 w-8 text-red-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"404 Page Not Found"})]}),e.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Did you forget to add the page to the router?"})]})})})}const Oa=[en,sn,tn];function eo(){const{role:s,slug:t}=Qt(),[,a]=ze(),[i,n]=o.useState(0);o.useEffect(()=>{const b=setInterval(()=>{n(g=>(g+1)%Oa.length)},5e3);return()=>clearInterval(b)},[]),o.useEffect(()=>{t&&localStorage.setItem("agentStore",t)},[t]);const r=b=>{a(`/store/${s}/${t}/${b}`)},{data:d,isLoading:c,error:x}=ee({queryKey:[`/api/store/${s}/${t}`],enabled:!!s&&!!t,refetchInterval:3e4,refetchOnWindowFocus:!0});if(c)return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx("header",{className:"border-b border-border bg-card text-card-foreground",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between h-16 px-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold",children:"Loading..."})]}),e.jsx(ke,{})]})}),e.jsx("main",{className:"flex-1",children:e.jsx(Ua,{text:"Loading store..."})})]});if(x||!d)return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx("header",{className:"border-b bg-background",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between h-16 px-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold text-foreground",children:"Store Not Found"})]}),e.jsx(ke,{})]})}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4",children:e.jsx(F,{className:"max-w-md w-full",children:e.jsxs(D,{className:"pt-6 text-center",children:[e.jsx(ot,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Store Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"This store doesn't exist or is not available."})]})})})]});const{store:m}=d;return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx("header",{className:"border-b sticky top-0 z-50 bg-background shadow-sm",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between h-16 px-4",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsx("h1",{className:"font-semibold text-lg text-foreground",children:m.businessName}),m.businessDescription&&e.jsx("p",{className:"text-sm text-muted-foreground",children:m.businessDescription})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>{var b;(b=document.getElementById("track-orders"))==null||b.scrollIntoView({behavior:"smooth"})},children:[e.jsx(Lt,{className:"h-4 w-4 mr-2"}),"Track Orders"]}),e.jsx(ke,{})]})]})}),e.jsxs("main",{className:"flex-1",children:[e.jsx("section",{className:"relative","data-testid":"banner-carousel",children:e.jsxs("div",{className:"relative h-[300px] md:h-[400px]",children:[Oa.map((b,g)=>e.jsx("img",{src:b,alt:`Banner ${g+1}`,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ${g===i?"opacity-100":"opacity-0"}`,"data-testid":`img-banner-${g+1}`},g)),e.jsx("div",{className:"absolute inset-0 bg-black/50"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"container mx-auto max-w-6xl text-center px-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl font-extrabold text-center hero-title-text",children:[e.jsx("span",{className:"font-extrabold text-white block",children:m.businessDescription||"Welcome to our store."}),e.jsx("span",{className:"text-blue-400 font-extrabold block",children:"Browse our selection of data bundles."})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-base sm:text-lg",children:[e.jsx(dt,{className:"h-5 w-5 text-blue-400"}),e.jsxs("span",{className:"font-semibold text-white/90 hero-title-text",children:["Secure payments powered by ",e.jsx("span",{className:"text-blue-400",children:"Paystack"})]})]})]}),(m.whatsappSupportLink||m.whatsappChannelLink)&&e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-6",children:[m.whatsappSupportLink&&e.jsxs("a",{href:m.whatsappSupportLink,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors",children:[e.jsx(tt,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"WhatsApp Support"})]}),m.whatsappChannelLink&&e.jsxs("a",{href:m.whatsappChannelLink,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors",children:[e.jsx(tt,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"WhatsApp Channel"})]})]})]})}),e.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2",children:Oa.map((b,g)=>e.jsx("button",{onClick:()=>n(g),className:`w-3 h-3 rounded-full transition-colors ${g===i?"bg-primary":"bg-muted"}`,"aria-label":`Go to banner ${g+1}`,"data-testid":`button-banner-dot-${g+1}`},g))})]})}),e.jsx("section",{className:"py-12 px-4 bg-background",children:e.jsxs("div",{className:"container mx-auto max-w-4xl",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-8",children:"Browse Our Products"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs(F,{className:"p-4 hover-elevate cursor-pointer transition-all aspect-square flex flex-col items-center justify-center gap-3 border border-border",onClick:()=>r("mtn"),children:[e.jsx("img",{src:$t,alt:"MTN Data Bundles",className:"w-16 h-16 md:w-20 md:h-20 object-contain rounded-lg"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold",children:"MTN Data Bundles"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Buy MTN data bundles."})]})]}),e.jsxs(F,{className:"p-4 hover-elevate cursor-pointer transition-all aspect-square flex flex-col items-center justify-center gap-3 border border-border",onClick:()=>r("telecel"),children:[e.jsx("img",{src:zt,alt:"Telecel Data Bundles",className:"w-16 h-16 md:w-20 md:h-20 object-contain rounded-lg"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Telecel Data Bundles"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Buy Telecel data bundles."})]})]}),e.jsxs(F,{className:"p-4 hover-elevate cursor-pointer transition-all aspect-square flex flex-col items-center justify-center gap-3 border border-border",onClick:()=>r("at_bigtime"),children:[e.jsx("img",{src:ws,alt:"AT BIG TIME Bundles",className:"w-16 h-16 md:w-20 md:h-20 object-contain rounded-lg"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold",children:"AT BIG TIME Bundles"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Buy AT BIG TIME data bundles."})]})]}),e.jsxs(F,{className:"p-4 hover-elevate cursor-pointer transition-all aspect-square flex flex-col items-center justify-center gap-3 border border-border",onClick:()=>r("at_ishare"),children:[e.jsx("img",{src:ws,alt:"AT iShare Bundles",className:"w-16 h-16 md:w-20 md:h-20 object-contain rounded-lg"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold",children:"AT iShare Bundles"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Buy AT iShare data bundles."})]})]})]})]})}),e.jsx("section",{id:"track-orders",className:"py-12 px-4 bg-muted border-y",children:e.jsxs("div",{className:"container mx-auto max-w-4xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold mb-2 text-foreground",children:"Track Orders"}),e.jsx("h3",{className:"text-xl text-foreground mb-4",children:"Never Lose Track"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Easily track your data bundle and result checker orders using your transaction ID or beneficiary phone number."})]}),e.jsx(Pt,{})]})})]}),e.jsx("footer",{className:"border-t py-8 px-4 bg-muted",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Â© ",new Date().getFullYear()," ",m.businessName,". All rights reserved."]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2 text-xs text-muted-foreground",children:[e.jsx(dt,{className:"h-3 w-3"}),e.jsx("span",{children:"Secure payments â€¢ Fast delivery â€¢ 24/7 support"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Developed by ",e.jsx("a",{href:"https://bm-portfolio-up2x.onrender.com",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"BlusMotif"})]})]})})})]})}function so({children:s}){const[t,a]=ze(),i=o.useRef(!1);return o.useEffect(()=>{if(i.current)return;i.current=!0;const n=Ms(),d=["/store/","/products/","/checkout","/wallet/topup/success","/login","/register","/agent/register","/agent/activation-complete","/agent/upgrade"].some(c=>t.startsWith(c));if(n){if(t==="/"){console.log("Redirecting from root to agent store:",n),a(`/store/agent/${n}`,{replace:!0});return}!d&&!t.startsWith(`/store/agent/${n}`)&&(console.log("Redirecting non-allowed path to agent store:",t,n),a(`/store/agent/${n}`,{replace:!0}))}},[]),e.jsx(e.Fragment,{children:s})}function to(){return e.jsxs(gi,{children:[e.jsx(ao,{}),e.jsx(so,{children:e.jsxs(ji,{children:[e.jsx(Je,{path:"/",component:nc}),e.jsx(Je,{path:"/data-bundles",component:jr}),e.jsx(Je,{path:"/products",component:jr}),e.jsx(Je,{path:"/products/result-checkers",component:gr}),e.jsx(Je,{path:"/products/waec-result-checker",component:gr}),e.jsx(Je,{path:"/products/:network",component:Dd}),e.jsx(Je,{path:"/login",component:dc}),e.jsx(Je,{path:"/register",component:mc}),e.jsx(Je,{path:"/rankings",component:Id}),e.jsx(Je,{path:"/checkout/:productType/:productId/:year?",component:yc}),e.jsx(Je,{path:"/checkout/success",component:wc}),e.jsx(Je,{path:"/wallet/topup/success",component:Pc}),e.jsx(Je,{path:"/agent/register",component:Fc}),e.jsx(Je,{path:"/agent/upgrade",component:Ec}),e.jsx(Je,{path:"/agent/activation-complete",component:Ic}),e.jsx(je,{path:"/user/dashboard",component:zd}),e.jsx(je,{path:"/user/wallet",component:Gd}),e.jsx(je,{path:"/user/bundles/:network",component:Wd}),e.jsx(je,{path:"/user/settings",component:Jd}),e.jsx(je,{path:"/user/vouchers",component:Yd}),e.jsx(je,{path:"/user/history",component:Hd}),e.jsx(je,{path:"/user/support",component:Vd}),e.jsx(je,{path:"/dealer/dashboard",component:Rc,requiredRole:"dealer"}),e.jsx(je,{path:"/super-dealer/dashboard",component:Dc,requiredRole:"super_dealer"}),e.jsx(je,{path:"/master/dashboard",component:Mc,requiredRole:"master"}),e.jsx(je,{path:"/agent/dashboard",component:Oc,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(je,{path:"/agent/transactions",component:$c,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(je,{path:"/agent/withdrawals",component:Gc,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(je,{path:"/agent/storefront",component:qc,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(je,{path:"/agent/settings",component:Hc,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(je,{path:"/agent/support",component:Vc,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(je,{path:"/agent/bundles/:network",component:Qc,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(je,{path:"/agent/wallet",component:ed,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(je,{path:"/agent/pricing",component:sd,requiredRoles:["agent","dealer","super_dealer","master"]}),e.jsx(je,{path:"/dashboard/api-integrations",component:dd,requiredRoles:["user","agent","dealer","super_dealer","master","admin"]}),e.jsx(je,{path:"/dashboard/api-documentation",component:od,requiredRoles:["user","agent","dealer","super_dealer","master","admin"]}),e.jsx(je,{path:"/dealer/pricing",component:td,requiredRole:"dealer"}),e.jsx(je,{path:"/super-dealer/pricing",component:ad,requiredRole:"super_dealer"}),e.jsx(je,{path:"/master/pricing",component:rd,requiredRole:"master"}),e.jsx(je,{path:"/admin",component:md,requiredRole:"admin"}),e.jsx(je,{path:"/admin/rankings",component:Sd,requiredRole:"admin"}),e.jsx(je,{path:"/admin/data-bundles",component:xd,requiredRole:"admin"}),e.jsx(je,{path:"/admin/role-base-prices",component:hd,requiredRole:"admin"}),e.jsx(je,{path:"/admin/result-checkers",component:ud,requiredRole:"admin"}),e.jsx(je,{path:"/admin/transactions",component:jd,requiredRole:"admin"}),e.jsx(je,{path:"/admin/users",component:fd,requiredRole:"admin"}),e.jsx(je,{path:"/admin/agents",component:Nd,requiredRole:"admin"}),e.jsx(je,{path:"/admin/withdrawals",component:vd,requiredRole:"admin"}),e.jsx(je,{path:"/admin/manual-topup",component:Fd,requiredRole:"admin"}),e.jsx(je,{path:"/admin/chat-support",component:yd,requiredRole:"admin"}),e.jsx(je,{path:"/admin/announcements",component:Ad,requiredRole:"admin"}),e.jsx(je,{path:"/admin/guides",component:Td,requiredRole:"admin"}),e.jsx(je,{path:"/admin/break-settings",component:Pd,requiredRole:"admin"}),e.jsx(je,{path:"/admin/external-api-providers",component:Cd,requiredRole:"admin"}),e.jsx(je,{path:"/admin/settings",component:kd,requiredRole:"admin"}),e.jsx(Je,{path:"/store/:role/:slug",component:eo}),e.jsx(Je,{path:"/store/:role/:slug/:network",component:Rd}),e.jsx(Je,{component:Zd})]})})]})}function ao(){return ze(),zi(),null}function ro(){const[s]=ze();return s==="/"||s.startsWith("/agent")||s.startsWith("/admin")?e.jsx(Ki,{}):null}function lo(){return e.jsx(_i,{children:e.jsx(pi,{client:be,children:e.jsx(Ri,{children:e.jsxs(Ei,{children:[e.jsx($i,{}),e.jsx(Di,{}),e.jsx(Gi,{children:e.jsx(to,{})}),e.jsx(ro,{}),e.jsx(Ii,{})]})})})})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(s=>{console.log("Service Worker registered successfully:",s.scope)}).catch(s=>{console.log("Service Worker registration failed:",s)})});const Nr=document.getElementById("root");Nr&&fi(Nr).render(e.jsx(lo,{}));
//# sourceMappingURL=index.SIF9sbD5.js.map
